{"version":3,"sources":["webpack:///popbyage.min.js","webpack:///webpack/bootstrap 2eeb54993b9ff0d9119c?d08a","webpack:///./src/index.js?9552","webpack:///./src/component.js?a623","webpack:///./src/template.html?60fe"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","_component","_component2","obj","default","VERSION_INFO","version","build","PopByAge","Vizabi","Tool","extend","init","placeholder","external_model","this","components","component","model","Component","_super","validate","entities","state","dimAllPossible","entities_allpossible","dim","keys","show","length","entities_geodomain","skipFilter","entities_side","Boolean","getFilteredEntities","default_model","marker_tags","ui","chart","mode","stacked","inpercent","flipSides","lockActive","lockNonSelected","buttons","dialogs","popup","sidebar","moreoptions","presentation","locale","versionInfo","_toConsumableArray","arr","Array","isArray","arr2","from","_Vizabi","utils","_Vizabi$helpers","helpers","axisSmart","DynamicBackground","TextEllipsis","iconQuestion","iconset","question","config","context","template","model_expects","type","_this","model_binds","change:time.startSelected","evt","_readyOnce","time","set","startSelected","Date","timeSteps","change:time.endSelected","endSelected","change:time.value","step","snapped","playing","dragging","snapTime","snap","updateStartEnd","groupBy","ready","next","d3","bisectLeft","prev","filter","t","marker","getFrame","frame","frameAxisX","axis_x","_updateEntities","updateBarsOpacity","nextIndex","prevFrameTime","nextFrameTime","fraction","nValues","pValues","interpolateDiagonal","change:marker.select","someSelected","select","nonSelectedOpacityZero","change:marker.highlight","path","_highlightBars","change:marker.opacitySelectDim","change:marker.opacityRegular","change:marker.color.palette","change:marker.color.scaleType","change:marker.color.which","stackDim","entitiesProps","color","use","colorConcept","getConceptprops","concept_type","domain","sideConcept","side","which","setWhich","concept","STACKDIM","skipFilterSide","SIDEDIM","geoDomainDimension","sideShow","marker_allpossible","change:marker.side.which","sideDim","entitiesSideProps","clearSideState","clearShow","change:entities.show","isEmpty","showEntities","isShown","showEntity","change:entities_side.show","doReturn","_entitiesSameDimWithSide","forEach","_space","h","_name","_updateIndicators","_updateSideTitles","_ready","smallMultiples","stackKeys","stackKey","_updateLimits","resize","_redrawLocked","change:entities_age.grouping","entities_age","grouping","getAllSteps","labels","text","change:ui.chart.inpercent","change:ui.chart.flipSides","switchSideState","change:ui.chart.lockNonSelected","lock","stackSkip","yearLocked","_makeOutlines","total","lockedPaths","ready:marker","textEllipsis","xScale","yScale","cScale","xAxis","xAxisLeft","yAxis","xScales","SHIFTEDAGEDIM","domReady","graphTemplate","XMLSerializer","serializeToString","element","node","timeModel","timeYear","formatDate","startYear","start","offset","getTimeOffset","checkDimensions","colorUseConstant","geoLess","sideSkip","readyOnce","el","setTooltip","interaction","_interaction","getDimension","geoDomainDefaultValue","xTitleEl","xInfoEl","yearEl","year","setText","on","_attributeUpdaters","_newWidth","width","AGEDIM","ageShift","PREFIXEDSIDEDIM","PREFIXEDSTACKDIM","width_","_newX","prevSbl","previousSibling","prevSblDatum","datum","x_","shiftScale","scaleLinear","range","domains","TIMEDIM","updateUIStrings","_updateGraphs","frameAllColor","frames","maxLimits","inpercentMaxLimits","totals","_createLimits","_getLimits","apFrame","data","graph","selectAll","exit","remove","enter","append","ownerDocument","importNode","DOMParser","parseFromString","documentElement","raise","yAxisEl","xAxisEl","xAxisLeftEl","yTitleEl","title","titleRight","titleCenter","barsCrop","lockedCrop","labelsCrop","bars","_this2","parse","lockFrame","lockTime","_interpolateBetweenTotals","dataBetweenFrames","val1","val2","shiftedAge","ageKeys","age","sideKeys","stack","translator","getTFunction","conceptPropsX","setIcon","attr","style","Number","description","sourceLink","parent","findChildByName","pin","rect","getBBox","coord","makeAbsoluteContext","farthestViewportElement","x","y","height","toolRect","root","getBoundingClientRect","chartRect","setHook","setPos","left","hide","_this3","duration","delayAnimations","axis_y","getScale","tickFormat","getTickFormatter","ageDim","ages","getKeys","map","shiftedAgeKeys","slice","reverse","concat","sideItems","label_side","getItems","sideFiltered","getEntity","f","sortFunc","ascending","descending","sort","push","stacks","sortedStackKeys","getPalette","reduce","val","indexOf","stackItems","label_stack","twoSided","xScaleLeft","copy","markers","classed","clear","each","sideKeysNF","getNestedItems","geoDefault","ageSum","sideMaxLimits","stackSum","maxSideLimit","Math","max","apply","axisX","domainMin","domainMax","domainScalers","_calcDomainScalers","sumDomains","a","b","nextStep","reorder","_this4","prefixedSideDim","prefixedStackDim","shiftedAgeDim","ageData","outAge","barsData","ageBars","oneBarHeight","barHeight","firstBarOffsetY","merge","sideBars","r","activeProfile","centerWidth","stackBars","highlighted","mouseover","mouseout","click","onTap","tap","order","stepShift","transition","ease","easeLinear","interrupt","entityLabels","yearOlds","parseInt","nextAge","_this5","KEYS","unique","_getAllDimensions","exceptType","key","line","curve","curveStepBefore","pathsData","_i","stackIndex","j","getValueMD","getColorShade","colorID","shadeID","paths","_setYear","timeValue","formattedTime","isTouchDevice","highlightMarker","_showLabel","clearHighlighted","selectMarker","event","stopPropagation","someHighlighted","highlight","formatter","format","deltaX","target","labelNode","nodes","labelEl","textData","invert","bbox","transform","getScreenCTM","inverse","multiply","overDrawLeft","e","overDrawRight","min","fullWidth","getGraphWidth","marginBetween","_width","scaler","getYAxisVisibility","index","presentationProfileChanges","medium","margin","top","right","bottom","between","infoElHeight","large","profiles","small","titlesSpacing","_this6","getActiveProfile","deltaMarginTop","graphWidth","warn","_sum","_prevSum","graphWidthSum","round","yScaleCopy","ticks","scale","tickSizeInner","tickSizeOuter","tickPadding","tickSizeMinor","labelerOptions","scaleType","toolMargin","limitMaxTickNumber","fitIntoScale","isPivotAuto","maxRange","translateX","zeroTickEl","tickCount","size","zeroTickBBox","tickNodes","isRTL","titleSpace","wrap","titleBBox","hTranslate","translateY","yearLabelOptions","topOffset","getLayoutProfile","rightOffset","xAlign","yAlign","heightRatio","setConditions","OPACITY_HIGHLT_DIM","opacityHighlightDim","OPACITY_REGULAR","opacityRegular","OPACITY_SELECT_DIM","opacitySelectDim","nonSelectedOpacityZeroFlag","isSelected","isHighlighted","bar"],"mappings":"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","file":"popbyage.min.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 4);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\n__webpack_require__(2);\n\nvar _component = __webpack_require__(1);\n\nvar _component2 = _interopRequireDefault(_component);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar VERSION_INFO = { version: \"1.2.6\", build: 1511447038254 };\n\n//BAR CHART TOOL\nvar PopByAge = Vizabi.Tool.extend(\"PopByAge\", {\n\n  /**\n   * Initializes the tool (Bar Chart Tool).\n   * Executed once before any template is rendered.\n   * @param {Object} placeholder Placeholder element for the tool\n   * @param {Object} external_model Model as given by the external page\n   */\n  init: function init(placeholder, external_model) {\n\n    this.name = \"popbyage\";\n\n    //specifying components\n    this.components = [{\n      component: _component2.default,\n      placeholder: \".vzb-tool-viz\",\n      model: [\"state.time\", \"state.marker\", \"state.marker_allpossible\", \"state.entities\", \"state.entities_side\", \"state.entities_age\", \"state.entities_allpossible\", \"state.entities_geodomain\", \"locale\", \"ui\"] //pass models to component\n    }, {\n      component: Vizabi.Component.get(\"timeslider\"),\n      placeholder: \".vzb-tool-timeslider\",\n      model: [\"state.time\", \"state.entities\", \"state.marker\", \"ui\"]\n    }, {\n      component: Vizabi.Component.get(\"dialogs\"),\n      placeholder: \".vzb-tool-dialogs\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"buttonlist\"),\n      placeholder: \".vzb-tool-buttonlist\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"treemenu\"),\n      placeholder: \".vzb-tool-treemenu\",\n      model: [\"state.marker\", \"state.marker_tags\", \"state.time\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datanotes\"),\n      placeholder: \".vzb-tool-datanotes\",\n      model: [\"state.marker\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"steppedspeedslider\"),\n      placeholder: \".vzb-tool-stepped-speed-slider\",\n      model: [\"state.time\", \"locale\"]\n    }];\n\n    //constructor is the same as any tool\n    this._super(placeholder, external_model);\n  },\n  validate: function validate(model) {\n    model = this.model || model;\n\n    this._super(model);\n\n    //validate on first model set only\n    if (!this.model) {\n      var entities = model.state.entities;\n      var dimAllPossible = model.state.entities_allpossible.dim;\n      if (Object.keys(entities.show).length > 0) {\n        var show = {};\n        if (entities.show[entities.dim] && entities.show[entities.dim][\"$in\"]) {\n          show[entities.dim] = {};\n          show[entities.dim][\"$in\"] = entities.show[entities.dim][\"$in\"];\n        }\n        if (entities.dim !== dimAllPossible) {\n          show[\"is--\" + dimAllPossible] = true;\n        }\n        if (!entities.show[entities.dim] || !(Object.keys(entities.show).length == 1)) {\n          entities.show = show;\n        }\n      }\n\n      var entities_geodomain = model.state.entities_geodomain;\n      entities_geodomain.skipFilter = (model.state.entities.dim === entities_geodomain.dim || model.state.entities_side.dim === entities_geodomain.dim) && (Boolean(model.state.entities.getFilteredEntities().length) || !model.state.entities_side.skipFilter);\n    }\n  },\n\n\n  default_model: {\n    state: {\n      marker_tags: {}\n    },\n    ui: {\n      chart: {\n        mode: \"smallMultiples\",\n        stacked: true,\n        inpercent: false,\n        flipSides: true,\n        lockActive: true,\n        lockNonSelected: 0\n      },\n      \"buttons\": [\"colors\", \"show\", \"lock\", \"side\", \"inpercent\", \"moreoptions\", \"fullscreen\"],\n      \"dialogs\": {\n        \"popup\": [\"timedisplay\", \"colors\", \"show\", \"side\", \"moreoptions\"],\n        \"sidebar\": [\"timedisplay\", \"colors\", \"grouping\", \"show\"],\n        \"moreoptions\": [\"opacity\", \"speed\", \"grouping\", \"colors\", \"side\", \"presentation\", \"about\"]\n      },\n      presentation: false\n    },\n    locale: {}\n  },\n\n  versionInfo: VERSION_INFO\n});\n\nexports.default = PopByAge;\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nvar _Vizabi = Vizabi,\n    utils = _Vizabi.utils,\n    Component = _Vizabi.Component,\n    _Vizabi$helpers = _Vizabi.helpers,\n    axisSmart = _Vizabi$helpers[\"d3.axisWithLabelPicker\"],\n    DynamicBackground = _Vizabi$helpers[\"d3.dynamicBackground\"],\n    TextEllipsis = _Vizabi$helpers[\"textEllipsis\"],\n    iconQuestion = _Vizabi.iconset.question;\n\n// POP BY AGE CHART COMPONENT\n\nvar PopByAge = Component.extend(\"popbyage\", {\n\n  /**\n   * Initializes the component (Bar Chart).\n   * Executed once before any template is rendered.\n   * @param {Object} config The config passed to the component\n   * @param {Object} context The component's parent\n   */\n  init: function init(config, context) {\n    this.name = \"popbyage\";\n    this.template = __webpack_require__(3);\n\n    //define expected models for this component\n    this.model_expects = [{\n      name: \"time\",\n      type: \"time\"\n    }, {\n      name: \"marker\",\n      type: \"marker\"\n    }, {\n      name: \"marker_allpossible\",\n      type: \"marker\"\n    }, {\n      name: \"entities\",\n      type: \"entities\"\n    }, {\n      name: \"entities_side\",\n      type: \"entities\"\n    }, {\n      name: \"entities_age\",\n      type: \"entities\"\n    }, {\n      name: \"entities_allpossible\",\n      type: \"entities\"\n    }, {\n      name: \"entities_geodomain\",\n      type: \"entities\"\n    }, {\n      name: \"locale\",\n      type: \"locale\"\n    }, {\n      name: \"ui\",\n      type: \"ui\"\n    }];\n\n    var _this = this;\n    this.model_binds = {\n      \"change:time.startSelected\": function changeTimeStartSelected(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.time.set({\n          startSelected: new Date(_this.timeSteps[0])\n        }, false, false);\n      },\n      \"change:time.endSelected\": function changeTimeEndSelected(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.time.set({\n          endSelected: new Date(_this.timeSteps[_this.timeSteps.length - 1])\n        }, false, false);\n      },\n      \"change:time.value\": function changeTimeValue(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.time.step != 1 && !_this.snapped && !_this.model.time.playing && !_this.model.time.dragging) {\n          if (_this.snapTime) {\n            if (+_this.snapTime - _this.model.time.value === 0) {\n              _this.snapTime = null;\n              _this.model.time.snap();\n            } else {\n              _this.model.time.value = new Date(_this.snapTime);\n            }\n            return;\n          }\n          if (_this.updateStartEnd(_this.model.time.value, _this.groupBy)) {\n            _this.ready();\n            return;\n          };\n          var next = d3.bisectLeft(_this.timeSteps, _this.model.time.value);\n          if (next != 0 && _this.timeSteps[next] - _this.model.time.value) {\n            _this.snapped = true;\n            var time = _this.model.time.value;\n            var prev = _this.timeSteps[next - 1];\n            next = _this.timeSteps[next];\n            var snapTime = time - prev < next - time ? prev : next;\n            _this.model.time.value = new Date(snapTime);\n          }\n        }\n        if (!_this.snapped) {\n          if (_this.timeSteps.filter(function (t) {\n            return t - _this.model.time.value == 0;\n          }).length) {\n            _this.model.marker.getFrame(_this.model.time.value, function (frame) {\n              if (!frame) return;\n              _this.frame = frame;\n              _this.frameAxisX = frame.axis_x;\n              _this._updateEntities();\n              _this.updateBarsOpacity();\n            });\n          } else if (_this.model.time.value < _this.model.time.startSelected || _this.model.time.value > _this.model.time.endSelected) {\n            _this.snapTime = _this.model.time.value;\n          } else {\n            _this.snapTime = null;\n            var nextIndex = d3.bisectLeft(_this.timeSteps, _this.model.time.value);\n            var prevFrameTime = _this.timeSteps[nextIndex - 1];\n            var nextFrameTime = _this.timeSteps[nextIndex];\n            var fraction = (_this.model.time.value - prevFrameTime) / (nextFrameTime - prevFrameTime);\n            _this.model.marker.getFrame(nextFrameTime, function (nValues) {\n              _this.model.marker.getFrame(prevFrameTime, function (pValues) {\n                _this.frameAxisX = _this.interpolateDiagonal(pValues.axis_x, nValues.axis_x, fraction);\n                _this._updateEntities();\n                _this.updateBarsOpacity();\n              });\n            });\n          }\n        }\n        _this.snapped = false;\n      },\n      \"change:marker.select\": function changeMarkerSelect(evt) {\n        _this.someSelected = _this.model.marker.select.length > 0;\n        _this.nonSelectedOpacityZero = false;\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.highlight\": function changeMarkerHighlight(evt, path) {\n        if (!_this._readyOnce) return;\n        _this._highlightBars();\n      },\n      \"change:marker.opacitySelectDim\": function changeMarkerOpacitySelectDim() {\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.opacityRegular\": function changeMarkerOpacityRegular() {\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.color.palette\": function changeMarkerColorPalette(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateEntities(true);\n      },\n      \"change:marker.color.scaleType\": function changeMarkerColorScaleType(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateEntities();\n      },\n      \"change:marker.color.which\": function changeMarkerColorWhich(evt) {\n        if (!_this._readyOnce) return;\n        var stackDim = void 0;\n        var show = {};\n        var entitiesProps = {};\n        if (_this.model.marker.color.use == \"constant\") {\n          stackDim = null;\n        } else {\n          var colorConcept = _this.model.marker.color.getConceptprops();\n          if (colorConcept.concept_type == \"entity_set\") {\n            stackDim = colorConcept.domain;\n            //show[\"is--\" + _this.model.marker.color.which] = true;\n            show[stackDim] = {};\n            var sideConcept = _this.model.marker.side.getConceptprops();\n            if (sideConcept.concept_type == \"entity_set\" && stackDim == sideConcept.domain && _this.model.marker.side.which !== _this.model.marker.color.which) {\n              _this.model.marker.side.setWhich({ \"concept\": _this.model.marker.color.which });\n            }\n          } else {\n            stackDim = _this.model.marker.color.which;\n          }\n        }\n        if (_this.STACKDIM !== stackDim) {\n          entitiesProps[\"show\"] = show;\n        }\n        entitiesProps[\"dim\"] = stackDim;\n        var skipFilterSide = _this.SIDEDIM !== _this.geoDomainDimension || _this.model.marker.color.which === _this.model.marker.side.which;\n        if (!skipFilterSide) {\n          var sideShow = {};\n          sideShow[\"is--\" + _this.model.marker.side.which] = true;\n          _this.model.entities_side.set(\"show\", sideShow);\n        }\n        _this.model.entities_side.skipFilter = skipFilterSide;\n        _this.model.entities.set(entitiesProps);\n        _this.model.entities_geodomain.skipFilter = (stackDim === _this.geoDomainDimension || _this.SIDEDIM === _this.geoDomainDimension) && (Boolean(_this.model.entities.getFilteredEntities().length) || !_this.model.entities_side.skipFilter);\n        _this.model.entities_allpossible.set(\"dim\", stackDim);\n        _this.model.marker_allpossible.color.set(\"which\", _this.model.marker.color.which);\n      },\n      \"change:marker.side.which\": function changeMarkerSideWhich(evt) {\n        if (!_this._readyOnce) return;\n        var sideDim = void 0;\n        var show = {};\n        var entitiesSideProps = {};\n        if (_this.model.marker.side.use == \"constant\") {\n          sideDim = null;\n        } else {\n          var sideConcept = _this.model.marker.side.getConceptprops();\n          if (sideConcept.concept_type == \"entity_set\") {\n            sideDim = sideConcept.domain;\n            var colorConcept = _this.model.marker.color.getConceptprops();\n            if (colorConcept.concept_type == \"entity_set\" && sideDim == colorConcept.domain && _this.model.marker.color.which !== _this.model.marker.side.which) {\n              _this.model.marker.color.setWhich({ \"concept\": _this.model.marker.side.which });\n            }\n          } else {\n            sideDim = _this.model.marker.side.which;\n          }\n        }\n        //        const sideDim = _this.model.marker.side.use == \"constant\" ? null : _this.model.marker.side.which;\n        _this.model.marker.side.clearSideState();\n        var skipFilterSide = sideDim !== _this.geoDomainDimension || _this.model.marker.color.which === _this.model.marker.side.which;\n        if (!skipFilterSide) {\n          show[\"is--\" + _this.model.marker.side.which] = true;\n        }\n        _this.model.entities_side.skipFilter = skipFilterSide;\n        entitiesSideProps[\"show\"] = show;\n        entitiesSideProps[\"dim\"] = sideDim;\n        //        _this.model.entities_side.clearShow();\n        _this.model.entities_side.set(entitiesSideProps);\n        _this.model.entities_geodomain.skipFilter = (sideDim === _this.geoDomainDimension || _this.STACKDIM === _this.geoDomainDimension) && (Boolean(_this.model.entities.getFilteredEntities().length) || !_this.model.entities_side.skipFilter);\n        if (_this.model.marker.color.which === _this.model.marker.side.which) {\n          _this.model.entities.clearShow();\n        }\n      },\n      \"change:entities.show\": function changeEntitiesShow(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.entities.dim === _this.model.entities_side.dim && !utils.isEmpty(_this.model.entities_side.show)) {\n          var showEntities = _this.model.entities_side.getFilteredEntities().filter(function (s) {\n            return !_this.model.entities.isShown(s);\n          });\n          if (showEntities.length) {\n            _this.model.marker.side.clearSideState();\n            _this.model.entities_side.showEntity(showEntities);\n          }\n        }\n        _this.model.entities_geodomain.skipFilter = (_this.SIDEDIM === _this.geoDomainDimension || _this.STACKDIM === _this.geoDomainDimension) && (Boolean(_this.model.entities.getFilteredEntities().length) || !_this.model.entities_side.skipFilter);\n      },\n      \"change:entities_side.show\": function changeEntities_sideShow(evt) {\n        if (!_this._readyOnce) return;\n\n        var doReturn = false;\n        var _entitiesSameDimWithSide = null;\n        utils.forEach(_this.model.marker.side._space, function (h) {\n          if (h.dim === _this.model.entities_side.dim && h._name !== _this.model.entities_side._name && h._name !== _this.model.entities_geodomain._name) {\n            _entitiesSameDimWithSide = h;\n          }\n        });\n        if (_entitiesSameDimWithSide) {\n          _this.model.entities.getFilteredEntities();\n          var showEntities = _this.model.entities_side.getFilteredEntities().filter(function (s) {\n            return !_entitiesSameDimWithSide.isShown(s);\n          });\n          if (showEntities.length) {\n            _entitiesSameDimWithSide.showEntity(showEntities);\n            doReturn = true;\n          }\n        }\n        if (_this.SIDEDIM !== _this.model.entities_side.dim) {\n          doReturn = true;\n        }\n        if (doReturn) return;\n\n        _this._updateIndicators();\n        _this._updateSideTitles();\n\n        if (!_this.model._ready || !_this.frame) return;\n        if (_this.smallMultiples) {\n          utils.forEach(_this.stackKeys, function (stackKey, i) {\n            _this._updateLimits(stackKey, i);\n          });\n        } else {\n          _this._updateLimits();\n        }\n        _this.resize();\n        _this._updateEntities(true);\n        _this._redrawLocked();\n      },\n      \"change:entities_age.grouping\": function changeEntities_ageGrouping(evt) {\n        _this.groupBy = +_this.model.entities_age.grouping || 1;\n        _this.model.time.step = _this.groupBy;\n        _this.timeSteps = _this.model.time.getAllSteps();\n        _this.model.ui.chart.lockNonSelected = 0;\n        _this.labels.text(\"\");\n      },\n      \"change:ui.chart.inpercent\": function changeUiChartInpercent(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.smallMultiples) {\n          utils.forEach(_this.stackKeys, function (stackKey, i) {\n            _this._updateLimits(stackKey, i);\n          });\n        } else {\n          _this._updateLimits();\n        }\n        _this.resize();\n        _this._updateEntities();\n        _this._redrawLocked();\n      },\n      \"change:ui.chart.flipSides\": function changeUiChartFlipSides(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.marker.side.switchSideState();\n        _this._updateIndicators();\n        _this._updateSideTitles();\n        _this.resize();\n        _this._updateEntities(true);\n        _this._redrawLocked();\n      },\n      \"change:ui.chart.lockNonSelected\": function changeUiChartLockNonSelected(evt) {\n        _this.lock = _this.model.ui.chart.lockNonSelected;\n        if (_this.lock) {\n          if (!(_this.stackKeys.length <= 1 || _this.stackSkip || _this.smallMultiples)) {\n            _this.model.ui.chart.lockNonSelected = 0;\n            return;\n          }\n          _this.yearLocked.text(\" \" + _this.lock); //\n          _this._makeOutlines(_this.frameAxisX, _this.total);\n        } else {\n          _this.yearLocked.text(\"\");\n          _this.lockedPaths.text(\"\");\n        }\n      },\n      \"ready:marker\": function readyMarker(evt) {\n        if (!_this._readyOnce) return;\n        _this.updateStartEnd(_this.model.time.value, _this.groupBy);\n      }\n    };\n\n    //contructor is the same as any component\n    this._super(config, context);\n\n    this.textEllipsis = new TextEllipsis(this);\n\n    this.xScale = null;\n    this.yScale = null;\n    this.cScale = null;\n\n    this.xAxis = axisSmart(\"bottom\");\n    this.xAxisLeft = axisSmart(\"bottom\");\n    this.yAxis = axisSmart(\"left\");\n    this.xScales = [];\n    this.SHIFTEDAGEDIM = \"s_age\";\n  },\n  domReady: function domReady() {\n    this._super();\n    ////replace code below when IE11 support will be skipped\n    // this.graphTemplate = d3.select(this.element)\n    //   .select(\".vzb-bc-graph\")\n    //   .html();\n    this.graphTemplate = new XMLSerializer().serializeToString(d3.select(this.element).select(\".vzb-bc-graph\").node());\n    ////\n  },\n\n\n  // afterPreload: function() {\n  //   var obj = {};\n  //   obj[\"which\"] = this.model.marker.axis_x.which;\n  //   obj[\"use\"] = this.model.marker.axis_x.use;\n  //   this.model.marker_side.hook_total.set(obj);\n  // },\n\n  updateStartEnd: function updateStartEnd(time, groupBy) {\n    var timeModel = this.model.time;\n    var timeYear = timeModel.formatDate(time);\n    var startYear = +timeModel.formatDate(timeModel.start);\n    var offset = (+timeYear - startYear) % groupBy;\n    if (offset !== timeModel.offset) {\n      timeModel.set(\"offset\", offset, false, false);\n      this.timeSteps = timeModel.getAllSteps();\n      timeModel.set({\n        startSelected: new Date(this.timeSteps[0]),\n        endSelected: new Date(this.timeSteps[this.timeSteps.length - 1])\n      }, false, false);\n      return true;\n    }\n    return false;\n  },\n  getTimeOffset: function getTimeOffset(timeModel, groupBy) {\n    var startYear = +timeModel.formatDate(timeModel.start);\n    var timeYear = +timeModel.formatDate(timeModel.value);\n    return (+timeYear - startYear) % groupBy;\n  },\n  checkDimensions: function checkDimensions() {\n    var stackDim = this.model.entities.dim;\n    var sideDim = this.model.entities_side.dim;\n\n    this.colorUseConstant = this.model.marker.color.use == \"constant\";\n    this.stackSkip = this.colorUseConstant || stackDim == sideDim;\n    this.geoLess = stackDim !== this.geoDomainDimension && sideDim !== this.geoDomainDimension;\n    this.sideSkip = this.model.marker.side.use == \"constant\";\n  },\n\n\n  /**\n   * DOM is ready\n   */\n  readyOnce: function readyOnce() {\n    var _this = this;\n    this.el = this.el ? this.el : d3.select(this.element);\n    this.element = this.el;\n\n    this.textEllipsis.setTooltip(this.element.select(\".vzb-bc-tooltip\"));\n\n    this.interaction = this._interaction();\n\n    this.geoDomainDimension = this.model.entities_geodomain.getDimension();\n    this.geoDomainDefaultValue = this.model.entities_geodomain.show[this.geoDomainDimension][\"$in\"][0];\n\n    this.xTitleEl = this.element.select(\".vzb-bc-axis-x-title\");\n    this.xInfoEl = this.element.select(\".vzb-bc-axis-x-info\");\n    this.yearEl = this.element.select(\".vzb-bc-year-now\");\n    this.year = new DynamicBackground(this.yearEl);\n    this.year.setText(this.model.time.formatDate(this.model.time.value));\n    this.yearLocked = this.element.select(\".vzb-bc-year-locked\");\n\n    this.someSelected = this.model.marker.select.length > 0;\n    this.nonSelectedOpacityZero = false;\n\n    this.groupBy = +this.model.entities_age.grouping || 1;\n\n    this.on(\"resize\", function () {\n      _this._updateEntities();\n      _this._redrawLocked();\n    });\n\n    this._attributeUpdaters = {\n      _newWidth: function _newWidth(d, i) {\n        //d[\"x_\"] = 0;\n        var width = void 0;\n        if (_this.geoLess && _this.stackSkip && _this.sideSkip) {\n          width = (_this.frameAxisX[d[_this.AGEDIM] + _this.ageShift] || {})[_this.geoDomainDefaultValue];\n        } else if (_this.geoLess && _this.stackSkip) {\n          width = _this.colorUseConstant || d[_this.PREFIXEDSIDEDIM] == d[_this.PREFIXEDSTACKDIM] ? (_this.frameAxisX[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM] + _this.ageShift] || {})[_this.geoDomainDefaultValue] : 0;\n        } else if (_this.geoLess && _this.sideSkip) {\n          width = (_this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.AGEDIM] + _this.ageShift] || {})[_this.geoDomainDefaultValue];\n        } else if (_this.stackSkip) {\n          width = _this.colorUseConstant || d[_this.PREFIXEDSIDEDIM] == d[_this.PREFIXEDSTACKDIM] ? _this.frameAxisX[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM] + _this.ageShift] : 0;\n        } else if (_this.sideSkip) {\n          width = _this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.AGEDIM] + _this.ageShift];\n        } else {\n          width = _this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM] + _this.ageShift];\n        }\n        d[\"width_\"] = width ? _this.xScale(width) : 0;\n        if (_this.ui.chart.inpercent) {\n          d[\"width_\"] /= _this.total[d.i][d[_this.PREFIXEDSIDEDIM]];\n        }\n        return d.width_;\n      },\n      _newX: function _newX(d, i) {\n        var prevSbl = this.previousSibling;\n        if (prevSbl) {\n          var prevSblDatum = d3.select(prevSbl).datum();\n          d[\"x_\"] = prevSblDatum.x_ + prevSblDatum.width_;\n        }\n        // else {\n        //   d[\"x_\"] = 0;\n        // }\n        return d.x_;\n      }\n    };\n  },\n\n\n  /*\n   * Both model and DOM are ready\n   */\n  ready: function ready() {\n    //TODO: get component ready if some submodel doesn't ready ??????\n    if (!this.model.marker._ready) return;\n\n    var _this = this;\n\n    this.lock = _this.model.ui.chart.lockNonSelected;\n\n    this.timeSteps = this.model.time.getAllSteps();\n\n    this.shiftScale = d3.scaleLinear().domain([this.timeSteps[0], this.timeSteps[this.timeSteps.length - 1]]).range([0, this.timeSteps.length - 1]);\n\n    this.domains = [];\n\n    this.SIDEDIM = this.model.entities_side.getDimension();\n    this.PREFIXEDSIDEDIM = \"side_\" + this.SIDEDIM;\n    this.STACKDIM = this.model.entities.getDimension(); // || this.geoDomainDimension;//this.model.marker.color.which;\n    this.PREFIXEDSTACKDIM = \"stack_\" + this.STACKDIM;\n    this.AGEDIM = this.model.entities_age.getDimension();\n    this.TIMEDIM = this.model.time.getDimension();\n    this.checkDimensions();\n    this.updateUIStrings();\n    this._updateIndicators();\n    this.smallMultiples = (this.model.ui.chart || {}).mode === \"smallMultiples\" && !this.stackSkip && this.stackKeys.length > 1 ? true : false;\n    this._updateGraphs(this.smallMultiples ? this.stackKeys : [\"undefined\"]);\n    this._updateSideTitles();\n\n    if (this.lock && (this.stackKeys.length <= 1 || this.stackSkip || this.smallMultiples)) {\n      this.yearLocked.text(\"\" + this.lock);\n    } else {\n      _this.model.ui.chart.lockNonSelected = 0;\n    }\n    this.model.ui.chart.set(\"lockUnavailable\", !(this.stackKeys.length <= 1 || this.stackSkip || this.smallMultiples), false, false);\n\n    this.frame = null;\n    this.frameAllColor = {};\n\n    this.model.marker.getFrame(_this.model.time.value, function (frame, time) {\n      _this.frame = frame;\n      _this.frameAxisX = frame.axis_x;\n\n      var frames = {};\n      frames[time] = frame;\n      _this.maxLimits = {};\n      _this.inpercentMaxLimits = {};\n      _this.totals = {};\n\n      if (_this.smallMultiples) {\n        utils.forEach(_this.stackKeys, function (stackKey, i) {\n          _this._createLimits(frames, stackKey);\n          _this._updateLimits(stackKey, i);\n        });\n      } else {\n        _this._createLimits(frames);\n        _this._updateLimits();\n      }\n      _this._getLimits();\n\n      _this.resize();\n      _this.model.marker_allpossible.getFrame(_this.model.time.value, function (apFrame) {\n        _this.frameAllColor = apFrame.color || {};\n        _this._updateEntities(true);\n        _this.updateBarsOpacity();\n        //_this._redrawLocked();\n        //_this.model.time.set('value', _this.model.time.value, true, true);\n      });\n    });\n  },\n  _updateGraphs: function _updateGraphs(data) {\n    var _this = this;\n    var graph = this.element.selectAll(\".vzb-bc-graph\").data(data);\n    graph.exit().remove();\n    ////replace code below when IE11 support will be skipped\n    //  graph.enter().append(\"g\")\n    //   .attr(\"class\", \"vzb-bc-graph\")\n    //   .html(this.graphTemplate);\n    graph.enter().append(function () {\n      return this.ownerDocument.importNode(new DOMParser().parseFromString(_this.graphTemplate, 'application/xml').documentElement, true);\n    });\n    ////\n\n    this.element.select(\".vzb-bc-tooltip\").raise();\n    this.graph = this.element.selectAll(\".vzb-bc-graph\");\n    this.yAxisEl = this.graph.select(\".vzb-bc-axis-y\");\n    this.xAxisEl = this.graph.select(\".vzb-bc-axis-x\");\n    this.xAxisLeftEl = this.graph.select(\".vzb-bc-axis-x-left\");\n    this.yTitleEl = this.graph.select(\".vzb-bc-axis-y-title\");\n    this.title = this.graph.select(\".vzb-bc-title\");\n    this.titleRight = this.graph.select(\".vzb-bc-title-right\");\n    this.titleCenter = this.graph.select(\".vzb-bc-title-center\");\n    this.barsCrop = this.graph.select(\".vzb-bc-bars-crop\");\n    this.lockedCrop = this.graph.select(\".vzb-bc-locked-crop\");\n    this.labelsCrop = this.graph.select(\".vzb-bc-labels-crop\");\n    this.bars = this.barsCrop.select(\".vzb-bc-bars\");\n    this.lockedPaths = this.lockedCrop.select(\".vzb-bc-paths\");\n    this.labels = this.labelsCrop.select(\".vzb-bc-labels\");\n  },\n  _getLimits: function _getLimits() {\n    var _this = this;\n    return function () {\n      var groupBy = _this.groupBy;\n      _this.model.marker.getFrame(null, function (frames) {\n        if (!frames || groupBy !== _this.groupBy) return;\n        if (_this.smallMultiples) {\n          utils.forEach(_this.stackKeys, function (stackKey, i) {\n            _this._createLimits(frames, stackKey);\n            _this._updateLimits(stackKey, i);\n          });\n        } else {\n          _this._createLimits(frames);\n          _this._updateLimits();\n        }\n        _this.resize();\n        _this._updateEntities(true);\n        _this.updateBarsOpacity();\n        _this._redrawLocked();\n      });\n    }();\n  },\n  _redrawLocked: function _redrawLocked() {\n    var _this2 = this;\n\n    var _this = this;\n    if (!this.lock) return;\n\n    this.model.marker.getFrame(this.model.time.parse(\"\" + this.lock), function (lockFrame, lockTime) {\n      if (!lockFrame) return;\n      _this.lockedPaths.text(\"\");\n      var total = {};\n      if (_this2.ui.chart.inpercent) {\n        if (_this2.smallMultiples) {\n          utils.forEach(_this2.stackKeys, function (stackKey, i) {\n            total[i] = _this2.totals[stackKey][lockTime] ? _this2.totals[stackKey][lockTime] : _this2._interpolateBetweenTotals(_this2.timeSteps, _this2.totals[stackKey], lockTime);\n          });\n        } else {\n          total[0] = _this2.totals[lockTime] ? _this2.totals[lockTime] : _this2._interpolateBetweenTotals(_this2.timeSteps, _this2.totals, lockTime);\n        }\n        if (!total[0]) return;\n      }\n      _this._makeOutlines(lockFrame.axis_x, total);\n    });\n  },\n  interpolateDiagonal: function interpolateDiagonal(pValues, nValues, fraction) {\n    var _this = this;\n    var dataBetweenFrames = {};\n    var data = void 0;\n    var val1 = void 0,\n        val2 = void 0,\n        shiftedAge = void 0;\n    var groupBy = this.groupBy;\n    if (this.geoLess && this.stackSkip && this.sideSkip) {\n      data = dataBetweenFrames;\n      utils.forEach(_this.ageKeys, function (age) {\n        shiftedAge = +age + groupBy;\n        val1 = pValues[age][_this.geoDomainDefaultValue];\n        val2 = (nValues[shiftedAge] || {})[_this.geoDomainDefaultValue] || 0;\n        data[shiftedAge] = {};\n        data[shiftedAge][_this.geoDomainDefaultValue] = val1 == null || val2 == null ? null : val1 + (val2 - val1) * fraction;\n      });\n      data[0] = {};\n      data[0][_this.geoDomainDefaultValue] = nValues[0][_this.geoDomainDefaultValue] || 0;\n    } else if (this.stackSkip && this.geoLess) {\n      utils.forEach(_this.sideKeys, function (side) {\n        data = dataBetweenFrames[side] = {};\n        utils.forEach(_this.ageKeys, function (age) {\n          shiftedAge = +age + groupBy;\n          val1 = pValues[side][age][_this.geoDomainDefaultValue];\n          val2 = (nValues[side][shiftedAge] || {})[_this.geoDomainDefaultValue] || 0;\n          data[shiftedAge] = {};\n          data[shiftedAge][_this.geoDomainDefaultValue] = val1 == null || val2 == null ? null : val1 + (val2 - val1) * fraction;\n        });\n        data[0] = {};\n        data[0][_this.geoDomainDefaultValue] = nValues[side][0][_this.geoDomainDefaultValue] || 0;\n      });\n    } else if (this.stackSkip) {\n      utils.forEach(_this.sideKeys, function (side) {\n        data = dataBetweenFrames[side] = {};\n        utils.forEach(_this.ageKeys, function (age) {\n          shiftedAge = +age + groupBy;\n          val1 = pValues[side][age];\n          val2 = nValues[side][shiftedAge] || 0;\n          data[shiftedAge] = val1 == null || val2 == null ? null : val1 + (val2 - val1) * fraction;\n        });\n        data[0] = nValues[side][0] || 0;\n      });\n    } else if (this.sideSkip && this.geoLess) {\n      utils.forEach(_this.stackKeys, function (stack) {\n        data = dataBetweenFrames[stack] = {};\n        utils.forEach(_this.ageKeys, function (age) {\n          shiftedAge = +age + groupBy;\n          val1 = pValues[stack][age][_this.geoDomainDefaultValue];\n          val2 = (nValues[stack][shiftedAge] || {})[_this.geoDomainDefaultValue] || 0;\n          data[shiftedAge] = {};\n          data[shiftedAge][_this.geoDomainDefaultValue] = val1 == null || val2 == null ? null : val1 + (val2 - val1) * fraction;\n        });\n        data[0] = {};\n        data[0][_this.geoDomainDefaultValue] = nValues[stack][0][_this.geoDomainDefaultValue] || 0;\n      });\n    } else if (this.sideSkip) {\n      utils.forEach(_this.stackKeys, function (stack) {\n        data = dataBetweenFrames[stack] = {};\n        utils.forEach(_this.ageKeys, function (age) {\n          shiftedAge = +age + groupBy;\n          val1 = pValues[stack][age];\n          val2 = nValues[stack][shiftedAge] || 0;\n          data[shiftedAge] = val1 == null || val2 == null ? null : val1 + (val2 - val1) * fraction;\n        });\n        data[0] = nValues[stack][0] || 0;\n      });\n    } else {\n      utils.forEach(_this.stackKeys, function (stack) {\n        dataBetweenFrames[stack] = {};\n        utils.forEach(_this.sideKeys, function (side) {\n          data = dataBetweenFrames[stack][side] = {};\n          utils.forEach(_this.ageKeys, function (age) {\n            shiftedAge = +age + groupBy;\n            val1 = pValues[stack][side][age];\n            val2 = nValues[stack][side][shiftedAge] || 0;\n            data[shiftedAge] = val1 == null || val2 == null ? null : val1 + (val2 - val1) * fraction;\n          });\n          data[0] = nValues[stack][side][0] || 0;\n        });\n      });\n    }\n    return dataBetweenFrames;\n  },\n  updateUIStrings: function updateUIStrings() {\n    var _this = this;\n    this.translator = this.model.locale.getTFunction();\n\n    var xTitle = this.xTitleEl.selectAll(\"text\").data([0]);\n    xTitle.enter().append(\"text\").text(_this.translator(\"popbyage/title\"));\n\n    var conceptPropsX = this.model.marker.axis_x.getConceptprops();\n    utils.setIcon(this.xInfoEl, iconQuestion).select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\").style('opacity', Number(Boolean(conceptPropsX.description || conceptPropsX.sourceLink)));\n\n    this.xInfoEl.on(\"click\", function () {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.xInfoEl.on(\"mouseover\", function () {\n      if (_this.model.time.dragging) return;\n      var rect = this.getBBox();\n      var coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      var toolRect = _this.root.element.getBoundingClientRect();\n      var chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"axis_x\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.xInfoEl.on(\"mouseout\", function () {\n      if (_this.model.time.dragging) return;\n      _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n    });\n\n    // var titleStringY = this.model.marker.axis_y.getConceptprops().name;\n\n    // var yTitle = this.yTitleEl.selectAll(\"text\").data([0]);\n    // yTitle.enter().append(\"text\");\n    // yTitle\n    //   .attr(\"y\", \"-6px\")\n    //   .attr(\"x\", \"-9px\")\n    //   .attr(\"dx\", \"-0.72em\")\n    //   .text(titleStringY);\n  },\n\n\n  /**\n   * Changes labels for indicators\n   */\n  _updateIndicators: function _updateIndicators() {\n    var _this3 = this;\n\n    var _this = this;\n    this.duration = this.model.time.delayAnimations;\n    this.yScale = this.model.marker.axis_y.getScale();\n    this.xScale = this.model.marker.axis_x.getScale();\n    this.yAxis.tickFormat(_this.model.marker.axis_y.getTickFormatter());\n    this.xAxis.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n    this.xAxisLeft.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n\n    var sideDim = this.SIDEDIM;\n    var stackDim = this.STACKDIM;\n    var ageDim = this.AGEDIM;\n    var groupBy = this.groupBy;\n\n    var ages = this.model.marker.getKeys(ageDim);\n    var ageKeys = [];\n    ageKeys = ages.map(function (m) {\n      return m[ageDim];\n    });\n    this.ageKeys = ageKeys;\n\n    this.shiftedAgeKeys = this.timeSteps.map(function (m, i) {\n      return -i * groupBy;\n    }).slice(1).reverse().concat(ageKeys);\n\n    this.sideItems = this.model.marker.label_side.getItems();\n    //var sideKeys = Object.keys(sideItems);\n    var sideKeys = [];\n    if (!utils.isEmpty(this.sideItems)) {\n      var sideFiltered = !!this.model.marker.side.getEntity().show[sideDim];\n      var sides = this.model.marker.getKeys(sideDim).filter(function (f) {\n        return !sideFiltered || _this3.model.marker.side.getEntity().isShown(f);\n      });\n      sideKeys = sides.map(function (m) {\n        return m[sideDim];\n      });\n\n      if (sideKeys.length > 2) sideKeys.length = 2;\n      if (sideKeys.length > 1) {\n        var sortFunc = this.ui.chart.flipSides ? d3.ascending : d3.descending;\n        sideKeys.sort(sortFunc);\n      }\n    }\n    if (!sideKeys.length) sideKeys.push(\"undefined\");\n    this.sideKeys = sideKeys;\n\n    var stacks = this.model.marker.getKeys(stackDim);\n    var stackKeys = stacks.map(function (m) {\n      return m[stackDim];\n    });\n\n    var sortedStackKeys = utils.keys(this.model.marker.color.getPalette()).reduce(function (arr, val) {\n      if (stackKeys.indexOf(val) != -1) arr.push(val);\n      return arr;\n    }, []);\n\n    if (sortedStackKeys.length != stackKeys.length) {\n      sortedStackKeys = stackKeys.reduce(function (arr, val) {\n        if (arr.indexOf(val) == -1) arr.push(val);\n        return arr;\n      }, sortedStackKeys);\n    }\n    this.stackKeys = sortedStackKeys;\n    this.stackItems = this.model.marker.label_stack.getItems();\n\n    this.stacked = this.ui.chart.stacked && this.model.marker.color.use != \"constant\" && this.model.entities.getDimension();\n\n    this.twoSided = this.sideKeys.length > 1;\n    if (this.twoSided) {\n      this.xScaleLeft = this.xScale.copy();\n    }\n\n    this.cScale = this.model.marker.color.getScale();\n\n    this.markers = this.model.marker.getKeys(ageDim);\n  },\n  _updateSideTitles: function _updateSideTitles() {\n    var _this = this;\n    var sideItems = this.sideItems;\n\n    this.titleRight.classed(\"vzb-hidden\", !this.twoSided);\n    if (this.twoSided) {\n      this.title.text(sideItems[this.sideKeys[1]]).call(this.textEllipsis.clear);\n      this.titleRight.text(sideItems[this.sideKeys[0]]).call(this.textEllipsis.clear);;\n    } else {\n      var title = this.sideKeys.length && sideItems[this.sideKeys[0]] ? sideItems[this.sideKeys[0]] : \"\";\n      this.title.text(title).call(this.textEllipsis.clear);;\n    }\n\n    if (this.smallMultiples) {\n      this.titleCenter.call(this.textEllipsis.clear).each(function (d, i) {\n        d3.select(this).text(_this.stackItems[_this.stackKeys[i]]);\n      });\n    } else {\n      var _title = this.stackKeys.length && this.stackItems[this.stackKeys[0]] ? this.stackItems[this.stackKeys[0]] : \"\";\n      this.titleCenter.text(_title).call(this.textEllipsis.clear);\n    }\n  },\n  _createLimits: function _createLimits(frames, stackKey) {\n    var _this = this;\n\n    var stackKeys = stackKey ? [stackKey] : this.stackKeys;\n    //const sideKeysNF = Object.keys(this.model.marker.side.getItems());\n    var sideKeysNF = Object.keys(this.model.marker.side.getNestedItems([this.SIDEDIM]));\n    if (!sideKeysNF.length) sideKeysNF.push(\"undefined\");\n\n    var totals = {};\n    var inpercentMaxLimits = {};\n    var maxLimits = {};\n    var geoLess = this.geoLess;\n    var geoDefault = this.geoDomainDefaultValue;\n    sideKeysNF.forEach(function (s) {\n      maxLimits[s] = [];\n      inpercentMaxLimits[s] = [];\n    });\n\n    if (_this.stackSkip && _this.sideSkip) {\n      utils.forEach(frames, function (f, time) {\n        var frame = f.axis_x;\n        totals[time] = {};\n        var ageSum = 0;\n        var sideMaxLimits = [];\n        utils.forEach(_this.ageKeys, function (age) {\n          var stackSum = 0;\n          if (frame[age]) {\n            stackSum += frame[age][geoDefault];\n            ageSum += stackSum;\n          }\n          sideMaxLimits.push(stackSum);\n        });\n        totals[time][sideKeysNF[0]] = ageSum;\n        var maxSideLimit = Math.max.apply(Math, sideMaxLimits);\n        inpercentMaxLimits[sideKeysNF[0]].push(maxSideLimit / ageSum);\n        maxLimits[sideKeysNF[0]].push(maxSideLimit);\n      });\n    } else if (_this.sideSkip) {\n      utils.forEach(frames, function (f, time) {\n        var frame = f.axis_x;\n        totals[time] = {};\n        var ageSum = 0;\n        var sideMaxLimits = [];\n        utils.forEach(_this.ageKeys, function (age) {\n          var stackSum = 0;\n          utils.forEach(stackKeys, function (stack) {\n            if (frame[stack] && frame[stack][age]) {\n              stackSum += geoLess ? frame[stack][age][geoDefault] : frame[stack][age];\n              ageSum += stackSum;\n            }\n          });\n          sideMaxLimits.push(stackSum);\n        });\n        totals[time][sideKeysNF[0]] = ageSum;\n        var maxSideLimit = Math.max.apply(Math, sideMaxLimits);\n        inpercentMaxLimits[sideKeysNF[0]].push(maxSideLimit / ageSum);\n        maxLimits[sideKeysNF[0]].push(maxSideLimit);\n      });\n    } else if (_this.stackSkip) {\n      utils.forEach(frames, function (f, time) {\n        var frame = f.axis_x;\n        totals[time] = {};\n        utils.forEach(sideKeysNF, function (side) {\n          var ageSum = 0;\n          var sideMaxLimits = [];\n          utils.forEach(_this.ageKeys, function (age) {\n            var stackSum = 0;\n            if (frame[side] && frame[side][age]) {\n              stackSum += geoLess ? frame[side][age][geoDefault] : frame[side][age];\n              ageSum += stackSum;\n            }\n            sideMaxLimits.push(stackSum);\n          });\n          totals[time][side] = ageSum;\n          var maxSideLimit = Math.max.apply(Math, sideMaxLimits);\n          inpercentMaxLimits[side].push(maxSideLimit / ageSum);\n          maxLimits[side].push(maxSideLimit);\n        });\n      });\n    } else {\n      utils.forEach(frames, function (f, time) {\n        var frame = f.axis_x;\n        totals[time] = {};\n        utils.forEach(sideKeysNF, function (side) {\n          var ageSum = 0;\n          var sideMaxLimits = [];\n          utils.forEach(_this.ageKeys, function (age) {\n            var stackSum = 0;\n            utils.forEach(stackKeys, function (stack) {\n              if (frame[stack][side] && frame[stack][side][age]) {\n                stackSum += geoLess ? frame[stack][side][age][geoDefault] : frame[stack][side][age];\n                ageSum += stackSum;\n              }\n            });\n            sideMaxLimits.push(stackSum);\n          });\n          totals[time][side] = ageSum;\n          var maxSideLimit = Math.max.apply(Math, sideMaxLimits);\n          inpercentMaxLimits[side].push(maxSideLimit / ageSum);\n          maxLimits[side].push(maxSideLimit);\n        });\n      });\n    }\n\n    if (stackKey) {\n      this.maxLimits[stackKey] = {};\n      this.inpercentMaxLimits[stackKey] = {};\n      sideKeysNF.forEach(function (s) {\n        _this.maxLimits[stackKey][s] = Math.max.apply(Math, _toConsumableArray(maxLimits[s]));\n        _this.inpercentMaxLimits[stackKey][s] = Math.max.apply(Math, _toConsumableArray(inpercentMaxLimits[s]));\n      });\n      this.totals[stackKey] = totals;\n    } else {\n      sideKeysNF.forEach(function (s) {\n        _this.maxLimits[s] = Math.max.apply(Math, _toConsumableArray(maxLimits[s]));\n        _this.inpercentMaxLimits[s] = Math.max.apply(Math, _toConsumableArray(inpercentMaxLimits[s]));\n      });\n      this.totals = totals;\n    }\n  },\n  _updateLimits: function _updateLimits(stackKey, i) {\n    var _this = this;\n    var axisX = this.model.marker.axis_x;\n    if (this.smallMultiples && stackKey) {\n      if (this.ui.chart.inpercent) {\n        this.domains[i] = [0, Math.max.apply(Math, _toConsumableArray(this.sideKeys.map(function (s) {\n          return _this.inpercentMaxLimits[stackKey][s];\n        })))];\n      } else {\n        this.domains[i] = axisX.domainMin != null && axisX.domainMax != null ? [+axisX.domainMin, +axisX.domainMax] : [0, Math.max.apply(Math, _toConsumableArray(this.sideKeys.map(function (s) {\n          return _this.maxLimits[stackKey][s];\n        })))];\n      }\n    } else {\n      if (this.ui.chart.inpercent) {\n        this.domains[0] = [0, Math.max.apply(Math, _toConsumableArray(this.sideKeys.map(function (s) {\n          return _this.inpercentMaxLimits[s];\n        })))];\n      } else {\n        this.domains[0] = axisX.domainMin != null && axisX.domainMax != null ? [+axisX.domainMin, +axisX.domainMax] : [0, Math.max.apply(Math, _toConsumableArray(this.sideKeys.map(function (s) {\n          return _this.maxLimits[s];\n        })))];\n      }\n    }\n\n    this.xScale.domain(this.domains[0]);\n    if (this.xScaleLeft) this.xScaleLeft.domain(this.xScale.domain());\n\n    this.domainScalers = this._calcDomainScalers();\n  },\n  _calcDomainScalers: function _calcDomainScalers() {\n    var domain = this.domains.map(function (m) {\n      return m[1] - m[0];\n    });\n    var sumDomains = domain.reduce(function (a, b) {\n      return a + b;\n    });\n    return domain.map(function (d) {\n      return d / sumDomains;\n    });\n  },\n  _interpolateBetweenTotals: function _interpolateBetweenTotals(timeSteps, totals, time) {\n    var nextStep = d3.bisectLeft(timeSteps, time);\n    var fraction = (time - timeSteps[nextStep - 1]) / (timeSteps[nextStep] - timeSteps[nextStep - 1]);\n    var total = {};\n    utils.forEach(this.sideKeys, function (side) {\n      total[side] = totals[timeSteps[nextStep]][side] * fraction + totals[timeSteps[nextStep - 1]][side] * (1 - fraction);\n    });\n    return total;\n  },\n\n\n  /**\n   * Updates entities\n   */\n  _updateEntities: function _updateEntities(reorder) {\n    var _this4 = this;\n\n    var _this = this;\n    var time = this.model.time;\n    var sideDim = this.SIDEDIM;\n    var prefixedSideDim = this.PREFIXEDSIDEDIM;\n    var ageDim = this.AGEDIM;\n    var stackDim = this.STACKDIM;\n    var prefixedStackDim = this.PREFIXEDSTACKDIM;\n    var timeDim = this.TIMEDIM;\n    var duration = time.playing ? time.delayAnimations : 0;\n    var total = void 0;\n\n    var groupBy = this.groupBy;\n    //var group_offset = this.model.marker.group_offset ? Math.abs(this.model.marker.group_offset % groupBy) : 0;\n\n    if (this.ui.chart.inpercent) {\n      this.total = {};\n      if (this.smallMultiples) {\n        utils.forEach(this.stackKeys, function (stackKey, i) {\n          _this4.total[i] = _this4.totals[stackKey][time.value] ? _this4.totals[stackKey][time.value] : _this4._interpolateBetweenTotals(_this4.timeSteps, _this4.totals[stackKey], time.value);\n        });\n      } else {\n        this.total[0] = this.totals[time.value] ? this.totals[time.value] : this._interpolateBetweenTotals(this.timeSteps, this.totals, time.value);\n      }\n    }\n\n    var domain = this.yScale.domain();\n\n    //this.model.age.setVisible(markers);\n\n    var nextStep = d3.bisectLeft(this.timeSteps, time.value);\n\n    var shiftedAgeDim = this.SHIFTEDAGEDIM;\n\n    var markers = this.markers.map(function (data) {\n      var o = {};\n      o[ageDim] = o[shiftedAgeDim] = +data[ageDim];\n      o[ageDim] -= nextStep * groupBy;\n      return o;\n    });\n\n    var ageData = markers.slice(0);\n\n    var outAge = {};\n    outAge[shiftedAgeDim] = markers.length * groupBy;\n    outAge[ageDim] = outAge[shiftedAgeDim] - nextStep * groupBy;\n\n    this.ageShift = nextStep * groupBy;\n\n    if (nextStep) ageData.push(outAge);\n\n    var stacks = _this.stacked ? _this.stackKeys : [_this.geoDomainDefaultValue];\n    var geoDomainDefaultValue = this.geoDomainDefaultValue;\n    var geoDomainDimension = this.geoDomainDimension;\n\n    // for(let i = 0, j = ageData.length; i < j; i++) {\n    //   const d = ageData[i];\n    //   d[\"side\"] = _this.sideKeys.map(m => {\n    //     const r = {};\n    //     r[ageDim] = d[ageDim];\n    //     r[shiftedAgeDim] = d[shiftedAgeDim];\n    //     r[prefixedSideDim] = m;\n    //     r[sideDim] = m;\n    //     r[\"stack\"] = stacks.map(m => {\n    //       const s = {};\n    //       s[geoDomainDimension] = geoDomainDefaultValue;\n    //       s[ageDim] = r[ageDim];\n    //       s[shiftedAgeDim] = r[shiftedAgeDim];\n    //       s[sideDim] = r[sideDim];\n    //       s[stackDim] = m;\n    //       s[prefixedSideDim] = r[prefixedSideDim];\n    //       s[prefixedStackDim] = m;\n    //       s[\"x_\"] = 0;\n    //       s[\"width_\"] = 0;\n    //       return s;\n    //     });\n    //     return r;\n    //   });\n    // }\n\n    //this.barsData = ageData;\n    this.barsData = [];\n    var ageBars = this.bars.selectAll(\".vzb-bc-bar\").data(function (d, i) {\n      return _this.barsData[i] = ageData.map(function (m) {\n        var p = {};\n        p[ageDim] = m[ageDim];\n        p[shiftedAgeDim] = m[shiftedAgeDim];\n        p.i = i;\n        return p;\n      }), _this4.barsData[i];\n    }, function (d) {\n      return d[ageDim];\n    });\n    //exit selection\n    ageBars.exit().remove();\n\n    var oneBarHeight = this.oneBarHeight;\n    var barHeight = this.barHeight;\n    var firstBarOffsetY = this.firstBarOffsetY;\n\n    //enter selection -- init bars\n    ageBars = ageBars.enter().append(\"g\").attr(\"class\", function (d) {\n      return \"vzb-bc-bar \" + \"vzb-bc-bar-\" + d[ageDim];\n    }).attr(\"transform\", function (d, i) {\n      return \"translate(0,\" + (firstBarOffsetY - (d[shiftedAgeDim] - domain[0] - groupBy) * oneBarHeight) + \")\";\n    }).merge(ageBars);\n\n    // this.ageBars.attr(\"class\", function(d) {\n    //     return \"vzb-bc-bar \" + \"vzb-bc-bar-\" + d[ageDim];\n    //   })\n\n\n    var sideBars = ageBars.selectAll(\".vzb-bc-side\").data(function (d, i) {\n      return d.side = _this.sideKeys.map(function (m) {\n        var r = {};\n        r[ageDim] = d[ageDim];\n        r[shiftedAgeDim] = d[shiftedAgeDim];\n        r[prefixedSideDim] = m;\n        r[sideDim] = m;\n        r.i = d.i;\n        return r;\n      }), d.side;\n    }, function (d) {\n      return d[prefixedSideDim];\n    });\n\n    sideBars.exit().remove();\n    sideBars = sideBars.enter().append(\"g\").attr(\"class\", function (d, i) {\n      return \"vzb-bc-side \" + \"vzb-bc-side-\" + (!i != !_this.twoSided ? \"right\" : \"left\");\n    }).attr(\"transform\", function (d, i) {\n      return i ? \"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\" : \"\";\n    }).merge(sideBars);\n\n    if (reorder) {\n      sideBars.attr(\"class\", function (d, i) {\n        return \"vzb-bc-side \" + \"vzb-bc-side-\" + (!i != !_this.twoSided ? \"right\" : \"left\");\n      }).attr(\"transform\", function (d, i) {\n        return i ? \"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\" : \"\";\n      });\n    }\n\n    var _attributeUpdaters = this._attributeUpdaters;\n\n    var stackBars = sideBars.selectAll(\".vzb-bc-stack\").data(function (d) {\n      return d.stack = (_this.smallMultiples ? [stacks[d.i]] : stacks).map(function (m) {\n        var s = {};\n        s[geoDomainDimension] = geoDomainDefaultValue;\n        s[ageDim] = d[ageDim];\n        s[shiftedAgeDim] = d[shiftedAgeDim];\n        s[sideDim] = d[sideDim];\n        s[stackDim] = m;\n        s[prefixedSideDim] = d[prefixedSideDim];\n        s[prefixedStackDim] = m;\n        s[\"x_\"] = 0;\n        s[\"width_\"] = 0;\n        s.i = d.i;\n        return s;\n      }), d.stack;\n    }, function (d) {\n      return d[prefixedStackDim];\n    });\n\n    stackBars.exit().remove();\n    stackBars = stackBars.enter().append(\"rect\").attr(\"class\", function (d, i) {\n      return \"vzb-bc-stack \" + \"vzb-bc-stack-\" + i + (_this.highlighted ? \" vzb-dimmed\" : \"\");\n    }).attr(\"y\", 0).attr(\"height\", barHeight - (groupBy > 2 ? 1 : 0)).attr(\"fill\", function (d) {\n      return _this.cScale(_this.frameAllColor[d[prefixedStackDim]] || d[prefixedStackDim]);\n    })\n    //.attr(\"width\", _attributeUpdaters._newWidth)\n    .attr(\"x\", _attributeUpdaters._newX).on(\"mouseover\", _this.interaction.mouseover).on(\"mouseout\", _this.interaction.mouseout).on(\"click\", _this.interaction.click).onTap(_this.interaction.tap).merge(stackBars);\n\n    if (reorder) stackBars.attr(\"class\", function (d, i) {\n      return \"vzb-bc-stack \" + \"vzb-bc-stack-\" + i + (_this.highlighted ? \" vzb-dimmed\" : \"\");\n    }).attr(\"fill\", function (d) {\n      return _this.cScale(_this.frameAllColor[d[prefixedStackDim]] || d[prefixedStackDim]);\n    }).order();\n\n    var stepShift = ageData[0][shiftedAgeDim] - ageData[0][ageDim] - this.shiftScale(time.value) * groupBy;\n\n    if (duration) {\n      var transition = d3.transition().duration(duration).ease(d3.easeLinear);\n\n      ageBars.transition(transition).attr(\"transform\", function (d, i) {\n        return \"translate(0,\" + (firstBarOffsetY - (d[shiftedAgeDim] - domain[0] - stepShift) * oneBarHeight) + \")\";\n      });\n      stackBars.transition(transition).attr(\"width\", _attributeUpdaters._newWidth).attr(\"x\", _attributeUpdaters._newX);\n    } else {\n      ageBars.interrupt().attr(\"transform\", function (d, i) {\n        return \"translate(0,\" + (firstBarOffsetY - (d[shiftedAgeDim] - domain[0] - stepShift) * oneBarHeight) + \")\";\n      });\n      stackBars.interrupt().attr(\"width\", _attributeUpdaters._newWidth).attr(\"x\", _attributeUpdaters._newX);\n    }\n\n    this.ageBars = ageBars;\n    this.sideBars = sideBars;\n    this.stackBars = stackBars;\n\n    this.entityLabels = this.labels.selectAll(\".vzb-bc-label text\").data(markers);\n    //exit selection\n    this.entityLabels.exit().remove();\n\n    this.entityLabels = this.entityLabels.enter().append(\"g\").attr(\"class\", function (d) {\n      return \"vzb-bc-label\" + \" vzb-bc-label-\" + d[shiftedAgeDim];\n    }).append(\"text\").attr(\"class\", \"vzb-bc-age\").merge(this.entityLabels).each(function (d, i) {\n      var yearOlds = _this.translator(\"popbyage/yearOlds\");\n\n      var age = parseInt(d[shiftedAgeDim], 10);\n\n      if (groupBy > 1) {\n        var nextAge = age + groupBy - 1;\n        age = age + \"-to-\" + (nextAge > domain[1] ? domain[1] : nextAge);\n      }\n\n      d[\"text\"] = age + yearOlds;\n    }).attr(\"y\", function (d, i) {\n      return firstBarOffsetY - (d[shiftedAgeDim] - domain[0]) * oneBarHeight - 10;\n    }).attr(\"dy\", function (d, i) {\n      return d[shiftedAgeDim] + groupBy > domain[1] ? (groupBy - domain[1] + d[shiftedAgeDim]) / groupBy * barHeight : 0;\n    });\n    // .style(\"fill\", function(d) {\n    //   var color = _this.cScale(values.color[d[ageDim]]);\n    //   return d3.rgb(color).darker(2);\n    // });\n\n    this.year.setText(this.model.time.formatDate(time.value), this.duration);\n  },\n  _makeOutlines: function _makeOutlines(frame, total) {\n    var _this5 = this;\n\n    var _this = this;\n\n    var KEYS = utils.unique(this.model.marker._getAllDimensions({ exceptType: \"time\" }));\n    KEYS.forEach(function (key, i) {\n      if (key === _this.AGEDIM) KEYS[i] = _this.SHIFTEDAGEDIM;\n      //if (_this.geoLess)\n    });\n\n    var groupBy = this.groupBy;\n    var barHeight = this.barHeight;\n    var firstBarOffsetY = this.firstBarOffsetY + barHeight;\n\n    var line = d3.line().curve(d3.curveStepBefore).x(function (d) {\n      return d.x;\n    }) //_ + d.width_)\n    .y(function (d, i) {\n      return firstBarOffsetY - barHeight * i - (groupBy > 2 ? 1 : 0);\n    });\n\n    var pathsData = this.barsData.map(function (barsData, _i) {\n      var stackIndex = [0, 0];\n\n      return _this5.sideKeys.map(function (s, i) {\n        if (_this.stackSkip) {\n          barsData[0].side[i].stack.forEach(function (d, j) {\n            if (d[_this.PREFIXEDSIDEDIM] === d[_this.PREFIXEDSTACKDIM]) {\n              stackIndex[i] = j;\n            }\n          });\n        }\n        var data = {};\n        data.d = barsData.map(function (age) {\n          var r = {};\n          var x = utils.getValueMD(age.side[i].stack[stackIndex[i]], frame, KEYS);\n          r.x = x ? _this.xScale(x) : 0;\n          if (_this.ui.chart.inpercent) {\n            r.x /= total[_i][age.side[i].stack[stackIndex[i]][_this.PREFIXEDSIDEDIM]];\n          }\n          return r;\n        });\n        return data;\n      });\n    });\n\n    var data = this.bars.selectAll(\".vzb-bc-side-left\").selectAll(\".vzb-bc-stack-0\").data();\n    var color = _this.cScale(data[0][this.PREFIXEDSTACKDIM]);\n    var colorShade = this.model.marker.color.getColorShade({\n      colorID: _this.frameAllColor[data[0][this.PREFIXEDSTACKDIM]] || data[0][this.PREFIXEDSTACKDIM],\n      shadeID: \"shade\"\n    }) || \"#000\"; //d3.hsl(color).darker(2);\n\n    this.lockedPaths.each(function (d, _i) {\n      var paths = d3.select(this).selectAll(\"path\").data(pathsData[_i]);\n      paths.exit().remove();\n      paths.enter().append(\"path\").merge(paths).attr(\"d\", function (d, i) {\n        return line(d.d);\n      }).attr(\"stroke\", \"#000\") //colorShade)\n      .attr(\"transform\", function (d, i) {\n        return i ? \"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\" : \"\";\n      });\n    });\n  },\n  _setYear: function _setYear(timeValue) {\n    var formattedTime = this.model.time.formatDate(timeValue);\n    return function () {\n      d3.select(this).text(formattedTime);\n    };\n  },\n  _interaction: function _interaction() {\n    var _this = this;\n    return {\n      mouseover: function mouseover(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.highlightMarker(d);\n        _this._showLabel(d);\n      },\n      mouseout: function mouseout(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.clearHighlighted();\n      },\n      click: function click(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.selectMarker(d);\n      },\n      tap: function tap(d) {\n        d3.event.stopPropagation();\n        _this.model.marker.selectMarker(d);\n      }\n    };\n  },\n  _highlightBars: function _highlightBars(d) {\n    var _this = this;\n\n    _this.someHighlighted = _this.model.marker.highlight.length > 0;\n\n    _this.updateBarsOpacity();\n\n    if (!_this.someHighlighted) {\n      //hide labels\n      _this.labels.selectAll(\".vzb-hovered\").classed(\"vzb-hovered\", false);\n    }\n  },\n  _showLabel: function _showLabel(d) {\n    var _this = this;\n    var formatter = _this.ui.chart.inpercent ? d3.format(\".1%\") : _this.model.marker.axis_x.getTickFormatter();\n    var sideDim = _this.SIDEDIM;\n    var ageDim = _this.AGEDIM;\n    var stackDim = _this.STACKDIM;\n    var shiftedAgeDim = \"s_age\";\n    var left = _this.sideKeys.indexOf(d[sideDim]) > 0;\n\n    var deltaX = 7;\n    if (!this.smallMultiples) {\n      var hoverBarEl = d3.select(d3.event.target);\n      deltaX += +hoverBarEl.attr(\"x\");\n    }\n\n    var labelNode = _this.labels.select(\".vzb-bc-label-\" + d[shiftedAgeDim]).nodes()[d.i]; // + \"-\" + _this._id);\n    var labelEl = d3.select(labelNode);\n    labelEl.selectAll(\".vzb-bc-age\").text(function (textData) {\n      //var total = _this.ui.chart.inpercent ? _this.totalValues[d[sideDim]] : 1;\n      var text = _this.stackKeys.length > 1 ? _this.stackItems[d[stackDim]] : textData.text;\n      text = _this.twoSided ? text : textData.text + \" \" + _this.stackItems[d[stackDim]];\n      var value = _this.xScale.invert(d[\"width_\"]);\n      return text + \": \" + formatter(value);\n    }).attr(\"x\", left ? -this.activeProfile.centerWidth - deltaX : deltaX).attr(\"dx\", 0).classed(\"vzb-text-left\", left);\n    labelEl.classed(\"vzb-prehovered\", true);\n    var bbox = labelNode.getBBox();\n    var transform = _this.element.node().getScreenCTM().inverse().multiply(labelNode.getScreenCTM());\n    var overDrawLeft = Math.max(-bbox.x - transform.e, 0);\n    var overDrawRight = Math.min(_this.fullWidth - bbox.x - bbox.width - transform.e, 0);\n    labelEl.selectAll(\".vzb-bc-age\").attr(\"dx\", overDrawLeft + overDrawRight);\n    labelEl.classed(\"vzb-prehovered\", false);\n    labelEl.classed(\"vzb-hovered\", true);\n  },\n  getGraphWidth: function getGraphWidth(width, marginBetween) {\n    var _width = width || this.width;\n    if (this.smallMultiples) {\n      var length = this.graph.data().length;\n      _width -= marginBetween * (length - 1);\n      return this.domainScalers.map(function (scaler) {\n        return _width * scaler;\n      });\n    } else {\n      return [_width];\n    }\n  },\n  getYAxisVisibility: function getYAxisVisibility(index) {\n    return index == 0 ? true : false;\n  },\n\n\n  /**\n   * Executes everytime the container or vizabi is resized\n   * Ideally,it contains only operations related to size\n   */\n\n  presentationProfileChanges: {\n    medium: {\n      margin: { top: 120, right: 50, left: 80, bottom: 60, between: 30 },\n      infoElHeight: 32\n    },\n    large: {\n      margin: { top: 120, right: 70, left: 100, bottom: 70, between: 30 },\n      infoElHeight: 32\n    }\n  },\n\n  profiles: {\n    \"small\": {\n      margin: {\n        top: 50,\n        right: 20,\n        left: 40,\n        bottom: 20,\n        between: 10\n      },\n      infoElHeight: 16,\n      centerWidth: 2,\n      titlesSpacing: 5\n    },\n    \"medium\": {\n      margin: {\n        top: 70,\n        right: 40,\n        left: 60,\n        bottom: 20,\n        between: 20\n      },\n      infoElHeight: 20,\n      centerWidth: 2,\n      titlesSpacing: 10\n    },\n    \"large\": {\n      margin: {\n        top: 80,\n        right: 60,\n        left: 60,\n        bottom: 30,\n        between: 20\n      },\n      infoElHeight: 22,\n      centerWidth: 2,\n      titlesSpacing: 20\n    }\n  },\n\n  resize: function resize() {\n    var _this6 = this;\n\n    var _this = this;\n\n    this.activeProfile = this.getActiveProfile(this.profiles, this.presentationProfileChanges);\n\n    //this.activeProfile = this.profiles[this.getLayoutProfile()];\n    var margin = this.activeProfile.margin;\n    var infoElHeight = this.activeProfile.infoElHeight;\n\n    var deltaMarginTop = this.sideSkip ? margin.top * 0.23 : 0;\n    //stage\n    this.height = parseInt(this.element.style(\"height\"), 10) + deltaMarginTop - margin.top - margin.bottom || 0;\n    this.width = parseInt(this.element.style(\"width\"), 10) - margin.left - margin.right || 0;\n    this.fullWidth = parseInt(this.element.style(\"width\"), 10) || 0;\n    this.graphWidth = this.getGraphWidth(this.width, margin.between);\n\n    if (this.height <= 0 || this.width <= 0) return utils.warn(\"Pop by age resize() abort: vizabi container is too little or has display:none\");\n\n    var _sum = 0;\n    var _prevSum = 0;\n    var graphWidthSum = this.graphWidth.map(function (width) {\n      _prevSum = _sum;_sum += width;return _prevSum;\n    });\n    this.graph.attr(\"transform\", function (d, i) {\n      return \"translate(\" + Math.round(margin.left + margin.between * i + graphWidthSum[i]) + \",\" + (margin.top - deltaMarginTop) + \")\";\n    });\n\n    this.barsCrop.attr(\"width\", function (d, i) {\n      return _this6.graphWidth[i];\n    }).attr(\"height\", Math.max(0, this.height));\n\n    this.lockedCrop.attr(\"width\", function (d, i) {\n      return _this6.graphWidth[i];\n    }).attr(\"height\", Math.max(0, this.height));\n\n    this.labelsCrop.attr(\"width\", function (d, i) {\n      return _this6.graphWidth[i];\n    }).attr(\"height\", Math.max(0, this.height));\n\n    var groupBy = this.groupBy;\n\n    var domain = this.yScale.domain();\n    this.oneBarHeight = this.height / (domain[1] - domain[0]);\n    var barHeight = this.barHeight = this.oneBarHeight * groupBy; // height per bar is total domain height divided by the number of possible markers in the domain\n    this.firstBarOffsetY = this.height - this.barHeight;\n\n    if (this.stackBars) this.stackBars.attr(\"height\", barHeight - (groupBy > 2 ? 1 : 0));\n\n    if (this.sideBars) this.sideBars.attr(\"transform\", function (d, i) {\n      return i ? \"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\" : \"\";\n    });\n\n    //update scales to the new range\n    //apply scales to axes and redraw\n    this.yScale.range([this.height, 0]);\n\n    var yScaleCopy = this.yScale.copy();\n    if (groupBy > 2) {\n      yScaleCopy.ticks = function () {\n        return d3.range(domain[0], domain[1] + 1, groupBy);\n      };\n    }\n\n    this.yAxisEl.each(function (d, i) {\n      _this.yAxis.scale(yScaleCopy.range([_this.height, 0])).tickSizeInner(-_this.graphWidth[i]).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-_this.graphWidth[i], 0).labelerOptions({\n        scaleType: _this.model.marker.axis_y.scaleType,\n        toolMargin: margin,\n        limitMaxTickNumber: 19,\n        fitIntoScale: \"optimistic\",\n        isPivotAuto: false\n      });\n\n      d3.select(this).attr(\"transform\", \"translate(\" + 0 + \",0)\").call(_this.yAxis).classed(\"vzb-bc-axis-text-hidden\", !_this.getYAxisVisibility(i));\n    });\n    this.yAxisEl.select(\".tick line\").classed(\"vzb-hidden\", true);\n\n    var maxRange = _this.twoSided ? (_this.graphWidth[0] - _this.activeProfile.centerWidth) * 0.5 : _this.graphWidth[0];\n    this.xScale.range([0, maxRange]);\n\n    var format = this.ui.chart.inpercent ? d3.format((groupBy > 3 ? \".1\" : \".1\") + \"%\") : this.model.marker.axis_x.getTickFormatter();\n\n    var translateX = [];\n    this.xAxisEl.each(function (d, i) {\n      var maxRange = _this.twoSided ? (_this.graphWidth[i] - _this.activeProfile.centerWidth) * 0.5 : _this.graphWidth[i];\n      translateX[i] = _this.twoSided ? (_this.graphWidth[i] + _this.activeProfile.centerWidth) * 0.5 : 0;\n\n      _this.xAxis.scale(_this.xScale.copy().domain(_this.domains[i]).range([0, maxRange])).tickFormat(format).tickSizeInner(-_this.height).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-_this.height, 0).labelerOptions({\n        scaleType: _this.model.marker.axis_x.scaleType,\n        toolMargin: margin,\n        limitMaxTickNumber: 6\n      });\n\n      d3.select(this).attr(\"transform\", \"translate(\" + translateX[i] + \",\" + _this.height + \")\").call(_this.xAxis);\n      var zeroTickEl = d3.select(this).selectAll(\".tick text\");\n      var tickCount = zeroTickEl.size();\n      if (tickCount > 0) {\n        var zeroTickBBox = zeroTickEl.node().getBBox();\n        if (tickCount > 1) {\n          d3.select(zeroTickEl.node()).attr(\"dx\", (_this.twoSided ? -_this.activeProfile.centerWidth * 0.5 : 0) - zeroTickBBox.width * 0.5 - zeroTickBBox.x);\n        }\n        zeroTickEl.classed(\"vzb-invisible\", _this.graphWidth[i] + margin.between < zeroTickBBox.width);\n      }\n    });\n\n    this.xAxisEl.select(\".tick line\").classed(\"vzb-hidden\", true);\n    this.xAxisLeftEl.classed(\"vzb-hidden\", !this.twoSided);\n    if (this.twoSided) {\n      this.xScaleLeft.range([(this.graphWidth[0] - this.activeProfile.centerWidth) * 0.5, 0]);\n\n      this.xAxisLeftEl.each(function (d, i) {\n\n        _this.xAxisLeft.scale(_this.xScaleLeft.copy().domain(_this.domains[i]).range([(_this.graphWidth[i] - _this.activeProfile.centerWidth) * 0.5, 0])).tickFormat(format).tickSizeInner(-_this.height).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-_this.height, 0).labelerOptions({\n          scaleType: _this.model.marker.axis_x.scaleType,\n          toolMargin: margin,\n          limitMaxTickNumber: 6\n        });\n        d3.select(this).attr(\"transform\", \"translate(0,\" + _this.height + \")\").call(_this.xAxisLeft);\n        //hide left axis zero tick\n        var tickNodes = d3.select(this).selectAll(\".tick\").classed(\"vzb-hidden\", false).nodes();\n        d3.select(tickNodes[tickNodes.length - 1]).classed(\"vzb-hidden\", true);\n      });\n    }\n\n    var isRTL = this.model.locale.isRTL();\n\n    this.bars.attr(\"transform\", function (d, i) {\n      return \"translate(\" + translateX[i] + \",0)\";\n    });\n    this.lockedPaths.attr(\"transform\", function (d, i) {\n      return \"translate(\" + translateX[i] + \",0)\";\n    });\n    this.labels.attr(\"transform\", function (d, i) {\n      return \"translate(\" + translateX[i] + \",0)\";\n    });\n\n    var titleSpace = function titleSpace(i) {\n      return translateX[i] - _this6.activeProfile.titlesSpacing < 0 ? _this.activeProfile.centerWidth * 0.5 : _this.activeProfile.titlesSpacing;\n    };\n\n    this.title.attr(\"x\", function (d, i) {\n      return _this6.twoSided ? translateX[i] - _this.activeProfile.centerWidth * 0.5 - titleSpace(i) : 0;\n    }).style(\"text-anchor\", this.twoSided ? \"end\" : \"\").attr(\"y\", -margin.top * 0.275 - deltaMarginTop).each(function (d, i) {\n      _this.textEllipsis.wrap(this, _this.twoSided ? (_this.graphWidth[i] + margin.between - titleSpace(i)) * 0.5 : _this.graphWidth[i] + margin.between);\n    });\n    this.titleRight.attr(\"x\", function (d, i) {\n      return translateX[i] - _this.activeProfile.centerWidth * 0.5 + titleSpace(i);\n    }).attr(\"y\", -margin.top * 0.275 - deltaMarginTop).each(function (d, i) {\n      _this.textEllipsis.wrap(this, (_this.graphWidth[i] + margin.between - titleSpace(i)) * 0.5);\n    });\n    this.titleCenter.attr(\"x\", function (d, i) {\n      return _this6.twoSided ? translateX[i] - _this.activeProfile.centerWidth * 0.5 : _this.graphWidth[i] * 0.5;\n    }).style(\"text-anchor\", \"middle\").attr(\"y\", (-margin.top - deltaMarginTop) * 0.035).each(function (d, i) {\n      _this.textEllipsis.wrap(this, _this.graphWidth[i] + margin.between);\n    });\n\n    this.xTitleEl.style(\"font-size\", infoElHeight + \"px\").attr(\"transform\", \"translate(\" + (isRTL ? margin.left + this.width : margin.left * 0.4) + \",\" + margin.top * 0.35 + \")\");\n\n    if (this.xInfoEl.select(\"svg\").node()) {\n      var titleBBox = this.xTitleEl.node().getBBox();\n      var t = utils.transform(this.xTitleEl.node());\n      var hTranslate = isRTL ? titleBBox.x + t.translateX - infoElHeight * 1.4 : titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4;\n\n      this.xInfoEl.select(\"svg\").attr(\"width\", infoElHeight + \"px\").attr(\"height\", infoElHeight + \"px\");\n      this.xInfoEl.attr(\"transform\", \"translate(\" + hTranslate + \",\" + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n\n    var yearLabelOptions = {\n      topOffset: this.ui.presentation ? 25 : this.getLayoutProfile() === \"small\" ? 10 : 15,\n      rightOffset: this.getLayoutProfile() === \"small\" ? 5 : 10,\n      xAlign: \"right\",\n      yAlign: \"top\",\n      heightRatio: this.ui.presentation ? 0.5 : 0.5\n      //widthRatio: this.getLayoutProfile() === \"large\" ? 3 / 8 : 5 / 10\n    };\n\n    //year resized\n    this.year.setConditions(yearLabelOptions).resize(this.fullWidth, margin.top);\n    this.yearLocked.attr(\"x\", isRTL ? margin.left * 0.4 : this.width + margin.left + margin.right - 10).attr(\"y\", (margin.top - deltaMarginTop) * (this.getLayoutProfile() === \"large\" ? 1.27 : 1.27));\n  },\n  updateBarsOpacity: function updateBarsOpacity(duration) {\n    var _this = this;\n\n    var OPACITY_HIGHLT = 1.0;\n    var OPACITY_HIGHLT_DIM = this.model.marker.opacityHighlightDim;\n    var OPACITY_SELECT = 1.0;\n    var OPACITY_REGULAR = this.model.marker.opacityRegular;\n    var OPACITY_SELECT_DIM = this.model.marker.opacitySelectDim;\n\n    var nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n    var nonSelectedOpacityZeroFlag = nonSelectedOpacityZero != this.nonSelectedOpacityZero;\n    var someSelected = this.someSelected;\n    var someHighlighted = this.someHighlighted;\n\n    this.stackBars.each(function (d) {\n      var isSelected = someSelected ? _this.model.marker.isSelected(d) : false;\n      var isHighlighted = someHighlighted ? _this.model.marker.isHighlighted(d) : false;\n      var bar = d3.select(this);\n\n      bar.style(\"opacity\", isHighlighted ? OPACITY_HIGHLT : someSelected ? isSelected ? OPACITY_SELECT : OPACITY_SELECT_DIM : someHighlighted ? OPACITY_HIGHLT_DIM : OPACITY_REGULAR).style(\"stroke\", isSelected ? \"#333\" : null).style(\"y\", isSelected ? \"0.5px\" : null);\n\n      if (nonSelectedOpacityZeroFlag) {\n        bar.style(\"pointer-events\", !someSelected || !nonSelectedOpacityZero || isSelected ? \"visible\" : \"none\");\n      }\n    });\n\n    this.nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n  }\n});\n\nexports.default = PopByAge;\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports) {\n\nmodule.exports = \"<!-- PopByAge Component -->\\n<svg class=\\\"vzb-popbyage\\\">\\n    <g class=\\\"vzb-bc-header\\\">\\n        <g class=\\\"vzb-bc-axis-x-title\\\"></g>\\n        <g class=\\\"vzb-bc-axis-x-info vzb-noexport\\\"></g>\\n        <g class=\\\"vzb-bc-year-now\\\"></g>\\n        <text class=\\\"vzb-bc-year vzb-bc-year-locked\\\"></text>\\n    </g>\\n    <g class=\\\"vzb-bc-graph\\\">\\n        <text class=\\\"vzb-bc-title\\\"></text>\\n        <text class=\\\"vzb-bc-title vzb-bc-title-right\\\"></text>\\n        <text class=\\\"vzb-bc-title vzb-bc-title-center\\\"></text>\\n\\n        <g class=\\\"vzb-bc-axis-y-title\\\"></g>\\n\\n        <g class=\\\"vzb-bc-axis-y\\\"></g>\\n\\n        <svg class=\\\"vzb-bc-bars-crop\\\">\\n            <g class=\\\"vzb-bc-bars\\\"></g>\\n        </svg>\\n        \\n        <svg class=\\\"vzb-bc-locked-crop\\\">\\n            <g class=\\\"vzb-bc-paths\\\"></g>\\n        </svg>\\n\\n        <g class=\\\"vzb-bc-axis-x\\\"></g>\\n        <g class=\\\"vzb-bc-axis-x vzb-bc-axis-x-left\\\"></g>\\n\\n        <svg class=\\\"vzb-bc-labels-crop\\\">\\n            <g class=\\\"vzb-bc-labels\\\"></g>\\n        </svg>\\n\\n        <g class=\\\"vzb-bc-axis-labels\\\">\\n            <!-- <text class=\\\"vzb-x_label\\\">Lifespan</text>\\n                  <text class=\\\"vzb-y_label\\\">Lifespan</text> -->\\n        </g>\\n    </g>\\n    <g class=\\\"vzb-bc-tooltip vzb-hidden\\\">\\n        <rect class=\\\"vzb-tooltip-border\\\"></rect>\\n        <text class=\\\"vzb-tooltip-text\\\"></text>\\n    </g>\\n</svg>\\n\";\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = __webpack_require__(0);\n\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// popbyage.min.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 2eeb54993b9ff0d9119c","import \"./styles.scss\";\nimport component from \"./component\";\n\nconst VERSION_INFO = { version: __VERSION, build: __BUILD };\n\n//BAR CHART TOOL\nconst PopByAge = Vizabi.Tool.extend(\"PopByAge\", {\n\n  /**\n   * Initializes the tool (Bar Chart Tool).\n   * Executed once before any template is rendered.\n   * @param {Object} placeholder Placeholder element for the tool\n   * @param {Object} external_model Model as given by the external page\n   */\n  init(placeholder, external_model) {\n\n    this.name = \"popbyage\";\n\n    //specifying components\n    this.components = [{\n      component,\n      placeholder: \".vzb-tool-viz\",\n      model: [\"state.time\", \"state.marker\", \"state.marker_allpossible\", \"state.entities\", \"state.entities_side\", \"state.entities_age\", \"state.entities_allpossible\", \"state.entities_geodomain\", \"locale\", \"ui\"] //pass models to component\n    }, {\n      component: Vizabi.Component.get(\"timeslider\"),\n      placeholder: \".vzb-tool-timeslider\",\n      model: [\"state.time\", \"state.entities\", \"state.marker\", \"ui\"]\n    }, {\n      component: Vizabi.Component.get(\"dialogs\"),\n      placeholder: \".vzb-tool-dialogs\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"buttonlist\"),\n      placeholder: \".vzb-tool-buttonlist\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"treemenu\"),\n      placeholder: \".vzb-tool-treemenu\",\n      model: [\"state.marker\", \"state.marker_tags\", \"state.time\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datanotes\"),\n      placeholder: \".vzb-tool-datanotes\",\n      model: [\"state.marker\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"steppedspeedslider\"),\n      placeholder: \".vzb-tool-stepped-speed-slider\",\n      model: [\"state.time\", \"locale\"]\n    }];\n\n    //constructor is the same as any tool\n    this._super(placeholder, external_model);\n  },\n\n  validate(model) {\n    model = this.model || model;\n\n    this._super(model);\n\n    //validate on first model set only\n    if (!this.model) {\n      const entities = model.state.entities;\n      const dimAllPossible = model.state.entities_allpossible.dim;\n      if (Object.keys(entities.show).length > 0) {\n        const show = {};\n        if (entities.show[entities.dim] && entities.show[entities.dim][\"$in\"]) {\n          show[entities.dim] = {};\n          show[entities.dim][\"$in\"] = entities.show[entities.dim][\"$in\"];\n        }\n        if (entities.dim !== dimAllPossible) {\n          show[\"is--\" + dimAllPossible] = true;\n        }\n        if (!entities.show[entities.dim] || !(Object.keys(entities.show).length == 1)) {\n          entities.show = show;\n        }\n      }\n\n      const entities_geodomain = model.state.entities_geodomain;\n      entities_geodomain.skipFilter = (model.state.entities.dim === entities_geodomain.dim || model.state.entities_side.dim === entities_geodomain.dim) && \n        (Boolean(model.state.entities.getFilteredEntities().length) || !model.state.entities_side.skipFilter);\n    }\n  },\n\n  default_model: {\n    state: {\n      marker_tags: {}\n    },\n    ui: {\n      chart: {\n        mode: \"smallMultiples\",\n        stacked: true,\n        inpercent: false,\n        flipSides: true,\n        lockActive: true,\n        lockNonSelected: 0\n      },\n      \"buttons\": [\"colors\", \"show\", \"lock\", \"side\", \"inpercent\", \"moreoptions\", \"fullscreen\"],\n      \"dialogs\": {\n        \"popup\": [\"timedisplay\", \"colors\", \"show\", \"side\", \"moreoptions\"],\n        \"sidebar\": [\"timedisplay\", \"colors\", \"grouping\", \"show\"],\n        \"moreoptions\": [\"opacity\", \"speed\", \"grouping\", \"colors\", \"side\", \"presentation\", \"about\"]\n      },\n      presentation: false\n    },\n    locale: { }\n  },\n\n  versionInfo: VERSION_INFO\n});\n\nexport default PopByAge;\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","const {\n  utils,\n  Component,\n  helpers: {\n    \"d3.axisWithLabelPicker\": axisSmart,\n    \"d3.dynamicBackground\": DynamicBackground,\n    \"textEllipsis\": TextEllipsis\n  },\n  iconset: {\n    question: iconQuestion\n  },\n} = Vizabi;\n\n// POP BY AGE CHART COMPONENT\nconst PopByAge = Component.extend(\"popbyage\", {\n\n  /**\n   * Initializes the component (Bar Chart).\n   * Executed once before any template is rendered.\n   * @param {Object} config The config passed to the component\n   * @param {Object} context The component's parent\n   */\n  init(config, context) {\n    this.name = \"popbyage\";\n    this.template = require(\"./template.html\");\n\n    //define expected models for this component\n    this.model_expects = [{\n      name: \"time\",\n      type: \"time\"\n    }, {\n      name: \"marker\",\n      type: \"marker\"\n    }, {\n      name: \"marker_allpossible\",\n      type: \"marker\"\n    }, {\n      name: \"entities\",\n      type: \"entities\"\n    }, {\n      name: \"entities_side\",\n      type: \"entities\"\n    }, {\n      name: \"entities_age\",\n      type: \"entities\"\n    }, {\n      name: \"entities_allpossible\",\n      type: \"entities\"\n    }, {\n      name: \"entities_geodomain\",\n      type: \"entities\"\n    }, {\n      name: \"locale\",\n      type: \"locale\"\n    }, {\n      name: \"ui\",\n      type: \"ui\"\n    }];\n\n    const _this = this;\n    this.model_binds = {\n      \"change:time.startSelected\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.time.set({\n          startSelected: new Date(_this.timeSteps[0])\n        }, false, false);\n\n      },\n      \"change:time.endSelected\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.time.set({\n          endSelected: new Date(_this.timeSteps[_this.timeSteps.length - 1])\n        }, false, false);\n      },\n      \"change:time.value\": function(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.time.step != 1 && !_this.snapped && !_this.model.time.playing && !_this.model.time.dragging) {\n          if(_this.snapTime) {\n            if(+_this.snapTime - _this.model.time.value === 0) {\n              _this.snapTime = null;\n              _this.model.time.snap();\n            } else {\n              _this.model.time.value = new Date(_this.snapTime);\n            }\n            return;\n          }\n          if(_this.updateStartEnd(_this.model.time.value, _this.groupBy)) {\n            _this.ready();\n            return;\n          };\n          let next = d3.bisectLeft(_this.timeSteps, _this.model.time.value);\n          if (next != 0 && (_this.timeSteps[next] - _this.model.time.value)) {\n            _this.snapped = true;\n            const time = _this.model.time.value;\n            const prev = _this.timeSteps[next - 1];\n            next = _this.timeSteps[next];\n            const snapTime = (time - prev) < (next - time) ? prev : next;\n            _this.model.time.value = new Date(snapTime);\n          }\n        }\n        if (!_this.snapped) {\n          if (_this.timeSteps.filter(t => (t - _this.model.time.value) == 0).length) {\n            _this.model.marker.getFrame(_this.model.time.value, frame => {\n              if(!frame) return;\n              _this.frame = frame;\n              _this.frameAxisX = frame.axis_x;\n              _this._updateEntities();\n              _this.updateBarsOpacity();\n            });\n          } else if(_this.model.time.value < _this.model.time.startSelected || _this.model.time.value > _this.model.time.endSelected) {\n            _this.snapTime = _this.model.time.value;\n          } else {\n            _this.snapTime = null;\n            const nextIndex = d3.bisectLeft(_this.timeSteps, _this.model.time.value);\n            const prevFrameTime = _this.timeSteps[nextIndex - 1];\n            const nextFrameTime = _this.timeSteps[nextIndex];\n            const fraction = (_this.model.time.value - prevFrameTime) / (nextFrameTime - prevFrameTime);\n            _this.model.marker.getFrame(nextFrameTime, nValues => {\n              _this.model.marker.getFrame(prevFrameTime, pValues => {\n                _this.frameAxisX = _this.interpolateDiagonal(pValues.axis_x, nValues.axis_x, fraction);\n                _this._updateEntities();\n                _this.updateBarsOpacity();\n              });\n            });\n          }\n        }\n        _this.snapped = false;\n      },\n      \"change:marker.select\": function(evt) {\n        _this.someSelected = (_this.model.marker.select.length > 0);\n        _this.nonSelectedOpacityZero = false;\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.highlight\": function(evt, path) {\n        if (!_this._readyOnce) return;\n        _this._highlightBars();\n      },\n      \"change:marker.opacitySelectDim\": function() {\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.opacityRegular\": function() {\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.color.palette\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateEntities(true);\n      },\n      \"change:marker.color.scaleType\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateEntities();\n      },\n      \"change:marker.color.which\": function(evt) {\n        if (!_this._readyOnce) return;\n        let stackDim;\n        const show = {};\n        const entitiesProps = {}\n        if (_this.model.marker.color.use == \"constant\") {\n          stackDim = null;\n        } else {\n          const colorConcept = _this.model.marker.color.getConceptprops();\n          if (colorConcept.concept_type == \"entity_set\") {\n            stackDim = colorConcept.domain;\n            //show[\"is--\" + _this.model.marker.color.which] = true;\n            show[stackDim] = {};\n            const sideConcept = _this.model.marker.side.getConceptprops();\n            if (sideConcept.concept_type == \"entity_set\" && stackDim == sideConcept.domain && _this.model.marker.side.which !== _this.model.marker.color.which) {\n              _this.model.marker.side.setWhich({\"concept\" : _this.model.marker.color.which});\n            }\n          } else {\n            stackDim = _this.model.marker.color.which;\n          }\n        }\n        if (_this.STACKDIM !== stackDim) {\n          entitiesProps[\"show\"] = show;\n        }\n        entitiesProps[\"dim\"] = stackDim;\n        const skipFilterSide = _this.SIDEDIM !== _this.geoDomainDimension || _this.model.marker.color.which === _this.model.marker.side.which;\n        if (!skipFilterSide) {\n          const sideShow = {};\n          sideShow[\"is--\" + _this.model.marker.side.which] = true;\n          _this.model.entities_side.set(\"show\", sideShow);\n        }\n        _this.model.entities_side.skipFilter = skipFilterSide;\n        _this.model.entities.set(entitiesProps);\n        _this.model.entities_geodomain.skipFilter = (stackDim === _this.geoDomainDimension || _this.SIDEDIM === _this.geoDomainDimension) &&\n          (Boolean(_this.model.entities.getFilteredEntities().length) || !_this.model.entities_side.skipFilter);\n        _this.model.entities_allpossible.set(\"dim\", stackDim);\n        _this.model.marker_allpossible.color.set(\"which\", _this.model.marker.color.which);\n      },\n      \"change:marker.side.which\": function(evt) {\n        if (!_this._readyOnce) return;\n        let sideDim;\n        const show = {};\n        const entitiesSideProps = {}\n        if (_this.model.marker.side.use == \"constant\") {\n          sideDim = null;\n        } else {\n          const sideConcept = _this.model.marker.side.getConceptprops();\n          if (sideConcept.concept_type == \"entity_set\") {\n            sideDim = sideConcept.domain;\n            const colorConcept = _this.model.marker.color.getConceptprops();\n            if (colorConcept.concept_type == \"entity_set\" && sideDim == colorConcept.domain && _this.model.marker.color.which !== _this.model.marker.side.which) {\n              _this.model.marker.color.setWhich({\"concept\" : _this.model.marker.side.which});\n            }\n          } else {\n            sideDim = _this.model.marker.side.which;\n          }\n        }\n//        const sideDim = _this.model.marker.side.use == \"constant\" ? null : _this.model.marker.side.which;\n        _this.model.marker.side.clearSideState();\n        const skipFilterSide = sideDim !== _this.geoDomainDimension || _this.model.marker.color.which === _this.model.marker.side.which;\n        if (!skipFilterSide) {\n          show[\"is--\" + _this.model.marker.side.which] = true;\n        }\n        _this.model.entities_side.skipFilter = skipFilterSide;\n        entitiesSideProps[\"show\"] = show;\n        entitiesSideProps[\"dim\"] = sideDim;\n//        _this.model.entities_side.clearShow();\n        _this.model.entities_side.set(entitiesSideProps);\n        _this.model.entities_geodomain.skipFilter = (sideDim === _this.geoDomainDimension || _this.STACKDIM === _this.geoDomainDimension) &&\n          (Boolean(_this.model.entities.getFilteredEntities().length) || !_this.model.entities_side.skipFilter);\n        if(_this.model.marker.color.which === _this.model.marker.side.which) {\n          _this.model.entities.clearShow();\n        }\n      },\n      \"change:entities.show\": function(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.entities.dim === _this.model.entities_side.dim\n          && !utils.isEmpty(_this.model.entities_side.show)) {\n          const showEntities = _this.model.entities_side.getFilteredEntities().filter(s => !_this.model.entities.isShown(s));\n          if (showEntities.length) {\n            _this.model.marker.side.clearSideState();\n            _this.model.entities_side.showEntity(showEntities);\n          }\n        }\n        _this.model.entities_geodomain.skipFilter = (_this.SIDEDIM === _this.geoDomainDimension || _this.STACKDIM === _this.geoDomainDimension) &&\n          (Boolean(_this.model.entities.getFilteredEntities().length) || !_this.model.entities_side.skipFilter);\n      },\n      \"change:entities_side.show\": function(evt) {\n        if (!_this._readyOnce) return;\n\n        let doReturn = false;\n        let _entitiesSameDimWithSide = null;\n        utils.forEach(_this.model.marker.side._space, h => {\n          if (h.dim === _this.model.entities_side.dim && h._name !== _this.model.entities_side._name && h._name !== _this.model.entities_geodomain._name) {\n            _entitiesSameDimWithSide = h;\n          }\n        });\n        if (_entitiesSameDimWithSide) {\n          _this.model.entities.getFilteredEntities();\n          const showEntities = _this.model.entities_side.getFilteredEntities().filter(s => !_entitiesSameDimWithSide.isShown(s));\n          if (showEntities.length) {\n            _entitiesSameDimWithSide.showEntity(showEntities);\n            doReturn = true;\n          }\n        }\n        if (_this.SIDEDIM !== _this.model.entities_side.dim) {\n          doReturn = true;\n        }\n        if (doReturn) return;\n\n        _this._updateIndicators();\n        _this._updateSideTitles();\n\n        if (!_this.model._ready || !_this.frame) return;\n        if (_this.smallMultiples) {\n          utils.forEach(_this.stackKeys, (stackKey, i) => {\n            _this._updateLimits(stackKey, i);\n          });\n        } else {\n          _this._updateLimits();\n        }\n        _this.resize();\n        _this._updateEntities(true);\n        _this._redrawLocked();\n      },\n      \"change:entities_age.grouping\": function(evt) {\n        _this.groupBy = +_this.model.entities_age.grouping || 1;\n        _this.model.time.step = _this.groupBy;\n        _this.timeSteps = _this.model.time.getAllSteps();\n        _this.model.ui.chart.lockNonSelected = 0;\n        _this.labels.text(\"\");\n      },\n      \"change:ui.chart.inpercent\": function(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.smallMultiples) {\n          utils.forEach(_this.stackKeys, (stackKey, i) => {\n            _this._updateLimits(stackKey, i);\n          });\n        } else {\n          _this._updateLimits();\n        }\n        _this.resize();\n        _this._updateEntities();\n        _this._redrawLocked();\n      },\n      \"change:ui.chart.flipSides\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.marker.side.switchSideState();\n        _this._updateIndicators();\n        _this._updateSideTitles();\n        _this.resize();\n        _this._updateEntities(true);\n        _this._redrawLocked();\n      },\n      \"change:ui.chart.lockNonSelected\": function(evt) {\n        _this.lock = _this.model.ui.chart.lockNonSelected;\n        if (_this.lock) {\n          if (!(_this.stackKeys.length <= 1 || _this.stackSkip || _this.smallMultiples)) {\n            _this.model.ui.chart.lockNonSelected = 0;\n            return;\n          }\n          _this.yearLocked.text(\" \" + _this.lock);//\n          _this._makeOutlines(_this.frameAxisX, _this.total);\n        } else {\n          _this.yearLocked.text(\"\");\n          _this.lockedPaths.text(\"\");\n        }\n      },\n      \"ready:marker\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.updateStartEnd(_this.model.time.value, _this.groupBy);\n      }\n    };\n\n    //contructor is the same as any component\n    this._super(config, context);\n\n    this.textEllipsis = new TextEllipsis(this);\n\n    this.xScale = null;\n    this.yScale = null;\n    this.cScale = null;\n\n    this.xAxis = axisSmart(\"bottom\");\n    this.xAxisLeft = axisSmart(\"bottom\");\n    this.yAxis = axisSmart(\"left\");\n    this.xScales = [];\n    this.SHIFTEDAGEDIM = \"s_age\";\n\n  },\n\n  domReady() {\n    this._super();\n    ////replace code below when IE11 support will be skipped\n    // this.graphTemplate = d3.select(this.element)\n    //   .select(\".vzb-bc-graph\")\n    //   .html();\n    this.graphTemplate = new XMLSerializer().serializeToString(d3.select(this.element).select(\".vzb-bc-graph\").node());\n    ////\n  },\n\n  // afterPreload: function() {\n  //   var obj = {};\n  //   obj[\"which\"] = this.model.marker.axis_x.which;\n  //   obj[\"use\"] = this.model.marker.axis_x.use;\n  //   this.model.marker_side.hook_total.set(obj);\n  // },\n\n  updateStartEnd(time, groupBy) {\n    const timeModel = this.model.time;\n    const timeYear = timeModel.formatDate(time);\n    const startYear = +timeModel.formatDate(timeModel.start);\n    const offset = (+timeYear - startYear) % groupBy;\n    if (offset !== timeModel.offset) {\n      timeModel.set(\"offset\", offset, false, false);\n      this.timeSteps = timeModel.getAllSteps();\n      timeModel.set({\n        startSelected: new Date(this.timeSteps[0]),\n        endSelected: new Date(this.timeSteps[this.timeSteps.length - 1])\n      }, false, false);\n      return true;\n    }\n    return false;\n  },\n\n  getTimeOffset(timeModel, groupBy) {\n    const startYear = +timeModel.formatDate(timeModel.start);\n    const timeYear = +timeModel.formatDate(timeModel.value);\n    return (+timeYear - startYear) % groupBy;\n  },\n\n  checkDimensions() {\n    const stackDim = this.model.entities.dim;\n    const sideDim = this.model.entities_side.dim;\n\n    this.colorUseConstant = this.model.marker.color.use == \"constant\";\n    this.stackSkip = this.colorUseConstant || stackDim == sideDim;\n    this.geoLess = stackDim !== this.geoDomainDimension && sideDim !== this.geoDomainDimension;\n    this.sideSkip = this.model.marker.side.use == \"constant\";\n  },\n\n  /**\n   * DOM is ready\n   */\n  readyOnce() {\n    const _this = this;\n    this.el = (this.el) ? this.el : d3.select(this.element);\n    this.element = this.el;\n\n    this.textEllipsis.setTooltip(this.element.select(\".vzb-bc-tooltip\"));\n\n    this.interaction = this._interaction();\n\n    this.geoDomainDimension = this.model.entities_geodomain.getDimension();\n    this.geoDomainDefaultValue = this.model.entities_geodomain.show[this.geoDomainDimension][\"$in\"][0];\n\n    this.xTitleEl = this.element.select(\".vzb-bc-axis-x-title\");\n    this.xInfoEl = this.element.select(\".vzb-bc-axis-x-info\");\n    this.yearEl = this.element.select(\".vzb-bc-year-now\");\n    this.year = new DynamicBackground(this.yearEl); \n    this.year.setText(this.model.time.formatDate(this.model.time.value));\n    this.yearLocked = this.element.select(\".vzb-bc-year-locked\");\n\n    this.someSelected = (this.model.marker.select.length > 0);\n    this.nonSelectedOpacityZero = false;\n\n    this.groupBy = +this.model.entities_age.grouping || 1;\n\n    this.on(\"resize\", () => {\n      _this._updateEntities();\n      _this._redrawLocked();\n    });\n\n    this._attributeUpdaters = {\n      _newWidth(d, i) {\n        //d[\"x_\"] = 0;\n        let width;\n        if (_this.geoLess && _this.stackSkip && _this.sideSkip) {\n          width = (_this.frameAxisX[d[_this.AGEDIM] + _this.ageShift] || {})[_this.geoDomainDefaultValue];\n        } else if (_this.geoLess && _this.stackSkip) {\n          width = _this.colorUseConstant || d[_this.PREFIXEDSIDEDIM] == d[_this.PREFIXEDSTACKDIM] ? (_this.frameAxisX[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM] + _this.ageShift] || {})[_this.geoDomainDefaultValue] : 0;\n        } else if (_this.geoLess && _this.sideSkip) {\n          width = (_this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.AGEDIM] + _this.ageShift] || {})[_this.geoDomainDefaultValue];\n        } else if (_this.stackSkip) {\n          width = _this.colorUseConstant || d[_this.PREFIXEDSIDEDIM] == d[_this.PREFIXEDSTACKDIM] ? _this.frameAxisX[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM] + _this.ageShift] : 0;\n        } else if (_this.sideSkip) {\n          width = _this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.AGEDIM] + _this.ageShift];\n        } else {\n          width = _this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM] + _this.ageShift];\n        }\n        d[\"width_\"] = width ? _this.xScale(width) : 0;\n        if (_this.ui.chart.inpercent) {\n          d[\"width_\"] /= _this.total[d.i][d[_this.PREFIXEDSIDEDIM]];\n        }\n        return d.width_;\n      },\n      _newX(d, i) {\n        const prevSbl = this.previousSibling;\n        if (prevSbl) {\n          const prevSblDatum = d3.select(prevSbl).datum();\n          d[\"x_\"] = prevSblDatum.x_ + prevSblDatum.width_;\n        }\n        // else {\n        //   d[\"x_\"] = 0;\n        // }\n        return d.x_;\n      }\n    };\n  },\n\n  /*\n   * Both model and DOM are ready\n   */\n  ready() {\n    //TODO: get component ready if some submodel doesn't ready ??????\n    if (!this.model.marker._ready) return;\n\n    const _this = this;\n\n    this.lock = _this.model.ui.chart.lockNonSelected;\n\n    this.timeSteps = this.model.time.getAllSteps();\n\n    this.shiftScale = d3.scaleLinear()\n      .domain([this.timeSteps[0], this.timeSteps[this.timeSteps.length - 1]])\n      .range([0, this.timeSteps.length - 1]);\n\n    this.domains = [];\n\n    this.SIDEDIM = this.model.entities_side.getDimension();\n    this.PREFIXEDSIDEDIM = \"side_\" + this.SIDEDIM;\n    this.STACKDIM = this.model.entities.getDimension();// || this.geoDomainDimension;//this.model.marker.color.which;\n    this.PREFIXEDSTACKDIM = \"stack_\" + this.STACKDIM;\n    this.AGEDIM = this.model.entities_age.getDimension();\n    this.TIMEDIM = this.model.time.getDimension();\n    this.checkDimensions();\n    this.updateUIStrings();\n    this._updateIndicators();\n    this.smallMultiples = (this.model.ui.chart || {}).mode === \"smallMultiples\" && !this.stackSkip && this.stackKeys.length > 1 ? true : false;\n    this._updateGraphs(this.smallMultiples ? this.stackKeys : [\"undefined\"]);\n    this._updateSideTitles();\n\n    if (this.lock && (this.stackKeys.length <= 1 || this.stackSkip || this.smallMultiples)) {\n      this.yearLocked.text(\"\" + this.lock);\n    } else {\n      _this.model.ui.chart.lockNonSelected = 0;\n    }\n    this.model.ui.chart.set(\"lockUnavailable\", !(this.stackKeys.length <= 1 || this.stackSkip || this.smallMultiples), false, false);\n\n    this.frame = null;\n    this.frameAllColor = {};\n\n    this.model.marker.getFrame(_this.model.time.value, (frame, time) => {\n      _this.frame = frame;\n      _this.frameAxisX = frame.axis_x;\n\n      const frames = {};\n      frames[time] = frame;\n      _this.maxLimits = {};\n      _this.inpercentMaxLimits = {};\n      _this.totals = {};\n\n      if (_this.smallMultiples) {\n        utils.forEach(_this.stackKeys, (stackKey, i) => {\n          _this._createLimits(frames, stackKey);\n          _this._updateLimits(stackKey, i);\n        });\n      } else {\n        _this._createLimits(frames);\n        _this._updateLimits();\n      }\n      _this._getLimits();\n\n      _this.resize();\n      _this.model.marker_allpossible.getFrame(_this.model.time.value, apFrame => {\n        _this.frameAllColor = apFrame.color || {};\n        _this._updateEntities(true);\n        _this.updateBarsOpacity();\n        //_this._redrawLocked();\n        //_this.model.time.set('value', _this.model.time.value, true, true);\n      });\n    });\n\n  },\n\n  _updateGraphs(data) {\n    const _this = this;\n    const graph = this.element.selectAll(\".vzb-bc-graph\").data(data)\n    graph.exit().remove();\n    ////replace code below when IE11 support will be skipped\n    //  graph.enter().append(\"g\")\n    //   .attr(\"class\", \"vzb-bc-graph\")\n    //   .html(this.graphTemplate);\n    graph.enter().append(function() {\n      return this.ownerDocument.importNode(\n        new DOMParser().parseFromString(_this.graphTemplate, 'application/xml').documentElement, true);\n    });\n    ////\n\n    this.element.select(\".vzb-bc-tooltip\").raise();\n    this.graph = this.element.selectAll(\".vzb-bc-graph\");\n    this.yAxisEl = this.graph.select(\".vzb-bc-axis-y\");\n    this.xAxisEl = this.graph.select(\".vzb-bc-axis-x\");\n    this.xAxisLeftEl = this.graph.select(\".vzb-bc-axis-x-left\");\n    this.yTitleEl = this.graph.select(\".vzb-bc-axis-y-title\");\n    this.title = this.graph.select(\".vzb-bc-title\");\n    this.titleRight = this.graph.select(\".vzb-bc-title-right\");\n    this.titleCenter = this.graph.select(\".vzb-bc-title-center\");\n    this.barsCrop = this.graph.select(\".vzb-bc-bars-crop\");\n    this.lockedCrop = this.graph.select(\".vzb-bc-locked-crop\");\n    this.labelsCrop = this.graph.select(\".vzb-bc-labels-crop\");\n    this.bars = this.barsCrop.select(\".vzb-bc-bars\");\n    this.lockedPaths = this.lockedCrop.select(\".vzb-bc-paths\");\n    this.labels = this.labelsCrop.select(\".vzb-bc-labels\");\n  },\n\n  _getLimits() {\n    const _this = this;\n    return function() {\n      const groupBy = _this.groupBy;\n      _this.model.marker.getFrame(null, frames => {\n        if(!frames || groupBy !== _this.groupBy) return;\n        if (_this.smallMultiples) {\n          utils.forEach(_this.stackKeys, (stackKey, i) => {\n            _this._createLimits(frames, stackKey);\n            _this._updateLimits(stackKey, i);            \n          });\n        } else {\n          _this._createLimits(frames);\n          _this._updateLimits();\n        }\n        _this.resize();\n        _this._updateEntities(true);\n        _this.updateBarsOpacity();\n        _this._redrawLocked();\n      });\n    }();\n  },\n\n  _redrawLocked() {\n    const _this = this;\n    if (!this.lock) return;\n\n    this.model.marker.getFrame(this.model.time.parse(\"\" + this.lock), (lockFrame, lockTime) => {\n      if (!lockFrame) return;\n      _this.lockedPaths.text(\"\");\n      let total = {};\n      if (this.ui.chart.inpercent) {\n        if (this.smallMultiples) {\n          utils.forEach(this.stackKeys, (stackKey, i) => {\n            total[i] = this.totals[stackKey][lockTime] ? this.totals[stackKey][lockTime] : this._interpolateBetweenTotals(this.timeSteps, this.totals[stackKey], lockTime);\n          });\n        } else {\n          total[0] = this.totals[lockTime] ? this.totals[lockTime] : this._interpolateBetweenTotals(this.timeSteps, this.totals, lockTime);\n        }\n        if (!total[0]) return;\n      }\n      _this._makeOutlines(lockFrame.axis_x, total);\n    });\n  },\n\n  interpolateDiagonal(pValues, nValues, fraction) {\n    const _this = this;\n    const dataBetweenFrames = {};\n    let data;\n    let val1, val2, shiftedAge;\n    const groupBy = this.groupBy;\n    if (this.geoLess && this.stackSkip && this.sideSkip) {\n      data = dataBetweenFrames;\n      utils.forEach(_this.ageKeys, age => {\n        shiftedAge = +age + groupBy;\n        val1 = pValues[age][_this.geoDomainDefaultValue];\n        val2 = (nValues[shiftedAge] || {})[_this.geoDomainDefaultValue] || 0;\n        data[shiftedAge] = {};\n        data[shiftedAge][_this.geoDomainDefaultValue] = (val1 == null || val2 == null) ? null : val1 + ((val2 - val1) * fraction);\n      });\n      data[0] = {};\n      data[0][_this.geoDomainDefaultValue] = nValues[0][_this.geoDomainDefaultValue] || 0;\n    } else if (this.stackSkip && this.geoLess) {\n      utils.forEach(_this.sideKeys, side => {\n        data = dataBetweenFrames[side] = {};\n        utils.forEach(_this.ageKeys, age => {\n          shiftedAge = +age + groupBy;\n          val1 = pValues[side][age][_this.geoDomainDefaultValue];\n          val2 = (nValues[side][shiftedAge] || {})[_this.geoDomainDefaultValue] || 0;\n          data[shiftedAge] = {};\n          data[shiftedAge][_this.geoDomainDefaultValue] = (val1 == null || val2 == null) ? null : val1 + ((val2 - val1) * fraction);\n        });\n        data[0] = {};\n        data[0][_this.geoDomainDefaultValue] = nValues[side][0][_this.geoDomainDefaultValue] || 0;\n      });\n    } else if (this.stackSkip) {\n      utils.forEach(_this.sideKeys, side => {\n        data = dataBetweenFrames[side] = {};\n        utils.forEach(_this.ageKeys, age => {\n          shiftedAge = +age + groupBy;\n          val1 = pValues[side][age];\n          val2 = nValues[side][shiftedAge] || 0;\n          data[shiftedAge] = (val1 == null || val2 == null) ? null : val1 + ((val2 - val1) * fraction);\n        });\n        data[0] = nValues[side][0] || 0;\n      });\n    } else if (this.sideSkip && this.geoLess) {\n      utils.forEach(_this.stackKeys, stack => {\n        data = dataBetweenFrames[stack] = {};\n        utils.forEach(_this.ageKeys, age => {\n          shiftedAge = +age + groupBy;\n          val1 = pValues[stack][age][_this.geoDomainDefaultValue];\n          val2 = (nValues[stack][shiftedAge] || {})[_this.geoDomainDefaultValue] || 0;\n          data[shiftedAge] = {};\n          data[shiftedAge][_this.geoDomainDefaultValue] = (val1 == null || val2 == null) ? null : val1 + ((val2 - val1) * fraction);\n        });\n        data[0] = {};\n        data[0][_this.geoDomainDefaultValue] = nValues[stack][0][_this.geoDomainDefaultValue] || 0;\n      });\n    } else if (this.sideSkip) {\n      utils.forEach(_this.stackKeys, stack => {\n        data = dataBetweenFrames[stack] = {};\n        utils.forEach(_this.ageKeys, age => {\n          shiftedAge = +age + groupBy;\n          val1 = pValues[stack][age];\n          val2 = nValues[stack][shiftedAge] || 0;\n          data[shiftedAge] = (val1 == null || val2 == null) ? null : val1 + ((val2 - val1) * fraction);\n        });\n        data[0] = nValues[stack][0] || 0;\n      });\n    } else {\n      utils.forEach(_this.stackKeys, stack => {\n        dataBetweenFrames[stack] = {};\n        utils.forEach(_this.sideKeys, side => {\n          data = dataBetweenFrames[stack][side] = {};\n          utils.forEach(_this.ageKeys, age => {\n            shiftedAge = +age + groupBy;\n            val1 = pValues[stack][side][age];\n            val2 = nValues[stack][side][shiftedAge] || 0;\n            data[shiftedAge] = (val1 == null || val2 == null) ? null : val1 + ((val2 - val1) * fraction);\n          });\n          data[0] = nValues[stack][side][0] || 0;\n        });\n      });\n    }\n    return dataBetweenFrames;\n  },\n\n  updateUIStrings() {\n    const _this = this;\n    this.translator = this.model.locale.getTFunction();\n\n    const xTitle = this.xTitleEl.selectAll(\"text\").data([0]);\n    xTitle.enter().append(\"text\")\n      .text(_this.translator(\"popbyage/title\"));\n\n    const conceptPropsX = this.model.marker.axis_x.getConceptprops();\n    utils.setIcon(this.xInfoEl, iconQuestion)\n      .select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\")\n      .style('opacity', Number(Boolean(conceptPropsX.description || conceptPropsX.sourceLink)));\n\n    this.xInfoEl.on(\"click\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.xInfoEl.on(\"mouseover\", function() {\n      if (_this.model.time.dragging) return;\n      const rect = this.getBBox();\n      const coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      const toolRect = _this.root.element.getBoundingClientRect();\n      const chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"axis_x\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.xInfoEl.on(\"mouseout\", () => {\n      if (_this.model.time.dragging) return;\n    _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n  });\n\n    // var titleStringY = this.model.marker.axis_y.getConceptprops().name;\n\n    // var yTitle = this.yTitleEl.selectAll(\"text\").data([0]);\n    // yTitle.enter().append(\"text\");\n    // yTitle\n    //   .attr(\"y\", \"-6px\")\n    //   .attr(\"x\", \"-9px\")\n    //   .attr(\"dx\", \"-0.72em\")\n    //   .text(titleStringY);\n  },\n\n  /**\n   * Changes labels for indicators\n   */\n  _updateIndicators() {\n    const _this = this;\n    this.duration = this.model.time.delayAnimations;\n    this.yScale = this.model.marker.axis_y.getScale();\n    this.xScale = this.model.marker.axis_x.getScale();\n    this.yAxis.tickFormat(_this.model.marker.axis_y.getTickFormatter());\n    this.xAxis.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n    this.xAxisLeft.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n\n    const sideDim = this.SIDEDIM;\n    const stackDim = this.STACKDIM;\n    const ageDim = this.AGEDIM;\n    const groupBy = this.groupBy;\n\n    const ages = this.model.marker.getKeys(ageDim);\n    let ageKeys = [];\n    ageKeys = ages.map(m => m[ageDim]);\n    this.ageKeys = ageKeys;\n\n    this.shiftedAgeKeys = this.timeSteps.map((m, i) => -i * groupBy).slice(1).reverse().concat(ageKeys);\n\n    this.sideItems = this.model.marker.label_side.getItems();\n    //var sideKeys = Object.keys(sideItems);\n    let sideKeys = [];\n    if (!utils.isEmpty(this.sideItems)) {\n      const sideFiltered = !!this.model.marker.side.getEntity().show[sideDim];\n      const sides = this.model.marker.getKeys(sideDim)\n          .filter(f => !sideFiltered || this.model.marker.side.getEntity().isShown(f));\n      sideKeys = sides.map(m => m[sideDim]);\n\n      if (sideKeys.length > 2) sideKeys.length = 2;\n      if (sideKeys.length > 1) {\n        const sortFunc = this.ui.chart.flipSides ? d3.ascending : d3.descending;\n        sideKeys.sort(sortFunc);\n      }\n    }\n    if (!sideKeys.length) sideKeys.push(\"undefined\");\n    this.sideKeys = sideKeys;\n\n    const stacks = this.model.marker.getKeys(stackDim);\n    const stackKeys = stacks.map(m => m[stackDim]);\n\n    let sortedStackKeys = utils.keys(this.model.marker.color.getPalette()).reduce((arr, val) => {\n        if (stackKeys.indexOf(val) != -1) arr.push(val);\n        return arr;\n      }, []);\n\n    if (sortedStackKeys.length != stackKeys.length) {\n      sortedStackKeys = stackKeys.reduce((arr, val) => {\n          if (arr.indexOf(val) == -1) arr.push(val);\n          return arr;\n        }, sortedStackKeys);\n    }\n    this.stackKeys = sortedStackKeys;\n    this.stackItems = this.model.marker.label_stack.getItems();\n\n    this.stacked = this.ui.chart.stacked && this.model.marker.color.use != \"constant\" && this.model.entities.getDimension();\n\n    this.twoSided = this.sideKeys.length > 1;\n    if (this.twoSided) {\n      this.xScaleLeft = this.xScale.copy();\n    }\n\n    this.cScale = this.model.marker.color.getScale();\n\n    this.markers = this.model.marker.getKeys(ageDim);\n  },\n\n  _updateSideTitles() {\n    const _this = this;\n    const sideItems = this.sideItems;\n    \n    this.titleRight.classed(\"vzb-hidden\", !this.twoSided);\n    if (this.twoSided) {\n      this.title.text(sideItems[this.sideKeys[1]]).call(this.textEllipsis.clear);\n      this.titleRight.text(sideItems[this.sideKeys[0]]).call(this.textEllipsis.clear);;\n    } else {\n      const title = this.sideKeys.length && sideItems[this.sideKeys[0]] ? sideItems[this.sideKeys[0]] : \"\";\n      this.title.text(title).call(this.textEllipsis.clear);;\n    }\n\n    if (this.smallMultiples) {\n      this.titleCenter.call(this.textEllipsis.clear).each(function(d, i) {\n        d3.select(this).text(_this.stackItems[_this.stackKeys[i]]);\n      });\n    } else {\n      const title = this.stackKeys.length && this.stackItems[this.stackKeys[0]] ? this.stackItems[this.stackKeys[0]] : \"\";\n      this.titleCenter.text(title).call(this.textEllipsis.clear);\n    }\n  },\n\n  _createLimits(frames, stackKey) {\n    const _this = this;\n\n    const stackKeys = stackKey ? [stackKey] : this.stackKeys;  \n    //const sideKeysNF = Object.keys(this.model.marker.side.getItems());\n    const sideKeysNF = Object.keys(this.model.marker.side.getNestedItems([this.SIDEDIM]));\n    if (!sideKeysNF.length) sideKeysNF.push(\"undefined\");\n\n    const totals = {};\n    const inpercentMaxLimits = {};\n    const maxLimits = {};\n    const geoLess = this.geoLess;\n    const geoDefault = this.geoDomainDefaultValue;\n    sideKeysNF.forEach(s => {\n      maxLimits[s] = [];\n      inpercentMaxLimits[s] = [];\n    });\n\n    if (_this.stackSkip && _this.sideSkip) {\n      utils.forEach(frames, (f, time) => {\n        const frame = f.axis_x;\n        totals[time] = {};\n        let ageSum = 0;\n        const sideMaxLimits = [];\n        utils.forEach(_this.ageKeys, age => {\n          let stackSum = 0;\n          if (frame[age]) {\n            stackSum += frame[age][geoDefault];\n            ageSum += stackSum;\n          }\n          sideMaxLimits.push(stackSum);\n        });\n        totals[time][sideKeysNF[0]] = ageSum;\n        const maxSideLimit = Math.max(...sideMaxLimits);\n        inpercentMaxLimits[sideKeysNF[0]].push(maxSideLimit / ageSum);\n        maxLimits[sideKeysNF[0]].push(maxSideLimit);\n      });\n    } else if (_this.sideSkip) {\n      utils.forEach(frames, (f, time) => {\n        const frame = f.axis_x;\n        totals[time] = {};\n        let ageSum = 0;\n        const sideMaxLimits = [];\n        utils.forEach(_this.ageKeys, age => {\n          let stackSum = 0;\n          utils.forEach(stackKeys, stack => {\n            if (frame[stack] && frame[stack][age]) {\n              stackSum += geoLess ? frame[stack][age][geoDefault] : frame[stack][age];\n              ageSum += stackSum;\n            }\n          });\n          sideMaxLimits.push(stackSum);\n        });\n        totals[time][sideKeysNF[0]] = ageSum;\n        const maxSideLimit = Math.max(...sideMaxLimits);\n        inpercentMaxLimits[sideKeysNF[0]].push(maxSideLimit / ageSum);\n        maxLimits[sideKeysNF[0]].push(maxSideLimit);\n      });\n    } else if (_this.stackSkip) {\n      utils.forEach(frames, (f, time) => {\n        const frame = f.axis_x;\n        totals[time] = {};\n        utils.forEach(sideKeysNF, side => {\n          let ageSum = 0;\n          const sideMaxLimits = [];\n          utils.forEach(_this.ageKeys, age => {\n            let stackSum = 0;\n            if (frame[side] && frame[side][age]) {\n              stackSum += geoLess ? frame[side][age][geoDefault] : frame[side][age];\n              ageSum += stackSum;\n            }\n            sideMaxLimits.push(stackSum);\n          });\n          totals[time][side] = ageSum;\n          const maxSideLimit = Math.max(...sideMaxLimits);\n          inpercentMaxLimits[side].push(maxSideLimit / ageSum);\n          maxLimits[side].push(maxSideLimit);\n        });\n      });\n    } else {\n      utils.forEach(frames, (f, time) => {\n        const frame = f.axis_x;\n        totals[time] = {};\n        utils.forEach(sideKeysNF, side => {\n          let ageSum = 0;\n          const sideMaxLimits = [];\n          utils.forEach(_this.ageKeys, age => {\n            let stackSum = 0;\n            utils.forEach(stackKeys, stack => {\n              if (frame[stack][side] && frame[stack][side][age]) {\n                stackSum += geoLess ? frame[stack][side][age][geoDefault] : frame[stack][side][age];\n                ageSum += stackSum;\n              }\n            });\n            sideMaxLimits.push(stackSum);\n          });\n          totals[time][side] = ageSum;\n          const maxSideLimit = Math.max(...sideMaxLimits);\n          inpercentMaxLimits[side].push(maxSideLimit / ageSum);\n          maxLimits[side].push(maxSideLimit);\n        });\n      });\n    }\n\n    if (stackKey) {\n      this.maxLimits[stackKey] = {};\n      this.inpercentMaxLimits[stackKey] = {};\n      sideKeysNF.forEach(s => {\n        _this.maxLimits[stackKey][s] = Math.max(...maxLimits[s]);\n        _this.inpercentMaxLimits[stackKey][s] = Math.max(...inpercentMaxLimits[s]);\n      });\n      this.totals[stackKey] = totals;\n    } else {\n      sideKeysNF.forEach(s => {\n        _this.maxLimits[s] = Math.max(...maxLimits[s]);\n        _this.inpercentMaxLimits[s] = Math.max(...inpercentMaxLimits[s]);\n      });\n      this.totals = totals;\n    }\n  },\n\n  _updateLimits(stackKey, i) {\n    const _this = this;\n    const axisX = this.model.marker.axis_x;\n    if (this.smallMultiples && stackKey) {\n      if (this.ui.chart.inpercent) {\n        this.domains[i] = [0, Math.max(...this.sideKeys.map(s => _this.inpercentMaxLimits[stackKey][s]))];\n      } else {\n        this.domains[i] = (axisX.domainMin != null && axisX.domainMax != null) ? [+axisX.domainMin, +axisX.domainMax] : [0, Math.max(...this.sideKeys.map(s => _this.maxLimits[stackKey][s]))];\n      }\n    } else {\n      if (this.ui.chart.inpercent) {\n        this.domains[0] = [0, Math.max(...this.sideKeys.map(s => _this.inpercentMaxLimits[s]))];\n      } else {\n        this.domains[0] = (axisX.domainMin != null && axisX.domainMax != null) ? [+axisX.domainMin, +axisX.domainMax] : [0, Math.max(...this.sideKeys.map(s => _this.maxLimits[s]))];\n      }\n    }\n\n    this.xScale.domain(this.domains[0]);\n    if (this.xScaleLeft) this.xScaleLeft.domain(this.xScale.domain());\n\n    this.domainScalers = this._calcDomainScalers();\n  },\n\n  _calcDomainScalers() {\n    const domain = this.domains.map(m => m[1] - m[0])\n    const sumDomains = domain.reduce((a, b) => a + b);\n    return domain.map(d => d / sumDomains);\n  },\n\n  _interpolateBetweenTotals(timeSteps, totals, time) {\n    const nextStep = d3.bisectLeft(timeSteps, time);\n    const fraction = (time - timeSteps[nextStep - 1]) / (timeSteps[nextStep] - timeSteps[nextStep - 1]);\n    const total = {};\n    utils.forEach(this.sideKeys, side => {\n      total[side] = totals[timeSteps[nextStep]][side] * fraction + totals[timeSteps[nextStep - 1]][side] * (1 - fraction);\n  });\n    return total;\n  },\n\n  /**\n   * Updates entities\n   */\n  _updateEntities(reorder) {\n\n    const _this = this;\n    const time = this.model.time;\n    const sideDim = this.SIDEDIM;\n    const prefixedSideDim = this.PREFIXEDSIDEDIM;\n    const ageDim = this.AGEDIM;\n    const stackDim = this.STACKDIM;\n    const prefixedStackDim = this.PREFIXEDSTACKDIM;\n    const timeDim = this.TIMEDIM;\n    const duration = (time.playing) ? time.delayAnimations : 0;\n    let total;\n\n    const groupBy = this.groupBy;\n    //var group_offset = this.model.marker.group_offset ? Math.abs(this.model.marker.group_offset % groupBy) : 0;\n\n    if (this.ui.chart.inpercent) {\n      this.total = {};\n      if (this.smallMultiples) {\n        utils.forEach(this.stackKeys, (stackKey, i) => {\n          this.total[i] = this.totals[stackKey][time.value] ? this.totals[stackKey][time.value] : this._interpolateBetweenTotals(this.timeSteps, this.totals[stackKey], time.value);\n        });\n      } else {\n        this.total[0] = this.totals[time.value] ? this.totals[time.value] : this._interpolateBetweenTotals(this.timeSteps, this.totals, time.value);\n      }\n    }\n\n    const domain = this.yScale.domain();\n\n    //this.model.age.setVisible(markers);\n\n    const nextStep = d3.bisectLeft(this.timeSteps, time.value);\n\n    const shiftedAgeDim = this.SHIFTEDAGEDIM;\n\n    const markers = this.markers.map(data => {\n        const o = {};\n    o[ageDim] = o[shiftedAgeDim] = +data[ageDim];\n    o[ageDim] -= nextStep * groupBy;\n    return o;\n  });\n\n    const ageData = markers.slice(0);\n\n    const outAge = {};\n    outAge[shiftedAgeDim] = markers.length * groupBy;\n    outAge[ageDim] = outAge[shiftedAgeDim] - nextStep * groupBy;\n\n    this.ageShift = nextStep * groupBy;\n\n    if (nextStep) ageData.push(outAge);\n\n    const stacks = _this.stacked ? _this.stackKeys : [_this.geoDomainDefaultValue];\n    const geoDomainDefaultValue = this.geoDomainDefaultValue;\n    const geoDomainDimension = this.geoDomainDimension;\n\n    // for(let i = 0, j = ageData.length; i < j; i++) {\n    //   const d = ageData[i];\n    //   d[\"side\"] = _this.sideKeys.map(m => {\n    //     const r = {};\n    //     r[ageDim] = d[ageDim];\n    //     r[shiftedAgeDim] = d[shiftedAgeDim];\n    //     r[prefixedSideDim] = m;\n    //     r[sideDim] = m;\n    //     r[\"stack\"] = stacks.map(m => {\n    //       const s = {};\n    //       s[geoDomainDimension] = geoDomainDefaultValue;\n    //       s[ageDim] = r[ageDim];\n    //       s[shiftedAgeDim] = r[shiftedAgeDim];\n    //       s[sideDim] = r[sideDim];\n    //       s[stackDim] = m;\n    //       s[prefixedSideDim] = r[prefixedSideDim];\n    //       s[prefixedStackDim] = m;\n    //       s[\"x_\"] = 0;\n    //       s[\"width_\"] = 0;\n    //       return s;\n    //     });\n    //     return r;\n    //   });\n    // }\n\n    //this.barsData = ageData;\n    this.barsData = [];\n    let ageBars = this.bars.selectAll(\".vzb-bc-bar\")\n      .data((d, i) => (_this.barsData[i] = ageData.map(m => {\n        const p = {};\n        p[ageDim] = m[ageDim];\n        p[shiftedAgeDim] = m[shiftedAgeDim];    \n        p.i = i;\n        return p;\n      }), this.barsData[i]), d => d[ageDim]);\n    //exit selection\n    ageBars.exit().remove();\n\n    const oneBarHeight = this.oneBarHeight;\n    const barHeight = this.barHeight;\n    const firstBarOffsetY = this.firstBarOffsetY;\n\n    //enter selection -- init bars\n    ageBars = ageBars.enter().append(\"g\")\n      .attr(\"class\", d => \"vzb-bc-bar \" + \"vzb-bc-bar-\" + d[ageDim])\n      .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - (d[shiftedAgeDim] - domain[0] - groupBy) * oneBarHeight) + \")\")\n      .merge(ageBars);\n\n    // this.ageBars.attr(\"class\", function(d) {\n    //     return \"vzb-bc-bar \" + \"vzb-bc-bar-\" + d[ageDim];\n    //   })\n\n\n    let sideBars = ageBars.selectAll(\".vzb-bc-side\").data((d, i) => (d.side = _this.sideKeys.map(m => {\n      const r = {};\n      r[ageDim] = d[ageDim];\n      r[shiftedAgeDim] = d[shiftedAgeDim];\n      r[prefixedSideDim] = m;\n      r[sideDim] = m;\n      r.i = d.i;\n      return r;\n    }), d.side), d => d[prefixedSideDim]);\n\n    sideBars.exit().remove();\n    sideBars = sideBars.enter().append(\"g\")\n      .attr(\"class\", (d, i) => \"vzb-bc-side \" + \"vzb-bc-side-\" + (!i != !_this.twoSided ? \"right\" : \"left\"))\n      .attr(\"transform\", (d, i) => i ? (\"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\") : \"\")\n      .merge(sideBars);\n\n    if (reorder) {\n      sideBars\n        .attr(\"class\", (d, i) => \"vzb-bc-side \" + \"vzb-bc-side-\" + (!i != !_this.twoSided ? \"right\" : \"left\"))\n        .attr(\"transform\", (d, i) => i ? (\"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\") : \"\");\n    }\n\n    const _attributeUpdaters = this._attributeUpdaters;\n\n    let stackBars = sideBars.selectAll(\".vzb-bc-stack\").data(d => ( d.stack = (_this.smallMultiples ? [stacks[d.i]] : stacks).map(m => {\n      const s = {};\n      s[geoDomainDimension] = geoDomainDefaultValue;\n      s[ageDim] = d[ageDim];\n      s[shiftedAgeDim] = d[shiftedAgeDim];\n      s[sideDim] = d[sideDim];\n      s[stackDim] = m;\n      s[prefixedSideDim] = d[prefixedSideDim];\n      s[prefixedStackDim] = m;\n      s[\"x_\"] = 0;\n      s[\"width_\"] = 0;\n      s.i = d.i;\n      return s;\n    }), d.stack), d => d[prefixedStackDim]);\n\n    stackBars.exit().remove();\n    stackBars = stackBars.enter().append(\"rect\")\n      .attr(\"class\", (d, i) => \"vzb-bc-stack \" + \"vzb-bc-stack-\" + i + (_this.highlighted ? \" vzb-dimmed\" : \"\"))\n      .attr(\"y\", 0)\n      .attr(\"height\", barHeight - (groupBy > 2 ? 1 : 0))\n      .attr(\"fill\", d => _this.cScale(_this.frameAllColor[d[prefixedStackDim]] || d[prefixedStackDim]))\n      //.attr(\"width\", _attributeUpdaters._newWidth)\n      .attr(\"x\", _attributeUpdaters._newX)\n      .on(\"mouseover\", _this.interaction.mouseover)\n      .on(\"mouseout\", _this.interaction.mouseout)\n      .on(\"click\", _this.interaction.click)\n      .onTap(_this.interaction.tap)\n      .merge(stackBars);\n\n\n    if (reorder) stackBars\n      .attr(\"class\", (d, i) => \"vzb-bc-stack \" + \"vzb-bc-stack-\" + i + (_this.highlighted ? \" vzb-dimmed\" : \"\"))\n      .attr(\"fill\", d => _this.cScale(_this.frameAllColor[d[prefixedStackDim]] || d[prefixedStackDim]))\n      .order();\n\n    const stepShift = (ageData[0][shiftedAgeDim] - ageData[0][ageDim]) - this.shiftScale(time.value) * groupBy;\n\n    if (duration) {\n      const transition = d3.transition()\n        .duration(duration)\n        .ease(d3.easeLinear);\n\n      ageBars\n        .transition(transition)\n        .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - (d[shiftedAgeDim] - domain[0] - stepShift) * oneBarHeight) + \")\");\n      stackBars\n        .transition(transition)\n        .attr(\"width\", _attributeUpdaters._newWidth)\n        .attr(\"x\", _attributeUpdaters._newX);\n    } else {\n      ageBars.interrupt()\n        .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - (d[shiftedAgeDim] - domain[0] - stepShift) * oneBarHeight) + \")\");\n      stackBars.interrupt()\n        .attr(\"width\", _attributeUpdaters._newWidth)\n        .attr(\"x\", _attributeUpdaters._newX);\n    }\n\n    this.ageBars = ageBars;\n    this.sideBars = sideBars;\n    this.stackBars = stackBars;\n\n    this.entityLabels = this.labels.selectAll(\".vzb-bc-label text\")\n      .data(markers);\n    //exit selection\n    this.entityLabels.exit().remove();\n\n    this.entityLabels = this.entityLabels.enter().append(\"g\")\n      .attr(\"class\", d => \"vzb-bc-label\" + \" vzb-bc-label-\" + d[shiftedAgeDim])\n      .append(\"text\")\n      .attr(\"class\", \"vzb-bc-age\")\n      .merge(this.entityLabels)\n      .each((d, i) => {\n        const yearOlds = _this.translator(\"popbyage/yearOlds\");\n\n        let age = parseInt(d[shiftedAgeDim], 10);\n\n        if (groupBy > 1) {\n          const nextAge = (age + groupBy - 1);\n          age = age + \"-to-\" + (nextAge > domain[1] ? domain[1] : nextAge);\n        }\n\n        d[\"text\"] = age + yearOlds;\n      })\n      .attr(\"y\", (d, i) => firstBarOffsetY - (d[shiftedAgeDim] - domain[0]) * oneBarHeight - 10)\n      .attr(\"dy\", (d, i) => (d[shiftedAgeDim] + groupBy) > domain[1] ? (groupBy - domain[1] + d[shiftedAgeDim]) / groupBy * barHeight : 0);\n    // .style(\"fill\", function(d) {\n    //   var color = _this.cScale(values.color[d[ageDim]]);\n    //   return d3.rgb(color).darker(2);\n    // });\n\n    this.year.setText(this.model.time.formatDate(time.value), this.duration);\n  },\n\n  _makeOutlines(frame, total) {\n    const _this = this;\n\n    const KEYS = utils.unique(this.model.marker._getAllDimensions({ exceptType: \"time\" }))\n    KEYS.forEach((key, i) => {\n        if (key === _this.AGEDIM) KEYS[i] = _this.SHIFTEDAGEDIM;\n        //if (_this.geoLess)\n      });\n\n    const groupBy = this.groupBy;\n    const barHeight = this.barHeight;\n    const firstBarOffsetY = this.firstBarOffsetY + barHeight;\n\n    const line = d3.line().curve(d3.curveStepBefore)\n      .x(d => d.x)//_ + d.width_)\n      .y((d, i) => firstBarOffsetY - barHeight * i  - (groupBy > 2 ? 1 : 0));\n\n    \n    const pathsData = this.barsData.map((barsData, _i) => {\n      const stackIndex = [0, 0];\n\n      return this.sideKeys.map((s, i) => {\n        if (_this.stackSkip) {\n          barsData[0].side[i].stack.forEach((d, j) => {\n            if (d[_this.PREFIXEDSIDEDIM] === d[_this.PREFIXEDSTACKDIM]) {\n              stackIndex[i] = j;\n            }\n          });\n        }\n        const data = {};\n        data.d = barsData.map(age => {\n          const r = {};\n          const x = utils.getValueMD(age.side[i].stack[stackIndex[i]], frame, KEYS);\n          r.x = x ? _this.xScale(x) : 0;\n            if (_this.ui.chart.inpercent) {\n              r.x /= total[_i][age.side[i].stack[stackIndex[i]][_this.PREFIXEDSIDEDIM]];\n            }\n          return r;\n        });\n        return data;\n      });\n    });\n\n    const data = this.bars.selectAll(\".vzb-bc-side-left\").selectAll(\".vzb-bc-stack-0\").data();\n    const color = _this.cScale(data[0][this.PREFIXEDSTACKDIM])\n    const colorShade = this.model.marker.color.getColorShade({\n      colorID: _this.frameAllColor[data[0][this.PREFIXEDSTACKDIM]] || data[0][this.PREFIXEDSTACKDIM],\n      shadeID: \"shade\"\n    }) || \"#000\";//d3.hsl(color).darker(2);\n\n    this.lockedPaths.each(function(d, _i) {\n      const paths = d3.select(this).selectAll(\"path\").data(pathsData[_i]);\n      paths.exit().remove();\n      paths.enter()\n        .append(\"path\")\n        .merge(paths)\n        .attr(\"d\", (d, i) => line(d.d))\n        .attr(\"stroke\", \"#000\")//colorShade)\n        .attr(\"transform\", (d, i) => i ? (\"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\") : \"\");\n    });\n  },\n\n  _setYear(timeValue) {\n    const formattedTime = this.model.time.formatDate(timeValue);\n    return function() { d3.select(this).text(formattedTime); };\n  },\n\n  _interaction() {\n    const _this = this;\n    return {\n      mouseover(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.highlightMarker(d);\n        _this._showLabel(d);\n      },\n      mouseout(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.clearHighlighted();\n      },\n      click(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.selectMarker(d);\n      },\n      tap(d) {\n        d3.event.stopPropagation();\n        _this.model.marker.selectMarker(d);\n      }\n    };\n  },\n\n  _highlightBars(d) {\n    const _this = this;\n\n    _this.someHighlighted = (_this.model.marker.highlight.length > 0);\n\n    _this.updateBarsOpacity();\n\n    if (!_this.someHighlighted) {\n      //hide labels\n      _this.labels.selectAll(\".vzb-hovered\").classed(\"vzb-hovered\", false);\n    }\n  },\n\n  _showLabel(d) {\n    const _this = this;\n    const formatter = _this.ui.chart.inpercent ? d3.format(\".1%\") : _this.model.marker.axis_x.getTickFormatter();\n    const sideDim = _this.SIDEDIM;\n    const ageDim = _this.AGEDIM;\n    const stackDim = _this.STACKDIM;\n    const shiftedAgeDim = \"s_age\";\n    const left = _this.sideKeys.indexOf(d[sideDim]) > 0;\n\n    let deltaX = 7;\n    if (!this.smallMultiples) {\n      const hoverBarEl = d3.select(d3.event.target);\n      deltaX += +hoverBarEl.attr(\"x\");\n    }\n\n    const labelNode = _this.labels.select(\".vzb-bc-label-\" + d[shiftedAgeDim]).nodes()[d.i];// + \"-\" + _this._id);\n    const labelEl = d3.select(labelNode);\n    labelEl.selectAll(\".vzb-bc-age\")\n      .text(textData => {\n        //var total = _this.ui.chart.inpercent ? _this.totalValues[d[sideDim]] : 1;\n        let text = _this.stackKeys.length > 1 ? _this.stackItems[d[stackDim]] : textData.text;\n        text = _this.twoSided ? text : textData.text + \" \" + _this.stackItems[d[stackDim]];\n        const value = _this.xScale.invert(d[\"width_\"]);\n        return text + \": \" + formatter(value);\n      })\n      .attr(\"x\", left ? -this.activeProfile.centerWidth - deltaX : deltaX)\n      .attr(\"dx\", 0)\n      .classed(\"vzb-text-left\", left);\n    labelEl.classed(\"vzb-prehovered\", true);      \n    const bbox = labelNode.getBBox();\n    const transform = _this.element.node().getScreenCTM().inverse().multiply(labelNode.getScreenCTM());\n    const overDrawLeft = Math.max(-bbox.x - transform.e, 0);\n    const overDrawRight = Math.min(_this.fullWidth - bbox.x - bbox.width - transform.e, 0);\n    labelEl.selectAll(\".vzb-bc-age\").attr(\"dx\", overDrawLeft + overDrawRight);\n    labelEl.classed(\"vzb-prehovered\", false);\n    labelEl.classed(\"vzb-hovered\", true);\n  },\n\n  getGraphWidth(width, marginBetween) {\n    let _width = width || this.width;\n    if (this.smallMultiples) {\n      const length = this.graph.data().length;\n      _width -= marginBetween * (length - 1);\n      return this.domainScalers.map(scaler => _width * scaler);\n    } else {\n      return [_width];\n    }\n  },\n\n  getYAxisVisibility(index) {\n    return index == 0 ? true : false;\n  },\n\n  /**\n   * Executes everytime the container or vizabi is resized\n   * Ideally,it contains only operations related to size\n   */\n\n\n  presentationProfileChanges: {\n    medium: {\n      margin: { top: 120, right: 50, left:80, bottom: 60, between: 30 },\n      infoElHeight: 32\n    },\n    large: {\n      margin: { top: 120, right: 70, left: 100, bottom: 70, between: 30 },\n      infoElHeight: 32\n    }\n  },\n\n  profiles: {\n    \"small\": {\n      margin: {\n        top: 50,\n        right: 20,\n        left: 40,\n        bottom: 20,\n        between: 10\n      },\n      infoElHeight: 16,\n      centerWidth: 2,\n      titlesSpacing: 5\n    },\n    \"medium\": {\n      margin: {\n        top: 70,\n        right: 40,\n        left: 60,\n        bottom: 20,\n        between: 20\n      },\n      infoElHeight: 20,\n      centerWidth: 2,\n      titlesSpacing: 10\n    },\n    \"large\": {\n      margin: {\n        top: 80,\n        right: 60,\n        left: 60,\n        bottom: 30,\n        between: 20\n      },\n      infoElHeight: 22,\n      centerWidth: 2,\n      titlesSpacing: 20\n    }\n  },\n\n  resize() {\n    const _this = this;\n\n    this.activeProfile = this.getActiveProfile(this.profiles, this.presentationProfileChanges);\n\n    //this.activeProfile = this.profiles[this.getLayoutProfile()];\n    const margin = this.activeProfile.margin;\n    const infoElHeight = this.activeProfile.infoElHeight;\n\n    const deltaMarginTop = this.sideSkip ? margin.top * 0.23 : 0;\n    //stage\n    this.height = (parseInt(this.element.style(\"height\"), 10) + deltaMarginTop - margin.top - margin.bottom) || 0;\n    this.width = (parseInt(this.element.style(\"width\"), 10) - margin.left - margin.right) || 0;\n    this.fullWidth = parseInt(this.element.style(\"width\"), 10) || 0;\n    this.graphWidth = this.getGraphWidth(this.width, margin.between);\n\n    if (this.height <= 0 || this.width <= 0) return utils.warn(\"Pop by age resize() abort: vizabi container is too little or has display:none\");\n\n    let _sum = 0;\n    let _prevSum = 0;\n    const graphWidthSum = this.graphWidth.map(width => {_prevSum = _sum; _sum += width; return _prevSum;});\n    this.graph\n      .attr(\"transform\", (d, i) => \"translate(\" + Math.round(margin.left + margin.between * i + graphWidthSum[i]) + \",\" + (margin.top - deltaMarginTop) + \")\");\n\n    this.barsCrop\n      .attr(\"width\", (d, i) => this.graphWidth[i])\n      .attr(\"height\", Math.max(0, this.height));\n\n    this.lockedCrop\n      .attr(\"width\", (d, i) => this.graphWidth[i])\n      .attr(\"height\", Math.max(0, this.height));\n\n    this.labelsCrop\n      .attr(\"width\", (d, i) => this.graphWidth[i])\n      .attr(\"height\", Math.max(0, this.height));\n\n    const groupBy = this.groupBy;\n\n    const domain = this.yScale.domain();\n    this.oneBarHeight = this.height / (domain[1] - domain[0]);\n    const barHeight = this.barHeight = this.oneBarHeight * groupBy; // height per bar is total domain height divided by the number of possible markers in the domain\n    this.firstBarOffsetY = this.height - this.barHeight;\n\n    if (this.stackBars) this.stackBars.attr(\"height\", barHeight - (groupBy > 2 ? 1 : 0));\n\n    if (this.sideBars) this.sideBars\n      .attr(\"transform\", (d, i) => i ? (\"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\") : \"\");\n\n\n    //update scales to the new range\n    //apply scales to axes and redraw\n    this.yScale.range([this.height, 0]);\n\n    const yScaleCopy = this.yScale.copy();\n    if (groupBy > 2) {\n      yScaleCopy.ticks = () => d3.range(domain[0], domain[1] + 1, groupBy);\n    }\n\n    this.yAxisEl.each(function(d, i) {\n      _this.yAxis.scale(yScaleCopy.range([_this.height, 0]))\n        .tickSizeInner(-_this.graphWidth[i])\n        .tickSizeOuter(0)\n        .tickPadding(6)\n        .tickSizeMinor(-_this.graphWidth[i], 0)\n        .labelerOptions({\n          scaleType: _this.model.marker.axis_y.scaleType,\n          toolMargin: margin,\n          limitMaxTickNumber: 19,\n          fitIntoScale: \"optimistic\",\n          isPivotAuto: false\n        });\n      \n      d3.select(this).attr(\"transform\", \"translate(\" + 0 + \",0)\")\n        .call(_this.yAxis)\n        .classed(\"vzb-bc-axis-text-hidden\", !_this.getYAxisVisibility(i));\n    });\n    this.yAxisEl.select(\".tick line\").classed(\"vzb-hidden\", true);\n\n    const maxRange = _this.twoSided ? ((_this.graphWidth[0] - _this.activeProfile.centerWidth) * 0.5) : _this.graphWidth[0];\n    this.xScale.range([0, maxRange]);\n\n    const format = this.ui.chart.inpercent ? d3.format((groupBy > 3 ? \".1\" : \".1\") + \"%\") : this.model.marker.axis_x.getTickFormatter();\n\n    const translateX = [];\n    this.xAxisEl.each(function(d, i) {\n      const maxRange = _this.twoSided ? ((_this.graphWidth[i] - _this.activeProfile.centerWidth) * 0.5) : _this.graphWidth[i];\n      translateX[i] = _this.twoSided ? ((_this.graphWidth[i] + _this.activeProfile.centerWidth) * 0.5) : 0;\n\n      _this.xAxis.scale(_this.xScale.copy().domain(_this.domains[i]).range([0, maxRange]))\n        .tickFormat(format)\n        .tickSizeInner(-_this.height)\n        .tickSizeOuter(0)\n        .tickPadding(6)\n        .tickSizeMinor(-_this.height, 0)\n        .labelerOptions({\n          scaleType: _this.model.marker.axis_x.scaleType,\n          toolMargin: margin,\n          limitMaxTickNumber: 6\n        });\n\n      d3.select(this)\n        .attr(\"transform\", \"translate(\" + translateX[i] + \",\" + _this.height + \")\")\n        .call(_this.xAxis);\n      const zeroTickEl = d3.select(this).selectAll(\".tick text\");\n      const tickCount = zeroTickEl.size();\n      if (tickCount > 0) {\n        const zeroTickBBox = zeroTickEl.node().getBBox();\n        if (tickCount > 1) {\n          d3.select(zeroTickEl.node()).attr(\"dx\", (_this.twoSided ? -_this.activeProfile.centerWidth * 0.5 : 0) - zeroTickBBox.width * 0.5 - zeroTickBBox.x);\n        }\n        zeroTickEl.classed(\"vzb-invisible\", (_this.graphWidth[i] + margin.between) < zeroTickBBox.width);\n      }\n    });\n\n    this.xAxisEl.select(\".tick line\").classed(\"vzb-hidden\", true);\n    this.xAxisLeftEl.classed(\"vzb-hidden\", !this.twoSided);\n    if (this.twoSided) {\n      this.xScaleLeft.range([(this.graphWidth[0] - this.activeProfile.centerWidth) * 0.5, 0]);\n\n      this.xAxisLeftEl.each(function(d, i) {\n      \n        _this.xAxisLeft.scale(_this.xScaleLeft.copy().domain(_this.domains[i]).range([(_this.graphWidth[i] - _this.activeProfile.centerWidth) * 0.5, 0]))\n          .tickFormat(format)\n          .tickSizeInner(-_this.height)\n          .tickSizeOuter(0)\n          .tickPadding(6)\n          .tickSizeMinor(-_this.height, 0)\n          .labelerOptions({\n            scaleType: _this.model.marker.axis_x.scaleType,\n            toolMargin: margin,\n            limitMaxTickNumber: 6\n          });\n        d3.select(this)\n          .attr(\"transform\", \"translate(0,\" + _this.height + \")\")\n          .call(_this.xAxisLeft);\n        //hide left axis zero tick\n        const tickNodes = d3.select(this).selectAll(\".tick\").classed(\"vzb-hidden\", false).nodes();\n        d3.select(tickNodes[tickNodes.length - 1]).classed(\"vzb-hidden\", true);\n      });\n    }\n\n    const isRTL = this.model.locale.isRTL();\n    \n    this.bars.attr(\"transform\", (d, i) => \"translate(\" + translateX[i] + \",0)\");\n    this.lockedPaths.attr(\"transform\", (d, i) => \"translate(\" + translateX[i] + \",0)\");\n    this.labels.attr(\"transform\", (d, i) => \"translate(\" + translateX[i] + \",0)\");\n\n    const titleSpace = (i) => (translateX[i] - this.activeProfile.titlesSpacing) < 0 ? _this.activeProfile.centerWidth * 0.5 : _this.activeProfile.titlesSpacing;\n\n    this.title\n      .attr(\"x\", (d, i) => this.twoSided ? translateX[i] - _this.activeProfile.centerWidth * 0.5 - titleSpace(i) : 0)\n      .style(\"text-anchor\", this.twoSided ? \"end\" : \"\")\n      .attr(\"y\", -margin.top * 0.275 - deltaMarginTop)\n      .each(function(d, i) {\n        _this.textEllipsis.wrap(this, _this.twoSided ? (_this.graphWidth[i] + margin.between - titleSpace(i)) * 0.5 : _this.graphWidth[i] +  margin.between)\n      });\n    this.titleRight\n      .attr(\"x\", (d, i) => translateX[i] - _this.activeProfile.centerWidth * 0.5 + titleSpace(i))\n      .attr(\"y\", -margin.top * 0.275 - deltaMarginTop)\n      .each(function(d, i) {\n        _this.textEllipsis.wrap(this, (_this.graphWidth[i] + margin.between - titleSpace(i)) * 0.5)\n      });\n    this.titleCenter\n      .attr(\"x\", (d, i) => this.twoSided ? translateX[i] - _this.activeProfile.centerWidth * 0.5: _this.graphWidth[i] * 0.5)\n      .style(\"text-anchor\", \"middle\")\n      .attr(\"y\", (-margin.top - deltaMarginTop)* 0.035 )\n      .each(function(d, i) {\n        _this.textEllipsis.wrap(this, _this.graphWidth[i] +  margin.between)\n      });\n\n    this.xTitleEl\n      .style(\"font-size\", infoElHeight + \"px\")\n      .attr(\"transform\", \"translate(\" + (isRTL ? margin.left + this.width : margin.left * 0.4) + \",\" + (margin.top * 0.35) + \")\");\n\n    if (this.xInfoEl.select(\"svg\").node()) {\n      const titleBBox = this.xTitleEl.node().getBBox();\n      const t = utils.transform(this.xTitleEl.node());\n      const hTranslate = isRTL ? (titleBBox.x + t.translateX - infoElHeight * 1.4) : (titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4);\n\n      this.xInfoEl.select(\"svg\")\n        .attr(\"width\", infoElHeight + \"px\")\n        .attr(\"height\", infoElHeight + \"px\");\n      this.xInfoEl.attr(\"transform\", \"translate(\"\n        + hTranslate + \",\"\n        + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n\n    const yearLabelOptions = {\n      topOffset: this.ui.presentation ? 25 : this.getLayoutProfile() === \"small\" ? 10 : 15,\n      rightOffset: this.getLayoutProfile() === \"small\" ? 5 : 10,\n      xAlign: \"right\",\n      yAlign: \"top\",\n      heightRatio: this.ui.presentation ? 0.5 : 0.5,\n      //widthRatio: this.getLayoutProfile() === \"large\" ? 3 / 8 : 5 / 10\n    };\n\n    //year resized\n    this.year\n      .setConditions(yearLabelOptions)\n      .resize(this.fullWidth, margin.top);\n    this.yearLocked.attr(\"x\", isRTL? margin.left * 0.4 : this.width + margin.left + margin.right - 10).attr(\"y\", (margin.top - deltaMarginTop) * (this.getLayoutProfile() === \"large\" ? 1.27 : 1.27));\n\n  },\n\n  updateBarsOpacity(duration) {\n    const _this = this;\n\n    const OPACITY_HIGHLT = 1.0;\n    const OPACITY_HIGHLT_DIM = this.model.marker.opacityHighlightDim;\n    const OPACITY_SELECT = 1.0;\n    const OPACITY_REGULAR = this.model.marker.opacityRegular;\n    const OPACITY_SELECT_DIM = this.model.marker.opacitySelectDim;\n\n    const nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n    const nonSelectedOpacityZeroFlag = nonSelectedOpacityZero != this.nonSelectedOpacityZero;\n    const someSelected = this.someSelected;\n    const someHighlighted = this.someHighlighted;\n\n    this.stackBars.each(function(d) {\n      const isSelected =  someSelected ? _this.model.marker.isSelected(d) : false;\n      const isHighlighted = someHighlighted ? _this.model.marker.isHighlighted(d): false;\n      const bar = d3.select(this);\n\n      bar.style(\"opacity\", isHighlighted ? OPACITY_HIGHLT\n        :\n        someSelected ? (isSelected ? OPACITY_SELECT : OPACITY_SELECT_DIM)\n          :\n          someHighlighted ? OPACITY_HIGHLT_DIM : OPACITY_REGULAR)\n        .style(\"stroke\", isSelected ? \"#333\" : null)\n        .style(\"y\", isSelected ? \"0.5px\" : null);\n\n      if(nonSelectedOpacityZeroFlag) {\n        bar.style(\"pointer-events\", !someSelected || !nonSelectedOpacityZero || isSelected ? \"visible\" : \"none\");\n      }\n    });\n\n    this.nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n  }\n\n});\n\nexport default PopByAge;\n\n\n\n// WEBPACK FOOTER //\n// ./src/component.js","module.exports = \"<!-- PopByAge Component -->\\n<svg class=\\\"vzb-popbyage\\\">\\n    <g class=\\\"vzb-bc-header\\\">\\n        <g class=\\\"vzb-bc-axis-x-title\\\"></g>\\n        <g class=\\\"vzb-bc-axis-x-info vzb-noexport\\\"></g>\\n        <g class=\\\"vzb-bc-year-now\\\"></g>\\n        <text class=\\\"vzb-bc-year vzb-bc-year-locked\\\"></text>\\n    </g>\\n    <g class=\\\"vzb-bc-graph\\\">\\n        <text class=\\\"vzb-bc-title\\\"></text>\\n        <text class=\\\"vzb-bc-title vzb-bc-title-right\\\"></text>\\n        <text class=\\\"vzb-bc-title vzb-bc-title-center\\\"></text>\\n\\n        <g class=\\\"vzb-bc-axis-y-title\\\"></g>\\n\\n        <g class=\\\"vzb-bc-axis-y\\\"></g>\\n\\n        <svg class=\\\"vzb-bc-bars-crop\\\">\\n            <g class=\\\"vzb-bc-bars\\\"></g>\\n        </svg>\\n        \\n        <svg class=\\\"vzb-bc-locked-crop\\\">\\n            <g class=\\\"vzb-bc-paths\\\"></g>\\n        </svg>\\n\\n        <g class=\\\"vzb-bc-axis-x\\\"></g>\\n        <g class=\\\"vzb-bc-axis-x vzb-bc-axis-x-left\\\"></g>\\n\\n        <svg class=\\\"vzb-bc-labels-crop\\\">\\n            <g class=\\\"vzb-bc-labels\\\"></g>\\n        </svg>\\n\\n        <g class=\\\"vzb-bc-axis-labels\\\">\\n            <!-- <text class=\\\"vzb-x_label\\\">Lifespan</text>\\n                  <text class=\\\"vzb-y_label\\\">Lifespan</text> -->\\n        </g>\\n    </g>\\n    <g class=\\\"vzb-bc-tooltip vzb-hidden\\\">\\n        <rect class=\\\"vzb-tooltip-border\\\"></rect>\\n        <text class=\\\"vzb-tooltip-text\\\"></text>\\n    </g>\\n</svg>\\n\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/template.html\n// module id = 3\n// module chunks = 0 1"],"sourceRoot":""}