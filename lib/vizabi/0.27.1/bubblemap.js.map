{"version":3,"sources":["webpack:///webpack/bootstrap 6a2711324c69435e97dc","webpack:///./src/index.js","webpack:///./src/component.js","webpack:///./src/styles.scss?ccec","webpack:///./src/template.html"],"names":["VERSION_INFO","version","build","BubbleMap","Vizabi","Tool","extend","init","placeholder","external_model","name","components","component","model","Component","get","_super","default_model","state","time","entities","locale","ui","map","path","colorGeo","preserveAspectRatio","scale","offset","top","right","bottom","left","projection","topology","objects","geo","boundaries","geoIdProperty","chart","superhighlightOnMinimapHover","labels","dragging","datawarning","doubtDomain","doubtRange","presentation","versionInfo","globals","_globals","utils","helpers","Labels","topojson","d3GeoProjection","DynamicBackground","iconset","iconWarn","warn","iconQuestion","question","BubbleMapComponent","config","context","template","require","bubblesDrawing","isMobile","isMobileOrTablet","model_expects","type","_this","model_binds","evt","_readyOnce","marker","getFrame","value","frameChanged","bind","highlightMarkers","updateOpacity","indexOf","ready","entityBubbles","updateMarkerSizeLimits","redrawDataPoints","selectMarkers","updateDoubtOpacity","_blinkSuperHighlighted","sScale","cScale","d3","scaleOrdinal","schemeCategory10","COLOR_WHITEISH","_labels","CSS_PREFIX","LABELS_CONTAINER_CLASS","LINES_CONTAINER_CLASS","SUPPRESS_HIGHLIGHT_DURING_PLAY","readyOnce","element","select","graph","mapSvg","bubbleContainerCrop","bubbleContainer","labelListContainer","dataWarningEl","yTitleEl","cTitleEl","yInfoEl","cInfoEl","yearEl","year","setConditions","xAlign","yAlign","on","updateSize","initMap","KEY","getDimension","TIMEDIM","updateUIStrings","wScale","scaleLinear","domain","range","updateIndicators","values","toString","defer","updateEntities","updateTime","frame","translator","getTFunction","conceptPropsS","size","getConceptprops","conceptPropsC","color","strings","title","S","C","text","parent","findChildByName","markerID","alignX","isRTL","alignY","updateView","toggle","setIcon","attr","append","html","style","Number","Boolean","description","sourceLink","pin","rect","getBBox","coord","makeAbsoluteContext","farthestViewportElement","x","y","height","toolRect","root","getBoundingClientRect","chartRect","node","setHook","show","setPos","hide","updateTitleNumbers","mobile","length","hovered","formatterS","getTickFormatter","formatterC","unitS","unit","unitC","valueS","valueC","isDiscrete","getColorlegendMarker","label","getItems","classed","opacity","getUTCFullYear","someSelected","OPACITY_HIGHLT","OPACITY_HIGHLT_DIM","OPACITY_SELECT","OPACITY_REGULAR","opacityRegular","OPACITY_SELECT_DIM","opacitySelectDim","someHighlighted","isHighlighted","d","isSelected","nonSelectedOpacityZero","getScale","getKeys","prefix","pointer","endTime","sortValue","sort","a","b","end","setVisible","call","splash","unselectBubblesWithNoData","selectAll","data","getVisible","order","exit","remove","enter","i","isTouchDevice","_interact","_mouseover","_mouseout","_click","onTap","event","stopPropagation","onLongTap","merge","forEach","selectMarker","duration","reposition","each","index","view","valueX","hook_lng","valueY","hook_lat","valueL","hidden_1","hidden","transition","ease","easeLinear","r","areaToRadius","cLoc","skew","interrupt","_updateLabel","time_1","playing","delayAnimations","setText","formatDate","fitSizeOfTitles","yTitleText","cTitleText","yTitleBB","cTitleBB","font","Math","max","parseInt","width","capitalize","mapPath","geoPath","mapGraph","mapFeature","feature","mesh","translate","mapBounds","bounds","features","insert","properties","toLowerCase","datum","profiles","small","margin","infoElHeight","minRadiusPx","maxRadiusEm","medium","large","presentationProfileChanges","activeProfile","getActiveProfile","containerWH","getVizWidthHeight","maxRadiusPx","hypotenuse","repositionElements","rescaleMap","widthRatio","resize","getLayoutProfile","use","warnBB","titleBBox","t","transform","hTranslate","translateX","translateY","s","mapWidth","mapHeight","viewPortHeight","viewPortWidth","mapTopOffset","mapLeftOffset","widthScale","heightScale","viewBoxHeight","viewBoxWidth","join","w","h","points","extent","minRadius","maxRadius","minArea","radiusToArea","maxArea","concat","highlightMarker","_setTooltip","clearHighlighted","isSuperHighlighted","highlight","druging","showhide","valueLST","cache","labelX0","labelY0","scaledS0","scaledC0","updateLabel","showCloseCross","labelValues","tooltipCache","mouse","labelText","setTooltip","preload","loadFromFile","assetName","onSuccess","getAsset","response","topoPath","getProp","topoWhich","topoKey","Promise","resolve","reject","dim","query","language","id","from","key","where","$and","$in","dataPromise","load","then","dataId","getData","err","JSON","stringify"],"mappings":"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","file":"bubblemap.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 6a2711324c69435e97dc","import \"./styles.scss\";\nimport component from \"./component\";\n\nconst VERSION_INFO = { version: __VERSION, build: __BUILD };\n\n//BAR CHART TOOL\nconst BubbleMap = Vizabi.Tool.extend(\"BubbleMap\", {\n\n\n  /**\n   * Initializes the tool (Bar Chart Tool).\n   * Executed once before any template is rendered.\n   * @param {Object} placeholder Placeholder element for the tool\n   * @param {Object} external_model Model as given by the external page\n   */\n  init(placeholder, external_model) {\n\n    this.name = \"bubblemap\";\n\n    //specifying components\n    this.components = [{\n      component,\n      placeholder: \".vzb-tool-viz\",\n      model: [\"state.time\", \"state.entities\", \"state.marker\", \"locale\", \"ui\", \"data\"] //pass models to component\n    }, {\n      component: Vizabi.Component.get(\"timeslider\"),\n      placeholder: \".vzb-tool-timeslider\",\n      model: [\"state.time\", \"state.entities\", \"state.marker\", \"ui\"]\n    }, {\n      component: Vizabi.Component.get(\"dialogs\"),\n      placeholder: \".vzb-tool-dialogs\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"buttonlist\"),\n      placeholder: \".vzb-tool-buttonlist\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"treemenu\"),\n      placeholder: \".vzb-tool-treemenu\",\n      model: [\"state.marker\", \"state.marker_tags\", \"state.time\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datawarning\"),\n      placeholder: \".vzb-tool-datawarning\",\n      model: [\"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datanotes\"),\n      placeholder: \".vzb-tool-datanotes\",\n      model: [\"state.marker\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"steppedspeedslider\"),\n      placeholder: \".vzb-tool-stepped-speed-slider\",\n      model: [\"state.time\", \"locale\"]\n    }\n    ];\n\n    //constructor is the same as any tool\n    this._super(placeholder, external_model);\n  },\n\n  default_model: {\n    state: {\n      time: {\n        \"delay\": 100,\n        \"delayThresholdX2\": 50,\n        \"delayThresholdX4\": 25\n      },\n      entities: {\n        \"opacitySelectDim\": 0.3,\n        \"opacityRegular\": 1\n      }\n    },\n    locale: { },\n    ui: {\n      map: {\n        path: null,\n        colorGeo: false,\n        preserveAspectRatio: true,\n        scale: 0.95,\n        offset: {\n          top: 0,\n          right: 0,\n          bottom: 0,\n          left: 0\n        },\n        projection: \"robinson\",\n        topology: {\n          path: null,\n          objects: {\n            geo: \"land\",\n            boundaries: \"countries\"\n          },\n          geoIdProperty: null,\n        }\n      },\n      chart: {\n        superhighlightOnMinimapHover: true,\n        labels: {\n          dragging: true\n        }\n      },\n      datawarning: {\n        doubtDomain: [],\n        doubtRange: []\n      },\n      \"buttons\": [\"colors\", \"find\", \"size\", \"moreoptions\", \"fullscreen\", \"presentation\"],\n      \"dialogs\": {\n        \"popup\": [\"colors\", \"find\", \"size\", \"moreoptions\"],\n        \"sidebar\": [\"colors\", \"find\", \"size\"],\n        \"moreoptions\": [\"opacity\", \"speed\", \"size\", \"colors\", \"presentation\", \"about\"]\n      },\n      presentation: false\n    }\n  },\n\n  versionInfo: VERSION_INFO\n});\n\nexport default BubbleMap;\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","const {\n  _globals: globals,\n  utils,\n  Component,\n  helpers: {\n    labels: Labels,\n    topojson,\n    \"d3.geoProjection\": d3GeoProjection,\n    \"d3.dynamicBackground\": DynamicBackground,\n  },\n  iconset: {\n    warn: iconWarn,\n    question: iconQuestion,\n  },\n} = Vizabi;\n\n\n// BUBBLE MAP CHART COMPONENT\nconst BubbleMapComponent = Component.extend(\"bubblemap\", {\n  /**\n   * Initializes the component (Bubble Map Chart).\n   * Executed once before any template is rendered.\n   * @param {Object} config The config passed to the component\n   * @param {Object} context The component's parent\n   */\n  init(config, context) {\n    this.name = \"bubblemap\";\n    this.template = require(\"./template.html\");\n    this.bubblesDrawing = null;\n\n\n    this.isMobile = utils.isMobileOrTablet();\n\n    //define expected models for this component\n    this.model_expects = [\n      {\n        name: \"time\",\n        type: \"time\"\n      },\n      {\n        name: \"entities\",\n        type: \"entities\"\n      },\n      {\n        name: \"marker\",\n        type: \"marker\"\n      },\n      {\n        name: \"locale\",\n        type: \"locale\"\n      },\n      {\n        name: \"ui\",\n        type: \"ui\"\n      },\n      {\n        name: \"data\",\n        type: \"data\"\n      }\n    ];\n\n    const _this = this;\n    this.model_binds = {\n      \"change:time.value\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.marker.getFrame(_this.model.time.value, _this.frameChanged.bind(_this));\n      },\n      \"change:marker.highlight\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.highlightMarkers();\n        _this.updateOpacity();\n      },\n      \"change:marker\": function(evt, path) {\n        // bubble size change is processed separately\n        if (!_this._readyOnce) return;\n\n        if (path.indexOf(\"scaleType\") > -1) {\n          _this.ready();\n        }\n      },\n      \"change:marker.size.extent\": function(evt, path) {\n        //console.log(\"EVENT change:marker:size:max\");\n        if (!_this._readyOnce || !_this.entityBubbles) return;\n        _this.updateMarkerSizeLimits();\n        _this.redrawDataPoints(null, false);\n      },\n      \"change:marker.color.palette\": function(evt, path) {\n        if (!_this._readyOnce) return;\n        _this.redrawDataPoints(null, false);\n      },\n      \"change:marker.select\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.selectMarkers();\n        _this.redrawDataPoints(null, false);\n        _this.updateOpacity();\n        _this.updateDoubtOpacity();\n\n      },\n      \"change:marker.opacitySelectDim\": function(evt) {\n        _this.updateOpacity();\n      },\n      \"change:marker.opacityRegular\": function(evt) {\n        _this.updateOpacity();\n      },\n      \"change:marker.superHighlight\": () => this._readyOnce && this._blinkSuperHighlighted(),\n    };\n\n    //this._selectlist = new Selectlist(this);\n\n    //contructor is the same as any component\n    this._super(config, context);\n\n    this.sScale = null;\n    this.cScale = d3.scaleOrdinal(d3.schemeCategory10);\n\n    _this.COLOR_WHITEISH = \"#fdfdfd\";\n\n    d3GeoProjection();\n\n    this._labels = new Labels(this);\n    this._labels.config({\n      CSS_PREFIX: \"vzb-bmc\",\n      LABELS_CONTAINER_CLASS: \"vzb-bmc-labels\",\n      LINES_CONTAINER_CLASS: \"vzb-bmc-lines\",\n      SUPPRESS_HIGHLIGHT_DURING_PLAY: false\n    });\n  },\n\n\n  /**\n   * DOM is ready\n   */\n  readyOnce() {\n\n    this.element = d3.select(this.element);\n\n    this.graph = this.element.select(\".vzb-bmc-graph\");\n    this.mapSvg = this.element.select(\".vzb-bmc-map-background\");\n\n    this.bubbleContainerCrop = this.graph.select(\".vzb-bmc-bubbles-crop\");\n    this.bubbleContainer = this.graph.select(\".vzb-bmc-bubbles\");\n    this.labelListContainer = this.graph.select(\".vzb-bmc-bubble-labels\");\n    this.dataWarningEl = this.graph.select(\".vzb-data-warning\");\n\n    this.yTitleEl = this.graph.select(\".vzb-bmc-axis-y-title\");\n    this.cTitleEl = this.graph.select(\".vzb-bmc-axis-c-title\");\n    this.yInfoEl = this.graph.select(\".vzb-bmc-axis-y-info\");\n    this.cInfoEl = this.graph.select(\".vzb-bmc-axis-c-info\");\n\n    this.entityBubbles = null;\n\n    // year background\n    this.yearEl = this.graph.select(\".vzb-bmc-year\");\n    this.year = new DynamicBackground(this.yearEl);\n    this.year.setConditions({ xAlign: \"left\", yAlign: \"bottom\" });\n\n    const _this = this;\n    this.on(\"resize\", () => {\n      //return if updatesize exists with error\n      if (_this.updateSize()) return;\n      _this.updateMarkerSizeLimits();\n      _this._labels.updateSize();\n      _this.redrawDataPoints();\n      //_this._selectlist.redraw();\n\n    });\n\n    this.initMap();\n\n    this.KEY = this.model.entities.getDimension();\n    this.TIMEDIM = this.model.time.getDimension();\n\n    this.updateUIStrings();\n\n    this.wScale = d3.scaleLinear()\n      .domain(this.model.ui.datawarning.doubtDomain)\n      .range(this.model.ui.datawarning.doubtRange);\n\n    this._labels.readyOnce();\n  },\n\n  /*\n   * Both model and DOM are ready\n   */\n  ready() {\n    const _this = this;\n    this.updateUIStrings();\n    this.updateIndicators();\n    this.updateSize();\n    this.updateMarkerSizeLimits();\n    this.model.marker.getFrame(this.model.time.value, (values, time) => {\n      // TODO: temporary fix for case when after data loading time changed on validation\n      if (time.toString() != _this.model.time.value.toString()) {\n        utils.defer(() => {\n          _this.ready();\n        });\n        return;\n      } // frame is outdated\n\n      if (!values) return;\n      _this.values = values;\n      _this.updateEntities();\n      _this.updateTime();\n      _this._labels.ready();\n      _this.redrawDataPoints();\n      _this.highlightMarkers();\n      _this.selectMarkers();\n//    this._selectlist.redraw();\n      _this.updateDoubtOpacity();\n      _this.updateOpacity();\n    });\n\n  },\n\n  frameChanged(frame, time) {\n    if (time.toString() != this.model.time.value.toString()) return; // frame is outdated\n    if (!frame) return;\n\n    this.values = frame;\n    this.updateTime();\n    this.updateDoubtOpacity();\n    this.redrawDataPoints(null, false);\n\n  },\n\n  updateUIStrings() {\n    const _this = this;\n\n    this.translator = this.model.locale.getTFunction();\n    const conceptPropsS = _this.model.marker.size.getConceptprops();\n    const conceptPropsC = _this.model.marker.color.getConceptprops();\n\n    this.strings = {\n      title: {\n        S: conceptPropsS.name,\n        C: conceptPropsC.name\n      }\n    };\n\n    this.yTitleEl.select(\"text\")\n      .text(this.translator(\"buttons/size\") + \": \" + this.strings.title.S)\n      .on(\"click\", () => {\n        _this.parent\n          .findChildByName(\"gapminder-treemenu\")\n          .markerID(\"size\")\n          .alignX(_this.model.locale.isRTL() ? \"right\" : \"left\")\n          .alignY(\"top\")\n          .updateView()\n          .toggle();\n      });\n\n    this.cTitleEl.select(\"text\")\n      .text(this.translator(\"buttons/color\") + \": \" + this.strings.title.C)\n      .on(\"click\", () => {\n        _this.parent\n          .findChildByName(\"gapminder-treemenu\")\n          .markerID(\"color\")\n          .alignX(_this.model.locale.isRTL() ? \"right\" : \"left\")\n          .alignY(\"top\")\n          .updateView()\n          .toggle();\n      });\n\n    utils.setIcon(this.dataWarningEl, iconWarn).select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\");\n    this.dataWarningEl.append(\"text\")\n      .attr(\"text-anchor\", \"end\")\n      .text(this.translator(\"hints/dataWarning\"));\n\n    this.dataWarningEl\n      .on(\"click\", () => {\n        _this.parent.findChildByName(\"gapminder-datawarning\").toggle();\n      })\n      .on(\"mouseover\", () => {\n        _this.updateDoubtOpacity(1);\n      })\n      .on(\"mouseout\", () => {\n        _this.updateDoubtOpacity();\n      });\n\n    this.yInfoEl\n      .html(iconQuestion)\n      .select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\")\n      .style('opacity', Number(Boolean(conceptPropsS.description || conceptPropsS.sourceLink)));\n\n    //TODO: move away from UI strings, maybe to ready or ready once\n    this.yInfoEl.on(\"click\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.yInfoEl.on(\"mouseover\", function() {\n      const rect = this.getBBox();\n      const coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      const toolRect = _this.root.element.getBoundingClientRect();\n      const chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"size\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.yInfoEl.on(\"mouseout\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n    });\n\n    this.cInfoEl\n      .html(iconQuestion)\n      .select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\")\n      .style('opacity', Number(Boolean(conceptPropsC.description || conceptPropsC.sourceLink)));\n\n    //TODO: move away from UI strings, maybe to ready or ready once\n    this.cInfoEl.on(\"click\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.cInfoEl.on(\"mouseover\", function() {\n      const rect = this.getBBox();\n      const coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      const toolRect = _this.root.element.getBoundingClientRect();\n      const chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"color\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.cInfoEl.on(\"mouseout\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n    });\n  },\n\n  // show size number on title when hovered on a bubble\n  updateTitleNumbers() {\n    const _this = this;\n\n    let mobile; // if is mobile device and only one bubble is selected, update the ytitle for the bubble\n    if (_this.isMobile && _this.model.marker.select && _this.model.marker.select.length === 1) {\n      mobile = _this.model.marker.select[0];\n    }\n\n    if (_this.hovered || mobile) {\n      const conceptPropsS = _this.model.marker.size.getConceptprops();\n      const conceptPropsC = _this.model.marker.color.getConceptprops();\n\n      const hovered = _this.hovered || mobile;\n      const formatterS = _this.model.marker.size.getTickFormatter();\n      const formatterC = _this.model.marker.color.getTickFormatter();\n\n      const unitS = conceptPropsS.unit || \"\";\n      const unitC = conceptPropsC.unit || \"\";\n\n      const valueS = _this.values.size[hovered[_this.KEY]];\n      let valueC = _this.values.color[hovered[_this.KEY]];\n\n      //resolve value for color from the color legend model\n      if (_this.model.marker.color.isDiscrete() && valueC) {\n        valueC = this.model.marker.color.getColorlegendMarker().label.getItems()[valueC] || \"\";\n      }\n\n      _this.yTitleEl.select(\"text\")\n        .text(_this.translator(\"buttons/size\") + \": \" + formatterS(valueS) + \" \" + unitS);\n\n      _this.cTitleEl.select(\"text\")\n        .text(_this.translator(\"buttons/color\") + \": \" +\n          (valueC || valueC === 0 ? formatterC(valueC) + \" \" + unitC : _this.translator(\"hints/nodata\")));\n\n      this.yInfoEl.classed(\"vzb-hidden\", true);\n      this.cInfoEl.classed(\"vzb-hidden\", true);\n    } else {\n      this.yTitleEl.select(\"text\")\n        .text(this.translator(\"buttons/size\") + \": \" + this.strings.title.S);\n      this.cTitleEl.select(\"text\")\n        .text(this.translator(\"buttons/color\") + \": \" + this.strings.title.C);\n\n      this.yInfoEl.classed(\"vzb-hidden\", false);\n      this.cInfoEl.classed(\"vzb-hidden\", false || this.cTitleEl.classed(\"vzb-hidden\"));\n    }\n  },\n\n  updateDoubtOpacity(opacity) {\n    if (opacity == null) opacity = this.wScale(+this.time.getUTCFullYear().toString());\n    if (this.someSelected) opacity = 1;\n    this.dataWarningEl.style(\"opacity\", opacity);\n  },\n\n  updateOpacity() {\n    const _this = this;\n    /*\n     this.entityBubbles.classed(\"vzb-selected\", function (d) {\n     return _this.model.marker.isSelected(d);\n     });\n     */\n\n    const OPACITY_HIGHLT = 1.0;\n    const OPACITY_HIGHLT_DIM = 0.3;\n    const OPACITY_SELECT = 1.0;\n    const OPACITY_REGULAR = this.model.marker.opacityRegular;\n    const OPACITY_SELECT_DIM = this.model.marker.opacitySelectDim;\n\n    this.entityBubbles.style(\"opacity\", d => {\n\n      if (_this.someHighlighted) {\n        //highlight or non-highlight\n        if (_this.model.marker.isHighlighted(d)) return OPACITY_HIGHLT;\n      }\n\n      if (_this.someSelected) {\n        //selected or non-selected\n        return _this.model.marker.isSelected(d) ? OPACITY_SELECT : OPACITY_SELECT_DIM;\n      }\n\n      if (_this.someHighlighted) return OPACITY_HIGHLT_DIM;\n\n      return OPACITY_REGULAR;\n\n    });\n\n    this.entityBubbles.classed(\"vzb-selected\", d => _this.model.marker.isSelected(d));\n\n    const nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n\n    // when pointer events need update...\n    if (nonSelectedOpacityZero !== this.nonSelectedOpacityZero) {\n      this.entityBubbles.style(\"pointer-events\", d => (!_this.someSelected || !nonSelectedOpacityZero || _this.model.marker.isSelected(d)) ?\n        \"visible\" : \"none\");\n    }\n\n    this.nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n  },\n\n  /**\n   * Changes labels for indicators\n   */\n  updateIndicators() {\n    this.sScale = this.model.marker.size.getScale();\n    this.cScale = this.model.marker.color.getScale();\n  },\n\n  /**\n   * Updates entities\n   */\n  updateEntities() {\n\n    const _this = this;\n    const KEY = this.KEY;\n    const TIMEDIM = this.TIMEDIM;\n\n    const getKeys = function(prefix) {\n      prefix = prefix || \"\";\n      return _this.model.marker.getKeys()\n        .map(d => {\n          const pointer = {};\n          pointer[KEY] = d[KEY];\n          pointer[TIMEDIM] = endTime;\n          pointer.sortValue = _this.values.size[d[KEY]] || 0;\n          pointer[KEY] = prefix + d[KEY];\n          return pointer;\n        })\n        .sort((a, b) => b.sortValue - a.sortValue);\n    };\n\n    // get array of GEOs, sorted by the size hook\n    // that makes larger bubbles go behind the smaller ones\n    const endTime = this.model.time.end;\n    this.model.marker.setVisible(getKeys.call(this));\n\n    //unselecting bubbles with no data is used for the scenario when\n    //some bubbles are selected and user would switch indicator.\n    //bubbles would disappear but selection would stay\n    if (!this.model.time.splash) {\n      this.unselectBubblesWithNoData();\n    }\n\n    // TODO: add to csv\n    //Africa 9.1021° N, 18.2812°E\n    //Europe 53.0000° N, 9.0000° E\n    //Asia 49.8380° N, 105.8203° E\n    //north American 48.1667° N and longitude 100.1667° W\n    /*\n     var pos = {\n     \"afr\": {lat: 9.1, lng: 18.3},\n     \"eur\": {lat: 53.0, lng: 9.0},\n     \"asi\": {lat: 49.8, lng: 105.8},\n     \"ame\": {lat: 48.2, lng: -100.2},\n     };\n     */\n\n\n    this.entityBubbles = this.bubbleContainer.selectAll(\".vzb-bmc-bubble\")\n      .data(this.model.marker.getVisible(), d => d[KEY])\n      .order();\n\n    //exit selection\n    this.entityBubbles.exit().remove();\n\n    //enter selection -- init circles\n    this.entityBubbles = this.entityBubbles.enter().append(\"circle\")\n      .attr(\"class\", \"vzb-bmc-bubble\")\n      .on(\"mouseover\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _this._interact()._mouseover(d, i);\n      })\n      .on(\"mouseout\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _this._interact()._mouseout(d, i);\n      })\n      .on(\"click\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _this._interact()._click(d, i);\n        _this.highlightMarkers();\n      })\n      .onTap((d, i) => {\n        _this._interact()._click(d, i);\n        d3.event.stopPropagation();\n      })\n      .onLongTap((d, i) => {\n      })\n      .merge(this.entityBubbles);\n\n  },\n\n  unselectBubblesWithNoData(frame) {\n    const _this = this;\n    const KEY = this.KEY;\n    if (!frame) frame = this.values;\n\n    if (!frame || !frame.size) return;\n\n    this.model.marker.select.forEach(d => {\n      if (!frame.size[d[KEY]] && frame.size[d[KEY]] !== 0)\n        _this.model.marker.selectMarker(d);\n    });\n  },\n\n  redrawDataPoints(duration, reposition) {\n    const _this = this;\n    if (!duration) duration = this.duration;\n    if (!reposition) reposition = true;\n    if (!this.entityBubbles) return utils.warn(\"redrawDataPoints(): no entityBubbles defined. likely a premature call, fix it!\");\n    this.entityBubbles.each(function(d, index) {\n      const view = d3.select(this);\n      const geo = d3.select(\"#\" + d[_this.KEY]);\n\n      const valueX = _this.values.hook_lng[d[_this.KEY]];\n      const valueY = _this.values.hook_lat[d[_this.KEY]];\n      const valueS = _this.values.size[d[_this.KEY]];\n      const valueC = _this.values.color[d[_this.KEY]];\n      const valueL = _this.values.label[d[_this.KEY]];\n\n      d.hidden_1 = d.hidden;\n      d.hidden = (!valueS && valueS !== 0) || valueX == null || valueY == null;\n\n\n      if (d.hidden !== d.hidden_1) {\n        if (duration) {\n          view.transition().duration(duration).ease(d3.easeLinear)\n            .style(\"opacity\", 0)\n            .on(\"end\", () => view.classed(\"vzb-hidden\", d.hidden).style(\"opacity\", _this.model.marker.opacityRegular));\n        } else {\n          view.classed(\"vzb-hidden\", d.hidden);\n        }\n      }\n      if (!d.hidden) {\n\n        d.r = utils.areaToRadius(_this.sScale(valueS || 0));\n        d.label = valueL;\n\n        view.classed(\"vzb-hidden\", false)\n          .attr(\"fill\", valueC != null ? _this.cScale(valueC) : _this.COLOR_WHITEISH);\n\n        if (_this.model.ui.map.colorGeo)\n          geo.style(\"fill\", valueC != null ? _this.cScale(valueC) : \"#999\");\n\n        if (reposition) {\n          d.cLoc = _this.skew(_this.projection([valueX || 0, valueY || 0]));\n\n          view.attr(\"cx\", d.cLoc[0])\n            .attr(\"cy\", d.cLoc[1]);\n        }\n\n        if (duration) {\n          view.transition().duration(duration).ease(d3.easeLinear)\n            .attr(\"r\", d.r);\n        } else {\n          view.interrupt()\n            .attr(\"r\", d.r)\n            .transition();\n        }\n\n        _this._updateLabel(d, index, d.cLoc[0], d.cLoc[1], valueS, valueC, d.label, duration);\n      } else {\n        _this._updateLabel(d, index, 0, 0, valueS, valueC, valueL, duration);\n      }\n\n    });\n  },\n\n  /*\n   * UPDATE TIME:\n   * Ideally should only update when time or data changes\n   */\n  updateTime() {\n    const _this = this;\n\n    this.time_1 = this.time == null ? this.model.time.value : this.time;\n    this.time = this.model.time.value;\n    this.duration = this.model.time.playing && (this.time - this.time_1 > 0) ? this.model.time.delayAnimations : 0;\n    this.year.setText(this.model.time.formatDate(this.time), this.duration);\n\n    //possibly update the exact value in size title\n    this.updateTitleNumbers();\n  },\n\n\n  fitSizeOfTitles() {\n    // reset font sizes first to make the measurement consistent\n    const yTitleText = this.yTitleEl.select(\"text\");\n    yTitleText.style(\"font-size\", null);\n\n    const cTitleText = this.cTitleEl.select(\"text\");\n    cTitleText.style(\"font-size\", null);\n\n    const yTitleBB = yTitleText.node().getBBox();\n    const cTitleBB = this.cTitleEl.classed(\"vzb-hidden\") ? yTitleBB : cTitleText.node().getBBox();\n\n    const font =\n      Math.max(parseInt(yTitleText.style(\"font-size\")), parseInt(cTitleText.style(\"font-size\")))\n      * this.width / Math.max(yTitleBB.width, cTitleBB.width);\n\n    if (Math.max(yTitleBB.width, cTitleBB.width) > this.width) {\n      yTitleText.style(\"font-size\", font + \"px\");\n      cTitleText.style(\"font-size\", font + \"px\");\n    } else {\n\n      // Else - reset the font size to default so it won't get stuck\n      yTitleText.style(\"font-size\", null);\n      cTitleText.style(\"font-size\", null);\n    }\n\n  },\n\n  initMap() {\n    if (!this.topology) utils.warn(\"bubble map afterPreload: missing country shapes \" + this.topology);\n\n    // http://bl.ocks.org/mbostock/d4021aa4dccfd65edffd patterson\n    // http://bl.ocks.org/mbostock/3710566 robinson\n    // map background\n\n    //stage\n\n    this.projection = d3[\"geo\" + utils.capitalize(this.model.ui.map.projection)]();\n\n    this.mapPath = d3.geoPath()\n      .projection(this.projection);\n\n    this.mapGraph = this.element.select(\".vzb-bmc-map-graph\");\n    this.mapGraph.html(\"\");\n\n    this.mapFeature = topojson.feature(this.topology, this.topology.objects[this.model.ui.map.topology.objects.geo]);\n    const boundaries = topojson.mesh(this.topology, this.topology.objects[this.model.ui.map.topology.objects.boundaries], (a, b) => a !== b);\n\n    // project to bounding box https://bl.ocks.org/mbostock/4707858\n    this.projection\n      .scale(1)\n      .translate([0, 0]);\n\n    this.mapBounds = this.mapPath.bounds(this.mapFeature);\n\n    if (this.mapFeature.features) {\n      this.mapGraph.selectAll(\".land\")\n        .data(this.mapFeature.features)\n        .enter().insert(\"path\")\n        .attr(\"d\", this.mapPath)\n        .attr(\"id\", d => d.properties[this.model.ui.map.topology.geoIdProperty].toLowerCase())\n        .attr(\"class\", \"land\");\n    } else {\n      this.mapGraph.insert(\"path\")\n        .datum(this.mapFeature)\n        .attr(\"class\", \"land\");\n    }\n\n    this.mapGraph.insert(\"path\")\n      .datum(boundaries)\n      .attr(\"class\", \"boundary\");\n  },\n\n  profiles: {\n    small: {\n      margin: { top: 10, right: 10, left: 10, bottom: 0 },\n      infoElHeight: 16,\n      minRadiusPx: 0.5,\n      maxRadiusEm: 0.05\n    },\n    medium: {\n      margin: { top: 20, right: 20, left: 20, bottom: 30 },\n      infoElHeight: 20,\n      minRadiusPx: 1,\n      maxRadiusEm: 0.05\n    },\n    large: {\n      margin: { top: 30, right: 30, left: 30, bottom: 35 },\n      infoElHeight: 22,\n      minRadiusPx: 1,\n      maxRadiusEm: 0.05\n    }\n  },\n\n  presentationProfileChanges: {\n    medium: {\n      infoElHeight: 26\n    },\n    large: {\n      infoElHeight: 32\n    }\n  },\n\n  /**\n   * Executes everytime the container or vizabi is resized\n   * Ideally,it contains only operations related to size\n   */\n  updateSize() {\n\n    this.activeProfile = this.getActiveProfile(this.profiles, this.presentationProfileChanges);\n\n    const containerWH = this.root.getVizWidthHeight();\n    this.activeProfile.maxRadiusPx = Math.max(\n      this.activeProfile.minRadiusPx,\n      this.activeProfile.maxRadiusEm * utils.hypotenuse(containerWH.width, containerWH.height)\n    );\n\n    const margin = this.activeProfile.margin;\n\n    this.height = (parseInt(this.element.style(\"height\"), 10) - margin.top - margin.bottom) || 0;\n    this.width = (parseInt(this.element.style(\"width\"), 10) - margin.left - margin.right) || 0;\n\n    if (this.height <= 0 || this.width <= 0) {\n      this.height = 0;\n      this.width = 0;\n      utils.warn(\"Bubble map chart updateSize(): vizabi container is too little or has display:none\");\n    }\n\n    this.repositionElements();\n    this.rescaleMap();\n\n  },\n\n  repositionElements() {\n\n    const margin = this.activeProfile.margin;\n    const infoElHeight = this.activeProfile.infoElHeight;\n    const isRTL = this.model.locale.isRTL();\n\n    this.graph\n      .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    this.year.setConditions({\n      widthRatio: 2 / 10\n    });\n    this.year.resize(this.width, this.height);\n\n    this.yTitleEl\n      .style(\"font-size\", infoElHeight)\n      .attr(\"transform\", \"translate(\" + (isRTL ? this.width : 0) + \",\" + margin.top + \")\");\n\n    const yTitleBB = this.yTitleEl.select(\"text\").node().getBBox();\n\n    //hide the second line about color in large profile or when color is constant\n    this.cTitleEl.attr(\"transform\", \"translate(\" + (isRTL ? this.width : 0) + \",\" + (margin.top + yTitleBB.height) + \")\")\n      .classed(\"vzb-hidden\", this.getLayoutProfile() === \"large\" || this.model.marker.color.use == \"constant\");\n\n    const warnBB = this.dataWarningEl.select(\"text\").node().getBBox();\n    this.dataWarningEl.select(\"svg\")\n      .attr(\"width\", warnBB.height * 0.75)\n      .attr(\"height\", warnBB.height * 0.75)\n      .attr(\"x\", -warnBB.width - warnBB.height * 1.2)\n      .attr(\"y\", -warnBB.height * 0.65);\n\n    this.dataWarningEl\n      .attr(\"transform\", \"translate(\" + (this.width) + \",\" + (this.height - warnBB.height * 0.5) + \")\")\n      .select(\"text\");\n\n    if (this.yInfoEl.select(\"svg\").node()) {\n      const titleBBox = this.yTitleEl.node().getBBox();\n      const t = utils.transform(this.yTitleEl.node());\n      const hTranslate = isRTL ? (titleBBox.x + t.translateX - infoElHeight * 1.4) : (titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4);\n\n      this.yInfoEl.select(\"svg\")\n        .attr(\"width\", infoElHeight)\n        .attr(\"height\", infoElHeight);\n      this.yInfoEl.attr(\"transform\", \"translate(\"\n        + hTranslate + \",\"\n        + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n\n    this.cInfoEl.classed(\"vzb-hidden\", this.cTitleEl.classed(\"vzb-hidden\"));\n\n    if (!this.cInfoEl.classed(\"vzb-hidden\") && this.cInfoEl.select(\"svg\").node()) {\n      const titleBBox = this.cTitleEl.node().getBBox();\n      const t = utils.transform(this.cTitleEl.node());\n      const hTranslate = isRTL ? (titleBBox.x + t.translateX - infoElHeight * 1.4) : (titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4);\n\n      this.cInfoEl.select(\"svg\")\n        .attr(\"width\", infoElHeight)\n        .attr(\"height\", infoElHeight);\n      this.cInfoEl.attr(\"transform\", \"translate(\"\n        + hTranslate + \",\"\n        + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n  },\n\n  rescaleMap() {\n\n    const offset = this.model.ui.map.offset;\n    const margin = this.activeProfile.margin;\n\n    // scale to aspect ratio\n    // http://bl.ocks.org/mbostock/4707858\n    const s = this.model.ui.map.scale / Math.max((this.mapBounds[1][0] - this.mapBounds[0][0]) / this.width, (this.mapBounds[1][1] - this.mapBounds[0][1]) / this.height);\n\n    // dimensions of the map itself (regardless of cropping)\n    const mapWidth = (s * (this.mapBounds[1][0] - this.mapBounds[0][0]));\n    const mapHeight = (s * (this.mapBounds[1][1] - this.mapBounds[0][1]));\n\n    // dimensions of the viewport in which the map is shown (can be bigger or smaller than map)\n    let viewPortHeight = mapHeight * (1 + offset.top + offset.bottom);\n    let viewPortWidth = mapWidth * (1 + offset.left + offset.right);\n    const mapTopOffset = mapHeight * offset.top;\n    const mapLeftOffset = mapWidth * offset.left;\n\n    // translate projection to the middle of map\n    const t = [(mapWidth - s * (this.mapBounds[1][0] + this.mapBounds[0][0])) / 2, (mapHeight - s * (this.mapBounds[1][1] + this.mapBounds[0][1])) / 2];\n\n    this.projection\n      .scale(s)\n      .translate(t);\n\n    this.mapGraph\n      .selectAll(\"path\").attr(\"d\", this.mapPath);\n\n    // handle scale to fit case\n    let widthScale, heightScale;\n    if (!this.model.ui.map.preserveAspectRatio) {\n\n      // wrap viewBox around viewport so map scales to fit viewport\n      const viewBoxHeight = viewPortHeight;\n      const viewBoxWidth = viewPortWidth;\n\n      // viewport is complete area (apart from scaling)\n      viewPortHeight = this.height * this.model.ui.map.scale;\n      viewPortWidth = this.width * this.model.ui.map.scale;\n\n      this.mapSvg\n        .attr(\"preserveAspectRatio\", \"none\")\n        .attr(\"viewBox\", [0, 0, viewBoxWidth, viewBoxHeight].join(\" \"));\n\n      //            ratio between map, viewport and offset (for bubbles)\n      widthScale = viewPortWidth / (mapWidth || 1) / (1 + offset.left + offset.right);\n      heightScale = viewPortHeight / (mapHeight || 1) / (1 + offset.top + offset.bottom);\n\n    } else {\n\n      // no scaling needed\n      widthScale = 1;\n      heightScale = 1;\n\n    }\n\n    // internal offset against parent container (mapSvg)\n    this.mapGraph\n      .attr(\"transform\", \"translate(\" + mapLeftOffset + \",\" + mapTopOffset + \")\");\n\n    // resize and put in center\n    this.mapSvg\n      .style(\"transform\", \"translate3d(\" + (margin.left + (this.width - viewPortWidth) / 2) + \"px,\" + (margin.top + (this.height - viewPortHeight) / 2) + \"px,0)\")\n      .attr(\"width\", viewPortWidth)\n      .attr(\"height\", viewPortHeight);\n\n    // set skew function used for bubbles in chart\n    const _this = this;\n    this.skew = (function() {\n      const w = _this.width;\n      const h = _this.height;\n      //input pixel loc after projection, return pixel loc after skew;\n      return function(points) {\n        //      input       scale         translate                    translate offset\n        const x = points[0] * widthScale + ((w - viewPortWidth) / 2) + mapLeftOffset * widthScale;\n        const y = points[1] * heightScale + ((h - viewPortHeight) / 2) + mapTopOffset * heightScale;\n        return [x, y];\n      };\n    })();\n\n\n  },\n\n  updateMarkerSizeLimits() {\n    const _this = this;\n    const extent = this.model.marker.size.extent || [0, 1];\n\n    if (!this.activeProfile) return utils.warn(\"updateMarkerSizeLimits() is called before ready(). This can happen if events get unfrozen and getFrame() still didn't return data\");\n\n    let minRadius = this.activeProfile.minRadiusPx;\n    let maxRadius = this.activeProfile.maxRadiusPx;\n\n    let minArea = utils.radiusToArea(Math.max(maxRadius * extent[0], minRadius));\n    let maxArea = utils.radiusToArea(Math.max(maxRadius * extent[1], minRadius));\n\n    let range = minArea === maxArea ? [minArea, maxArea] :\n      d3.range(minArea, maxArea, (maxArea - minArea) / this.sScale.domain().length).concat(maxArea);\n\n    this.sScale.range(range);\n  },\n\n  _interact() {\n    const _this = this;\n\n    return {\n      _mouseover(d, i) {\n        if (_this.model.time.dragging) return;\n\n        _this.model.marker.highlightMarker(d);\n\n        _this.hovered = d;\n        //put the exact value in the size title\n        _this.updateTitleNumbers();\n        _this.fitSizeOfTitles();\n\n        if (_this.model.marker.isSelected(d)) { // if selected, not show hover tooltip\n          _this._setTooltip();\n        } else {\n          //position tooltip\n          _this._setTooltip(d);\n        }\n      },\n      _mouseout(d, i) {\n        if (_this.model.time.dragging) return;\n        _this._setTooltip();\n        _this.hovered = null;\n        _this.updateTitleNumbers();\n        _this.fitSizeOfTitles();\n        _this.model.marker.clearHighlighted();\n      },\n      _click(d, i) {\n        _this.model.marker.selectMarker(d);\n      }\n    };\n\n  },\n\n  _blinkSuperHighlighted() {\n    this.entityBubbles\n      .classed(\"vzb-super-highlighted\", d => this.model.marker.isSuperHighlighted(d));\n  },\n\n  highlightMarkers() {\n    const _this = this;\n    this.someHighlighted = (this.model.marker.highlight.length > 0);\n\n    if (utils.isTouchDevice()) {\n      if (this.someHighlighted) {\n        _this.hovered = this.model.marker.highlight[0];\n      } else {\n        _this.hovered = null;\n      }\n      _this.updateTitleNumbers();\n      _this.fitSizeOfTitles();\n    }\n\n\n//      if (!this.selectList || !this.someSelected) return;\n//      this.selectList.classed(\"vzb-highlight\", function (d) {\n//          return _this.model.entities.isHighlighted(d);\n//      });\n//      this.selectList.each(function (d, i) {\n//        d3.select(this).selectAll(\".vzb-bmc-label-x\")\n//          .classed(\"vzb-invisible\", function(n) {\n//            return !_this.model.entities.isHighlighted(d);\n//          });\n//\n//      });\n\n  },\n\n  _updateLabel(d, index, valueX, valueY, valueS, valueC, valueL, duration) {\n    const _this = this;\n    const KEY = this.KEY;\n    if (d[KEY] == _this.druging) return;\n    if (duration == null) duration = _this.duration;\n\n    // only for selected entities\n    if (_this.model.marker.isSelected(d)) {\n\n      const showhide = d.hidden !== d.hidden_1;\n      const valueLST = null;\n      const cache = {};\n      cache.labelX0 = valueX / this.width;\n      cache.labelY0 = valueY / this.height;\n      cache.scaledS0 = valueS ? utils.areaToRadius(_this.sScale(valueS)) : null;\n      cache.scaledC0 = valueC != null ? _this.cScale(valueC) : _this.COLOR_WHITEISH;\n\n      this._labels.updateLabel(d, index, cache, valueX / this.width, valueY / this.height, valueS, valueC, valueL, valueLST, duration, showhide);\n    }\n  },\n\n  selectMarkers() {\n    const _this = this;\n    const KEY = this.KEY;\n    this.someSelected = (this.model.marker.select.length > 0);\n\n//      this._selectlist.rebuild();\n    if (utils.isTouchDevice()) {\n      _this._labels.showCloseCross(null, false);\n      if (_this.someHighlighted) {\n        _this.model.marker.clearHighlighted();\n      } else {\n        _this.updateTitleNumbers();\n        _this.fitSizeOfTitles();\n      }\n    } else {\n      // hide recent hover tooltip\n      if (!_this.hovered || _this.model.marker.isSelected(_this.hovered)) {\n        _this._setTooltip();\n      }\n    }\n\n    this.nonSelectedOpacityZero = false;\n  },\n\n  _setTooltip(d) {\n    if (d) {\n      const KEY = this.KEY;\n      const values = this.values;\n      const labelValues = {};\n      const tooltipCache = {};\n      const mouse = d3.mouse(this.graph.node()).map(d => parseInt(d));\n      const x = d.cLoc[0] || mouse[0];\n      const y = d.cLoc[1] || mouse[1];\n      const offset = d.r || 0;\n\n      labelValues.valueS = values.size[d[KEY]];\n      labelValues.labelText = labelValues.valueL = values.label[d[KEY]];\n      tooltipCache.labelX0 = labelValues.valueX = x / this.width;\n      tooltipCache.labelY0 = labelValues.valueY = y / this.height;\n      tooltipCache.scaledS0 = offset;\n      tooltipCache.scaledC0 = null;\n\n      this._labels.setTooltip(d, labelValues.labelText, tooltipCache, labelValues);\n    } else {\n      this._labels.setTooltip();\n    }\n  },\n\n  preload() {\n    const _this = this;\n\n    //this component shall fetch the preload geoshape information from a file\n    const loadFromFile = function(assetName, onSuccess) {\n      _this.model.data.getAsset(assetName, function(response){\n        _this.topology = response;\n        onSuccess();\n      });\n    }\n\n    //where the path to preload geoshape can be defined either directly in config:\n    const topoPath = utils.getProp(this, [\"model\", \"ui\", \"map\", \"topology\", \"path\"]);\n\n    //or via an entity property in dataset:\n    const topoWhich = utils.getProp(this, [\"model\", \"ui\", \"map\", \"topology\", \"which\"]);\n    const topoKey = utils.getProp(this, [\"model\", \"ui\", \"map\", \"topology\", \"key\"]);\n\n\n    return new Promise((resolve, reject) => {\n\n      // priority 1: direct URL to the topojson file\n      if (topoPath) {\n        loadFromFile(topoPath, resolve);\n\n        // priority 2: getting URL to the topojson file via DDF request\n      } else if (topoWhich) {\n        const KEY = this.model.entities.dim;\n\n        //build a query to the reader to fetch preload info\n        const query = {\n          language: this.model.locale.id,\n          from: \"entities\",\n          select: {\n            key: [KEY],\n            value: [topoWhich]\n          },\n          where: {\n            $and: [\n              { [KEY]: \"$\" + KEY }\n            ]\n          },\n          join: {\n            [\"$\" + KEY]: { key: KEY, where: { [KEY]: { $in: [topoKey || \"world\"] } } }\n          },\n        };\n\n        const dataPromise = this.model.data.load(query, { [topoWhich]: d => d });\n\n        dataPromise.then(\n          function(dataId) {\n            loadFromFile(_this.model.data.getData(dataId)[0][topoWhich], resolve);\n          },\n          err => utils.warn(\"Problem with Preload query: \", err, JSON.stringify(query))\n        );\n\n        // priority 3: no clues provided, go for a hardcoded filename for a world map\n      } else {\n        loadFromFile(\"assets/world-50m.json\", resolve);\n      }\n\n    });\n  }\n\n\n});\n\n\nexport default BubbleMapComponent;\n\n\n\n// WEBPACK FOOTER //\n// ./src/component.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/styles.scss\n// module id = 2\n// module chunks = 0 1","module.exports = \"<!-- Bubble Map Chart Component -->\\n<div class=\\\"vzb-bubblemap\\\">\\n    <svg class=\\\"vzb-bmc-map-background vzb-export\\\">\\n        <g class=\\\"vzb-bmc-map-graph\\\"></g>\\n    </svg>\\n    <svg class=\\\"vzb-bubblemap-svg vzb-export\\\">\\n        <g class=\\\"vzb-bmc-graph\\\">\\n            <g class=\\\"vzb-bmc-year\\\"></g>\\n\\n            <g class=\\\"vzb-bmc-lines\\\"></g>\\n            <g class=\\\"vzb-bmc-bubbles\\\"></g>\\n            <g class=\\\"vzb-bmc-bubble-labels\\\"></g>\\n\\n\\n            <g class=\\\"vzb-bmc-axis-y-title\\\">\\n                <text></text>\\n            </g>\\n\\n            <g class=\\\"vzb-bmc-axis-c-title\\\">\\n                <text></text>\\n            </g>\\n\\n            <g class=\\\"vzb-bmc-axis-y-info vzb-noexport\\\">\\n            </g>\\n\\n            <g class=\\\"vzb-bmc-axis-c-info vzb-noexport\\\">\\n            </g>\\n\\n            <g class=\\\"vzb-data-warning vzb-noexport\\\">\\n                <svg></svg>\\n                <text></text>\\n            </g>\\n            <g class=\\\"vzb-bmc-labels\\\"></g>\\n        </g>\\n    </svg>\\n</div>\\n\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/template.html\n// module id = 3\n// module chunks = 0 1"],"sourceRoot":""}