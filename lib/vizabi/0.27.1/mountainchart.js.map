{"version":3,"sources":["webpack:///webpack/bootstrap 13931b5586eff35dd323","webpack:///./src/index.js","webpack:///./src/component.js","webpack:///./src/dialogs/axesmc/axesmc.js","webpack:///./src/mountainchart-math.js","webpack:///./src/mountainchart-probe.js","webpack:///./src/mountainchart-selectlist.js","webpack:///./src/styles.scss?ccec","webpack:///./src/dialogs/axesmc/axesmc.html","webpack:///./src/template.html"],"names":["VERSION_INFO","version","build","MountainChart","Vizabi","Tool","extend","init","placeholder","external_model","name","components","component","model","Component","get","_super","default_model","state","time","locale","ui","chart","manualSortingEnabled","yMaxMethod","showProbeX","probeX","xLogStops","xPoints","preload","preloadKey","datawarning","doubtDomain","doubtRange","presentation","versionInfo","utils","globals","_globals","iconset","iconWarn","warn","iconQuestion","question","helpers","Exporter","svgexport","axisSmart","DynamicBackground","THICKNESS_THRESHOLD","COLOR_WHITEISH","MountainChartComponent","config","context","_this","template","require","model_expects","type","model_binds","evt","_readyOnce","marker","getFrame","value","frameChanged","bind","playing","redrawDataPoints","ready","updateSize","_adjustMaxY","force","record","_export","open","element","reset","highlightMarkers","updateOpacity","selectMarkers","_selectlist","redraw","updateDoubtOpacity","_probe","path","indexOf","zoomToMaxMin","updatePointers","pause","redrawDataPointsOnlyColors","_math","prefix","deleteClasses","area","d3","curve","curveBasis","x","xScale","rescale","d","y0","yScale","y1","y","stack","order","stackOrderReverse","key","cached","cScale","xAxis","rangeRatio","rangeShift","mesh","yMax","domReady","select","graph","xAxisEl","xTitleEl","yTitleEl","infoEl","dataWarningEl","yearEl","year","mountainMergeStackedContainer","mountainMergeGroupedContainer","mountainAtomicContainer","mountainLabelContainer","tooltip","eventAreaEl","probeEl","probeLineEl","probeTextEl","selectAll","onTap","i","_interact","_mouseout","afterPreload","xScaleFactor","axis_x","xScaleShift","precomputedShape","income_mountains","shape","length","scaleLog","domain","domainMin","domainMax","scaleLinear","Math","round","map","m","data","enter","append","attr","style","transition","duration","ease","easeLinear","readyOnce","on","dragging","level","invert","mouse","full","KEY","entities","getDimension","TIMEDIM","remove","setText","formatDate","wScale","range","updateUIStrings","updateIndicators","values","valuesAggregated","color","axis_y","end","updateEntities","endValues","_spawnMasks","updateTime","frame","toString","meshLength","profiles","small","margin","top","right","left","bottom","infoElHeight","medium","large","presentationProfileChanges","activeProfile","getActiveProfile","height","parseInt","width","isRTL","yearLabelOptions","topOffset","getLayoutProfile","xAlign","yAlign","widthRatio","setConditions","resize","scaleType","scale","tickSizeOuter","tickPadding","tickSizeMinor","labelerOptions","toolMargin","pivotingLimit","method","METHOD_REPEATING","stops","formatter","getTickFormatter","call","warnBB","node","getBBox","titleBBox","t","transform","hTranslate","translateX","translateY","generateMesh","mdl","zoomedMin","zoomedMax","x1","x2","isFinite","translator","getTFunction","xConceptprops","getConceptprops","text","setIcon","parent","findChildByName","pin","rect","coord","makeAbsoluteContext","farthestViewportElement","toolRect","root","getBoundingClientRect","chartRect","setHook","show","setPos","hide","toggle","opacity","getUTCFullYear","someSelected","getScale","tickFormat","mountainPointers","getKeys","filter","axis_s","pointer","sortValue","aggrLevel","groupedPointers","nest","use","group","sortValues","a","b","entries","groupManualSort","manualSorting","isManualSortCorrect","isArray","forEach","groupSortValue","includes","sum","sortGroupKeys","which","stackedPointers","sort","sortKeys","mountainsMergeStacked","mountainsMergeGrouped","mountainsAtomic","exit","merge","mountains","isTouchDevice","_mousemove","_click","event","stopPropagation","onLongTap","highlightMarker","_setTooltip","getColorlegendMarker","label","getItems","showCloseCross","clearHighlighted","isPlayingOrDragging","isSelected","selectMarker","someHighlighted","highlight","selectList","classed","isHighlighted","rebuild","nonSelectedOpacityZero","_sumLeafPointersByMarker","branch","OPACITY_HIGHLT","OPACITY_HIGHLT_DIM","OPACITY_SELECT","OPACITY_REGULAR","opacityRegular","OPACITY_SELECT_DIM","opacitySelectDim","time_1","delayAnimations","vertices","_spawn","hidden","toStack","concat","subgroup","f","keys","keyIndex","verticesIndex","valuesPointer","max","mergeGrouped","mergeStacked","firstLast","_getFirstLastPointersInStack","_getVerticesOfaMergedShape","first","visible","e","yMaxGroup","visible2","last","arg","tailFatX","unscale","tailCutX","tailFade","k","PI","log","spawnMask","cosineShape","cosineArea","dX","exp","cos","norm","sigma","giniToSigma","mu","gdpToMu","distribution","acc","pdf","lognormal","result","options","prevValues","stackMode","dragOrPlay","each","view","_renderShape","isColorUseIndicator","palette","datum","random","easeCircle","write","id","fill","tooltipText","contentBBox","getProp","Promise","resolve","dim","query","language","from","where","$and","join","$in","order_by","reject","dataPromise","load","JSON","parse","then","dataId","getData","err","stringify","Axes","updateView","markerID","selectDomainMinMax","selectZoomedMinMax","yMaxRadio","setModel","probeCheck","property","probeFieldEl","parseFloat","replace","what","push","MCMath","Class","rangeFrom","rangeTo","rangeStep","gdp","gini","normsinv","pow","normal","p","c","plow","phigh","q","sqrt","r","MCProbe","highlightValue","sumValue","totalArea","leftArea","_computeAreas","formatter1","format","formatter2","heightOfLabels","string","iconClose","close","MCSelectList","_local","listData","descending","unique","geo","_id","labelCloseGroup","insert","sample","fontHeight","fontSizeToFontHeight","parentNode","titleHeight","maxFontHeight","currentAggrLevel","aggrLevelSpacing","groupLabels","spacing","number","closeGroup","closeTextBBox","setTimeout","unhighlightMarker"],"mappings":"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","file":"mountainchart.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 9);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 13931b5586eff35dd323","import \"./styles.scss\";\nimport component from \"./component\";\nimport \"./dialogs/axesmc/axesmc\";\n\nconst VERSION_INFO = { version: __VERSION, build: __BUILD };\n\n// MOUNTAIN CHART TOOL\nconst MountainChart = Vizabi.Tool.extend(\"MountainChart\", {\n\n  /**\n   * Initializes the tool (MountainChart Tool).\n   * Executed once before any template is rendered.\n   * @param {Object} placeholder Placeholder element for the tool\n   * @param {Object} external_model Model as given by the external page\n   */\n  init(placeholder, external_model) {\n\n    this.name = \"mountainchart\";\n\n    //specifying components\n    this.components = [{\n      component,\n      placeholder: \".vzb-tool-viz\",\n      model: [\"state.time\", \"state.entities\", \"state.marker\", \"locale\", \"data\", \"ui\"] //pass models to component\n    }, {\n      component: Vizabi.Component.get(\"timeslider\"),\n      placeholder: \".vzb-tool-timeslider\",\n      model: [\"state.time\", \"state.entities\", \"state.marker\", \"ui\"]\n    }, {\n      component: Vizabi.Component.get(\"dialogs\"),\n      placeholder: \".vzb-tool-dialogs\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"buttonlist\"),\n      placeholder: \".vzb-tool-buttonlist\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"treemenu\"),\n      placeholder: \".vzb-tool-treemenu\",\n      model: [\"state.marker\", \"state.marker_tags\", \"state.time\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datawarning\"),\n      placeholder: \".vzb-tool-datawarning\",\n      model: [\"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datanotes\"),\n      placeholder: \".vzb-tool-datanotes\",\n      model: [\"state.marker\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"steppedspeedslider\"),\n      placeholder: \".vzb-tool-stepped-speed-slider\",\n      model: [\"state.time\", \"locale\"]\n    }];\n\n    //constructor is the same as any tool\n    this._super(placeholder, external_model);\n  },\n\n  default_model: {\n    state: {\n      time: {\n        \"delay\": 100,\n        \"delayThresholdX2\": 50,\n        \"delayThresholdX4\": 25\n      },\n      \"entities\": {\n        \"opacitySelectDim\": 0.3,\n        \"opacityRegular\": 0.7\n      }\n    },\n    locale: { },\n    ui: {\n      chart: {\n        manualSortingEnabled: true,\n        yMaxMethod: \"latest\",\n        showProbeX: true,\n        probeX: 1.85,\n        xLogStops: [1, 2, 5],\n        xPoints: 50,\n        preload: \"income_mountains\",\n        preloadKey: \"world\"\n      },\n      \"buttons\": [\"colors\", \"find\", \"stack\", \"show\", \"moreoptions\", \"fullscreen\", \"presentation\"],\n      \"dialogs\": {\n        \"popup\": [\"colors\", \"find\", \"stack\", \"show\", \"moreoptions\"],\n        \"sidebar\": [\"colors\", \"find\", \"stack\"],\n        \"moreoptions\": [\"opacity\", \"speed\", \"stack\", \"axesmc\", \"colors\", \"presentation\", \"about\"]\n      },\n      datawarning: {\n        doubtDomain: [],\n        doubtRange: []\n      },\n      presentation: false\n    }\n  },\n\n  versionInfo: VERSION_INFO\n});\n\nexport default MountainChart;\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","/**\n * VIZABI MOUNTAINCHART\n * This graph displays income distribution in the world\n *\n * Original code:\n * Angie https://github.com/angieskazka\n *\n * Contributions:\n * IncoCode https://github.com/IncoCode/\n * Arthur https://github.com/arthurcamara1\n *\n * Developed in Gapminder Foundation, 2015\n */\n\nconst { \n  utils, \n  _globals: globals,\n  iconset: {\n    warn: iconWarn,\n    question: iconQuestion\n  },\n  helpers: {\n    svgexport: Exporter,\n    \"d3.axisWithLabelPicker\": axisSmart,\n    \"d3.dynamicBackground\": DynamicBackground,\n  }\n} = Vizabi;\n\nimport MountainChartMath from \"./mountainchart-math\";\nimport Selectlist from \"./mountainchart-selectlist\";\nimport Probe from \"./mountainchart-probe\";\n\nconst THICKNESS_THRESHOLD = 0.001;\nconst COLOR_WHITEISH = \"#d3d3d3\";\n\n// MOUNTAIN CHART COMPONENT\nconst MountainChartComponent = Vizabi.Component.extend(\"mountainchart\", {\n\n  /**\n   * Initialize the component\n   * Executed once before any template is rendered.\n   * @param {Object} config The config passed to the component\n   * @param {Object} context The component's parent\n   */\n  init(config, context) {\n\n    const _this = this;\n    this.name = \"mountainchart\";\n    this.template = require(\"./template.html\");\n\n    //define expected models for this component\n    this.model_expects = [\n      { name: \"time\", type: \"time\" },\n      { name: \"entities\", type: \"entities\" },\n      { name: \"marker\", type: \"marker\" },\n      { name: \"locale\", type: \"locale\" },\n      { name: \"data\", type: \"data\" },\n      { name: \"ui\", type: \"ui\" }\n    ];\n\n    //attach event listeners to the model items\n    this.model_binds = {\n      \"change:time.value\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.marker.getFrame(_this.model.time.value, _this.frameChanged.bind(_this));\n      },\n      \"change:time.playing\": function(evt) {\n        // this listener is a patch for fixing #1228. time.js doesn't produce the last event\n        // with playing == false when paused softly\n        if (!_this.model.time.playing) {\n          _this.redrawDataPoints();\n        }\n      },\n      \"change:marker.axis_x.xScaleFactor\": function() {\n        _this.ready();\n      },\n      \"change:marker.axis_x.xScaleShift\": function() {\n        _this.ready();\n      },\n      \"change:marker.axis_x.tailFatX\": function() {\n        _this.ready();\n      },\n      \"change:marker.axis_x.tailCutX\": function() {\n        _this.ready();\n      },\n      \"change:marker.axis_x.tailFade\": function() {\n        _this.ready();\n      },\n      \"change:ui.chart.probeX\": function() {\n        _this.ready();\n      },\n      \"change:ui.chart.showProbeX\": function() {\n        _this.ready();\n      },\n      \"change:ui.chart.xPoints\": function() {\n        _this.ready();\n      },\n      \"change:ui.chart.xLogStops\": function() {\n        _this.updateSize();\n      },\n      \"change:ui.chart.yMaxMethod\": function() {\n        _this._adjustMaxY({ force: true });\n        _this.redrawDataPoints();\n      },\n      \"change:time.record\": function(evt) {\n        if (_this.model.time.record) {\n          _this._export.open(this.element, this.name);\n        } else {\n          _this._export.reset();\n        }\n      },\n      \"change:marker.highlight\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.highlightMarkers();\n        _this.updateOpacity();\n      },\n      \"change:marker.select\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.selectMarkers();\n        _this._selectlist.redraw();\n        _this.updateOpacity();\n        _this.updateDoubtOpacity();\n        _this.redrawDataPoints();\n        _this._probe.redraw();\n      },\n      \"change:marker.opacitySelectDim\": function(evt) {\n        _this.updateOpacity();\n      },\n      \"change:marker.opacityRegular\": function(evt) {\n        _this.updateOpacity();\n      },\n      \"change:marker\": function(evt, path) {\n        if (!_this._readyOnce) return;\n        if (path.indexOf(\"scaleType\") > -1) {\n          _this.ready();\n        } else if (path.indexOf(\"zoomedMin\") > -1 || path.indexOf(\"zoomedMax\") > -1) {\n          _this.zoomToMaxMin();\n          _this.redrawDataPoints();\n          _this._probe.redraw();\n        }\n      },\n      \"change:marker.group\": function(evt, path) {\n        if (!_this._readyOnce) return;\n        if (path.indexOf(\"group.merge\") > -1) return;\n        _this.ready();\n      },\n      \"change:marker.group.merge\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.updatePointers();\n        _this.redrawDataPoints();\n      },\n      \"change:marker.stack\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.ready();\n      },\n      \"change:marker.stack.which\": function(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.time.playing) {\n          _this.model.time.pause();\n        }\n      },\n      \"change:marker.stack.use\": function(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.time.playing) {\n          _this.model.time.pause();\n        }\n      },\n      \"change:marker.color.palette\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.redrawDataPointsOnlyColors();\n        _this._selectlist.redraw();\n      },\n    };\n\n    this._super(config, context);\n\n    this._math = new MountainChartMath(this);\n    this._export = new Exporter(this);\n    this._export\n      .prefix(\"vzb-mc-\")\n      .deleteClasses([\"vzb-mc-mountains-mergestacked\", \"vzb-mc-mountains-mergegrouped\", \"vzb-mc-mountains\", \"vzb-mc-year\", \"vzb-mc-mountains-labels\", \"vzb-mc-axis-labels\"]);\n    this._probe = new Probe(this);\n    this._selectlist = new Selectlist(this);\n\n    // define path generator\n    this.area = d3.area()\n      .curve(d3.curveBasis)\n      .x(d => _this.xScale(_this._math.rescale(d.x)))\n      .y0(d => _this.yScale(d.y0))\n      .y1(d => _this.yScale(d.y0 + d.y));\n\n    //define d3 stack layout\n    this.stack = d3.stack()\n      .order(d3.stackOrderReverse)\n      .value((d, key) => _this.cached[key][d].y);\n\n    // init internal variables\n    this.xScale = null;\n    this.yScale = null;\n    this.cScale = null;\n\n    this.xAxis = axisSmart(\"bottom\");\n\n\n    this.rangeRatio = 1;\n    this.rangeShift = 0;\n    this.cached = {};\n    this.mesh = [];\n    this.yMax = 0;\n  },\n\n  domReady() {\n    const _this = this;\n\n    // reference elements\n    this.element = d3.select(this.element);\n    this.graph = this.element.select(\".vzb-mc-graph\");\n    this.xAxisEl = this.graph.select(\".vzb-mc-axis-x\");\n    this.xTitleEl = this.graph.select(\".vzb-mc-axis-x-title\");\n    this.yTitleEl = this.graph.select(\".vzb-mc-axis-y-title\");\n    this.infoEl = this.graph.select(\".vzb-mc-axis-info\");\n    this.dataWarningEl = this.graph.select(\".vzb-data-warning\");\n\n    this.yearEl = this.graph.select(\".vzb-mc-year\");\n    this.year = new DynamicBackground(this.yearEl);\n\n    this.mountainMergeStackedContainer = this.graph.select(\".vzb-mc-mountains-mergestacked\");\n    this.mountainMergeGroupedContainer = this.graph.select(\".vzb-mc-mountains-mergegrouped\");\n    this.mountainAtomicContainer = this.graph.select(\".vzb-mc-mountains\");\n    this.mountainLabelContainer = this.graph.select(\".vzb-mc-mountains-labels\");\n    this.tooltip = this.element.select(\".vzb-mc-tooltip\");\n    this.eventAreaEl = this.element.select(\".vzb-mc-eventarea\");\n    this.probeEl = this.element.select(\".vzb-mc-probe\");\n    this.probeLineEl = this.probeEl.select(\"line\");\n    this.probeTextEl = this.probeEl.selectAll(\"text\");\n\n    this.element\n      .onTap((d, i) => {\n        _this._interact()._mouseout(d, i);\n      });\n  },\n\n  afterPreload() {\n    const _this = this;\n\n    this._math.xScaleFactor = this.model.marker.axis_x.xScaleFactor;\n    this._math.xScaleShift = this.model.marker.axis_x.xScaleShift;\n\n    if (!this.precomputedShape || !this.precomputedShape[0] || !this.precomputedShape[0].income_mountains) return;\n\n    const yMax = this.precomputedShape[0].income_mountains[\"yMax_\" + this.model.ui.chart.yMaxMethod];\n    let shape = this.precomputedShape[0].income_mountains.shape;\n\n    if (!yMax || !shape || shape.length === 0) return;\n\n    this.xScale = d3.scaleLog().domain([this.model.marker.axis_x.domainMin, this.model.marker.axis_x.domainMax]);\n    this.yScale = d3.scaleLinear().domain([0, Math.round(yMax)]);\n\n    _this.updateSize(shape.length);\n    _this.zoomToMaxMin();\n\n    shape = shape.map((m, i) => ({ x: _this.mesh[i], y0: 0, y: +m }));\n\n    this.mountainAtomicContainer.selectAll(\".vzb-mc-prerender\")\n      .data([0])\n      .enter().append(\"path\")\n      .attr(\"class\", \"vzb-mc-prerender\")\n      .style(\"fill\", \"pink\")\n      .style(\"opacity\", 0)\n      .attr(\"d\", _this.area(shape))\n      .transition().duration(1000).ease(d3.easeLinear)\n      .style(\"opacity\", 1);\n  },\n\n  readyOnce() {\n\n    this.eventAreaEl\n      .on(\"mousemove\", function() {\n        if (_this.model.time.dragging) return;\n        if (!_this.model.ui.chart.showProbeX) return;\n        _this._probe.redraw({\n          level: _this.xScale.invert(d3.mouse(this)[0]),\n          full: true\n        });\n      })\n      .on(\"mouseout\", () => {\n        if (_this.model.time.dragging) return;\n        if (!_this.model.ui.chart.showProbeX) return;\n        _this._probe.redraw();\n      });\n\n    const _this = this;\n    this.on(\"resize\", () => {\n      //console.log(\"acting on resize\");\n      //return if updatesize exists with error\n      if (_this.updateSize()) return;\n      _this.updatePointers(); // respawn is needed\n      _this.redrawDataPoints();\n      _this._selectlist.redraw();\n      _this._probe.redraw();\n    });\n\n    this.KEY = this.model.entities.getDimension();\n    this.TIMEDIM = this.model.time.getDimension();\n\n    this.mountainAtomicContainer.select(\".vzb-mc-prerender\").remove();\n    this.year.setText(this.model.time.formatDate(this.model.time.value));\n    this.wScale = d3.scaleLinear()\n      .domain(this.model.ui.datawarning.doubtDomain)\n      .range(this.model.ui.datawarning.doubtRange);\n  },\n\n  ready() {\n    //console.log(\"ready\")\n    const _this = this;\n\n    this._math.xScaleFactor = this.model.marker.axis_x.xScaleFactor;\n    this._math.xScaleShift = this.model.marker.axis_x.xScaleShift;\n\n    this.updateUIStrings();\n    this.updateIndicators();\n    this.model.marker.getFrame(this.model.time.value, values => {\n      if (!values) return;\n      _this.values = values;\n      _this.valuesAggregated = { color: {}, axis_y: {} };\n      \n      _this.model.marker.getFrame(_this.model.time.end, endValues => {\n        _this.updateEntities(endValues);\n        _this.updateSize();\n        _this.zoomToMaxMin();\n        _this._spawnMasks();\n        _this.updateTime();\n        _this.updatePointers();\n        _this._adjustMaxY({ force: true });\n        _this.redrawDataPoints();\n        _this.redrawDataPointsOnlyColors();\n        _this.highlightMarkers();\n        _this.selectMarkers();\n        _this._selectlist.redraw();\n        _this.updateOpacity();\n        _this.updateDoubtOpacity();\n        _this._probe.redraw();\n      });\n    });\n  },\n\n  frameChanged(frame, time) {\n    if (!frame) return utils.warn(\"change:time.value: empty data received from marker.getFrame(). doing nothing\");\n    if (time.toString() != this.model.time.value.toString()) return; // frame is outdated\n    this.values = frame;\n    this.updateTime();\n    this.updatePointers();\n    this.redrawDataPoints();\n    this._selectlist.redraw();\n    this._probe.redraw();\n    this.updateDoubtOpacity();\n  },\n\n\n  updateSize(meshLength) {\n    const profiles = {\n      small: {\n        margin: { top: 10, right: 10, left: 10, bottom: 18 },\n        infoElHeight: 16\n      },\n      medium: {\n        margin: { top: 20, right: 20, left: 20, bottom: 30 },\n        infoElHeight: 20\n      },\n      large: {\n        margin: { top: 30, right: 30, left: 30, bottom: 35 },\n        infoElHeight: 22\n      }\n    };\n\n    const presentationProfileChanges = {\n      medium: {\n        margin: { top: 20, right: 20, left: 20, bottom: 50 },\n        infoElHeight: 26\n      },\n      large: {\n        margin: { top: 30, right: 30, left: 30, bottom: 50 },\n        infoElHeight: 32\n      }\n    };\n\n    this.activeProfile = this.getActiveProfile(profiles, presentationProfileChanges);\n    const { margin } = this.activeProfile;\n    const { infoElHeight } = this.activeProfile;\n\n    //mesure width and height\n    this.height = (parseInt(this.element.style(\"height\"), 10) - margin.top - margin.bottom) || 0;\n    this.width = (parseInt(this.element.style(\"width\"), 10) - margin.left - margin.right) || 0;\n\n    if (this.height <= 0 || this.width <= 0) {\n      this.height = 0;\n      this.width = 0;\n      utils.warn(\"Mountain chart updateSize(): vizabi container is too little or has display:none\");\n    }\n\n    //graph group is shifted according to margins (while svg element is at 100 by 100%)\n    this.graph.attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    const isRTL = this.model.locale.isRTL();\n\n    const yearLabelOptions = {\n      topOffset: this.getLayoutProfile() === \"large\" ? margin.top * 2 : 0,\n      xAlign: this.getLayoutProfile() === \"large\" ? (isRTL ? \"left\" : \"right\") : \"center\",\n      yAlign: this.getLayoutProfile() === \"large\" ? \"top\" : \"center\",\n      widthRatio: this.getLayoutProfile() === \"large\" ? 3 / 8 : 8 / 10\n    };\n\n    //year is centered and resized\n    this.year\n      .setConditions(yearLabelOptions)\n      .resize(this.width, this.height);\n\n    //update scales to the new range\n    this.yScale.range([this.height, 0]);\n    this.xScale.range([this.rangeShift, this.width * this.rangeRatio + this.rangeShift]);\n\n\n    //need to know scale type of X to move on\n    const scaleType = this._readyOnce ? this.model.marker.axis_x.scaleType : \"log\";\n\n    //axis is updated\n    this.xAxis.scale(this.xScale)\n      .tickSizeOuter(0)\n      .tickPadding(9)\n      .tickSizeMinor(3, 0)\n      .labelerOptions({\n        scaleType,\n        toolMargin: margin,\n        pivotingLimit: margin.bottom * 1.5,\n        method: this.xAxis.METHOD_REPEATING,\n        stops: this._readyOnce ? this.model.ui.chart.xLogStops : [1],\n        formatter: this.model.marker.axis_x.getTickFormatter()\n      });\n\n\n    this.xAxisEl\n      .attr(\"transform\", \"translate(0,\" + this.height + \")\")\n      .call(this.xAxis);\n\n    this.xTitleEl.select(\"text\")\n      .attr(\"transform\", \"translate(\" + this.width + \",\" + this.height + \")\")\n      .attr(\"dy\", \"-0.36em\");\n\n    this.yTitleEl\n      .style(\"font-size\", infoElHeight + \"px\")\n      .attr(\"transform\", \"translate(\" + (isRTL ? this.width : 0) + \",\" + margin.top + \")\");\n\n\n    const warnBB = this.dataWarningEl.select(\"text\").node().getBBox();\n    this.dataWarningEl.select(\"svg\")\n      .attr(\"width\", warnBB.height)\n      .attr(\"height\", warnBB.height)\n      .attr(\"x\", warnBB.height * 0.1)\n      .attr(\"y\", -warnBB.height * 1.0 + 1);\n\n    this.dataWarningEl\n      .attr(\"transform\", \"translate(\" + (isRTL ? this.width - warnBB.width - warnBB.height * 2 : 0) + \",\" + (margin.top + warnBB.height * 1.5) + \")\")\n      .select(\"text\")\n      .attr(\"dx\", warnBB.height * 1.5);\n\n    if (this.infoEl.select(\"svg\").node()) {\n      const titleBBox = this.yTitleEl.node().getBBox();\n      const t = utils.transform(this.yTitleEl.node());\n      const hTranslate = isRTL ? (titleBBox.x + t.translateX - infoElHeight * 1.4) : (titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4);\n\n      this.infoEl.select(\"svg\")\n        .attr(\"width\", infoElHeight + \"px\")\n        .attr(\"height\", infoElHeight + \"px\");\n      this.infoEl.attr(\"transform\", \"translate(\"\n        + hTranslate + \",\"\n        + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n\n    this.eventAreaEl\n      .attr(\"y\", this.height)\n      .attr(\"width\", this.width)\n      .attr(\"height\", margin.bottom);\n\n    if (!meshLength) meshLength = this.model.ui.chart.xPoints;\n    this.mesh = this._math.generateMesh(meshLength, scaleType, this.xScale.domain());\n  },\n\n\n  zoomToMaxMin() {\n    const _this = this;\n    const mdl = this.model.marker.axis_x;\n\n    if (mdl.zoomedMin == null && mdl.domainMin == null || mdl.zoomedMax == null && mdl.domainMin == null) return;\n\n    const x1 = this.xScale(mdl.zoomedMin || mdl.domainMin);\n    const x2 = this.xScale(mdl.zoomedMax || mdl.domainMax);\n    // if we have same x1 and x2 then divider will be 0 and rangeRation will become -Infinity\n    if (!isFinite(x1) || !isFinite(x2) || x1 === x2) return;\n\n    this.rangeRatio = this.width / (x2 - x1) * this.rangeRatio;\n    this.rangeShift = (this.rangeShift - x1) / (x2 - x1) * this.width;\n\n    this.xScale.range([this.rangeShift, this.width * this.rangeRatio + this.rangeShift]);\n\n    this.xAxisEl.call(this.xAxis);\n  },\n\n\n  updateUIStrings() {\n    const _this = this;\n\n    this.translator = this.model.locale.getTFunction();\n    const xConceptprops = this.model.marker.axis_x.getConceptprops();\n\n\n    this.xTitleEl.select(\"text\")\n      .text(this.translator(\"unit/mountainchart_hardcoded_income_per_day\"));\n\n    this.yTitleEl.select(\"text\")\n      .text(this.translator(\"mount/title\"));\n\n    utils.setIcon(this.dataWarningEl, iconWarn).select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\");\n    this.dataWarningEl.append(\"text\")\n      .text(this.translator(\"hints/dataWarning\"));\n\n    utils.setIcon(this.infoEl, iconQuestion).select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\");\n\n    //TODO: move away from UI strings, maybe to ready or ready once\n    this.infoEl.on(\"click\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.infoEl.on(\"mouseover\", function() {\n      const rect = this.getBBox();\n      const coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      const toolRect = _this.root.element.getBoundingClientRect();\n      const chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"axis_y\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.infoEl.on(\"mouseout\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n    });\n\n\n    this.dataWarningEl\n      .on(\"click\", () => {\n        _this.parent.findChildByName(\"gapminder-datawarning\").toggle();\n      })\n      .on(\"mouseover\", () => {\n        _this.updateDoubtOpacity(1);\n      })\n      .on(\"mouseout\", () => {\n        _this.updateDoubtOpacity();\n      });\n  },\n\n  updateDoubtOpacity(opacity) {\n    if (opacity == null) opacity = this.wScale(+this.time.getUTCFullYear().toString());\n    if (this.someSelected) opacity = 1;\n    this.dataWarningEl.style(\"opacity\", opacity);\n  },\n\n  updateIndicators() {\n    const _this = this;\n\n    //fetch scales, or rebuild scales if there are none, then fetch\n    this.yScale = this.model.marker.axis_y.getScale();\n    this.xScale = this.model.marker.axis_x.getScale();\n    this.cScale = this.model.marker.color.getScale();\n\n    this.xAxis.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n  },\n\n  updateEntities(values = this.values) {\n    const _this = this;\n\n    // construct pointers\n    this.mountainPointers = this.model.marker.getKeys()\n      .filter(d => 1\n      && values.axis_x[d[_this.KEY]]\n      && values.axis_y[d[_this.KEY]]\n      && values.axis_s[d[_this.KEY]])\n      .map(d => {\n        const pointer = {};\n        pointer[_this.KEY] = d[_this.KEY];\n        pointer.KEY = function() {\n          return this[_this.KEY];\n        };\n        pointer.sortValue = [values.axis_y[pointer.KEY()] || 0, 0];\n        pointer.aggrLevel = 0;\n        return pointer;\n      });\n\n\n    //TODO: optimise this!\n    this.groupedPointers = d3.nest()\n      .key(d => _this.model.marker.stack.use === \"property\" ? values.stack[d.KEY()] : values.group[d.KEY()])\n      .sortValues((a, b) => b.sortValue[0] - a.sortValue[0])\n      .entries(this.mountainPointers);\n\n\n    const groupManualSort = this.model.marker.group.manualSorting;\n    const isManualSortCorrect = utils.isArray(groupManualSort) && groupManualSort.length > 1;\n    this.groupedPointers.forEach(group => {\n      const groupSortValue = isManualSortCorrect ?\n        groupManualSort.includes(group.key) ?\n          groupManualSort.length - 1 - groupManualSort.indexOf(group.key) :\n          -1 :\n        d3.sum(group.values.map(m => m.sortValue[0]));\n\n      group.values.forEach(d => {\n        d.sortValue[1] = groupSortValue;\n      });\n\n      group[_this.model.entities.getDimension()] = group.key; // hack to get highlihgt and selection work\n      group.KEY = function() {\n        return this.key;\n      };\n      group.aggrLevel = 1;\n    });\n\n    const sortGroupKeys = {};\n    _this.groupedPointers.forEach(m => {\n      sortGroupKeys[m.key] = m.values[0].sortValue[1];\n    });\n\n\n    // update the stacked pointers\n    if (_this.model.marker.stack.which === \"none\") {\n      this.stackedPointers = [];\n      this.mountainPointers.sort((a, b) => b.sortValue[0] - a.sortValue[0]);\n\n    } else {\n      this.stackedPointers = d3.nest()\n        .key(d => values.stack[d.KEY()])\n        .key(d => values.group[d.KEY()])\n        .sortKeys((a, b) => sortGroupKeys[b] - sortGroupKeys[a])\n        .sortValues((a, b) => b.sortValue[0] - a.sortValue[0])\n        .entries(this.mountainPointers);\n\n      this.mountainPointers.sort((a, b) => b.sortValue[1] - a.sortValue[1]);\n\n\n      this.stackedPointers.forEach(stack => {\n        stack.KEY = function() {\n          return this.key;\n        };\n        stack[_this.model.entities.getDimension()] = stack.key; // hack to get highlihgt and selection work\n        stack.aggrLevel = 2;\n      });\n    }\n\n    //bind the data to DOM elements\n    this.mountainsMergeStacked = this.mountainAtomicContainer.selectAll(\".vzb-mc-mountain.vzb-mc-aggrlevel2\")\n      .data(this.stackedPointers);\n    this.mountainsMergeGrouped = this.mountainAtomicContainer.selectAll(\".vzb-mc-mountain.vzb-mc-aggrlevel1\")\n      .data(this.groupedPointers);\n    this.mountainsAtomic = this.mountainAtomicContainer.selectAll(\".vzb-mc-mountain.vzb-mc-aggrlevel0\")\n      .data(this.mountainPointers);\n\n    //exit selection -- remove shapes\n    this.mountainsMergeStacked.exit().remove();\n    this.mountainsMergeGrouped.exit().remove();\n    this.mountainsAtomic.exit().remove();\n\n    //enter selection -- add shapes\n    this.mountainsMergeStacked = this.mountainsMergeStacked.enter().append(\"path\")\n      .attr(\"class\", \"vzb-mc-mountain vzb-mc-aggrlevel2\")\n      .merge(this.mountainsMergeStacked);\n    this.mountainsMergeGrouped = this.mountainsMergeGrouped.enter().append(\"path\")\n      .attr(\"class\", \"vzb-mc-mountain vzb-mc-aggrlevel1\")\n      .merge(this.mountainsMergeGrouped);\n    this.mountainsAtomic = this.mountainsAtomic.enter().append(\"path\")\n      .attr(\"class\", \"vzb-mc-mountain vzb-mc-aggrlevel0\")\n      .merge(this.mountainsAtomic);\n\n    //add interaction\n    this.mountains = this.mountainAtomicContainer.selectAll(\".vzb-mc-mountain\");\n\n    this.mountains\n      .on(\"mousemove\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _this._interact()._mousemove(d, i);\n      })\n      .on(\"mouseout\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _this._interact()._mouseout(d, i);\n      })\n      .on(\"click\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _this._interact()._click(d, i);\n        _this.highlightMarkers();\n      })\n      .onTap((d, i) => {\n        _this._interact()._click(d, i);\n        d3.event.stopPropagation();\n      })\n      .onLongTap((d, i) => {\n      });\n  },\n\n  _interact() {\n    const _this = this;\n\n    return {\n      _mousemove(d, i) {\n        if (_this.model.time.dragging || _this.model.time.playing) return;\n\n        _this.model.marker.highlightMarker(d);\n\n        const mouse = d3.mouse(_this.graph.node()).map(d => parseInt(d));\n\n        //position tooltip\n        _this._setTooltip(d.key ? _this.model.marker.color.getColorlegendMarker().label.getItems()[d.key] : _this.values.label[d.KEY()]);\n        _this._selectlist.showCloseCross(d, true);\n\n      },\n      _mouseout(d, i) {\n        if (_this.model.time.dragging || _this.model.time.playing) return;\n\n        _this._setTooltip(\"\");\n        _this.model.marker.clearHighlighted();\n        _this._selectlist.showCloseCross(d, false);\n\n      },\n      _click(d) {\n        const isPlayingOrDragging = _this.model.time.dragging || _this.model.time.playing;\n        if (!isPlayingOrDragging || _this.model.marker.isSelected(d)) {\n          _this.model.marker.selectMarker(d);\n        }\n      }\n    };\n\n  },\n\n  highlightMarkers() {\n    const _this = this;\n    this.someHighlighted = (this.model.marker.highlight.length > 0);\n\n    if (!this.selectList || !this.someSelected) return;\n    this.selectList.classed(\"vzb-highlight\", d => _this.model.marker.isHighlighted(d));\n\n  },\n\n  selectMarkers() {\n    const _this = this;\n    this.someSelected = (this.model.marker.select.length > 0);\n\n    this._selectlist.rebuild();\n    this.nonSelectedOpacityZero = false;\n  },\n\n  _sumLeafPointersByMarker(branch, marker) {\n    const _this = this;\n    if (!branch.key) return _this.values[marker][branch.KEY()];\n    return d3.sum(branch.values.map(m => _this._sumLeafPointersByMarker(m, marker)));\n  },\n\n  updateOpacity() {\n    const _this = this;\n    //if(!duration)duration = 0;\n\n    const OPACITY_HIGHLT = 1.0;\n    const OPACITY_HIGHLT_DIM = 0.3;\n    const OPACITY_SELECT = 1.0;\n    const OPACITY_REGULAR = this.model.marker.opacityRegular;\n    const OPACITY_SELECT_DIM = this.model.marker.opacitySelectDim;\n\n    this.mountains.style(\"opacity\", d => {\n\n      if (_this.someHighlighted) {\n        //highlight or non-highlight\n        if (_this.model.marker.isHighlighted(d)) return OPACITY_HIGHLT;\n      }\n\n      if (_this.someSelected) {\n        //selected or non-selected\n        return _this.model.marker.isSelected(d) ? OPACITY_SELECT : OPACITY_SELECT_DIM;\n      }\n\n      if (_this.someHighlighted) return OPACITY_HIGHLT_DIM;\n\n      return OPACITY_REGULAR;\n\n    });\n\n    this.mountains.classed(\"vzb-selected\", d => _this.model.marker.isSelected(d));\n\n    const nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n\n    // when pointer events need update...\n    if (nonSelectedOpacityZero !== this.nonSelectedOpacityZero) {\n      this.mountainsAtomic.style(\"pointer-events\", d => (!_this.someSelected || !nonSelectedOpacityZero || _this.model.marker.isSelected(d)) ?\n        \"visible\" : \"none\");\n    }\n\n    this.nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n  },\n\n  updateTime() {\n    const _this = this;\n\n    this.time_1 = this.time == null ? this.model.time.value : this.time;\n    this.time = this.model.time.value;\n    this.duration = this.model.time.playing && (this.time - this.time_1 > 0) ? this.model.time.delayAnimations : 0;\n    this.year.setText(this.model.time.formatDate(this.time), this.duration);\n  },\n\n  updatePointers() {\n    const _this = this;\n    this.yMax = 0;\n\n\n    //spawn the original mountains\n    this.mountainPointers.forEach((d, i) => {\n      const vertices = _this._spawn(_this.values, d);\n      _this.cached[d.KEY()] = vertices;\n      d.hidden = vertices.length === 0;\n    });\n\n\n    //recalculate stacking\n    if (_this.model.marker.stack.which !== \"none\") {\n      this.stackedPointers.forEach(group => {\n        let toStack = [];\n        group.values.forEach(subgroup => {\n          toStack = toStack.concat(subgroup.values.filter(f => !f.hidden));\n        });\n        _this.stack.keys(toStack.map(d => d.KEY()))(d3.range(_this.mesh.length))\n          .forEach((vertices, keyIndex) => {\n            const key = toStack[keyIndex].KEY();\n            vertices.forEach((d, verticesIndex) => {\n              _this.cached[key][verticesIndex].y0 = d[0];\n            });\n          });\n      });\n    }\n\n    this.mountainPointers.forEach(d => {\n      d.valuesPointer = _this.values;\n      d.yMax = d3.max(_this.cached[d.KEY()].map(m => m.y0 + m.y));\n      if (_this.yMax < d.yMax) _this.yMax = d.yMax;\n    });\n\n    const mergeGrouped = _this.model.marker.group.merge;\n    const mergeStacked = _this.model.marker.stack.merge;\n    //var dragOrPlay = (_this.model.time.dragging || _this.model.time.playing) && this.model.marker.stack.which !== \"none\";\n\n    //if(mergeStacked){\n    this.stackedPointers.forEach(d => {\n      d.valuesPointer = _this.valuesAggregated;\n      const firstLast = _this._getFirstLastPointersInStack(d);\n      _this.cached[d.key] = _this._getVerticesOfaMergedShape(firstLast);\n      _this.valuesAggregated.color[d.key] = \"_default\";\n      _this.valuesAggregated.axis_y[d.key] = _this._sumLeafPointersByMarker(d, \"axis_y\");\n      d.yMax = firstLast.first.yMax;\n    });\n    //} else if (mergeGrouped || dragOrPlay){\n    this.groupedPointers.forEach(d => {\n      d.valuesPointer = _this.valuesAggregated;\n      const firstLast = _this._getFirstLastPointersInStack(d);\n      _this.cached[d.key] = _this._getVerticesOfaMergedShape(firstLast);\n      _this.valuesAggregated.color[d.key] = _this.values.color[firstLast.first.KEY()];\n      _this.valuesAggregated.axis_y[d.key] = _this._sumLeafPointersByMarker(d, \"axis_y\");\n      d.yMax = firstLast.first.yMax;\n    });\n    //}\n\n    if (!mergeStacked && !mergeGrouped && this.model.marker.stack.use === \"property\") {\n      this.groupedPointers.forEach(d => {\n        const visible = d.values.filter(f => !f.hidden);\n        d.yMax = visible[0].yMax;\n        d.values.forEach(e => {\n          e.yMaxGroup = d.yMax;\n        });\n      });\n    }\n\n\n  },\n\n  _getFirstLastPointersInStack(group) {\n    let visible, visible2;\n    let first, last;\n\n    if (group.values[0].values) {\n      visible = group.values[0].values.filter(f => !f.hidden);\n      visible2 = group.values[group.values.length - 1].values.filter(f => !f.hidden);\n      first = visible[0];\n      last = visible2[visible2.length - 1];\n    } else {\n      visible = group.values.filter(f => !f.hidden);\n      first = visible[0];\n      last = visible[visible.length - 1];\n    }\n\n    if (!visible.length || (visible2 && !visible2.length)) utils.warn(\"mountain chart failed to generate shapes. check the incoming data\");\n\n    return {\n      first,\n      last\n    };\n  },\n\n  _getVerticesOfaMergedShape(arg) {\n    const _this = this;\n\n    const first = arg.first.KEY();\n    const last = arg.last.KEY();\n\n    return _this.mesh.map((m, i) => {\n      const y = _this.cached[first][i].y0 + _this.cached[first][i].y - _this.cached[last][i].y0;\n      const y0 = _this.cached[last][i].y0;\n      return {\n        x: m,\n        y0,\n        y\n      };\n    });\n  },\n\n  _spawnMasks() {\n    const _this = this;\n\n    const tailFatX = this._math.unscale(this.model.marker.axis_x.tailFatX);\n    const tailCutX = this._math.unscale(this.model.marker.axis_x.tailCutX);\n    const tailFade = this.model.marker.axis_x.tailFade;\n    const k = 2 * Math.PI / (Math.log(tailFatX) - Math.log(tailCutX));\n    const m = Math.PI - Math.log(tailFatX) * k;\n\n\n    this.spawnMask = [];\n    this.cosineShape = [];\n    this.cosineArea = 0;\n\n    this.mesh.forEach((dX, i) => {\n      _this.spawnMask[i] = dX < tailCutX ? 1 : (dX > tailFade * 7 ? 0 : Math.exp((tailCutX - dX) / tailFade));\n      _this.cosineShape[i] = (dX > tailCutX && dX < tailFatX ? (1 + Math.cos(Math.log(dX) * k + m)) : 0);\n      _this.cosineArea += _this.cosineShape[i];\n    });\n  },\n\n  _spawn(values, d) {\n    const _this = this;\n\n    const norm = values.axis_y[d.KEY()];\n    const sigma = _this._math.giniToSigma(values.axis_s[d.KEY()]);\n    const mu = _this._math.gdpToMu(values.axis_x[d.KEY()], sigma);\n\n    if (!norm || !mu || !sigma) return [];\n\n    const distribution = [];\n    let acc = 0;\n\n    this.mesh.forEach((dX, i) => {\n      distribution[i] = _this._math.pdf.lognormal(dX, mu, sigma);\n      acc += _this.spawnMask[i] * distribution[i];\n    });\n\n    const result = this.mesh.map((dX, i) => ({\n      x: dX,\n      y0: 0,\n      y: norm * (distribution[i] * (1 - _this.spawnMask[i]) + _this.cosineShape[i] / _this.cosineArea * acc)\n    }));\n\n    return result;\n  },\n\n  _adjustMaxY(options) {\n    if (!options) options = {};\n    const _this = this;\n    const method = this.model.ui.chart.yMaxMethod;\n\n    if (method !== \"immediate\" && !options.force) return;\n    if (method === \"latest\") {\n      const prevValues = _this.values;\n      _this.model.marker.getFrame(_this.model.time.end, values => {\n        if (!values) return;\n\n        //below is a complicated issue when updatePointers() is first calculated for one set of values (at the end of time series), then yMax is taken from that data (assuming that population always grows, so the last year has the highest mountain)\n        _this.values = values;\n        _this.updatePointers();\n\n        //after that updatePointers() is called with the actual data of the current time point\n        _this.values = prevValues;\n        _this.yScale.domain([0, Math.round(_this.yMax)]);\n        _this.updatePointers();\n        _this.redrawDataPoints();\n      });\n    } else {\n      if (!_this.yMax) utils.warn(\"Setting yMax to \" + _this.yMax + \". You failed again :-/\");\n      _this.yScale.domain([0, Math.round(_this.yMax)]);\n    }\n  },\n\n  redrawDataPoints() {\n    const _this = this;\n    const mergeGrouped = this.model.marker.group.merge;\n    const mergeStacked = this.model.marker.stack.merge;\n    const stackMode = this.model.marker.stack.which;\n    //it's important to know if the chart is dragging or playing at the moment.\n    //because if that is the case, the mountain chart will merge the stacked entities to save performance\n    const dragOrPlay = (this.model.time.dragging || this.model.time.playing)\n      //never merge when no entities are stacked\n      && stackMode !== \"none\";\n\n    this._adjustMaxY();\n\n    this.mountainsMergeStacked.each(function(d) {\n      const view = d3.select(this);\n      const hidden = !mergeStacked;\n      _this._renderShape(view, d.KEY(), hidden);\n    });\n\n    this.mountainsMergeGrouped.each(function(d) {\n      const view = d3.select(this);\n      const hidden = (!mergeGrouped && !dragOrPlay) || (mergeStacked && !_this.model.marker.isSelected(d));\n      _this._renderShape(view, d.KEY(), hidden);\n    });\n\n    this.mountainsAtomic.each(function(d, i) {\n      const view = d3.select(this);\n      const hidden = d.hidden || ((mergeGrouped || mergeStacked || dragOrPlay) && !_this.model.marker.isSelected(d));\n      _this._renderShape(view, d.KEY(), hidden);\n    });\n\n    if (stackMode === \"none\") {\n      this.mountainsAtomic.sort((a, b) => b.yMax - a.yMax);\n\n    } else if (stackMode === \"all\") {\n      // do nothing if everything is stacked\n\n    } else {\n      if (mergeGrouped || dragOrPlay) {\n        // this.mountainsMergeGrouped.sort(function (a, b) {\n        //     return b.yMax - a.yMax;\n        // });\n      } else {\n        this.mountainsAtomic.sort((a, b) => b.yMaxGroup - a.yMaxGroup);\n      }\n    }\n\n\n    // exporting shapes for shape preloader. is needed once in a while\n    // if (!this.shapes) this.shapes = {}\n    // this.shapes[this.model.time.value.getUTCFullYear()] = {\n    //     yMax: d3.format(\".2e\")(_this.yMax),\n    //     shape: _this.cached[\"all\"].map(function (d) {return d3.format(\".2e\")(d.y);})\n    // }\n\n  },\n\n  redrawDataPointsOnlyColors() {\n    const _this = this;\n    if (!this.mountains) return utils.warn(\"redrawDataPointsOnlyColors(): no mountains  defined. likely a premature call, fix it!\");\n    const isColorUseIndicator = this.model.marker.color.use === \"indicator\";\n    this.mountains.style(\"fill\", d => d.valuesPointer.color[d.KEY()] ?\n      (\n        isColorUseIndicator && d.valuesPointer.color[d.KEY()] == \"_default\" ?\n          _this.model.marker.color.palette[\"_default\"]\n          :\n          _this.cScale(d.valuesPointer.color[d.KEY()])\n      )\n      :\n      COLOR_WHITEISH);\n  },\n\n  _renderShape(view, key, hidden) {\n    const stack = this.model.marker.stack.which;\n    const _this = this;\n    const valuesPointer = view.datum().valuesPointer;\n\n    view.classed(\"vzb-hidden\", hidden);\n\n    if (hidden) {\n      if (stack !== \"none\") view.style(\"stroke-opacity\", 0);\n      return;\n    }\n\n    const filter = {};\n    filter[this.KEY] = key;\n    if (this.model.marker.isSelected(filter)) {\n      view.attr(\"d\", this.area(this.cached[key].filter(f => f.y > valuesPointer.axis_y[key] * THICKNESS_THRESHOLD)));\n    } else {\n      view.attr(\"d\", this.area(this.cached[key]));\n    }\n\n    //color use indicator suggests that this should be updated on every timeframe\n    if (this.model.marker.color.use === \"indicator\") {\n      view.style(\"fill\", valuesPointer.color[key] ?\n        (\n          valuesPointer.color[key] !== \"_default\" ?\n            _this.cScale(valuesPointer.color[key])\n            :\n            _this.model.marker.color.palette[\"_default\"]\n        )\n        :\n        COLOR_WHITEISH\n      );\n    }\n\n    if (stack !== \"none\") view\n      .transition().duration(Math.random() * 900 + 100).ease(d3.easeCircle)\n      .style(\"stroke-opacity\", 0.5);\n\n    if (this.model.time.record) this._export.write({\n      type: \"path\",\n      id: key,\n      time: this.model.time.value.getUTCFullYear(),\n      fill: this.cScale(valuesPointer.color[key]),\n      d: this.area(this.cached[key])\n    });\n  },\n\n  _setTooltip(tooltipText) {\n    if (tooltipText) {\n      const mouse = d3.mouse(this.graph.node()).map(d => parseInt(d));\n\n      //position tooltip\n      this.tooltip.classed(\"vzb-hidden\", false)\n        .attr(\"transform\", \"translate(\" + (mouse[0]) + \",\" + (mouse[1]) + \")\")\n        .selectAll(\"text\")\n        .attr(\"text-anchor\", \"middle\")\n        .attr(\"alignment-baseline\", \"middle\")\n        .text(tooltipText);\n\n      const contentBBox = this.tooltip.select(\"text\").node().getBBox();\n\n      this.tooltip.select(\"rect\")\n        .attr(\"width\", contentBBox.width + 8)\n        .attr(\"height\", contentBBox.height + 8)\n        .attr(\"x\", -contentBBox.width - 25)\n        .attr(\"y\", -contentBBox.height - 25)\n        .attr(\"rx\", contentBBox.height * 0.2)\n        .attr(\"ry\", contentBBox.height * 0.2);\n\n      this.tooltip.selectAll(\"text\")\n        .attr(\"x\", -contentBBox.width - 25 + ((contentBBox.width + 8) / 2))\n        .attr(\"y\", -contentBBox.height - 25 + ((contentBBox.height + 11) / 2)); // 11 is 8 for margin + 3 for strokes\n      const translateX = (mouse[0] - contentBBox.width - 25) > 0 ? mouse[0] : (contentBBox.width + 25);\n      const translateY = (mouse[1] - contentBBox.height - 25) > 0 ? mouse[1] : (contentBBox.height + 25);\n      this.tooltip\n        .attr(\"transform\", \"translate(\" + translateX + \",\" + translateY + \")\");\n\n    } else {\n\n      this.tooltip.classed(\"vzb-hidden\", true);\n    }\n  },\n\n  preload() {\n    const _this = this;\n    \n    const preload = utils.getProp(this, [\"model\", \"ui\", \"chart\", \"preload\"]);\n    const preloadKey = utils.getProp(this, [\"model\", \"ui\", \"chart\", \"preloadKey\"]);\n    if(!preload) return Promise.resolve();\n    \n    const KEY = this.model.entities.dim;\n    const TIMEDIM = this.model.time.dim;\n\n    //build a query to the reader to fetch preload info\n    const query = {\n      language: this.model.locale.id,\n      from: \"datapoints\",\n      select: {\n        key: [KEY, TIMEDIM],\n        value: [preload]\n      },\n      where: { $and: [\n        { [KEY]: \"$\" + KEY },\n        { [TIMEDIM]: \"$\" + TIMEDIM }\n      ] },\n      join: {\n        [\"$\" + KEY]: { key: KEY, where: { [KEY]: { $in: [preloadKey||\"world\"] } } },\n        [\"$\" + TIMEDIM]: { key: TIMEDIM, where: { [TIMEDIM]: this.model.time.formatDate(this.model.time.value) } }\n      },\n      order_by: [TIMEDIM]\n    };\n    \n    return new Promise((resolve, reject) => {\n\n      const dataPromise = this.model.data.load(query, {[preload]: d => JSON.parse(d)});\n\n      dataPromise.then(\n        function(dataId){\n          _this.precomputedShape = _this.model.data.getData(dataId);\n          resolve();\n        },\n        err => utils.warn(\"Problem with Preload mountainchart query: \", err, JSON.stringify(query))\n      );\n    });\n  }\n\n});\n\nexport default MountainChartComponent;\n\n\n\n// WEBPACK FOOTER //\n// ./src/component.js","/*\n * Axes dialog\n */\n\nconst Axes = Vizabi.Component.get(\"_dialog\").extend(\"axesmc\", {\n\n  /**\n   * Initializes the dialog component\n   * @param config component configuration\n   * @param context component context (parent)\n   */\n  init(config, parent) {\n    this.name = \"axesmc\";\n    const _this = this;\n\n    this.model_binds = {\n      \"change:ui.chart.xLogStops\": function() {\n        _this.updateView();\n      },\n      \"change:ui.chart.yMaxMethod\": function() {\n        _this.updateView();\n      }\n    };\n\n    this.components = [{\n      component: Vizabi.Component.get(\"minmaxinputs\"),\n      placeholder: \".vzb-xlimits-container\",\n      model: [\"state.marker\", \"state.time\", \"locale\"],\n      markerID: \"axis_x\",\n      ui: {\n        selectDomainMinMax: false,\n        selectZoomedMinMax: true\n      }\n    }];\n\n\n    this._super(config, parent);\n    this.template = require(\"./axesmc.html\");\n  },\n\n  readyOnce() {\n    this._super();\n\n    const _this = this;\n\n    this.yMaxRadio = this.element.select(\".vzb-yaxis-container\").selectAll(\"input\")\n      .on(\"change\", function() {\n        _this.setModel(\"yMaxMethod\", d3.select(this).node().value);\n      });\n\n    this.xLogStops = this.element.select(\".vzb-xaxis-container\").selectAll(\"input\")\n      .on(\"change\", function() {\n        _this.setModel(\"xLogStops\", d3.select(this).node().value);\n      });\n\n    this.probeCheck = this.element.select(\".vzb-probe-check\")\n      .on(\"change\", function() {\n        _this.setModel(\"showProbeX\", d3.select(this).property(\"checked\"));\n      });\n\n    this.probeFieldEl = this.element.select(\".vzb-probe-field\")\n      .on(\"change\", function() {\n        let result = parseFloat(this.value.replace(\",\", \".\"));\n        if (!result || result <= _this.model.state.marker.axis_x.tailCutX) {\n          this.value = _this.model.ui.chart.probeX;\n          return;\n        } else if (result > _this.model.state.marker.axis_x.domainMax) {\n          result = _this.model.state.marker.axis_x.domainMax;\n        }\n        this.value = result;\n        _this.setModel(\"probeX\", result);\n      });\n\n    this.updateView();\n\n  },\n\n  updateView() {\n    const _this = this;\n\n    this.yMaxRadio.property(\"checked\", function() {\n      return d3.select(this).node().value === _this.model.ui.chart.yMaxMethod;\n    });\n    this.xLogStops.property(\"checked\", function() {\n      return _this.model.ui.chart.xLogStops.indexOf(+d3.select(this).node().value) !== -1;\n    });\n    this.probeCheck.property(\"checked\", this.model.ui.chart.showProbeX);\n    this.probeFieldEl.property(\"value\", this.model.ui.chart.probeX);\n  },\n\n  setModel(what, value) {\n    let result;\n\n    if (what == \"yMaxMethod\") {\n      result = value;\n    }\n    if (what == \"xLogStops\") {\n      result = [];\n      this.xLogStops.each(function() {\n        if (d3.select(this).property(\"checked\")) result.push(+d3.select(this).node().value);\n      });\n    }\n    if (what == \"probeX\" || what == \"showProbeX\") {\n      result = value;\n    }\n\n    this.model.ui.chart[what] = result;\n  }\n});\n\nexport default Axes;\n\n\n\n// WEBPACK FOOTER //\n// ./src/dialogs/axesmc/axesmc.js","const { utils } = Vizabi;\n\nconst MCMath = Vizabi.Class.extend({\n\n  init(context) {\n    this.context = context;\n\n    this.xScaleFactor = 1;\n    this.xScaleShift = 0;\n  },\n\n  rescale(x) {\n    return Math.exp(this.xScaleFactor * Math.log(x) + this.xScaleShift);\n  },\n  unscale(x) {\n    return Math.exp((Math.log(x) - this.xScaleShift) / this.xScaleFactor);\n  },\n\n  generateMesh(length, scaleType, domain) {\n    // span a uniform mesh across the entire X scale\n    // if the scale is log, the mesh would be exponentially distorted to look uniform\n\n    const rangeFrom = scaleType === \"linear\" ? domain[0]\n      : Math.log(this.unscale(domain[0]));\n\n    const rangeTo = scaleType === \"linear\" ? domain[1]\n      : Math.log(this.unscale(domain[1]));\n\n    const rangeStep = (rangeTo - rangeFrom) / length;\n\n    let mesh = d3.range(rangeFrom, rangeTo, rangeStep).concat(rangeTo);\n\n    if (scaleType !== \"linear\") {\n      mesh = mesh.map(dX => Math.exp(dX));\n    } else {\n      mesh = mesh.filter(dX => dX > 0);\n    }\n\n    return mesh;\n  },\n\n  gdpToMu(gdp, sigma, xScaleFactor, xScaleShift) {\n    // converting gdp per capita per day into MU for lognormal distribution\n    // see https://en.wikipedia.org/wiki/Log-normal_distribution\n    return Math.log(gdp / 365) - sigma * sigma / 2;\n  },\n\n  giniToSigma(gini) {\n    // The ginis are turned into std deviation.\n    // Mattias uses this formula in Excel: stddev = NORMSINV( ((gini/100)+1)/2 )*2^0.5\n    return this.normsinv(((gini / 100) + 1) / 2) * Math.pow(2, 0.5);\n  },\n\n  // this function returns PDF values for a specified distribution\n  pdf: {\n    normal(x, mu, sigma) {\n      return Math.exp(\n        -0.5 * Math.log(2 * Math.PI)\n        - Math.log(sigma)\n        - Math.pow(x - mu, 2) / (2 * sigma * sigma)\n      );\n    },\n    lognormal(x, mu, sigma) {\n      return Math.exp(\n        -0.5 * Math.log(2 * Math.PI) //should not be different for the two scales- (scaleType==\"linear\"?Math.log(x):0)\n        - Math.log(sigma)\n        - Math.pow(Math.log(x) - mu, 2) / (2 * sigma * sigma)\n      );\n    }\n  },\n\n\n  normsinv(p) {\n    //\n    // Lower tail quantile for standard normal distribution function.\n    //\n    // This function returns an approximation of the inverse cumulative\n    // standard normal distribution function.  I.e., given P, it returns\n    // an approximation to the X satisfying P = Pr{Z <= X} where Z is a\n    // random variable from the standard normal distribution.\n    //\n    // The algorithm uses a minimax approximation by rational functions\n    // and the result has a relative error whose absolute value is less\n    // than 1.15e-9.\n    //\n    // Author:      Peter John Acklam\n    // (Javascript version by Alankar Misra @ Digital Sutras (alankar@digitalsutras.com))\n    // Time-stamp:  2003-05-05 05:15:14\n    // E-mail:      pjacklam@online.no\n    // WWW URL:     http://home.online.no/~pjacklam\n\n    // Taken from http://home.online.no/~pjacklam/notes/invnorm/index.html\n    // adapted from Java code\n\n    // An algorithm with a relative error less than 1.15*10-9 in the entire region.\n\n    // Coefficients in rational approximations\n    const a = [-3.969683028665376e+01, 2.209460984245205e+02, -2.759285104469687e+02, 1.383577518672690e+02, -3.066479806614716e+01, 2.506628277459239e+00];\n    const b = [-5.447609879822406e+01, 1.615858368580409e+02, -1.556989798598866e+02, 6.680131188771972e+01, -1.328068155288572e+01];\n    const c = [-7.784894002430293e-03, -3.223964580411365e-01, -2.400758277161838e+00, -2.549732539343734e+00, 4.374664141464968e+00, 2.938163982698783e+00];\n    const d = [7.784695709041462e-03, 3.224671290700398e-01, 2.445134137142996e+00, 3.754408661907416e+00];\n\n    // Define break-points.\n    const plow = 0.02425;\n    const phigh = 1 - plow;\n\n    // Rational approximation for lower region:\n    if (p < plow) {\n      const q = Math.sqrt(-2 * Math.log(p));\n      return (((((c[0] * q + c[1]) * q + c[2]) * q + c[3]) * q + c[4]) * q + c[5]) /\n        ((((d[0] * q + d[1]) * q + d[2]) * q + d[3]) * q + 1);\n    }\n\n    // Rational approximation for upper region:\n    if (phigh < p) {\n      const q = Math.sqrt(-2 * Math.log(1 - p));\n      return -(((((c[0] * q + c[1]) * q + c[2]) * q + c[3]) * q + c[4]) * q + c[5]) /\n        ((((d[0] * q + d[1]) * q + d[2]) * q + d[3]) * q + 1);\n    }\n\n    // Rational approximation for central region:\n    const q = p - 0.5;\n    const r = q * q;\n    return (((((a[0] * r + a[1]) * r + a[2]) * r + a[3]) * r + a[4]) * r + a[5]) * q /\n      (((((b[0] * r + b[1]) * r + b[2]) * r + b[3]) * r + b[4]) * r + 1);\n\n  }\n\n\n});\n\nexport default MCMath;\n\n\n\n// WEBPACK FOOTER //\n// ./src/mountainchart-math.js","const MCProbe = Vizabi.Class.extend({\n\n  init(context) {\n    this.context = context;\n\n  },\n\n  redraw(options) {\n    const _this = this.context;\n    if (!options) options = {};\n\n    if (!options.level) options.level = _this.model.ui.chart.probeX;\n\n    _this.probeEl.classed(\"vzb-hidden\", !options.level || !_this.model.ui.chart.showProbeX);\n    if (!options.level) return;\n\n    _this.xAxisEl.call(_this.xAxis.highlightValue(options.full ? options.level : \"none\"));\n\n    let sumValue = 0;\n    let totalArea = 0;\n    let leftArea = 0;\n\n    const _computeAreas = function(d) {\n      sumValue += d.valuesPointer.axis_y[d.KEY()];\n      _this.cached[d.KEY()].forEach(d => {\n        totalArea += d.y;\n        if (_this._math.rescale(d.x) < options.level) leftArea += d.y;\n      });\n    };\n\n    if (_this.model.marker.stack.which === \"all\") {\n      _this.stackedPointers.forEach(_computeAreas);\n    } else if (_this.model.marker.stack.which === \"none\") {\n      _this.mountainPointers.forEach(_computeAreas);\n    } else {\n      _this.groupedPointers.forEach(_computeAreas);\n    }\n\n    const formatter1 = d3.format(\".3r\");\n    const formatter2 = _this.model.marker.axis_y.getTickFormatter();\n    _this.heightOfLabels = _this.heightOfLabels || (0.66 * _this.height);\n\n    _this.probeTextEl.each(function(d, i) {\n      if (i !== 8) return;\n      const view = d3.select(this);\n\n      if (!options.full && _this.model.ui.chart.probeX == _this.model.marker.axis_x.tailFatX) {\n\n        view.text(_this.translator(\"mount/extremepoverty\"))\n          .classed(\"vzb-hidden\", false)\n          .attr(\"x\", -_this.height)\n          .attr(\"y\", _this.xScale(options.level))\n          .attr(\"dy\", \"-1.15em\")\n          .attr(\"dx\", \"0.5em\")\n          .attr(\"transform\", \"rotate(-90)\");\n\n        _this.heightOfLabels = _this.height - view.node().getBBox().width - view.node().getBBox().height * 1.75;\n      } else {\n        view.classed(\"vzb-hidden\", true);\n      }\n    });\n\n\n    _this.probeTextEl.each(function(d, i) {\n      if (i === 8) return;\n      const view = d3.select(this);\n\n      let string;\n      if (i === 0 || i === 4) string = formatter1(leftArea / totalArea * 100) + \"%\";\n      if (i === 1 || i === 5) string = formatter1(100 - leftArea / totalArea * 100) + \"%\";\n      if (i === 2 || i === 6) string = formatter2(sumValue * leftArea / totalArea);\n      if (i === 3 || i === 7) string = formatter2(sumValue * (1 - leftArea / totalArea)) + \" \" + _this.translator(\"mount/people\");\n\n      view.text(string)\n        .classed(\"vzb-hidden\", !options.full && (_this.someSelected || (i !== 0 && i !== 4)))\n        .attr(\"x\", _this.xScale(options.level) + ([0, 4, 2, 6].indexOf(i) > -1 ? -6 : +5))\n        .attr(\"y\", _this.heightOfLabels)\n        .attr(\"dy\", [0, 1, 4, 5].indexOf(i) > -1 ? 0 : \"1.5em\");\n    });\n\n\n    _this.probeLineEl\n      .attr(\"x1\", _this.xScale(options.level))\n      .attr(\"x2\", _this.xScale(options.level))\n      .attr(\"y1\", _this.height + 6)\n      .attr(\"y2\", 0);\n\n\n  },\n\n\n});\n\nexport default MCProbe;\n\n\n\n// WEBPACK FOOTER //\n// ./src/mountainchart-probe.js","const { \n  utils,\n  iconset: {\n    close: iconClose\n  }\n} = Vizabi;\n\nconst MCSelectList = Vizabi.Class.extend({\n\n  init(context) {\n    this.context = context;\n\n  },\n\n  rebuild(data) {\n    const _this = this.context;\n    const _local = this;\n\n    const listData = _this.mountainPointers\n      .concat(_this.groupedPointers)\n      .concat(_this.stackedPointers)\n      .filter(f => _this.model.marker.isSelected(f)).sort((a, b) => {\n        if (a.sortValue && b.sortValue) {\n          if (a.sortValue[1] === b.sortValue[1]) {\n            return d3.descending(a.sortValue[0], b.sortValue[0]);\n          }\n          return d3.descending(a.sortValue[1], b.sortValue[1]);\n        }\n\n        if (a.aggrLevel != b.aggrLevel) {\n          return d3.descending(a.aggrLevel, b.aggrLevel);\n        } else if (a.aggrLevel && b.aggrLevel) {\n          return d3.descending(a.yMax, b.yMax);\n        }\n\n        return 0;\n      });\n    _this.selectList = _this.mountainLabelContainer.selectAll(\"g.vzb-mc-label\")\n      .data(utils.unique(listData, d => d.KEY()));\n    _this.selectList.exit().remove();\n    _this.selectList = _this.selectList.enter().append(\"g\")\n      .attr(\"class\", \"vzb-mc-label\")\n      .each(function(d, i) {\n        const label = d3.select(this);\n        label.append(\"circle\").attr(\"class\", \"vzb-mc-label-legend\");\n        label.append(\"text\").attr(\"class\", \"vzb-mc-label-shadow vzb-mc-label-text\");\n        label.append(\"text\").attr(\"class\", \"vzb-mc-label-text\");\n        label.append(\"g\").attr(\"class\", \"vzb-mc-label-x vzb-label-shadow vzb-invisible\")\n          .on(\"click\", (d, i) => {\n            if (utils.isTouchDevice()) return;\n            d3.event.stopPropagation();\n            _this.model.marker.clearHighlighted();\n            _this.model.marker.selectMarker(d);\n            d3.event.stopPropagation();\n          })\n          .onTap((d, i) => {\n            d3.select(\"#\" + d.geo + \"-label-\" + _this._id).remove();\n            _this.model.marker.clearHighlighted();\n            _this.model.marker.selectMarker(d);\n          });\n        const labelCloseGroup = label.select(\"g.vzb-mc-label-x\");\n        if (!utils.isTouchDevice()) {\n          utils.setIcon(labelCloseGroup, iconClose)\n            .select(\"svg\")\n            .attr(\"class\", \"vzb-mc-label-x-icon\")\n            .attr(\"width\", \"0px\")\n            .attr(\"height\", \"0px\");\n\n          labelCloseGroup.insert(\"circle\", \"svg\");\n\n        } else {\n          labelCloseGroup.append(\"rect\");\n          labelCloseGroup.append(\"text\")\n            .attr(\"class\", \"vzb-mc-label-x-text\")\n            .text(\"Deselect\");\n        }\n      })\n      .on(\"mousemove\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _local.showCloseCross(d, true);\n        _this.model.marker.highlightMarker(d);\n      })\n      .on(\"mouseout\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _local.showCloseCross(d, false);\n        _this.model.marker.clearHighlighted();\n\n      })\n      .on(\"click\", (d, i) => {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.clearHighlighted();\n        _this.model.marker.selectMarker(d);\n      })\n      .merge(_this.selectList);\n  },\n\n  redraw() {\n    const _this = this.context;\n    if (!_this.selectList || !_this.someSelected) return;\n\n    const sample = _this.mountainLabelContainer.append(\"g\").attr(\"class\", \"vzb-mc-label\").append(\"text\").text(\"0\");\n    let fontHeight = sample.node().getBBox().height * 1.2;\n    const fontSizeToFontHeight = parseFloat(sample.style(\"font-size\")) / fontHeight;\n    d3.select(sample.node().parentNode).remove();\n    const formatter = _this.model.marker.axis_y.getTickFormatter();\n\n    const titleHeight = _this.yTitleEl.select(\"text\").node().getBBox().height || 0;\n\n    const maxFontHeight = (_this.height - titleHeight * 3) / (_this.selectList.data().length + 2);\n    if (fontHeight > maxFontHeight) fontHeight = maxFontHeight;\n\n    let currentAggrLevel = \"null\";\n    let aggrLevelSpacing = 0;\n\n    const groupLabels = _this.model.marker.color.getColorlegendMarker().label.getItems();\n\n    const isRTL = _this.model.locale.isRTL();\n\n    _this.selectList\n      .attr(\"transform\", (d, i) => {\n        if (d.aggrLevel != currentAggrLevel) aggrLevelSpacing += fontHeight;\n        const spacing = fontHeight * i + titleHeight * 2 + aggrLevelSpacing;\n        currentAggrLevel = d.aggrLevel;\n        return \"translate(\" + (isRTL ? _this.width : 0) + \",\" + spacing + \")\";\n      })\n      .each(function(d, i) {\n\n        const view = d3.select(this).attr(\"id\", d.geo + \"-label-\" + _this._id);\n        let name = \"\";\n        if (d.key) {\n          name = d.key === \"all\" ? _this.translator(\"mount/merging/world\") : groupLabels[d.key];\n        } else {\n          name = _this.values.label[d.KEY()];\n        }\n\n        const number = d.valuesPointer.axis_y[d.KEY()];\n\n        const string = name + \": \" + formatter(number) + (i === 0 ? \" \" + _this.translator(\"mount/people\") : \"\");\n\n        const text = view.selectAll(\".vzb-mc-label-text\")\n          .attr(\"x\", (isRTL ? -1 : 1) * fontHeight)\n          .attr(\"y\", fontHeight)\n          .text(string)\n          .style(\"font-size\", fontHeight === maxFontHeight ? (fontHeight * fontSizeToFontHeight + \"px\") : null);\n\n        const contentBBox = text.node().getBBox();\n\n        const closeGroup = view.select(\".vzb-mc-label-x\");\n\n        if (utils.isTouchDevice()) {\n          const closeTextBBox = closeGroup.select(\"text\").node().getBBox();\n          closeGroup\n            .classed(\"vzb-revert-color\", true)\n            .select(\".vzb-mc-label-x-text\")\n            .classed(\"vzb-revert-color\", true)\n            .attr(\"x\", contentBBox.width + contentBBox.height * 1.12 + closeTextBBox.width * 0.5)\n            .attr(\"y\", contentBBox.height * 0.55);\n\n          closeGroup.select(\"rect\")\n            .attr(\"width\", closeTextBBox.width + contentBBox.height * 0.6)\n            .attr(\"height\", contentBBox.height)\n            .attr(\"x\", contentBBox.width + contentBBox.height * 0.9)\n            .attr(\"y\", 0)\n            .attr(\"rx\", contentBBox.height * 0.25)\n            .attr(\"ry\", contentBBox.height * 0.25);\n        } else {\n          closeGroup\n            .attr(\"x\", contentBBox.width + contentBBox.height * 1.1)\n            .attr(\"y\", contentBBox.height / 3);\n\n          closeGroup.select(\"circle\")\n            .attr(\"r\", contentBBox.height * 0.4)\n            .attr(\"cx\", (isRTL ? -1 : 1) * (contentBBox.width + contentBBox.height * 1.1))\n            .attr(\"cy\", contentBBox.height / 3);\n\n          closeGroup.select(\"svg\")\n            .attr(\"x\", (isRTL ? -1 : 1) * (contentBBox.width + contentBBox.height * (1.1 - (isRTL ? -0.4 : 0.4))))\n            .attr(\"y\", contentBBox.height * (1 / 3 - 0.4))\n            .attr(\"width\", contentBBox.height * 0.8)\n            .attr(\"height\", contentBBox.height * 0.8);\n        }\n\n        view.select(\".vzb-mc-label-legend\")\n          .attr(\"r\", fontHeight / 3)\n          .attr(\"cx\", (isRTL ? -1 : 1) * fontHeight * 0.4)\n          .attr(\"cy\", fontHeight / 1.5)\n          .style(\"fill\", _this.cScale(d.valuesPointer.color[d.KEY()]));\n\n        view.onTap((d, i) => {\n          d3.event.stopPropagation();\n          _this.model.marker.highlightMarker(d);\n          setTimeout(() => {\n            _this.model.marker.unhighlightMarker(d);\n          }, 2000);\n        });\n      });\n  },\n\n  showCloseCross(d, show) {\n    const _this = this.context;\n    const KEY = _this.KEY;\n    //show the little cross on the selected label\n    _this.selectList\n      .filter(f => f[KEY] == d[KEY])\n      .select(\".vzb-mc-label-x\")\n      .classed(\"vzb-invisible\", !show);\n  },\n\n});\n\nexport default MCSelectList;\n\n\n\n// WEBPACK FOOTER //\n// ./src/mountainchart-selectlist.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/styles.scss\n// module id = 6\n// module chunks = 0 1","module.exports = \"<div class='vzb-dialog-modal'>\\n    <span class=\\\"thumb-tack-class thumb-tack-class-ico-pin fa\\\" data-dialogtype=\\\"axesmc\\\" data-click=\\\"pinDialog\\\"></span>\\n    <span class=\\\"thumb-tack-class thumb-tack-class-ico-drag fa\\\" data-dialogtype=\\\"axesmc\\\" data-click=\\\"dragDialog\\\"></span>\\n    <div class=\\\"vzb-dialog-title\\\">\\n        <%=t (\\\"buttons/axes\\\") %>\\n    </div>\\n    <div class=\\\"vzb-dialog-content\\\">\\n        <div class=\\\"vzb-yaxis-container\\\">\\n            <p class=\\\"vzb-dialog-sublabel\\\"><%=t (\\\"hints/mount/maxYvalue\\\") %></p>\\n            <form class=\\\"vzb-dialog-paragraph\\\">\\n                <label><input type=\\\"radio\\\" name=\\\"ymax\\\" value=\\\"immediate\\\"><%=t (\\\"mount/maxYmode/immediate\\\") %></label>\\n                <label><input type=\\\"radio\\\" name=\\\"ymax\\\" value=\\\"latest\\\"><%=t (\\\"mount/maxYmode/latest\\\") %></label>\\n            </form>\\n        </div>\\n        <div class=\\\"vzb-xaxis-container\\\">\\n            <p class=\\\"vzb-dialog-sublabel\\\">\\n                <%=t (\\\"hints/mount/logXstops\\\") %>\\n            </p>\\n            <form class=\\\"vzb-dialog-paragraph\\\">\\n                <input type=\\\"checkbox\\\" name=\\\"logstops\\\" value=\\\"1\\\">1\\n                <input type=\\\"checkbox\\\" name=\\\"logstops\\\" value=\\\"2\\\">2\\n                <input type=\\\"checkbox\\\" name=\\\"logstops\\\" value=\\\"5\\\">5\\n            </form>\\n        </div>\\n        <p class=\\\"vzb-dialog-sublabel\\\">\\n            <%=t (\\\"hints/mount/xlimits\\\") %>\\n        </p>\\n        <div class=\\\"vzb-xlimits-container vzb-dialog-paragraph\\\"></div>\\n        <div class=\\\"vzb-probe-container\\\">\\n            <p class=\\\"vzb-dialog-sublabel\\\">\\n              <input type=\\\"checkbox\\\" name=\\\"probe\\\" class=\\\"vzb-probe-check\\\"> <%=t (\\\"hints/mount/probe\\\") %>\\n            </p>\\n            <input type=\\\"text\\\" class=\\\"vzb-probe-field\\\" name=\\\"probe\\\">\\n        </div>\\n    </div>\\n    <div class=\\\"vzb-dialog-buttons\\\">\\n        <div data-click=\\\"closeDialog\\\" class=\\\"vzb-dialog-button vzb-label-primary\\\">\\n            <%=t (\\\"buttons/ok\\\") %>\\n        </div>\\n    </div>\\n</div>\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/dialogs/axesmc/axesmc.html\n// module id = 7\n// module chunks = 0 1","module.exports = \"<!-- MountainChart Component -->\\n<div class=\\\"vzb-mountainchart\\\">\\n    <svg class=\\\"vzb-mountainchart-svg vzb-export\\\">\\n        <g class=\\\"vzb-mc-graph\\\">\\n            <rect class=\\\"vzb-mc-eventarea\\\"></rect>\\n            <g class=\\\"vzb-mc-year\\\"></g>\\n\\n            <g class=\\\"vzb-mc-mountains-mergestacked\\\"></g>\\n            <g class=\\\"vzb-mc-mountains-mergegrouped\\\"></g>\\n            <g class=\\\"vzb-mc-mountains\\\"></g>\\n            <g class=\\\"vzb-mc-mountains-labels\\\"></g>\\n\\n\\n            <g class=\\\"vzb-mc-axis-y-title\\\">\\n                <text></text>\\n            </g>\\n\\n            <g class=\\\"vzb-mc-axis-x-title\\\">\\n                <text></text>\\n            </g>\\n\\n            <g class=\\\"vzb-mc-axis-info vzb-noexport\\\">\\n            </g>\\n\\n            <g class=\\\"vzb-data-warning vzb-noexport\\\">\\n                <svg></svg>\\n                <text></text>\\n            </g>\\n\\n            <g class=\\\"vzb-mc-axis-x\\\"></g>\\n\\n            <g class=\\\"vzb-mc-axis-labels\\\"></g>\\n            <g class=\\\"vzb-mc-probe\\\">\\n                <text class=\\\"vzb-shadow vzb-mc-probe-value-ul\\\"></text>\\n                <text class=\\\"vzb-shadow vzb-mc-probe-value-ur\\\"></text>\\n                <text class=\\\"vzb-shadow vzb-mc-probe-value-dl\\\"></text>\\n                <text class=\\\"vzb-shadow vzb-mc-probe-value-dr\\\"></text>\\n                <text class=\\\"vzb-mc-probe-value-ul\\\"></text>\\n                <text class=\\\"vzb-mc-probe-value-ur\\\"></text>\\n                <text class=\\\"vzb-mc-probe-value-dl\\\"></text>\\n                <text class=\\\"vzb-mc-probe-value-dr\\\"></text>\\n                <text class=\\\"vzb-mc-probe-extremepoverty\\\"></text>\\n                <line></line>\\n            </g>\\n\\n            <g class=\\\"vzb-mc-tooltip vzb-hidden\\\">\\n                <rect class=\\\"vzb-tooltip-border\\\"></rect>\\n                <text class=\\\"vzb-tooltip-text\\\"></text>\\n            </g>\\n        </g>\\n    </svg>\\n</div>\\n\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/template.html\n// module id = 8\n// module chunks = 0 1"],"sourceRoot":""}