{"version":3,"sources":["webpack:///webpack/bootstrap 88d0b8395caf302db98a","webpack:///./src/index.js","webpack:///./src/component.js","webpack:///./src/panzoom.js","webpack:///./src/trail.js","webpack:///./~/css.escape/css.escape.js","webpack:///./src/styles.scss?ccec","webpack:///./src/template.html","webpack:///(webpack)/buildin/global.js"],"names":["VERSION_INFO","version","build","Vizabi","Tool","extend","init","placeholder","external_model","name","components","component","model","Component","get","_super","validate","ui","chart","lockNonSelected","splash","state","time","parse","start","formatDate","end","default_model","entities","entities_colorlegend","entities_tags","marker_tags","space","label","use","which","hook_parent","marker","axis_x","index","type","axis_y","size","color","syncModels","size_label","scaleType","_important","extent","allow","names","locale","superhighlightOnMinimapHover","whenHovering","showProjectionLineX","showProjectionLineY","higlightValueX","higlightValueY","labels","dragging","removeLabelBox","margin","left","top","trails","datawarning","doubtDomain","doubtRange","show_ticks","presentation","panWithArrow","adaptMinMaxZoom","cursorMode","zoomOnScrolling","buttons","dialogs","popup","sidebar","moreoptions","versionInfo","utils","helpers","Exporter","svgexport","Labels","axisSmart","DynamicBackground","iconset","iconWarn","warn","iconQuestion","question","BubbleChart","config","context","_this","template","require","model_expects","model_binds","evt","original","isTouchDevice","playing","someHighlighted","clearHighlighted","_readyOnce","_trails","create","then","run","record","_export","open","element","reset","toggle","redrawDataPoints","path","indexOf","ready","yScale","xScale","updateSize","updateMarkerSizeLimits","draggingNow","approxEqual","_zoomedXYMinMax","zoomedMin","zoomedMax","playAfterZoom","pause","_panZoom","zoomToMaxMin","getZoomedMin","getZoomedMax","postponePause","entityBubbles","source","_val","length","_previousVal","selectDataPoints","updateBubbleOpacity","_updateDoubtOpacity","_blinkSuperHighlighted","titles","_formatSTitleValues","_updateSTitle","highlightDataPoints","calculationQueue","value","toString","push","getFrame","frame","_frameIsValid","splice","frameChanged","expandCanvas","redrawDataPointsOnlySize","redrawDataPointsOnlyColors","svg","chartSvg","classed","someSelected","clearSelected","sScale","cScale","xAxis","yAxis","COLOR_BLACKISH","COLOR_WHITEISH","isCanvasPreviouslyExpanded","prefix","deleteClasses","_labels","CSS_PREFIX","LABELS_CONTAINER_CLASS","LINES_CONTAINER_CLASS","LINES_CONTAINER_SELECTOR_PREFIX","_rangeBump","arg","undo","bump","activeProfile","maxRadiusPx","isArray","z1","z2","readyOnce","scrollableAncestor","findScrollableAncestor","d3","select","graph","yAxisElContainer","yAxisEl","xAxisElContainer","xAxisEl","ySubTitleEl","xSubTitleEl","yTitleEl","xTitleEl","sTitleEl","cTitleEl","yearEl","year","yInfoEl","xInfoEl","dataWarningEl","projectionX","projectionY","lineEqualXY","trailsContainer","bubbleContainerCrop","zoomSelection","labelsContainerCrop","bubbleContainer","labelsContainer","linesContainer","zoomRect","eventArea","bubbleCrown","selectAll","attr","location","pathname","tooltipMobile","on","xMin","xMax","yMin","yMax","zoomer","dontFeedToState","rerun","event","metaKey","ctrlKey","root","call","dragRectangle","cursor","defaultPrevented","zoomByIncrement","KEY","getDimension","TIMEDIM","updateUIStrings","wScale","scaleLinear","domain","range","Object","keys","endTime","updateIndicators","updateTime","defer","updateEntities","zoomToMarkerMaxMin","resetZoomState","xDomain","getScale","yDomain","zoomedMinX","zoomedMaxX","zoomedMinY","zoomedMaxY","setScales","tickFormat","getTickFormatter","duration","_reorderEntities","_getSubtitle","title","shortTitle","subtitle","replace","slice","regexpResult","exec","trim","layoutProfile","getLayoutProfile","conceptPropsY","getConceptprops","conceptPropsX","conceptPropsS","conceptPropsC","translator","getTFunction","strings","Y","X","S","C","title_short","name_short","unit","ySubTitle","data","enter","append","xSubTitle","yTitle","parent","findChildByName","markerID","alignX","isRTL","alignY","updateView","xTitle","sTitle","setIcon","text","style","Number","Boolean","description","sourceLink","pin","rect","getBBox","coord","makeAbsoluteContext","farthestViewportElement","x","y","height","toolRect","getBoundingClientRect","chartRect","node","setHook","show","setPos","hide","opacity","getKeys","map","pointer","d","sortValue","sort","a","b","markers","setVisible","unselectBubblesWithNoData","getVisible","exit","remove","i","_bubblesInteract","mouseover","mouseout","click","onTap","stopPropagation","onLongTap","merge","_select","forEach","sizeA","sizeB","descending","ascending","trailStartTime","status","highlightMarker","showCloseCross","isSelected","selectMarker","time_1","delayAnimations","setText","svgWidth","px2num","svgHeight","marginScaleH","marginMin","ratio","marginScaleW","profiles","small","bottom","right","leftMarginRatio","padding","minRadiusPx","maxRadiusEm","infoElHeight","yAxisTitleBottomMargin","xAxisTitleBottomMargin","medium","large","hideSTitle","presentationProfileChanges","getActiveProfile","containerWH","getVizWidthHeight","Math","max","hypotenuse","width","setCloseCrossHeight","setTooltipFontSize","parseInt","resize","rangePoints","scale","tickSizeInner","tickSizeOuter","tickPadding","tickSizeMinor","labelerOptions","toolMargin","limitMaxTickNumber","viewportLength","formatter","yTitleText","xTitleText","titleBBox","t","transform","hTranslate","translateX","translateY","_resizeDataWarning","set","_updateLineEqualXY","oneMeasure","min","concat","transition","dataWarningText","dataWarningWidth","remainingWidth","font","warnBB","minRadius","maxRadius","minArea","radiusToArea","maxArea","valuesNow","valuesLocked","each","selected","valueC","scaledC","find","f","valuesTrailStart","cache","scaledC0","updateLabelOnlyColor","valueS","scaledS","areaToRadius","scaledS0","updateLabelOnlyPosition","lockedFrame","_updateBubble","values","view","showhide","valueY","valueX","valueL","valueLST","hidden","ease","easeExp","easeLinear","interrupt","write","id","getUTCFullYear","fill","cx","cy","r","_updateLabel","labelX0","labelY0","labelText","_getLabelText","updateLabel","_setTooltip","tooltipText","s","c","labelValues","tooltipCache","invert","setTooltip","titleS","titleC","unitS","unitC","formatterS","formatterC","isDiscrete","getColorlegendMarker","getItems","sTitleContentON","cTitleContentON","sTitleText","sTitleWidth","remainigHeight","_setBubbleCrown","nonSelectedOpacityZero","glow","skipInnerFill","_axisProjections","radius","highlightValue","highlight","clone","entityOutOfView","hoverTrail","selectedData","target","skipCrownInnerFill","clonedSelectedData","isSuperHighlighted","OPACITY_HIGHLT","OPACITY_HIGHLT_DIM","opacityHighlightDim","OPACITY_SELECT","OPACITY_REGULAR","opacityRegular","OPACITY_SELECT_DIM","opacitySelectDim","isHighlighted","PanZoom","Class","drag","zoom","subject","dragSubject","go","stop","filter","zoomFilter","scaleExtent","Infinity","ratioX","ratioY","self","sourceEvent","touches","targetTouches","mouse","origin","abs","e","compensateDragging","_zoomOnRectangle","_data","k","pan","isNaN","deltaY","wheelDelta","minZoomScale","zoomXOut","zoomYOut","property","zoomIdentity","translate","xPanOffset","yPanOffset","xRange","yRange","xRangeBumped","yRangeBumped","xRangeMinOffset","xRangeMaxOffset","yRangeMinOffset","yRangeMaxOffset","xRangeBounds","yRangeBounds","xRangeBoundsBumped","yRangeBoundsBumped","rangeBands","n","isDate","toFixed","zoomedXRange","zoomedYRange","optionsY","optionsX","transitionDuration","mmX","mmY","suggestedFrame","x1","y1","x2","y2","xBounds","yBounds","TOLERANCE","xBoundsBumped","yBoundsBumped","minX","maxX","minY","maxY","zoomedX1","zoomedY1","zoomedX2","zoomedY2","zoomTransform","minZoom","maxZoom","direction","log","LN2","floor","ceil","locus","pow","scaleBy","Trail","_isCreated","actionsQueue","entityTrails","trailsData","trailsInProgress","activePromises","trailTransitions","delayedIterations","drawingQueue","_context","selection","Promise","resolve","reject","timePoints","getAllSteps","promises","_clearActions","selectedEntityData","insert","querySelector","trail","trailSegmentData","m","key","segment","getModelObject","trigger","all","_addActions","selections","actions","promise","_getNextAction","shift","action","pop","executeSequential","response","_remove","parentNode","_resize","transparent","next","lineLength","sqrt","_recolor","strokeColor","getColorShade","colorID","shadeID","_opacityHandler","_findVisible","resolve1","reject1","limits","getEntityLimits","cached","segmentVisibility","visibilityChanged","_groups","_abortAnimation","_reveal","delay","generateTrailSegment","nextIndex","level","datum","nextSegment","previous","nextTime","nextFrame","addNewIntervals","addPointBetween","previousIndex","previousSegment","firstLineLength","secondLineLength","mediumIndex","getPointBetween","first","round","_generateKeys","div","maxValue","minValue","__data__","unshift","processPoints","processPoint","pointIndex","random","point","JSON","stringify","generateTrails","processPointsBetween","framesAreReady","trailKeys","segments"],"mappings":"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AAF,CAAxB,CAA7B;AACAvJ,kBAAM8hB,iBAAN,CAAwBrS,EAAElG,GAAF,CAAxB,IAAkC,EAAlC;AACAge;AACD;AACF,SARD,EAQG,YAAM;AACPpF;AACD,SAVD;AAWD;AACF,KAxDM,CAAP;AAyDD;AA7vB+B,CAApB,CAAd;;kBAgwBeb,K;;;;;;ACrwBf;AACA,CAAC;AACD;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA,EAAE;AACF;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,CAAC;;;;;;;;ACzGD,yC;;;;;;ACAA,8rE;;;;;;ACAA;;AAEA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;;AAEA;AACA;AACA,4CAA4C;;AAE5C","file":"bubblechart.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 88d0b8395caf302db98a","import \"./styles.scss\";\nimport component from \"./component\";\n\nconst VERSION_INFO = { version: __VERSION, build: __BUILD };\n\nexport default Vizabi.Tool.extend(\"BubbleChart\", {\n\n  /**\n   * Initializes the tool (Bubble Chart Tool).\n   * Executed once before any template is rendered.\n   * @param {Object} placeholder Placeholder element for the tool\n   * @param {Object} external_model Model as given by the external page\n   */\n  init(placeholder, external_model) {\n\n    this.name = \"bubblechart\";\n\n    //specifying components\n    this.components = [{\n      component,\n      placeholder: \".vzb-tool-viz\",\n      model: [\"state.time\", \"state.entities\", \"state.marker\", \"locale\", \"ui\"] //pass models to component\n    }, {\n      component: Vizabi.Component.get(\"timeslider\"),\n      placeholder: \".vzb-tool-timeslider\",\n      model: [\"state.time\", \"state.entities\", \"state.marker\", \"ui\"]\n    }, {\n      component: Vizabi.Component.get(\"dialogs\"),\n      placeholder: \".vzb-tool-dialogs\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"buttonlist\"),\n      placeholder: \".vzb-tool-buttonlist\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"treemenu\"),\n      placeholder: \".vzb-tool-treemenu\",\n      model: [\"state.marker\", \"state.marker_tags\", \"state.time\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datawarning\"),\n      placeholder: \".vzb-tool-datawarning\",\n      model: [\"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datanotes\"),\n      placeholder: \".vzb-tool-datanotes\",\n      model: [\"state.marker\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"steppedspeedslider\"),\n      placeholder: \".vzb-tool-stepped-speed-slider\",\n      model: [\"state.time\", \"locale\"]\n    }];\n\n    this._super(placeholder, external_model);\n\n  },\n\n  validate(model) {\n    model = this.model || model;\n\n    this._super(model);\n\n    if (model.ui.chart.lockNonSelected && (!model.ui.splash || model.state.time.splash === false)) {\n      const time = model.state.time.parse(\"\" + model.ui.chart.lockNonSelected);\n      if (time < model.state.time.start) model.ui.chart.lockNonSelected = model.state.time.formatDate(model.state.time.start);\n      if (time > model.state.time.end) model.ui.chart.lockNonSelected = model.state.time.formatDate(model.state.time.end);\n    }\n  },\n\n  /**\n   * Determines the default model of this tool\n   */\n  default_model: {\n    state: {\n      time: {\n        \"autoconfig\": {\n          \"type\": \"time\"\n        }\n      },\n      entities: {\n        \"autoconfig\": {\n          \"type\": \"entity_domain\",\n          \"excludeIDs\": [\"tag\"]\n        }\n      },\n      entities_colorlegend: {\n        \"autoconfig\": {\n          \"type\": \"entity_domain\",\n          \"excludeIDs\": [\"tag\"]\n        }\n      },\n      entities_tags: {\n        \"autoconfig\": {\n          \"type\": \"entity_domain\",\n          \"includeOnlyIDs\": [\"tag\"]\n        }\n      },\n      marker_tags: {\n        space: [\"entities_tags\"],\n        label: {\n          use: \"property\",\n          which: \"name\"\n        },\n        hook_parent: {}\n      },\n      marker: {\n        space: [\"entities\", \"time\"],\n        axis_x: {\n          use: \"indicator\",\n          \"autoconfig\": {\n            index: 0,\n            type: \"measure\"\n          }\n        },\n        axis_y: {\n          use: \"indicator\",\n          \"autoconfig\": {\n            index: 1,\n            type: \"measure\"\n          }\n        },\n        label: {\n          use: \"property\",\n          \"autoconfig\": {\n            \"includeOnlyIDs\": [\"name\"],\n            \"type\": \"string\"\n          }\n        },\n        size: {\n          \"autoconfig\": {\n              index: 2,\n              type: \"measure\"\n            }\n        },\n        color: {\n          syncModels: [\"marker_colorlegend\"],\n          \"autoconfig\": {}\n        },\n        size_label: {\n          use: \"constant\",\n          which: \"_default\",\n          scaleType: \"ordinal\",\n          _important: false,\n          extent: [0, 0.33],\n          allow: {\n            names: [\"_default\"]\n          }\n        },\n      },\n      \"marker_colorlegend\": {\n        \"space\": [\"entities_colorlegend\"],\n        \"label\": {\n          \"use\": \"property\",\n          \"which\": \"name\"\n        },\n        \"hook_rank\": {\n          \"use\": \"property\",\n          \"which\": \"rank\"\n        },\n        \"hook_geoshape\": {\n          \"use\": \"property\",\n          \"which\": \"shape_lores_svg\"\n        }\n      }\n    },\n    locale: {},\n    ui: {\n      chart: {\n        superhighlightOnMinimapHover: true,\n        whenHovering: {\n          showProjectionLineX: true,\n          showProjectionLineY: true,\n          higlightValueX: true,\n          higlightValueY: true\n        },\n        labels: {\n          dragging: true,\n          removeLabelBox: false\n        },\n        margin: {\n          left: 0,\n          top:0\n        },\n        trails: true,\n        lockNonSelected: 0\n      },\n      datawarning: {\n        doubtDomain: [],\n        doubtRange: []\n      },\n      show_ticks: true,\n      presentation: false,\n      panWithArrow: false,\n      adaptMinMaxZoom: false,\n      cursorMode: \"arrow\",\n      zoomOnScrolling: false,\n      buttons: [\"colors\", \"find\", \"zoom\", \"trails\", \"lock\", \"moreoptions\", \"fullscreen\", \"presentation\"],\n      dialogs: {\n        popup: [\"colors\", \"find\", \"size\", \"zoom\", \"moreoptions\"],\n        sidebar: [\"colors\", \"find\", \"size\", \"zoom\"],\n        moreoptions: [\"opacity\", \"speed\", \"axes\", \"size\", \"colors\", \"label\", \"zoom\", \"presentation\", \"about\"]\n      }\n    }\n  },\n\n  versionInfo: VERSION_INFO\n});\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","const { utils } = Vizabi;\n\nconst {\n  svgexport: Exporter,\n  labels: Labels,\n  'd3.axisWithLabelPicker': axisSmart,\n  'd3.dynamicBackground': DynamicBackground\n} = Vizabi.helpers;\n\nconst {\n  warn: iconWarn,\n  question: iconQuestion\n} = Vizabi.iconset;\n\nimport Trail from './trail';\nimport PanZoom from './panzoom';\n\n\n// BUBBLE CHART COMPONENT\nconst BubbleChart = Vizabi.Component.extend(\"bubblechart\", {\n\n  /**\n   * Initializes the component (Bubble Chart).\n   * Executed once before any template is rendered.\n   * @param {Object} config The config passed to the component\n   * @param {Object} context The component's parent\n   */\n  init(config, context) {\n    const _this = this;\n    this.name = \"bubblechart\";\n    this.template = require(\"./template.html\");\n\n    //define expected models for this component\n    this.model_expects = [{\n      name: \"time\",\n      type: \"time\"\n    }, {\n      name: \"entities\",\n      type: \"entities\"\n    }, {\n      name: \"marker\",\n      type: \"marker\"\n    }, {\n      name: \"locale\",\n      type: \"locale\"\n    }, {\n      name: \"ui\",\n      type: \"ui\"\n    }];\n\n    this.model_binds = {\n      \"change:time.playing\": function(evt, original) {\n        if (utils.isTouchDevice() && _this.model.time.playing && _this.someHighlighted) {\n          _this.model.marker.clearHighlighted();\n        }\n      },\n      \"change:time.start\": function(evt, original) {\n        if (!_this._readyOnce || _this.model.time.splash) return;\n        _this._trails.create().then(() => {\n          _this._trails.run([\"findVisible\", \"reveal\", \"opacityHandler\"]);\n        });\n      },\n      \"change:time.end\": function(evt, original) {\n        if (!_this._readyOnce || _this.model.time.splash) return;\n        _this._trails.create().then(() => {\n          _this._trails.run([\"findVisible\", \"reveal\", \"opacityHandler\"]);\n        });\n      },\n      \"change:time.record\": function() {\n        //console.log(\"change time record\");\n        if (_this.model.time.record) {\n          _this._export.open(this.element, this.name);\n        } else {\n          _this._export.reset();\n        }\n      },\n      \"change:ui.chart.trails\": function(evt) {\n        //console.log(\"EVENT change:time:trails\");\n        if (!_this._readyOnce) return;\n        _this._trails.toggle(_this.model.ui.chart.trails);\n        _this.redrawDataPoints();\n      },\n      \"change:ui.chart.lockNonSelected\": function(evt) {\n        if (!_this._readyOnce) return;\n        //console.log(\"EVENT change:time:lockNonSelected\");\n        _this.redrawDataPoints(500);\n      },\n      \"change:marker\": function(evt, path) {\n        // bubble size change is processed separately\n        if (!_this._readyOnce) return;\n        if (path.indexOf(\"scaleType\") > -1) {\n          _this.ready();\n          return;\n        }\n\n        if (path.indexOf(\"marker.color\") !== -1) return;\n        if (path.indexOf(\"marker.size\") !== -1) return;\n        if (path.indexOf(\"marker.size_label\") !== -1) return;\n\n        if (path.indexOf(\"domainMin\") > -1 || path.indexOf(\"domainMax\") > -1) {\n          if (!_this.yScale || !_this.xScale) return; //abort if building of the scale is in progress\n          _this.updateSize();\n          _this.updateMarkerSizeLimits();\n          _this._trails.run(\"findVisible\");\n          _this.redrawDataPoints();\n          _this._trails.run(\"resize\", null, 500);\n        } else if (path.indexOf(\"zoomedMin\") > -1 || path.indexOf(\"zoomedMax\") > -1) {\n          if (_this.draggingNow) return;\n\n          //avoid zooming again if values didn't change.\n          //also prevents infinite loop on forced URL update from zoom.stop()\n          if (utils.approxEqual(_this._zoomedXYMinMax.axis_x.zoomedMin, _this.model.marker.axis_x.zoomedMin, 0.01)\n            && utils.approxEqual(_this._zoomedXYMinMax.axis_x.zoomedMax, _this.model.marker.axis_x.zoomedMax, 0.01)\n            && utils.approxEqual(_this._zoomedXYMinMax.axis_y.zoomedMin, _this.model.marker.axis_y.zoomedMin, 0.01)\n            && utils.approxEqual(_this._zoomedXYMinMax.axis_y.zoomedMax, _this.model.marker.axis_y.zoomedMax, 0.01)\n          ) return;\n          let playAfterZoom = false;\n          if (_this.model.time.playing) {\n            playAfterZoom = true;\n            _this.model.time.pause(true);\n          }\n          _this._trails.run(\"abortAnimation\");\n          _this._panZoom.zoomToMaxMin(\n            _this.model.marker.axis_x.getZoomedMin(),\n            _this.model.marker.axis_x.getZoomedMax(),\n            _this.model.marker.axis_y.getZoomedMin(),\n            _this.model.marker.axis_y.getZoomedMax(),\n            500 /*duration*/, \"don't feed these zoom values back to state\"\n          );\n          if (playAfterZoom) {\n            _this.model.time.postponePause = false;\n          }\n        }\n\n        //console.log(\"EVENT change:marker\", evt);\n      },\n      \"change:marker.select\": function(evt, path) {\n        if (!_this._readyOnce || !_this.entityBubbles) return;\n        //console.log(\"EVENT change:entities:select\");\n\n        //disable trails if too many items get selected at once\n        //otherwise it's too much waiting time\n        if ((evt.source._val || []).length - (evt.source._previousVal || []).length > 50) _this.model.ui.chart.trails = false;\n\n        _this.selectDataPoints();\n        _this.redrawDataPoints();\n        _this._trails.create().then(() => {\n          _this._trails.run([\"findVisible\", \"reveal\", \"opacityHandler\"]);\n        });\n        _this.updateBubbleOpacity();\n        _this._updateDoubtOpacity();\n      },\n      \"change:marker.superHighlight\": (evt, path) => {\n        if (this._readyOnce) {\n          this._blinkSuperHighlighted();\n        }\n      },\n      \"change:marker.highlight\": function(evt, path) {\n        if (!_this._readyOnce) return;\n        //path have values if trail is highlighted\n        if (path != \"highlight\") {\n          if (path !== null) {\n            const titles = _this._formatSTitleValues(path.size, path.color);\n            _this._updateSTitle(titles[0], titles[1]);\n          } else {\n            _this._updateSTitle();\n          }\n          return;\n        }\n        //console.log(\"EVENT change:entities:highlight\");\n        _this.highlightDataPoints();\n      },\n      \"change:time.value\": function() {\n        if (_this.model.time.splash || !_this._readyOnce || !_this.entityBubbles) return;\n        if (!_this.calculationQueue) { // collect timestamp that we request\n          _this.calculationQueue = [_this.model.time.value.toString()];\n        } else {\n          _this.calculationQueue.push(_this.model.time.value.toString());\n        }\n        (function(time) { // isolate timestamp\n          //_this._bubblesInteract().mouseout();\n          _this.model.marker.getFrame(time, (frame, time) => {\n            if (!_this._frameIsValid(frame)) return utils.warn(\"change:time.value: empty data received from marker.getFrame(). doing nothing\");\n            const index = _this.calculationQueue.indexOf(time.toString()); //\n            if (index == -1) { // we was receive more recent frame before so we pass this frame\n              return;\n            }\n            _this.calculationQueue.splice(0, index + 1); // remove timestamps that added to queue before current timestamp\n            _this.frameChanged(frame, time);\n          });\n\n        })(_this.model.time.value);\n      },\n      \"change:ui.adaptMinMaxZoom\": function() {\n        //console.log(\"EVENT change:ui:adaptMinMaxZoom\");\n        if (_this.model.ui.adaptMinMaxZoom) {\n          _this._panZoom.expandCanvas(500);\n        } else {\n          _this._panZoom.reset();\n        }\n      },\n      \"change:marker.size.extent\": function(evt, path) {\n        //console.log(\"EVENT change:marker:size:max\");\n        if (!_this._readyOnce) return;\n        _this.updateMarkerSizeLimits();\n        _this.redrawDataPointsOnlySize();\n        _this._trails.run(\"resize\");\n      },\n      \"change:marker.color\": function(evt, path) {\n        if (!_this._readyOnce) return;\n        //console.log(\"EVENT change:marker:color:palette\");\n        _this.redrawDataPointsOnlyColors();\n        _this._trails.run(\"recolor\");\n      },\n      // 'change:marker.color.palette': function(evt, path) {\n      //   if(!_this._readyOnce) return;\n      //   //console.log(\"EVENT change:marker:color:palette\");\n      //   _this.redrawDataPointsOnlyColors();\n      //   _this._trails.run(\"recolor\");\n      // },\n      \"change:marker.opacitySelectDim\": function() {\n        _this.updateBubbleOpacity();\n      },\n      \"change:marker.opacityRegular\": function() {\n        _this.updateBubbleOpacity();\n        _this._trails.run(\"opacityHandler\");\n      },\n      \"change:ui.cursorMode\": function() {\n        const svg = _this.chartSvg;\n        if (_this.model.ui.cursorMode === \"plus\") {\n          svg.classed(\"vzb-zoomin\", true);\n          svg.classed(\"vzb-zoomout\", false);\n          svg.classed(\"vzb-panhand\", false);\n        } else if (_this.model.ui.cursorMode === \"minus\") {\n          svg.classed(\"vzb-zoomin\", false);\n          svg.classed(\"vzb-zoomout\", true);\n          svg.classed(\"vzb-panhand\", false);\n        } else if (_this.model.ui.cursorMode === \"hand\") {\n          svg.classed(\"vzb-zoomin\", false);\n          svg.classed(\"vzb-zoomout\", false);\n          svg.classed(\"vzb-panhand\", true);\n        } else {\n          svg.classed(\"vzb-zoomin\", false);\n          svg.classed(\"vzb-zoomout\", false);\n          svg.classed(\"vzb-panhand\", false);\n        }\n      },\n      \"change:entities.dim\": function() {\n        if (_this.someHighlighted) {\n          _this.model.marker.clearHighlighted();\n        }\n        if (_this.someSelected) {\n          _this.model.marker.clearSelected();\n        }\n      },\n      \"ready\": function() {\n        // if(_this.model.marker.color.scaleType === 'time') {\n        //   _this.model.marker.color.scale = null;\n        //   utils.defer(function() {\n        //     _this.trigger('ready');\n        //   });\n        // }\n      }\n    };\n\n    this._super(config, context);\n\n    this.xScale = null;\n    this.yScale = null;\n    this.sScale = null;\n    this.cScale = null;\n\n    this.xAxis = axisSmart(\"bottom\");\n    this.yAxis = axisSmart(\"left\");\n\n    _this.COLOR_BLACKISH = \"#333\";\n    _this.COLOR_WHITEISH = \"#fdfdfd\";\n\n    this.isCanvasPreviouslyExpanded = false;\n    this.draggingNow = null;\n\n    this._trails = new Trail(this);\n    this._panZoom = new PanZoom(this);\n    this._export = new Exporter(this);\n    this._export\n      .prefix(\"vzb-bc-\")\n      .deleteClasses([\"vzb-bc-bubbles-crop\", \"vzb-hidden\", \"vzb-bc-year\", \"vzb-bc-zoom-rect\",\n        \"vzb-bc-projection-x\", \"vzb-bc-projection-y\", \"vzb-bc-axis-c-title\"\n      ]);\n    this._labels = new Labels(this);\n    this._labels.config({\n      CSS_PREFIX: \"vzb-bc\",\n      LABELS_CONTAINER_CLASS: \"vzb-bc-labels\",\n      LINES_CONTAINER_CLASS: \"vzb-bc-bubbles\",\n      LINES_CONTAINER_SELECTOR_PREFIX: \"bubble-\"\n    });\n  },\n\n  _rangeBump(arg, undo) {\n    const bump = this.activeProfile.maxRadiusPx / 2;\n    undo = undo ? -1 : 1;\n    if (utils.isArray(arg) && arg.length > 1) {\n      let z1 = arg[0];\n      let z2 = arg[arg.length - 1];\n\n      //the sign of bump depends on the direction of the scale\n      if (z1 < z2) {\n        z1 += bump * undo;\n        z2 -= bump * undo;\n        // if the scale gets inverted because of bump, set it to avg between z1 and z2\n        if (z1 > z2) z1 = z2 = (z1 + z2) / 2;\n      } else if (z1 > z2) {\n        z1 -= bump * undo;\n        z2 += bump * undo;\n        // if the scale gets inverted because of bump, set it to avg between z1 and z2\n        if (z1 < z2) z1 = z2 = (z1 + z2) / 2;\n      } else {\n        // rangeBump error: the input scale range has 0 length. that sucks but we keep cool\n      }\n      return [z1, z2];\n    }\n    utils.warn(\"rangeBump error: input is not an array or empty\");\n  },\n\n\n  /**\n   * Executes right after the template is in place, but the model is not yet ready\n   */\n  readyOnce() {\n    const _this = this;\n    this._readyOnce = false;\n    this.scrollableAncestor = utils.findScrollableAncestor(this.element);\n    this.element = d3.select(this.element);\n\n    // reference elements\n    this.chartSvg = this.element.select(\"svg\");\n    this.graph = this.element.select(\".vzb-bc-graph\");\n    this.yAxisElContainer = this.graph.select(\".vzb-bc-axis-y\");\n    this.yAxisEl = this.yAxisElContainer.select(\"g\");\n\n    this.xAxisElContainer = this.graph.select(\".vzb-bc-axis-x\");\n    this.xAxisEl = this.xAxisElContainer.select(\"g\");\n\n    this.ySubTitleEl = this.graph.select(\".vzb-bc-axis-y-subtitle\");\n    this.xSubTitleEl = this.graph.select(\".vzb-bc-axis-x-subtitle\");\n    this.yTitleEl = this.graph.select(\".vzb-bc-axis-y-title\");\n    this.xTitleEl = this.graph.select(\".vzb-bc-axis-x-title\");\n    this.sTitleEl = this.graph.select(\".vzb-bc-axis-s-title\");\n    this.cTitleEl = this.graph.select(\".vzb-bc-axis-c-title\");\n    this.yearEl = this.graph.select(\".vzb-bc-year\");\n\n    this.year = new DynamicBackground(this.yearEl);\n\n    this.yInfoEl = this.graph.select(\".vzb-bc-axis-y-info\");\n    this.xInfoEl = this.graph.select(\".vzb-bc-axis-x-info\");\n    this.dataWarningEl = this.graph.select(\".vzb-data-warning\");\n\n    this.projectionX = this.graph.select(\".vzb-bc-projection-x\");\n    this.projectionY = this.graph.select(\".vzb-bc-projection-y\");\n    this.lineEqualXY = this.graph.select(\".vzb-bc-line-equal-xy\");\n\n    this.trailsContainer = this.graph.select(\".vzb-bc-trails\");\n    this.bubbleContainerCrop = this.graph.select(\".vzb-bc-bubbles-crop\");\n    this.zoomSelection = this.graph.select(\".vzb-zoom-selection\");\n    this.labelsContainerCrop = this.graph.select(\".vzb-bc-labels-crop\");\n    this.bubbleContainer = this.graph.select(\".vzb-bc-bubbles\");\n    this.labelsContainer = this.graph.select(\".vzb-bc-labels\");\n    this.linesContainer = this.graph.select(\".vzb-bc-lines\");\n    this.zoomRect = this.element.select(\".vzb-bc-zoom-rect\");\n    this.eventArea = this.element.select(\".vzb-bc-eventarea\");\n\n    this.entityBubbles = null;\n    this.bubbleCrown = this.element.select(\".vzb-bc-bubble-crown\");\n    //set filter\n    this.bubbleCrown.selectAll(\".vzb-crown-glow\")\n      .attr(\"filter\", \"url(\" + location.pathname + \"#vzb-glow-filter)\");\n    this.tooltipMobile = this.element.select(\".vzb-tooltip-mobile\");\n    //component events\n    this.on(\"resize\", () => {\n      //console.log(\"EVENT: resize\");\n      //return if updatesize exists with error\n      _this._trails.run(\"abortAnimation\");\n      if (_this.updateSize()) return;\n      _this.updateMarkerSizeLimits();\n      _this._labels.updateSize();\n      (function(xMin, xMax, yMin, yMax) {\n        _this._panZoom.zoomer.dontFeedToState = true;\n        _this._panZoom.rerun(); // includes redraw data points and trail resize\n        _this._panZoom.zoomToMaxMin(xMin, xMax, yMin, yMax, 0, true);\n      })(_this._zoomedXYMinMax.axis_x.zoomedMin,\n        _this._zoomedXYMinMax.axis_x.zoomedMax,\n        _this._zoomedXYMinMax.axis_y.zoomedMin,\n        _this._zoomedXYMinMax.axis_y.zoomedMax);\n    });\n\n    //keyboard listeners\n    d3.select(\"body\")\n      .on(\"keydown\", () => {\n        if (_this.model.ui.cursorMode !== \"arrow\" && _this.model.ui.cursorMode !== \"hand\") return;\n        if (d3.event.metaKey || d3.event.ctrlKey) _this.element.select(\"svg\").classed(\"vzb-zoomin\", true);\n      })\n      .on(\"keyup\", () => {\n        if (_this.model.ui.cursorMode !== \"arrow\" && _this.model.ui.cursorMode !== \"hand\") return;\n        if (!d3.event.metaKey && !d3.event.ctrlKey) _this.element.select(\"svg\").classed(\"vzb-zoomin\", false);\n      })\n      //this is for the case when user would press ctrl and move away from the browser tab or window\n      //keyup event would happen somewhere else and won't be captured, so zoomin class would get stuck\n      .on(\"mouseenter\", () => {\n        if (_this.model.ui.cursorMode !== \"arrow\" && _this.model.ui.cursorMode !== \"hand\") return;\n        if (!d3.event.metaKey && !d3.event.ctrlKey) _this.element.select(\"svg\").classed(\"vzb-zoomin\", false);\n      });\n\n    this.root.on(\"resetZoom\", () => {\n      _this._panZoom.reset(null, 500);\n    });\n\n    this._panZoom.zoomSelection(this.bubbleContainerCrop);\n    this.bubbleContainerCrop\n      .call(this._panZoom.dragRectangle)\n      .call(this._panZoom.zoomer)\n      .on(\"dblclick.zoom\", null)\n      .on(\"mouseup\", () => {\n        _this.draggingNow = false;\n      })\n      .on(\"click\", () => {\n        const cursor = _this.model.ui.cursorMode;\n        if (!d3.event.defaultPrevented && cursor !== \"arrow\" && cursor !== \"hand\") {\n          _this._panZoom.zoomByIncrement(cursor, 500);\n        }\n      });\n\n    this.KEY = this.model.entities.getDimension();\n    this.TIMEDIM = this.model.time.getDimension();\n\n    this.updateUIStrings();\n\n    this.wScale = d3.scaleLinear()\n      .domain(this.model.ui.datawarning.doubtDomain)\n      .range(this.model.ui.datawarning.doubtRange);\n\n    this._labels.readyOnce();\n\n    _this._readyOnce = true;\n  },\n\n  _frameIsValid(frame) {\n    return !(!frame\n    || Object.keys(frame.axis_y).length === 0\n    || Object.keys(frame.axis_x).length === 0\n    || Object.keys(frame.size).length === 0);\n  },\n\n  ready() {\n    const _this = this;\n    this.KEY = this.model.entities.getDimension();\n    this.updateUIStrings();\n    const endTime = this.model.time.end;\n    this.updateIndicators();\n    this.updateTime();\n    if (!_this.model.time.splash) {\n      _this._trails.create();\n    }\n    this.model.marker.getFrame(this.model.time.value, (frame, time) => {\n      // TODO: temporary fix for case when after data loading time changed on validation\n      if (time.toString() != _this.model.time.value.toString()) {\n        utils.defer(() => {\n          _this.ready();\n        });\n        return;\n      }\n      if (!_this._frameIsValid(frame)) return utils.warn(\"ready: empty data received from marker.getFrame(). doing nothing\");\n\n      _this.frame = frame;\n      _this.updateSize();\n      _this.updateMarkerSizeLimits();\n      _this.updateEntities();\n      _this._labels.ready();\n      _this.redrawDataPoints();\n      _this.selectDataPoints();\n      _this.updateBubbleOpacity();\n      _this._updateDoubtOpacity();\n      _this.zoomToMarkerMaxMin(); // includes redraw data points and trail resize\n      if (!_this.model.time.splash) {\n        _this._trails.run([\"findVisible\", \"reveal\", \"opacityHandler\"]);\n      }\n      if (_this.model.ui.adaptMinMaxZoom) _this._panZoom.expandCanvas();\n    });\n  },\n\n  /*\n   * Zoom to the min and max values given in the URL axes markers.\n   */\n  zoomToMarkerMaxMin() {\n    /*\n     * Reset just the zoom values without triggering a zoom event. This ensures\n     * a clean zoom state for the subsequent zoom event.\n     */\n    this._panZoom.resetZoomState();\n\n    const xAxis = this.model.marker.axis_x;\n    const yAxis = this.model.marker.axis_y;\n\n    const xDomain = xAxis.getScale().domain();\n    const yDomain = yAxis.getScale().domain();\n\n    /*\n     * The axes may return null when there is no value given for the zoomed\n     * min and max values. In that case, fall back to the axes' domain values.\n     */\n    const zoomedMinX = xAxis.getZoomedMin();\n    const zoomedMaxX = xAxis.getZoomedMax();\n    const zoomedMinY = yAxis.getZoomedMin();\n    const zoomedMaxY = yAxis.getZoomedMax();\n\n    //by default this will apply no transition and feed values back to state\n    this._panZoom.zoomToMaxMin(zoomedMinX, zoomedMaxX, zoomedMinY, zoomedMaxY, 0, \"don't feed these zoom values back to state\");\n  },\n\n  /*\n   * UPDATE INDICATORS\n   */\n  updateIndicators() {\n    const _this = this;\n\n    //scales\n    this.yScale = this.model.marker.axis_y.getScale();\n    this.xScale = this.model.marker.axis_x.getScale();\n    this.sScale = this.model.marker.size.getScale();\n    this.cScale = this.model.marker.color.getScale();\n    this._labels.setScales(this.xScale, this.yScale);\n\n    this.yAxis.tickFormat(_this.model.marker.axis_y.getTickFormatter());\n    this.xAxis.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n  },\n\n  frameChanged(frame, time) {\n//    if (time.toString() != this.model.time.value.toString()) return; // frame is outdated\n    this.frame = frame;\n    this.updateTime();\n\n    this._updateDoubtOpacity();\n    this._trails.run(\"findVisible\");\n    if (this.model.ui.adaptMinMaxZoom) {\n      this._panZoom.expandCanvas();\n    } else {\n      this.redrawDataPoints();\n    }\n    this._trails.run(\"reveal\", null, this.duration);\n    this.tooltipMobile.classed(\"vzb-hidden\", true);\n    this._reorderEntities();\n  },\n\n  _getSubtitle(title, shortTitle) {\n    let subtitle = title.replace(shortTitle,\"\");\n    if (subtitle[0] === \",\") subtitle = subtitle.slice(1);\n    const regexpResult = /^\\((.*)\\)$|.*/.exec(subtitle.trim());\n    return regexpResult[1] || regexpResult[0] || \"\";\n  },\n\n  updateUIStrings() {\n    const _this = this;\n    const layoutProfile = this.getLayoutProfile();\n\n    const conceptPropsY = _this.model.marker.axis_y.getConceptprops();\n    const conceptPropsX = _this.model.marker.axis_x.getConceptprops();\n    const conceptPropsS = _this.model.marker.size.getConceptprops();\n    const conceptPropsC = _this.model.marker.color.getConceptprops();\n    this.translator = this.model.locale.getTFunction();\n\n    this.strings = {\n      title: {\n        Y: conceptPropsY.name,\n        X: conceptPropsX.name,\n        S: conceptPropsS.name,\n        C: conceptPropsC.name\n      },\n      title_short: {\n        Y: conceptPropsY.name_short,\n        X: conceptPropsX.name_short,\n        S: conceptPropsS.name_short,\n        C: conceptPropsC.name_short        \n      },\n      subtitle: {\n        Y: this._getSubtitle(conceptPropsY.name, conceptPropsY.name_short),\n        X: this._getSubtitle(conceptPropsX.name, conceptPropsX.name_short),\n        S: conceptPropsS.name_short,\n        C: conceptPropsC.name_short        \n      },\n      unit: {\n        Y: conceptPropsY.unit || \"\",\n        X: conceptPropsX.unit || \"\",\n        S: conceptPropsS.unit || \"\",\n        C: conceptPropsC.unit || \"\"\n      }\n    };\n\n    const ySubTitle = this.ySubTitleEl.selectAll(\"text\").data([0]);\n    ySubTitle.enter().append(\"text\");\n    const xSubTitle = this.xSubTitleEl.selectAll(\"text\").data([0]);\n    xSubTitle.enter().append(\"text\");\n\n    const yTitle = this.yTitleEl.selectAll(\"text\").data([0]);\n    yTitle.enter().append(\"text\");\n    yTitle\n    //.attr(\"y\", \"-6px\")\n      .on(\"click\", () => {\n        _this.parent\n          .findChildByName(\"gapminder-treemenu\")\n          .markerID(\"axis_y\")\n          .alignX(_this.model.locale.isRTL() ? \"right\" : \"left\")\n          .alignY(\"top\")\n          .updateView()\n          .toggle();\n      });\n\n    const xTitle = this.xTitleEl.selectAll(\"text\").data([0]);\n    xTitle.enter().append(\"text\");\n    xTitle\n      .on(\"click\", () => {\n        _this.parent\n          .findChildByName(\"gapminder-treemenu\")\n          .markerID(\"axis_x\")\n          .alignX(_this.model.locale.isRTL() ? \"right\" : \"left\")\n          .alignY(\"bottom\")\n          .updateView()\n          .toggle();\n      });\n\n    const sTitle = this.sTitleEl.selectAll(\"text\").data([0]);\n    sTitle.enter().append(\"text\");\n    sTitle\n      .attr(\"text-anchor\", \"end\");\n\n    utils.setIcon(this.dataWarningEl, iconWarn).select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\");\n    this.dataWarningEl.append(\"text\")\n      .attr(\"text-anchor\", \"end\")\n      .text(this.translator(\"hints/dataWarning\"));\n\n    utils.setIcon(this.yInfoEl, iconQuestion)\n      .select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\")\n      .style('opacity', Number(Boolean(conceptPropsY.description || conceptPropsY.sourceLink)));\n\n    utils.setIcon(this.xInfoEl, iconQuestion)\n      .select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\")\n      .style('opacity', Number(Boolean(conceptPropsX.description || conceptPropsX.sourceLink)));\n\n\n    //TODO: move away from UI strings, maybe to ready or ready once\n    this.yInfoEl.on(\"click\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.yInfoEl.on(\"mouseover\", function() {\n      const rect = this.getBBox();\n      const coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      const toolRect = _this.root.element.getBoundingClientRect();\n      const chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"axis_y\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.yInfoEl.on(\"mouseout\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n    });\n    this.xInfoEl.on(\"click\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.xInfoEl.on(\"mouseover\", function() {\n      if (_this.model.time.dragging) return;\n      const rect = this.getBBox();\n      const coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      const toolRect = _this.root.element.getBoundingClientRect();\n      const chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"axis_x\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.xInfoEl.on(\"mouseout\", () => {\n      if (_this.model.time.dragging) return;\n      _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n    });\n    this.dataWarningEl\n      .on(\"click\", () => {\n        _this.parent.findChildByName(\"gapminder-datawarning\").toggle();\n      })\n      .on(\"mouseover\", () => {\n        _this._updateDoubtOpacity(1);\n      })\n      .on(\"mouseout\", () => {\n        _this._updateDoubtOpacity();\n      });\n  },\n\n  _updateDoubtOpacity(opacity) {\n    if (opacity == null) opacity = this.wScale(+this.model.time.formatDate(this.time));\n    if (this.someSelected) opacity = 1;\n    this.dataWarningEl.style(\"opacity\", opacity);\n  },\n\n  /*\n   * UPDATE ENTITIES:\n   * Ideally should only update when show parameters change or data changes\n   */\n  updateEntities() {\n    const _this = this;\n    const KEY = this.KEY;\n    const TIMEDIM = this.TIMEDIM;\n\n    const getKeys = function(prefix) {\n      prefix = prefix || \"\";\n      return _this.model.marker.getKeys()\n        .map(d => {\n          const pointer = {};\n          pointer[KEY] = d[KEY];\n          pointer[TIMEDIM] = endTime;\n          pointer.sortValue = _this.frame.size[d[KEY]] || 0;\n          pointer[KEY] = prefix + d[KEY];\n          return pointer;\n        })\n        .sort((a, b) => b.sortValue - a.sortValue);\n    };\n\n    // get array of GEOs, sorted by the size hook\n    // that makes larger bubbles go behind the smaller ones\n    const endTime = this.model.time.end;\n    const markers = getKeys.call(this);\n    this.model.marker.setVisible(markers);\n\n    //unselecting bubbles with no data is used for the scenario when\n    //some bubbles are selected and user would switch indicator.\n    //bubbles would disappear but selection would stay\n    if (!this.model.time.splash) {\n      this.unselectBubblesWithNoData(markers);\n    }\n    this.entityBubbles = this.bubbleContainer.selectAll(\"circle.vzb-bc-entity\")\n      .data(this.model.marker.getVisible(), d => d[KEY]); // trails have not keys\n\n    //exit selection\n    this.entityBubbles.exit().remove();\n\n    //enter selection -- init circles\n    this.entityBubbles = this.entityBubbles.enter().append(\"circle\")\n      .attr(\"class\", d => \"vzb-bc-entity \" + \"bubble-\" + d[KEY])\n      .on(\"mouseover\", (d, i) => {\n        if (utils.isTouchDevice() || (_this.model.ui.cursorMode !== \"arrow\" && _this.model.ui.cursorMode !== \"hand\")) return;\n        _this._bubblesInteract().mouseover(d, i);\n      })\n      .on(\"mouseout\", (d, i) => {\n        if (utils.isTouchDevice() || (_this.model.ui.cursorMode !== \"arrow\" && _this.model.ui.cursorMode !== \"hand\")) return;\n\n        _this._bubblesInteract().mouseout(d, i);\n      })\n      .on(\"click\", (d, i) => {\n        if (utils.isTouchDevice() || (_this.model.ui.cursorMode !== \"arrow\" && _this.model.ui.cursorMode !== \"hand\")) return;\n\n        _this._bubblesInteract().click(d, i);\n      })\n      .onTap((d, i) => {\n        d3.event.stopPropagation();\n        _this._bubblesInteract().click(d, i);\n      })\n      .onLongTap((d, i) => {\n      })\n      .merge(this.entityBubbles);\n\n    this._reorderEntities();\n  },\n\n  unselectBubblesWithNoData(entities) {\n    const _this = this;\n    const KEY = this.KEY;\n    if (!this.model.marker.select.length) return;\n\n    const _select = [];\n    const keys = entities.map(d => d[KEY]);\n\n    this.model.marker.select.forEach(d => {\n      if (keys.indexOf(d[KEY]) !== -1) _select.push(d);\n    });\n\n    if (_select.length !== _this.model.marker.select.length) _this.model.marker.select = _select;\n  },\n\n  _reorderEntities() {\n    const _this = this;\n    const KEY = this.KEY;\n    this.bubbleContainer.selectAll(\".vzb-bc-entity\")\n      .sort((a, b) => {\n        const sizeA = _this.frame.size[a[KEY]];\n        const sizeB = _this.frame.size[b[KEY]];\n\n        if (typeof sizeA === \"undefined\" && typeof sizeB !== \"undefined\") return -1;\n        if (typeof sizeA !== \"undefined\" && typeof sizeB === \"undefined\") return 1;\n        if (sizeA != sizeB) return d3.descending(sizeA, sizeB);\n        if (a[KEY] != b[KEY]) return d3.ascending(a[KEY], b[KEY]);\n        if (typeof a.trailStartTime !== \"undefined\" || typeof b.trailStartTime !== \"undefined\") return typeof a.trailStartTime !== \"undefined\" ? -1 : 1; // only lines has trailStartTime\n        if (typeof a.status !== \"undefined\" || typeof b.status !== \"undefined\") return typeof a.status !== \"undefined\" ? -1 : 1; // only trails has attribute status\n        return d3.descending(sizeA, sizeB);\n      });\n  },\n\n  _bubblesInteract() {\n    const _this = this;\n    const KEY = this.KEY;\n    const TIMEDIM = this.TIMEDIM;\n\n    return {\n      mouseover(d, i) {\n        _this.model.marker.highlightMarker(d);\n\n        _this._labels.showCloseCross(d, true);\n      },\n\n      mouseout(d, i) {\n        _this.model.marker.clearHighlighted();\n\n        _this._labels.showCloseCross(d, false);\n      },\n\n      click(d, i) {\n        if (_this.draggingNow) return;\n        const isSelected = _this.model.marker.isSelected(d);\n        _this.model.marker.selectMarker(d);\n        //return to highlighted state\n        if (!utils.isTouchDevice()) {\n          if (isSelected) _this.model.marker.highlightMarker(d);\n          _this.highlightDataPoints();\n        }\n      }\n    };\n  },\n\n\n  /*\n   * UPDATE TIME:\n   * Ideally should only update when time or data changes\n   */\n  updateTime() {\n    const _this = this;\n\n    this.time_1 = this.time == null ? this.model.time.value : this.time;\n    this.time = this.model.time.value;\n    this.duration = this.model.time.playing && (this.time - this.time_1 > 0) ? this.model.time.delayAnimations : 0;\n    this.year.setText(this.model.time.formatDate(this.time, \"ui\"), this.duration);\n  },\n\n  /*\n   * RESIZE:\n   * Executed whenever the container is resized\n   */\n  updateSize() {\n\n    const { chartSvg } = this;\n    const svgWidth = utils.px2num(chartSvg.style(\"width\"));\n    const svgHeight = utils.px2num(chartSvg.style(\"height\"));\n    const marginScaleH = (marginMin, ratio = 0) => marginMin + svgHeight * ratio;\n    const marginScaleW = (marginMin, ratio = 0) => marginMin + svgWidth * ratio;\n\n    const profiles = {\n      small: {\n        margin: { top: 30, bottom: 35, left: 30, right: 10},\n        leftMarginRatio: 1,\n        padding: 2,\n        minRadiusPx: 0.5,\n        maxRadiusEm: this.model.ui.chart.maxRadiusEm || 0.05,\n        infoElHeight: 16,\n        yAxisTitleBottomMargin: 6,\n        xAxisTitleBottomMargin: 4\n      },\n      medium: {\n        margin: { top: 15, bottom: 40, left: 40, right: 15},\n        leftMarginRatio: 1.6,\n        padding: 2,\n        minRadiusPx: 1,\n        maxRadiusEm: this.model.ui.chart.maxRadiusEm || 0.05,\n        infoElHeight: 20,\n        yAxisTitleBottomMargin: 3,\n        xAxisTitleBottomMargin: 4\n      },\n      large: {\n        margin: { top: 15, bottom: marginScaleH(20, 0.03), left: marginScaleW(31, 0.015), right: 20},\n        leftMarginRatio: 1.8,\n        padding: 2,\n        minRadiusPx: 1,\n        maxRadiusEm: this.model.ui.chart.maxRadiusEm || 0.05,\n        infoElHeight: 22,\n        yAxisTitleBottomMargin: 3,//marginScaleH(4, 0.01),\n        xAxisTitleBottomMargin: marginScaleH(-10, 0.01),\n        hideSTitle: true\n      }\n    };\n\n    const presentationProfileChanges = {\n      medium: {\n        margin: { top: 20, bottom: 55, left: 50, right: 20 },\n        yAxisTitleBottomMargin: 3,\n        xAxisTitleBottomMargin: 4,\n        infoElHeight: 26,\n      },\n      large: {\n        margin: { top: 30, bottom: marginScaleH(45, 0.03), left: marginScaleW(35, 0.025), right: 30 },\n        yAxisTitleBottomMargin: 3,//marginScaleH(4, 0.01),\n        xAxisTitleBottomMargin: marginScaleH(-10, 0.01),\n        infoElHeight: 32,\n        hideSTitle: true\n      }\n    };\n    \n    const _this = this;\n\n    this.activeProfile = this.getActiveProfile(profiles, presentationProfileChanges);\n    const layoutProfile = this.getLayoutProfile();\n    const containerWH = this.root.getVizWidthHeight();\n    this.activeProfile.maxRadiusPx = Math.max(\n      this.activeProfile.minRadiusPx,\n      this.activeProfile.maxRadiusEm * utils.hypotenuse(containerWH.width, containerWH.height)\n    );\n\n    const margin = this.activeProfile.margin;\n    const infoElHeight = this.activeProfile.infoElHeight;\n\n    //labels\n    _this._labels.setCloseCrossHeight(_this.activeProfile.infoElHeight * 1.2);\n    _this._labels.setTooltipFontSize(_this.activeProfile.infoElHeight + \"px\");\n    \n    //stage\n    this.height = (parseInt(this.element.style(\"height\"), 10) - margin.top - margin.bottom) || 0;\n    this.width = (parseInt(this.element.style(\"width\"), 10) - margin.left * this.activeProfile.leftMarginRatio - margin.right) || 0;\n\n    if (this.height <= 0 || this.width <= 0) {\n      this.height = 0;\n      this.width = 0;\n      utils.warn(\"Bubble chart updateSize(): vizabi container is too little or has display:none\");\n    }\n\n    //graph group is shifted according to margins (while svg element is at 100 by 100%)\n    this.graph\n      .attr(\"transform\", \"translate(\" + (margin.left * this.activeProfile.leftMarginRatio) + \",\" + margin.top + \")\");\n\n    this.year.resize(this.width, this.height);\n    this.eventArea\n      .attr(\"width\", this.width)\n      .attr(\"height\", Math.max(0, this.height));\n\n    //update scales to the new range\n    if (this.model.marker.axis_y.scaleType !== \"ordinal\") {\n      this.yScale.range(this._rangeBump([this.height, 0]));\n    } else {\n      this.yScale.rangePoints([this.height, 0], _this.activeProfile.padding).range();\n    }\n    if (this.model.marker.axis_x.scaleType !== \"ordinal\") {\n      this.xScale.range(this._rangeBump([0, this.width]));\n    } else {\n      this.xScale.rangePoints([0, this.width], _this.activeProfile.padding).range();\n    }\n\n    //apply scales to axes and redraw\n    this.yAxis.scale(this.yScale)\n      .tickSizeInner(-this.width)\n      .tickSizeOuter(0)\n      .tickPadding(6)\n      .tickSizeMinor(-this.width, 0)\n      .labelerOptions({\n        scaleType: this.model.marker.axis_y.scaleType,\n        toolMargin: margin,\n        limitMaxTickNumber: 6,\n        bump: this.activeProfile.maxRadiusPx / 2,\n        viewportLength: this.height,\n        formatter: this.model.marker.axis_y.getTickFormatter()\n      });\n\n    this.xAxis.scale(this.xScale)\n      .tickSizeInner(-this.height)\n      .tickSizeOuter(0)\n      .tickPadding(6)\n      .tickSizeMinor(-this.height, 0)\n      .labelerOptions({\n        scaleType: this.model.marker.axis_x.scaleType,\n        toolMargin: margin,\n        bump: this.activeProfile.maxRadiusPx / 2,\n        viewportLength: this.width,\n        formatter: this.model.marker.axis_x.getTickFormatter()\n      });\n\n\n    this.bubbleContainerCrop\n      .attr(\"width\", this.width)\n      .attr(\"height\", Math.max(0, this.height));\n\n    this.labelsContainerCrop\n      .attr(\"width\", this.width)\n      .attr(\"height\", Math.max(0, this.height));\n\n    this.xAxisElContainer\n      .attr(\"width\", this.width + 1)\n      .attr(\"height\", this.activeProfile.margin.bottom + this.height)\n      .attr(\"y\", -1)\n      .attr(\"x\", -1);\n    this.xAxisEl\n      .attr(\"transform\", \"translate(1,\" + (1 + this.height) + \")\");\n\n    this.yAxisElContainer\n      .attr(\"width\", this.activeProfile.margin.left + this.width)\n      .attr(\"height\", Math.max(0, this.height))\n      .attr(\"x\", -this.activeProfile.margin.left);\n    this.yAxisEl\n      .attr(\"transform\", \"translate(\" + (this.activeProfile.margin.left - 1) + \",\" + 0 + \")\");\n\n    this.yAxisEl.call(this.yAxis);\n    this.xAxisEl.call(this.xAxis);\n\n    this.projectionX.attr(\"y1\", _this.yScale.range()[0] + this.activeProfile.maxRadiusPx / 2);\n    this.projectionY.attr(\"x2\", _this.xScale.range()[0] - this.activeProfile.maxRadiusPx / 2);\n\n\n    // reduce font size if the caption doesn't fit\n    this._updateSTitle();\n    this.sTitleEl\n      .attr(\"transform\", \"translate(\" + this.width + \",\" + 20 + \") rotate(-90)\");\n\n    if (layoutProfile !== \"small\") {\n      this.ySubTitleEl.select(\"text\").attr(\"dy\", infoElHeight * 0.6).text(this.strings.subtitle.Y);\n      this.xSubTitleEl.select(\"text\").attr(\"dy\", -infoElHeight * 0.3).text(this.strings.subtitle.X);\n      \n      this.yTitleEl.select(\"text\").text(this.strings.title_short.Y + \" \")\n        .append(\"tspan\")\n        .style(\"font-size\", (infoElHeight * 0.7) + \"px\")\n        .text(\"▼\");\n      this.xTitleEl.select(\"text\").text(this.strings.title_short.X + \" \")\n        .append(\"tspan\")\n        .style(\"font-size\", (infoElHeight * 0.7) + \"px\")\n        .text(\"▼\");\n    } else {\n      this.ySubTitleEl.select(\"text\").text(\"\");\n      this.xSubTitleEl.select(\"text\").text(\"\");\n\n      const yTitleText = this.yTitleEl.select(\"text\").text(this.strings.title.Y);\n      if (yTitleText.node().getBBox().width > this.width) yTitleText.text(this.strings.title_short.Y);\n    \n      const xTitleText = this.xTitleEl.select(\"text\").text(this.strings.title.X);\n      if (xTitleText.node().getBBox().width > this.width - 100) xTitleText.text(this.strings.title_short.X);      \n    }\n\n    const isRTL = this.model.locale.isRTL();\n    this.ySubTitleEl\n      .style(\"font-size\", (infoElHeight * 0.8) + \"px\")\n      .attr(\"transform\", \"translate(\" + 0 + \",\" + 0 + \") rotate(-90)\");\n    this.xSubTitleEl\n      .style(\"font-size\", (infoElHeight * 0.8) + \"px\")\n      .attr(\"transform\", \"translate(\" + this.width + \",\" + this.height + \")\");\n  \n    this.yTitleEl\n      .style(\"font-size\", infoElHeight + \"px\")\n      .attr(\"transform\", layoutProfile !== \"small\" ?\n        \"translate(\" + (-margin.left - this.activeProfile.yAxisTitleBottomMargin)  + \",\" + (this.height * 0.5) + \") rotate(-90)\"\n        : \n        \"translate(\" + (isRTL ? this.width : 10 - this.activeProfile.margin.left) + \", -\" + this.activeProfile.yAxisTitleBottomMargin + \")\")\n\n    this.xTitleEl\n      .style(\"font-size\", infoElHeight + \"px\")\n      .attr(\"transform\", layoutProfile !== \"small\" ?\n        \"translate(\" + (this.width * 0.5) + \",\" + (this.height + margin.bottom - this.activeProfile.xAxisTitleBottomMargin) + \")\"\n        :\n        \"translate(\" + (isRTL ? this.width : 0) + \",\" + (this.height + margin.bottom - this.activeProfile.xAxisTitleBottomMargin) + \")\");\n\n    if (this.yInfoEl.select(\"svg\").node()) {\n      const titleBBox = this.yTitleEl.node().getBBox();\n      const t = utils.transform(this.yTitleEl.node());\n      const hTranslate = isRTL ? (titleBBox.x + t.translateX - infoElHeight * 1.4) : (titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4);\n\n      this.yInfoEl.select(\"svg\")\n        .attr(\"width\", infoElHeight + \"px\")\n        .attr(\"height\", infoElHeight + \"px\");\n      this.yInfoEl.attr(\"transform\", layoutProfile !== \"small\" ?\n        \"translate(\" + (t.translateX - infoElHeight * 0.8) + \",\" + (t.translateY - infoElHeight * 0.4 - titleBBox.width * 0.5) + \") rotate(-90)\"\n        :\n        \"translate(\" + hTranslate + \",\" + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n\n    if (this.xInfoEl.select(\"svg\").node()) {\n      const titleBBox = this.xTitleEl.node().getBBox();\n      const t = utils.transform(this.xTitleEl.node());\n      const hTranslate = isRTL ? (titleBBox.x + t.translateX - infoElHeight * 1.4) : (titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4);\n\n      this.xInfoEl.select(\"svg\")\n        .attr(\"width\", infoElHeight + \"px\")\n        .attr(\"height\", infoElHeight + \"px\");\n      this.xInfoEl.attr(\"transform\", \"translate(\"\n        + hTranslate + \",\"\n        + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n\n    this._resizeDataWarning();\n\n    this.model.ui.chart.margin.set(\"left\", margin.left * this.activeProfile.leftMarginRatio, false, false);\n  },\n\n\n  _updateLineEqualXY(duration) {\n    const oneMeasure = this.model.marker.axis_x.which == this.model.marker.axis_y.which;\n    this.lineEqualXY.classed(\"vzb-invisible\", !oneMeasure);\n    if (!oneMeasure) return;\n\n    const min = d3.min(this.yScale.domain().concat(this.xScale.domain()));\n    const max = d3.max(this.yScale.domain().concat(this.xScale.domain()));\n\n    this.lineEqualXY\n      .transition()\n      .duration(duration || 0)\n      .attr(\"y1\", this.yScale(min))\n      .attr(\"y2\", this.yScale(max))\n      .attr(\"x1\", this.xScale(min))\n      .attr(\"x2\", this.xScale(max));\n  },\n\n  _resizeDataWarning() {\n    // reset font size to remove jumpy measurement\n    const dataWarningText = this.dataWarningEl.select(\"text\").style(\"font-size\", null);\n\n    // reduce font size if the caption doesn't fit\n    const dataWarningWidth = dataWarningText.node().getBBox().width + dataWarningText.node().getBBox().height * 3;\n    const remainingWidth = this.width - this.xTitleEl.node().getBBox().width - this.activeProfile.infoElHeight;\n    const font = parseInt(dataWarningText.style(\"font-size\")) * remainingWidth / dataWarningWidth;\n    dataWarningText.style(\"font-size\", dataWarningWidth > remainingWidth ? font + \"px\" : null);\n\n    // position the warning icon\n    const warnBB = dataWarningText.node().getBBox();\n    this.dataWarningEl.select(\"svg\")\n      .attr(\"width\", warnBB.height * 0.75)\n      .attr(\"height\", warnBB.height * 0.75)\n      .attr(\"x\", -warnBB.width - warnBB.height * 1.2)\n      .attr(\"y\", -warnBB.height * 0.65);\n\n    this.dataWarningEl\n      .attr(\"transform\", \"translate(\"\n        + (this.model.locale.isRTL() ? warnBB.width + warnBB.height : this.width) + \",\"\n        + (this.height + this.activeProfile.margin.bottom - this.activeProfile.xAxisTitleBottomMargin)\n        + \")\");\n  },\n\n  updateMarkerSizeLimits() {\n    const _this = this;\n    const extent = this.model.marker.size.extent || [0, 1];\n\n    if (!this.activeProfile) return utils.warn(\"updateMarkerSizeLimits() is called before ready(). This can happen if events get unfrozen and getFrame() still didn't return data\");\n\n    let minRadius = this.activeProfile.minRadiusPx;\n    let maxRadius = this.activeProfile.maxRadiusPx;\n\n    let minArea = utils.radiusToArea(Math.max(maxRadius * extent[0], minRadius));\n    let maxArea = utils.radiusToArea(Math.max(maxRadius * extent[1], minRadius));\n\n    let range = minArea === maxArea? [minArea, maxArea] :\n      d3.range(minArea, maxArea, (maxArea - minArea)/this.sScale.domain().length).concat(maxArea);\n\n    this.sScale.range(range);\n  },\n\n  redrawDataPointsOnlyColors() {\n    const _this = this;\n    if (!this.entityBubbles) return utils.warn(\"redrawDataPointsOnlyColors(): no entityBubbles defined. likely a premature call, fix it!\");\n\n    let valuesNow;\n    const KEY = this.KEY;\n\n\n    let time = this.model.time.value;\n\n    if (this.model.ui.chart.lockNonSelected && this.someSelected) {\n      time = this.model.time.parse(\"\" + this.model.ui.chart.lockNonSelected);\n    }\n    this.model.marker.getFrame(time, valuesLocked => {\n      if (!_this._frameIsValid(valuesLocked)) return utils.warn(\"redrawDataPointsOnlyColor: empty data received from marker.getFrame(). doing nothing\");\n\n      valuesNow = _this.frame;\n      _this.entityBubbles.each(function(d, index) {\n\n        const selected = _this.model.marker.isSelected(d);\n\n        const valueC = selected ? valuesNow.color[d[KEY]] : valuesLocked.color[d[KEY]];\n\n        const scaledC = valueC != null ? _this.cScale(valueC) : _this.COLOR_WHITEISH;\n\n        d3.select(this).style(\"fill\", scaledC);\n\n        //update lines of labels\n        if (selected) {\n\n          const select = utils.find(_this.model.marker.select, f => f[KEY] == d[KEY]);\n\n          const trailStartTime = _this.model.time.parse(\"\" + select.trailStartTime);\n\n          _this.model.marker.getFrame(trailStartTime, valuesTrailStart => {\n            if (!valuesTrailStart) return utils.warn(\"redrawDataPointsOnlyColor: empty data received from marker.getFrames(). doing nothing\");\n\n            const cache = {};\n            if (!_this.model.ui.chart.trails || trailStartTime - _this.time == 0) {\n              cache.scaledC0 = scaledC;\n            } else {\n              const valueC = valuesTrailStart.color[d[KEY]];\n              cache.scaledC0 = valueC != null ? _this.cScale(valueC) : _this.COLOR_WHITEISH;\n            }\n\n            _this._labels.updateLabelOnlyColor(d, index, cache);\n\n          });\n        }\n      });\n    });\n\n  },\n\n  redrawDataPointsOnlySize() {\n    const _this = this;\n\n    let valuesNow;\n    const KEY = this.KEY;\n\n\n    let time = this.model.time.value;\n\n    if (this.model.ui.chart.lockNonSelected && this.someSelected) {\n      time = this.model.time.parse(\"\" + this.model.ui.chart.lockNonSelected);\n    }\n    this.model.marker.getFrame(time, valuesLocked => {\n      if (!_this._frameIsValid(valuesLocked)) return utils.warn(\"redrawDataPointsOnlySize: empty data received from marker.getFrame(). doing nothing\");\n\n      valuesNow = _this.frame;\n      _this.entityBubbles.each(function(d, index) {\n\n        const selected = _this.model.marker.isSelected(d);\n\n        const valueS = selected ? valuesNow.size[d[KEY]] : valuesLocked.size[d[KEY]];\n        if (valueS == null) return;\n\n        const scaledS = utils.areaToRadius(_this.sScale(valueS));\n        d3.select(this).attr(\"r\", scaledS);\n\n        //update lines of labels\n        if (selected) {\n\n          const select = utils.find(_this.model.marker.select, f => f[KEY] == d[KEY]);\n\n          const trailStartTime = _this.model.time.parse(\"\" + select.trailStartTime);\n\n          _this.model.marker.getFrame(trailStartTime, valuesTrailStart => {\n            if (!valuesTrailStart) return utils.warn(\"redrawDataPointsOnlySize: empty data received from marker.getFrames(). doing nothing\");\n\n            const cache = {};\n            if (!_this.model.ui.chart.trails || trailStartTime - _this.time == 0) {\n              cache.scaledS0 = scaledS;\n            } else {\n              cache.scaledS0 = utils.areaToRadius(_this.sScale(valuesTrailStart.size[d[KEY]]));\n            }\n\n            _this._labels.updateLabelOnlyPosition(d, index, cache);\n\n          });\n        }\n      });\n    });\n  },\n\n  /*\n   * REDRAW DATA POINTS:\n   * Here plotting happens\n   * debouncing to improve performance: events might trigger it more than 1x\n   */\n  redrawDataPoints(duration) {\n    const _this = this;\n    const KEY = this.KEY;\n    if (duration == null) duration = _this.duration;\n\n    if (this.model.ui.chart.lockNonSelected && this.someSelected) {\n      const time = this.model.time.parse(\"\" + this.model.ui.chart.lockNonSelected);\n\n      //get values for locked frames\n      this.model.marker.getFrame(time, lockedFrame => {\n        if (!lockedFrame) return utils.warn(\"redrawDataPoints: empty data received from marker.getFrames(). doing nothing\");\n\n        // each bubble\n        _this.entityBubbles.each(function(d, index) {\n          const frame = _this.model.marker.isSelected(d) ? _this.frame : lockedFrame;\n          _this._updateBubble(d, frame, index, d3.select(this), duration);\n        });\n      });\n    } else {\n      // each bubble\n      _this.entityBubbles.each(function(d, index) {\n        _this._updateBubble(d, _this.frame, index, d3.select(this), duration);\n      });\n    }\n\n    this._updateLineEqualXY(duration);\n  },\n\n  //redraw Data Points\n  _updateBubble(d, values, index, view, duration) {\n    const _this = this;\n    const KEY = this.KEY;\n\n    let showhide = false;\n\n    const valueY = values.axis_y[d[KEY]];\n    const valueX = values.axis_x[d[KEY]];\n    const valueS = values.size[d[KEY]];\n    const valueL = values.label[d[KEY]];\n    const valueC = values.color[d[KEY]];\n    const valueLST = values.size_label[d[KEY]];\n\n    // check if fetching data succeeded\n    if (!valueL && valueL !== 0 || !valueY && valueY !== 0 || !valueX && valueX !== 0 || !valueS && valueS !== 0) {\n      // if entity is missing data it should hide\n      if (!d.hidden) {\n        d.hidden = true;\n        showhide = true;\n      }\n\n      if (showhide) {\n        if (duration) {\n          const opacity = view.style(\"opacity\");\n          view.transition().duration(duration).ease(d3.easeExp)\n            .style(\"opacity\", 0)\n            .on(\"end\", () => {\n              //to avoid transition from null state add class with a delay\n              view.classed(\"vzb-invisible\", d.hidden);\n              view.style(\"opacity\", opacity);\n            });\n        } else {\n          //immediately hide the bubble\n          view.classed(\"vzb-invisible\", d.hidden);\n        }\n      }\n    } else {\n      if (d.hidden || view.classed(\"vzb-invisible\")) {\n        d.hidden = false;\n        showhide = true;\n      }\n\n\n      // if entity has all the data we update the visuals\n      const scaledS = utils.areaToRadius(_this.sScale(valueS));\n\n      view.style(\"fill\", valueC != null ? _this.cScale(valueC) : _this.COLOR_WHITEISH);\n\n      if (duration) {\n        if (showhide) {\n          const opacity = view.style(\"opacity\");\n          view.classed(\"vzb-invisible\", d.hidden);\n          view.style(\"opacity\", 0)\n            .attr(\"cy\", _this.yScale(valueY))\n            .attr(\"cx\", _this.xScale(valueX))\n            .attr(\"r\", scaledS)\n            .transition().duration(duration).ease(d3.easeExp)\n            .style(\"opacity\", opacity);\n        } else {\n          view.transition().duration(duration).ease(d3.easeLinear)\n            .attr(\"cy\", _this.yScale(valueY))\n            .attr(\"cx\", _this.xScale(valueX))\n            .attr(\"r\", scaledS);\n        }\n\n      } else {\n\n        //interrupt the ongoing transition and immediately do the visual updates\n        view.interrupt()\n          .attr(\"cy\", _this.yScale(valueY))\n          .attr(\"cx\", _this.xScale(valueX))\n          .attr(\"r\", scaledS)\n          .transition();\n\n        //show entity if it was hidden\n        if (showhide) view.classed(\"vzb-invisible\", d.hidden);\n      }\n\n      if (this.model.time.record) _this._export.write({\n        type: \"circle\",\n        id: d[KEY],\n        time: this.model.time.value.getUTCFullYear(),\n        fill: valueC != null ? _this.cScale(valueC) : _this.COLOR_WHITEISH,\n        cx: _this.xScale(valueX),\n        cy: _this.yScale(valueY),\n        r: scaledS\n      });\n\n    } // data exists\n    _this._updateLabel(d, index, valueX, valueY, valueS, valueC, valueL, valueLST, duration, showhide);\n  },\n\n  _updateLabel(d, index, valueX, valueY, valueS, valueC, valueL, valueLST, duration, showhide) {\n    const _this = this;\n    const KEY = this.KEY;\n\n    // only for selected markers\n    if (_this.model.marker.isSelected(d)) {\n\n      const cache = {};\n\n      const select = utils.find(_this.model.marker.select, f => f[KEY] == d[KEY]);\n\n      const time = _this.model.time.formatDate(_this.time);\n      if (!this.model.ui.chart.trails || select.trailStartTime == time || select.trailStartTime == null) {\n        if (this.model.ui.chart.trails && select.trailStartTime == null) select.trailStartTime = time; // need only when trailStartTime == null\n\n        cache.labelX0 = valueX;\n        cache.labelY0 = valueY;\n        cache.scaledC0 = valueC != null ? _this.cScale(valueC) : _this.COLOR_WHITEISH,\n        cache.scaledS0 = (valueS || valueS === 0) ? utils.areaToRadius(_this.sScale(valueS)) : null;\n      }\n\n      const trailStartTime = _this.model.time.parse(\"\" + select.trailStartTime);\n\n      const labelText = _this._getLabelText(valueL, select.trailStartTime);\n\n      if (showhide && d.hidden && _this.model.ui.chart.trails && trailStartTime && (trailStartTime < _this.time)) showhide = false;\n      if (d.hidden && !_this.model.ui.chart.trails) showhide = true;\n\n      this._labels.updateLabel(d, index, cache, valueX, valueY, valueS, valueC, labelText, valueLST, duration, showhide);\n\n    }\n  },\n\n  _getLabelText(value, time) {    \n    return value + (this.model.ui.chart.trails ? \" \" + time : \"\");\n  },\n\n  _setTooltip(tooltipText, x, y, s, c, d) {\n    if (tooltipText) {\n      const labelValues = {};\n      if (d) {\n        const KEY = this.KEY;\n        const values = this.frame;\n        labelValues.valueY = values.axis_y[d[KEY]];\n        labelValues.valueX = values.axis_x[d[KEY]];\n        labelValues.valueS = values.size[d[KEY]];\n        labelValues.valueL = values.label[d[KEY]];\n        labelValues.valueC = values.color[d[KEY]];\n        labelValues.valueLST = values.size_label[d[KEY]];\n        labelValues.labelText = this._getLabelText(labelValues.valueL, this.model.time.formatDate(this.time));\n      }\n\n      const tooltipCache = {};\n      tooltipCache.labelX0 = this.xScale.invert(x);\n      tooltipCache.labelY0 = this.yScale.invert(y);\n      tooltipCache.scaledS0 = s;\n      tooltipCache.scaledC0 = null;\n\n      this._labels.setTooltip(d, tooltipText, tooltipCache, labelValues);\n    } else {\n      this._labels.setTooltip();\n    }\n  },\n\n  _formatSTitleValues(titleS, titleC) {\n    const _this = this;\n    const unitS = this.strings.unit.S;\n    const unitC = this.strings.unit.C;\n\n    const formatterS = this.model.marker.size.getTickFormatter();\n    const formatterC = this.model.marker.color.getTickFormatter();\n\n    //resolve labels for colors via the color legend\n    if (this.model.marker.color.isDiscrete() && this.model.marker.color.use !== \"constant\" && titleC && this.model.marker.color.getColorlegendMarker()) {\n      titleC = this.model.marker.color.getColorlegendMarker().label.getItems()[titleC] || \"\";\n    }\n\n    return [formatterS(titleS) + \" \" + unitS,\n      titleC || titleC === 0 ? formatterC(titleC) + \" \" + unitC : this.translator(\"hints/nodata\")];\n  },\n\n  _updateSTitle(titleS, titleC) {\n\n    // vertical text about size and color\n    if (this.activeProfile.hideSTitle\n      && this.model.ui.dialogs.sidebar.indexOf(\"colors\") > -1\n      && this.model.ui.dialogs.sidebar.indexOf(\"size\") > -1) {\n      this.sTitleEl.classed(\"vzb-invisible\", true);\n      return;\n    }\n    if (this.sTitleEl.classed(\"vzb-invisible\")) {\n      this.sTitleEl.classed(\"vzb-invisible\", false);\n    }\n    const sTitleContentON = this.model.marker.size.use !== \"constant\";\n    const cTitleContentON = this.model.marker.color.use !== \"constant\";\n    const sTitleText = this.sTitleEl.select(\"text\")\n    // reset font size to remove jumpy measurement\n      .style(\"font-size\", null)\n      .text(\n        (sTitleContentON ? this.translator(\"buttons/size\") + \": \" + (titleS ? titleS : this.strings.title.S) : \"\") +\n        (sTitleContentON && cTitleContentON ? \", \" : \"\") +\n        (cTitleContentON ? this.translator(\"buttons/colors\") + \": \" + (titleC ? titleC : this.strings.title.C) : \"\")\n      );\n    const sTitleWidth = sTitleText.node().getBBox().width;\n    const remainigHeight = this.height - 30;\n    const font = parseInt(sTitleText.style(\"font-size\")) * remainigHeight / sTitleWidth;\n    sTitleText.style(\"font-size\", sTitleWidth > remainigHeight ? font + \"px\" : null);\n  },\n\n  selectDataPoints() {\n    const _this = this;\n    const KEY = this.KEY;\n\n    if (utils.isTouchDevice()) {\n      _this.model.marker.clearHighlighted();\n      _this._labels.showCloseCross(null, false);\n    } else {\n      //hide tooltip\n      _this._setTooltip();\n      _this._setBubbleCrown();\n    }\n\n    _this.someSelected = (_this.model.marker.select.length > 0);\n    _this.nonSelectedOpacityZero = false;\n  },\n\n  _setBubbleCrown(x, y, r, glow, skipInnerFill) {\n    if (x != null) {\n      this.bubbleCrown.classed(\"vzb-hidden\", false);\n      this.bubbleCrown.select(\".vzb-crown\")\n        .attr(\"cx\", x)\n        .attr(\"cy\", y)\n        .attr(\"r\", r)\n        .attr(\"fill\", skipInnerFill ? \"none\" : glow);\n      this.bubbleCrown.selectAll(\".vzb-crown-glow\")\n        .attr(\"cx\", x)\n        .attr(\"cy\", y)\n        .attr(\"r\", r + 10)\n        .attr(\"stroke\", glow);\n\n    } else {\n      this.bubbleCrown.classed(\"vzb-hidden\", true);\n    }\n\n  },\n\n  /*\n   * Shows and hides axis projections\n   */\n  _axisProjections(d) {\n    const _this = this;\n    const TIMEDIM = this.TIMEDIM;\n    const KEY = this.KEY;\n\n    if (d != null) {\n\n      this.model.marker.getFrame(d[TIMEDIM], values => {\n        const valueY = values.axis_y[d[KEY]];\n        const valueX = values.axis_x[d[KEY]];\n        const valueS = values.size[d[KEY]];\n        const radius = utils.areaToRadius(_this.sScale(valueS));\n\n        if (!valueY && valueY !== 0 || !valueX && valueX !== 0 || !valueS && valueS !== 0) return;\n\n        if (_this.model.ui.chart.whenHovering.showProjectionLineX\n          && _this.xScale(valueX) > 0 && _this.xScale(valueX) < _this.width\n          && (_this.yScale(valueY) + radius) < _this.height) {\n          _this.projectionX\n            .style(\"opacity\", 1)\n            .attr(\"y2\", _this.yScale(valueY) + radius)\n            .attr(\"x1\", _this.xScale(valueX))\n            .attr(\"x2\", _this.xScale(valueX));\n        }\n\n        if (_this.model.ui.chart.whenHovering.showProjectionLineY\n          && _this.yScale(valueY) > 0 && _this.yScale(valueY) < _this.height\n          && (_this.xScale(valueX) - radius) > 0) {\n          _this.projectionY\n            .style(\"opacity\", 1)\n            .attr(\"y1\", _this.yScale(valueY))\n            .attr(\"y2\", _this.yScale(valueY))\n            .attr(\"x1\", _this.xScale(valueX) - radius);\n        }\n\n        if (_this.model.ui.chart.whenHovering.higlightValueX) _this.xAxisEl.call(\n          _this.xAxis.highlightValue(valueX)\n        );\n\n        if (_this.model.ui.chart.whenHovering.higlightValueY) _this.yAxisEl.call(\n          _this.yAxis.highlightValue(valueY)\n        );\n      });\n\n    } else {\n\n      this.projectionX.style(\"opacity\", 0);\n      this.projectionY.style(\"opacity\", 0);\n      this.xAxisEl.call(this.xAxis.highlightValue(\"none\"));\n      this.yAxisEl.call(this.yAxis.highlightValue(\"none\"));\n\n    }\n\n  },\n\n  /*\n   * Highlights all hovered bubbles\n   */\n  highlightDataPoints() {\n    const _this = this;\n    const TIMEDIM = this.TIMEDIM;\n    const KEY = this.KEY;\n\n    this.someHighlighted = (this.model.marker.highlight.length > 0);\n\n    this.updateBubbleOpacity();\n\n    if (this.model.marker.highlight.length === 1) {\n      const d = utils.clone(this.model.marker.highlight[0]);\n\n      if (_this.model.ui.chart.lockNonSelected && _this.someSelected && !_this.model.marker.isSelected(d)) {\n        d[TIMEDIM] = _this.model.time.parse(\"\" + _this.model.ui.chart.lockNonSelected);\n      } else {\n        d[TIMEDIM] = _this.model.time.parse(\"\" + d.trailStartTime) || _this.time;\n      }\n\n      _this.model.marker.getFrame(d[TIMEDIM], values => {\n        if (!values) return;\n        const x = _this.xScale(values.axis_x[d[KEY]]);\n        const y = _this.yScale(values.axis_y[d[KEY]]);\n        const s = utils.areaToRadius(_this.sScale(values.size[d[KEY]]));\n        const c = values.color[d[KEY]] != null ? _this.cScale(values.color[d[KEY]]) : _this.COLOR_WHITEISH;\n        let entityOutOfView = false;\n\n        const titles = _this._formatSTitleValues(values.size[d[KEY]], values.color[d[KEY]]);\n        _this._updateSTitle(titles[0], titles[1]);\n        if (x + s < 0 || x - s > _this.width || y + s < 0 || y - s > _this.height) {\n          entityOutOfView = true;\n        }\n\n        //show tooltip\n        let text = \"\";\n        let hoverTrail = false;\n        if (_this.model.marker.isSelected(d) && _this.model.ui.chart.trails) {\n          text = _this.model.time.formatDate(_this.time);\n          const selectedData = utils.find(_this.model.marker.select, f => f[KEY] == d[KEY]);\n          hoverTrail = text !== selectedData.trailStartTime && !d3.select(d3.event.target).classed(\"bubble-\" + d[KEY]);\n          text = text !== selectedData.trailStartTime && _this.time === d[TIMEDIM] ? text : \"\";\n        } else {\n          text = _this.model.marker.isSelected(d) ? \"\" : values.label[d[KEY]];\n        }\n\n        _this._labels.highlight(null, false);\n        _this._labels.highlight(d, true);\n        if (_this.model.marker.isSelected(d)) {\n          const skipCrownInnerFill = !d.trailStartTime || d.trailStartTime == _this.model.time.formatDate(_this.time);\n          _this._setBubbleCrown(x, y, s, c, skipCrownInnerFill);\n        }\n\n        if (!entityOutOfView && !hoverTrail) {\n          _this._axisProjections(d);\n        }\n\n        //set tooltip and show axis projections\n        if (text && !entityOutOfView && !hoverTrail) {\n          _this._setTooltip(text, x, y, s + 3, c, d);\n        }\n\n        const selectedData = utils.find(_this.model.marker.select, f => f[KEY] == d[KEY]);\n        if (selectedData) {\n          const clonedSelectedData = utils.clone(selectedData);\n          //change opacity to OPACITY_HIGHLT = 1.0;\n          clonedSelectedData.opacity = 1.0;\n          _this._trails.run([\"opacityHandler\"], clonedSelectedData);\n        }\n      });\n    } else {\n      this._axisProjections();\n      this._trails.run([\"opacityHandler\"]);\n      //hide tooltip\n      _this._updateSTitle();\n      this._setTooltip();\n      this._setBubbleCrown();\n      this._labels.highlight(null, false);\n    }\n\n  },\n\n  _blinkSuperHighlighted() {\n    this.entityBubbles\n      .classed(\"vzb-super-highlighted\", d => this.model.marker.isSuperHighlighted(d));\n  },\n\n  updateBubbleOpacity(duration) {\n    const _this = this;\n    //if(!duration)duration = 0;\n\n    const OPACITY_HIGHLT = 1.0;\n    const OPACITY_HIGHLT_DIM = this.model.marker.opacityHighlightDim;\n    const OPACITY_SELECT = 1.0;\n    const OPACITY_REGULAR = this.model.marker.opacityRegular;\n    const OPACITY_SELECT_DIM = this.model.marker.opacitySelectDim;\n\n    this.entityBubbles\n    //.transition().duration(duration)\n      .style(\"opacity\", d => {\n\n        if (_this.someHighlighted) {\n          //highlight or non-highlight\n          if (_this.model.marker.isHighlighted(d)) return OPACITY_HIGHLT;\n        }\n\n        if (_this.someSelected) {\n          //selected or non-selected\n          return _this.model.marker.isSelected(d) ? OPACITY_SELECT : OPACITY_SELECT_DIM;\n        }\n\n        if (_this.someHighlighted) return OPACITY_HIGHLT_DIM;\n\n        return OPACITY_REGULAR;\n      });\n\n\n    const nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n\n    // when pointer events need update...\n    if (nonSelectedOpacityZero != this.nonSelectedOpacityZero) {\n      this.entityBubbles.style(\"pointer-events\", d => (!_this.someSelected || !nonSelectedOpacityZero || _this.model.marker.isSelected(d)) ?\n        \"visible\" : \"none\");\n    }\n\n    this.nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n  }\n\n});\n\nexport default BubbleChart;\n\n\n\n// WEBPACK FOOTER //\n// ./src/component.js","const { utils } = Vizabi;\n\nconst PanZoom = Vizabi.Class.extend({\n\n  init(context) {\n    this.context = context;\n\n    this.dragRectangle = d3.drag();\n    this.zoomer = d3.zoom();\n\n    // this.dragLock = false;\n\n    this.dragRectangle\n      .subject(this.dragSubject())\n      .on(\"start\", this.drag().start)\n      .on(\"drag\", this.drag().go)\n      .on(\"end\", this.drag().stop);\n\n    this.zoomer\n      .filter(this.zoomFilter())\n      .scaleExtent([0.0625, +Infinity])\n      .on(\"start\", this.zoom().start)\n      .on(\"zoom\", this.zoom().go)\n      .on(\"end\", this.zoom().stop);\n\n    this.zoomer.ratioX = 1;\n    this.zoomer.ratioY = 1;\n\n    context._zoomedXYMinMax = {\n      axis_x: { zoomedMin: null, zoomedMax: null },\n      axis_y: { zoomedMin: null, zoomedMax: null }\n    };\n  },\n\n  dragSubject() {\n    const _this = this.context;\n    const self = this;\n\n    return function(d) {\n      /*\n       * Do not drag if the Ctrl key, Meta key, or plus cursor mode is\n       * not enabled. Also do not drag if zoom-pinching on touchmove\n       * events.\n       */\n      if (!(d3.event.sourceEvent.ctrlKey || d3.event.sourceEvent.metaKey ||\n        _this.ui.cursorMode === \"plus\") || (_this.ui.cursorMode === \"minus\") ||\n        (d3.event.sourceEvent.type === \"touchmove\" || d3.event.sourceEvent.type === \"touchstart\") &&\n        (d3.event.sourceEvent.touches.length > 1 || d3.event.sourceEvent.targetTouches.length > 1)) {\n        return null;\n      }\n\n      return {\n        x: d3.mouse(this)[0],\n        y: d3.mouse(this)[1]\n      };\n    };\n  },\n\n  drag() {\n    const _this = this.context;\n    const self = this;\n\n    return {\n      start(d, i) {\n        /*\n         * Do not drag if the Ctrl key, Meta key, or plus cursor mode is\n         * not enabled. Also do not drag if zoom-pinching on touchmove\n         * events.\n         */\n        //   if(!(d3.event.sourceEvent.ctrlKey || d3.event.sourceEvent.metaKey ||\n        //          _this.ui.cursorMode === \"plus\") ||\n        //          (d3.event.sourceEvent.type === \"touchmove\" || d3.event.sourceEvent.type === \"touchstart\") &&\n        //          (d3.event.sourceEvent.touches.length > 1 || d3.event.sourceEvent.targetTouches.length > 1)) {\n        //         return;\n        //     }\n\n        // self.dragLock = true;\n        this.origin = {\n          x: d3.mouse(this)[0],\n          y: d3.mouse(this)[1]\n        };\n        _this.zoomRect.classed(\"vzb-invisible\", false);\n      },\n\n      go(d, i) {\n        /*\n         * Cancel drag if drag lock is false, or when zoom-pinching via\n         * touchmove events.\n         */\n        // if (!self.dragLock || (d3.event.sourceEvent.type === \"touchmove\" || d3.event.sourceEvent.type === \"touchstart\") &&\n        //             (d3.event.sourceEvent.touches.length > 1 || d3.event.sourceEvent.targetTouches.length > 1)) {\n        //   self.dragLock = false;\n\n        //   _this.zoomRect\n        //     .attr(\"width\", 0)\n        //     .attr(\"height\", 0)\n        //     .classed(\"vzb-invisible\", true);\n\n        //   return;\n        // }\n\n        const origin = this.origin;\n        const mouse = {\n          x: d3.event.x,\n          y: d3.event.y\n        };\n\n        _this.zoomRect\n          .attr(\"x\", Math.min(mouse.x, origin.x))\n          .attr(\"y\", Math.min(mouse.y, origin.y))\n          .attr(\"width\", Math.abs(mouse.x - origin.x))\n          .attr(\"height\", Math.abs(mouse.y - origin.y));\n      },\n\n      stop(e) {\n        // if (!self.dragLock) return;\n        // self.dragLock = false;\n\n        _this.zoomRect\n          .attr(\"width\", 0)\n          .attr(\"height\", 0)\n          .classed(\"vzb-invisible\", true);\n\n        this.target = {\n          x: d3.mouse(this)[0],\n          y: d3.mouse(this)[1]\n        };\n        if (Math.abs(this.origin.x - this.target.x) < 10 || Math.abs(this.origin.y - this.target.y) < 10) return;\n\n        /*\n         * Only compensate for dragging when the Ctrl key or Meta key\n         * are pressed, or if the cursorMode is not in plus mode.\n         */\n        const compensateDragging = d3.event.sourceEvent.ctrlKey ||\n          d3.event.sourceEvent.metaKey ||\n          _this.ui.cursorMode === \"plus\";\n\n        self._zoomOnRectangle(\n          d3.select(this),\n          this.origin.x,\n          this.origin.y,\n          this.target.x,\n          this.target.y,\n          compensateDragging, 500\n        );\n      }\n    };\n  },\n  zoomFilter() {\n    const _this = this.context;\n    const self = this;\n\n    return function(d) {\n      const event = d3.event;\n\n      if (event.ctrlKey || event.metaKey) return false;\n\n      // Cancel drag lock when zoom-pinching via touchmove events.\n      if ((event.type === \"touchmove\" || event.type === \"touchstart\") &&\n        (event.touches.length > 1 || event.targetTouches.length > 1)) return true;\n\n      if ((event.type === \"wheel\" || event.type === \"mousewheel\") &&\n        _this.ui.zoomOnScrolling) {\n        // if (_this.scrollableAncestor) {\n        //   _this.scrollableAncestor.scrollTop -= (event.deltaY || -event.wheelDelta);\n        // }\n        // d3.event.scale = null;\n        //zoomer.scale(this.savedScale);\n        return true;\n      }\n\n      if ((event.type === \"mousedown\" || event.type === \"touchstart\") &&\n        (_this.ui.cursorMode !== \"plus\") && (_this.ui.cursorMode !== \"minus\") &&\n        (_this.ui.panWithArrow || _this.ui.cursorMode === \"hand\")) return true;\n\n      return false;\n    };\n  },\n  zoom() {\n    const _this = this.context;\n    const zoomer = this.zoomer;\n    const self = this;\n\n    return {\n      start() {\n        //this.savedScale = zoomer.scale;\n        if ((_this.ui.cursorMode !== \"plus\") && (_this.ui.cursorMode !== \"minus\")) {\n          _this.chartSvg.classed(\"vzb-zooming\", true);\n        }\n\n        _this.model._data.marker.clearHighlighted();\n        _this._setTooltip();\n\n      },\n      go() {\n\n        const sourceEvent = d3.event.sourceEvent;\n\n        //if (sourceEvent != null && (sourceEvent.ctrlKey || sourceEvent.metaKey)) return;\n\n        // Cancel drag lock when zoom-pinching via touchmove events.\n        // if (sourceEvent !== null &&\n        //             (sourceEvent.type === \"touchmove\" || sourceEvent.type === \"touchstart\") &&\n        //             (sourceEvent.touches.length > 1 || sourceEvent.targetTouches.length > 1)) {\n        //   self.dragLock = false;\n        // }\n\n        //if (self.dragLock) return;\n\n        //send the event to the page if fully zoomed our or page not scrolled into view\n//\n//                    if(d3.event.scale == 1)\n//\n//                    if(utils.getViewportPosition(_this.element.node()).y < 0 && d3.event.scale > 1) {\n//                        _this.scrollableAncestor.scrollTop += d3.event.sourceEvent.deltaY;\n//                        return;\n//                    }\n        /*\n         * Do not zoom on the chart if the scroll event is a wheel\n         * scroll. Instead, redirect the scroll event to the scrollable\n         * ancestor\n         */\n        // if (sourceEvent != null && (sourceEvent.type === \"wheel\" || sourceEvent.type === \"mousewheel\") &&\n        //             !_this.ui.zoomOnScrolling) {\n        //   if (_this.scrollableAncestor) {\n        //     _this.scrollableAncestor.scrollTop += (sourceEvent.deltaY || -sourceEvent.wheelDelta);\n        //   }\n        //   d3.event.scale = null;\n        //             //zoomer.scale(this.savedScale);\n        //   this.quitZoom = true;\n        //   return;\n        // }\n        // this.quitZoom = false;\n\n        //_this.model._data.marker.clearHighlighted();\n        //_this._setTooltip();\n\n        //var transform = d3.zoomTransform(self.zoomSelection.node())\n        //  .translate(, )\n        //.scale(d3.event.transform.k);\n        let zoom = d3.event.transform.k;\n\n        let pan = [d3.event.transform.x, d3.event.transform.y];//d3.event.translate;\n        let ratioY = zoomer.ratioY;\n        let ratioX = zoomer.ratioX;\n\n        _this.draggingNow = true;\n\n        //value protections and fallbacks\n        if (isNaN(zoom) || zoom == null) zoom = zoomer.scale;\n        if (isNaN(zoom) || zoom == null) zoom = 1;\n\n        //TODO: this is a patch to fix #221. A proper code review of zoom and zoomOnRectangle logic is needed\n        /*\n         * Mouse wheel and touchmove events set the zoom value\n         * independently of axis ratios. If the zoom event was triggered\n         * by a mouse wheel event scrolling down or touchmove event with\n         * more than 1 contact that sets zoom to 1, then set the axis\n         * ratios to 1 as well, which will fully zoom out.\n         */\n        if (zoom === 1 && sourceEvent !== null &&\n          ((sourceEvent.type === \"wheel\" || sourceEvent.type === \"mousewheel\") && (sourceEvent.deltaY || -sourceEvent.wheelDelta) > 0 ||\n          sourceEvent.type === \"touchmove\" && sourceEvent.touches.length > 1)) {\n          zoomer.ratioX = 1;\n          ratioX = 1;\n          zoomer.ratioY = 1;\n          ratioY = 1;\n        }\n\n//                if(isNaN(pan[0]) || isNaN(pan[1]) || pan[0] == null || pan[1] == null) pan = zoomer.translate();\n        if (isNaN(pan[0]) || isNaN(pan[1]) || pan[0] == null || pan[1] == null) pan = [0, 0];\n\n        // limit the zooming, so that it never goes below min value of zoom for any of the axes\n        const minZoomScale = zoomer.scaleExtent()[0];\n        if (zoom * ratioY < minZoomScale) {\n          ratioY = minZoomScale / zoom;\n          zoomer.ratioY = ratioY;\n        }\n        if (zoom * ratioX < minZoomScale) {\n          ratioX = minZoomScale / zoom;\n          zoomer.ratioX = ratioX;\n        }\n\n        const zoomXOut = zoom * ratioX < 1;\n        const zoomYOut = zoom * ratioY < 1;\n\n        //limit the panning, so that we are never outside the possible range\n        if (!zoomXOut) {\n          if (pan[0] > 0) pan[0] = 0;\n          if (pan[0] < (1 - zoom * ratioX) * _this.width) pan[0] = (1 - zoom * ratioX) * _this.width;\n        } else {\n          if (pan[0] < 0) pan[0] = 0;\n          if (pan[0] > (1 - zoom * ratioX) * _this.width) pan[0] = (1 - zoom * ratioX) * _this.width;\n        }\n\n        if (!zoomYOut) {\n          if (pan[1] > 0) pan[1] = 0;\n          if (pan[1] < (1 - zoom * ratioY) * _this.height) pan[1] = (1 - zoom * ratioY) * _this.height;\n        } else {\n          if (pan[1] < 0) pan[1] = 0;\n          if (pan[1] > (1 - zoom * ratioY) * _this.height) pan[1] = (1 - zoom * ratioY) * _this.height;\n        }\n\n        //limit zoom translate\n        self.zoomSelection.property(\"__zoom\", d3.zoomIdentity.translate(pan[0], pan[1]).scale(zoom));\n\n        const xPanOffset = _this.width * zoom * ratioX;\n        const yPanOffset = _this.height * zoom * ratioY;\n\n        const xRange = [0 * zoom * ratioX + pan[0], xPanOffset + pan[0]];\n        const yRange = [yPanOffset + pan[1], 0 * zoom * ratioY + pan[1]];\n\n        const xRangeBumped = _this._rangeBump(xRange);\n        const yRangeBumped = _this._rangeBump(yRange);\n\n        /*\n         * Shift xRange and yRange by the difference between the bumped\n         * ranges, which is scaled by the zoom factor. This accounts for\n         * the range bump, which controls a gutter around the\n         * bubblechart, while correctly zooming.\n         */\n        const xRangeMinOffset = (xRangeBumped[0] - xRange[0]) * zoom * ratioX;\n        const xRangeMaxOffset = (xRangeBumped[1] - xRange[1]) * zoom * ratioX;\n\n        const yRangeMinOffset = (yRangeBumped[0] - yRange[0]) * zoom * ratioY;\n        const yRangeMaxOffset = (yRangeBumped[1] - yRange[1]) * zoom * ratioY;\n\n        xRange[0] += xRangeMinOffset;\n        xRange[1] += xRangeMaxOffset;\n\n        yRange[0] += yRangeMinOffset;\n        yRange[1] += yRangeMaxOffset;\n\n        // Calculate the maximum xRange and yRange available.\n        const xRangeBounds = [0, _this.width];\n        const yRangeBounds = [_this.height, 0];\n\n        const xRangeBoundsBumped = _this._rangeBump(xRangeBounds);\n        const yRangeBoundsBumped = _this._rangeBump(yRangeBounds);\n\n        /*\n         * Set the pan to account for the range bump by subtracting\n         * offsets and preventing panning past the range bump gutter.\n         */\n        if (!zoomXOut) {\n          if (xRange[0] > xRangeBoundsBumped[0]) pan[0] = xRangeBoundsBumped[0] - xRangeMinOffset;\n          if (xRange[1] < xRangeBoundsBumped[1]) pan[0] = xRangeBoundsBumped[1] - xRangeMaxOffset - xPanOffset;\n        } else {\n          if (xRange[0] < xRangeBoundsBumped[0]) pan[0] = xRangeBoundsBumped[0] - xRangeMinOffset;\n          if (xRange[1] > xRangeBoundsBumped[1]) pan[0] = xRangeBoundsBumped[1] - xRangeMaxOffset - xPanOffset;\n        }\n\n        if (!zoomYOut) {\n          if (yRange[0] < yRangeBoundsBumped[0]) pan[1] = yRangeBoundsBumped[0] - yRangeMinOffset - yPanOffset;\n          if (yRange[1] > yRangeBoundsBumped[1]) pan[1] = yRangeBoundsBumped[1] - yRangeMaxOffset;\n        } else {\n          if (yRange[0] > yRangeBoundsBumped[0]) pan[1] = yRangeBoundsBumped[0] - yRangeMinOffset - yPanOffset;\n          if (yRange[1] < yRangeBoundsBumped[1]) pan[1] = yRangeBoundsBumped[1] - yRangeMaxOffset;\n        }\n\n        //zoomer.translate = pan;\n        //self.zoomSelection.property(\"__zoom\", d3.zoomIdentity.translate(pan[0], pan[1]).scale(zoom));\n\n        /*\n         * Clamp the xRange and yRange by the amount that the bounds\n         * that are range bumped.\n         *\n         * Additionally, take the amount clamped on the end of the range\n         * and either subtract or add it to the range's other end. This\n         * prevents visible stretching of the range when only panning.\n         */\n        if (!zoomXOut) {\n          if (xRange[0] > xRangeBoundsBumped[0]) {\n            xRange[1] -= Math.abs(xRange[0] - xRangeBoundsBumped[0]);\n            xRange[0] = xRangeBoundsBumped[0];\n          }\n\n          if (xRange[1] < xRangeBoundsBumped[1]) {\n            xRange[0] += Math.abs(xRange[1] - xRangeBoundsBumped[1]);\n            xRange[1] = xRangeBoundsBumped[1];\n          }\n        } else {\n          if (xRange[0] < xRangeBoundsBumped[0]) {\n            xRange[1] += Math.abs(xRange[0] - xRangeBoundsBumped[0]);\n            xRange[0] = xRangeBoundsBumped[0];\n          }\n\n          if (xRange[1] > xRangeBoundsBumped[1]) {\n            xRange[0] -= Math.abs(xRange[1] - xRangeBoundsBumped[1]);\n            xRange[1] = xRangeBoundsBumped[1];\n          }\n        }\n\n        if (!zoomYOut) {\n          if (yRange[0] < yRangeBoundsBumped[0]) {\n            yRange[1] += Math.abs(yRange[0] - yRangeBoundsBumped[0]);\n            yRange[0] = yRangeBoundsBumped[0];\n          }\n\n          if (yRange[1] > yRangeBoundsBumped[1]) {\n            yRange[0] -= Math.abs(yRange[1] - yRangeBoundsBumped[1]);\n            yRange[1] = yRangeBoundsBumped[1];\n          }\n        } else {\n          if (yRange[0] > yRangeBoundsBumped[0]) {\n            yRange[1] -= Math.abs(yRange[0] - yRangeBoundsBumped[0]);\n            yRange[0] = yRangeBoundsBumped[0];\n          }\n\n          if (yRange[1] < yRangeBoundsBumped[1]) {\n            yRange[0] += Math.abs(yRange[1] - yRangeBoundsBumped[1]);\n            yRange[1] = yRangeBoundsBumped[1];\n          }\n        }\n\n        if (_this.model.marker.axis_x.scaleType === \"ordinal\") {\n          _this.xScale.rangeBands(xRange);\n        } else {\n          _this.xScale.range(xRange);\n        }\n\n        if (_this.model.marker.axis_y.scaleType === \"ordinal\") {\n          _this.yScale.rangeBands(yRange);\n        } else {\n          _this.yScale.range(yRange);\n        }\n\n        const formatter = function(n) {\n          return utils.isDate(n) ? n : +n.toFixed(2);\n        };\n\n        const zoomedXRange = xRangeBoundsBumped;\n        const zoomedYRange = yRangeBoundsBumped;\n\n        /*\n         * Set the zoomed min/max to the correct value depending on if the\n         * min/max values lie within the range bound regions.\n         */\n        /*\n         if(!zoomXOut) {\n         zoomedXRange[0] = xRangeBounds[0] > xRange[0] ? xRangeBounds[0] : xRange[0];\n         zoomedXRange[1] = xRangeBounds[1] < xRange[1] ? xRangeBounds[1] : xRange[1];\n         }\n\n         if(!zoomYOut) {\n         zoomedYRange[0] = yRangeBounds[0] < yRange[0] ? yRangeBounds[0] : yRange[0];\n         zoomedYRange[1] = yRangeBounds[1] > yRange[1] ? yRangeBounds[1] : yRange[1];\n         }\n         */\n\n        _this._zoomedXYMinMax = {\n          axis_x: {\n            zoomedMin: formatter(_this.xScale.invert(zoomedXRange[0])),\n            zoomedMax: formatter(_this.xScale.invert(zoomedXRange[1]))\n          },\n          axis_y: {\n            zoomedMin: formatter(_this.yScale.invert(zoomedYRange[0])),\n            zoomedMax: formatter(_this.yScale.invert(zoomedYRange[1]))\n          }\n        };\n\n\n        if (!zoomer.dontFeedToState) _this.model.marker.set(_this._zoomedXYMinMax, null, false /*avoid storing it in URL*/);\n\n        const optionsY = _this.yAxis.labelerOptions();\n        const optionsX = _this.xAxis.labelerOptions();\n        optionsY.limitMaxTickNumber = zoom * ratioY < 1.5 ? 8 : zoom * ratioY * 8;\n        optionsX.limitMaxTickNumber = zoom * ratioX < 1.5 ? 8 : zoom * ratioX * 8;\n        optionsY.transitionDuration = zoomer.duration;\n        optionsX.transitionDuration = zoomer.duration;\n\n        _this.xAxisEl.call(_this.xAxis.labelerOptions(optionsX));\n        _this.yAxisEl.call(_this.yAxis.labelerOptions(optionsY));\n        _this.redrawDataPoints(zoomer.duration);\n        _this._trails.run(\"resize\", null, zoomer.duration);\n\n        zoomer.duration = 0;\n      },\n\n      stop() {\n        _this.chartSvg.classed(\"vzb-zooming\", false);\n\n        _this.draggingNow = false;\n\n        // if (this.quitZoom) return;\n\n        //Force the update of the URL and history, with the same values\n        if (!zoomer.dontFeedToState) _this.model.marker.set(_this._zoomedXYMinMax, true, true);\n        zoomer.dontFeedToState = null;\n      }\n    };\n  },\n\n  expandCanvas(duration) {\n    const _this = this.context;\n    if (!duration) duration = _this.duration;\n\n    //d3 extent returns min and max of the input array as [min, max]\n    const mmX = d3.extent(utils.values(_this.frame.axis_x));\n    const mmY = d3.extent(utils.values(_this.frame.axis_y));\n\n    //protection agains unreasonable min-max results -- abort function\n    if (!mmX[0] && mmX[0] !== 0 || !mmX[1] && mmX[1] !== 0 || !mmY[0] && mmY[0] !== 0 || !mmY[1] && mmY[1] !== 0) {\n      return utils.warn(\"panZoom.expandCanvas: X or Y min/max are broken. Aborting with no action\");\n    }\n    /*\n     * Use a range bumped scale to correctly accommodate the range bump\n     * gutter.\n     */\n    const suggestedFrame = {\n      x1: _this.xScale(mmX[0]),\n      y1: _this.yScale(mmY[0]),\n      x2: _this.xScale(mmX[1]),\n      y2: _this.yScale(mmY[1])\n    };\n    const xBounds = [0, _this.width];\n    const yBounds = [_this.height, 0];\n\n    // Get the current zoom frame based on the current dimensions.\n    const frame = {\n      x1: xBounds[0],\n      x2: xBounds[1],\n      y1: yBounds[0],\n      y2: yBounds[1]\n    };\n\n    const TOLERANCE = 0.0;\n\n    /*\n     * If there is no current zoom frame, or if any of the suggested frame\n     * points extend outside of the current zoom frame, then expand the\n     * canvas.\n     */\n    if (!_this.isCanvasPreviouslyExpanded ||\n      suggestedFrame.x1 < frame.x1 * (1 - TOLERANCE) || suggestedFrame.x2 > frame.x2 * (1 + TOLERANCE) ||\n      suggestedFrame.y2 < frame.y2 * (1 - TOLERANCE) || suggestedFrame.y1 > frame.y1 * (1 + TOLERANCE)) {\n      /*\n       * If there is already a zoom frame, then clamp the suggested frame\n       * points to only zoom out and expand the canvas.\n       *\n       * If any of x1, x2, y1, or y2 is within the current frame\n       * boundaries, then clamp them to the frame boundaries. If any of\n       * the above values will translate into a data value that is outside\n       * of the possible data range, then clamp them to the frame\n       * coordinate that corresponds to the maximum data value that can\n       * be displayed.\n       */\n      if (_this.isCanvasPreviouslyExpanded) {\n        /*\n         * Calculate bounds and bumped scale for calculating the data boundaries\n         * to which the suggested frame points need to be clamped.\n         */\n        const xBoundsBumped = _this._rangeBump(xBounds);\n        const yBoundsBumped = _this._rangeBump(yBounds);\n\n        if (suggestedFrame.x1 > xBoundsBumped[0]) suggestedFrame.x1 = xBoundsBumped[0];\n        if (suggestedFrame.x2 < xBoundsBumped[1]) suggestedFrame.x2 = xBoundsBumped[1];\n        if (suggestedFrame.y1 < yBoundsBumped[0]) suggestedFrame.y1 = yBoundsBumped[0];\n        if (suggestedFrame.y2 > yBoundsBumped[0]) suggestedFrame.y2 = yBoundsBumped[1];\n      }\n\n      _this.isCanvasPreviouslyExpanded = true;\n      this._zoomOnRectangle(_this.element, suggestedFrame.x1, suggestedFrame.y1,\n        suggestedFrame.x2, suggestedFrame.y2, false, duration);\n    } else {\n      _this.redrawDataPoints(duration);\n    }\n  },\n\n  zoomToMaxMin(zoomedMinX, zoomedMaxX, zoomedMinY, zoomedMaxY, duration, dontFeedToState) {\n    const _this = this.context;\n    let minX = zoomedMinX;\n    let maxX = zoomedMaxX;\n    let minY = zoomedMinY;\n    let maxY = zoomedMaxY;\n\n    const xDomain = _this.xScale.domain();\n    const yDomain = _this.yScale.domain();\n\n    /*\n     * Prevent zoomout if only one of zoom edges set outside domain\n     */\n    if (minX < xDomain[0] && maxX < xDomain[1]) minX = xDomain[0];\n    if (minX > xDomain[0] && maxX > xDomain[1]) maxX = xDomain[1];\n    if (minY < yDomain[0] && maxY < yDomain[1]) minY = yDomain[0];\n    if (minY > yDomain[0] && maxY > yDomain[1]) maxY = yDomain[1];\n\n\n    const xRange = [_this.xScale(minX), _this.xScale(maxX)];\n    const yRange = [_this.yScale(minY), _this.yScale(maxY)];\n\n\n    this._zoomOnRectangle(_this.element, xRange[0], yRange[0], xRange[1], yRange[1], false, duration, dontFeedToState);\n  },\n\n  _zoomOnRectangle(element, zoomedX1, zoomedY1, zoomedX2, zoomedY2, compensateDragging, duration, dontFeedToState) {\n    const _this = this.context;\n    const zoomer = this.zoomer;\n    const transform = d3.zoomTransform(this.zoomSelection.node());\n\n    const x1 = zoomedX1;\n    const y1 = zoomedY1;\n    const x2 = zoomedX2;\n    const y2 = zoomedY2;\n\n    /*\n     * When dragging to draw a rectangle, the translate vector has (x2 - x1)\n     * added to zoomer.translate()[0], and (y2 - 1) added to\n     * zoomer.translate()[1].\n     *\n     * We need to compensate for this addition when\n     * zooming with a rectangle, because zooming with a rectangle will\n     * update the translate vector with new values based on the rectangle\n     * dimensions.\n     */\n    if (compensateDragging) {\n      transform.translate(\n        x1 - x2,\n        y1 - y2\n      );\n      // zoomer.translate([\n      //     zoomer.translate()[0] + x1 - x2,\n      //     zoomer.translate()[1] + y1 - y2\n      // ]);\n    }\n\n    const xRangeBounds = [0, _this.width];\n    const yRangeBounds = [_this.height, 0];\n\n    const xRangeBoundsBumped = _this._rangeBump(xRangeBounds);\n    const yRangeBoundsBumped = _this._rangeBump(yRangeBounds);\n\n    const minZoom = zoomer.scaleExtent()[0];\n    const maxZoom = zoomer.scaleExtent()[1];\n    let zoom, ratioX, ratioY;\n\n    if (x1 == x2 || y1 == y2 || xRangeBoundsBumped[0] == xRangeBoundsBumped[1] || yRangeBoundsBumped[0] == yRangeBoundsBumped[1]) {\n      return utils.warn(\"_zoomOnRectangle(): can not proceed because this may result in infinity zooms\");\n    }\n\n    if (Math.abs(x1 - x2) > Math.abs(y1 - y2)) {\n      zoom = Math.abs(yRangeBoundsBumped[0] - yRangeBoundsBumped[1]) / Math.abs(y1 - y2) * transform.k;\n\n      /*\n       * Clamp the zoom scalar to the maximum zoom allowed before\n       * calculating the next ratioX and ratioY.\n       */\n      if (zoom < minZoom) {\n        zoomer.ratioY *= zoom / transform.k;\n        zoom = minZoom;\n      }\n      if (zoom > maxZoom) zoom = maxZoom;\n\n      ratioX = Math.abs(xRangeBoundsBumped[0] - xRangeBoundsBumped[1]) / Math.abs(x1 - x2) * transform.k / zoom * zoomer.ratioX;\n      ratioY = zoomer.ratioY;\n    } else {\n      zoom = Math.abs(xRangeBoundsBumped[0] - xRangeBoundsBumped[1]) / Math.abs(x1 - x2) * transform.k;\n\n      /*\n       * Clamp the zoom scalar to the maximum zoom allowed before\n       * calculating the next ratioX and ratioY.\n       */\n      if (zoom < minZoom) {\n        zoomer.ratioX *= zoom / transform.k;\n        zoom = minZoom;\n      }\n      if (zoom > maxZoom) zoom = maxZoom;\n\n      ratioY = Math.abs(yRangeBoundsBumped[0] - yRangeBoundsBumped[1]) / Math.abs(y1 - y2) * transform.k / zoom * zoomer.ratioY;\n      ratioX = zoomer.ratioX;\n    }\n\n    const pan = [\n      (transform.x - Math.min(x1, x2)) / transform.k / zoomer.ratioX * zoom * ratioX + (xRangeBoundsBumped[0] - xRangeBounds[0]),\n      (transform.y - Math.min(y1, y2)) / transform.k / zoomer.ratioY * zoom * ratioY + (yRangeBoundsBumped[1] - yRangeBounds[1])\n    ];\n\n    zoomer.dontFeedToState = dontFeedToState;\n    //zoomer.scale(zoom);\n    zoomer.ratioY = ratioY || 1; //NaN defaults to 1\n    zoomer.ratioX = ratioX || 1; //NaN defaults to 1\n    //zoomer.translate(pan);\n    zoomer.duration = duration ? duration : 0;\n\n    //zoomer.event(element);\n    this.zoomSelection.call(zoomer.transform, d3.zoomIdentity.translate(pan[0], pan[1]).scale(zoom));\n  },\n\n  /*\n   * Incrementally zoom in or out and pan the view so that it never looses the point where click happened\n   * this function is a modified d3's own zoom behavior on double click\n   * for the original code see https://github.com/mbostock/d3/blob/master/src/behavior/zoom.js\n   * function dblclicked() and what it refers to\n   */\n  zoomByIncrement(direction, duration) {\n    const _this = this.context;\n    const transform = d3.zoomTransform(this.zoomSelection.node());\n\n    let ratio = transform.k;\n    const pan = [transform.x, transform.y];\n\n    const mouse = d3.mouse(this.zoomSelection.node());\n    let k = Math.log(ratio) / Math.LN2;\n\n    //change factor direction based on the input. default is no direction supplied\n    if (direction == \"plus\" || !direction) k = Math.floor(k) + 1;\n    if (direction == \"minus\") k = Math.ceil(k) - 1;\n\n    //decode panning\n    let locus = [(mouse[0] - pan[0]) / ratio, (mouse[1] - pan[1]) / ratio];\n\n    //recalculate zoom ratio\n    const scaleExtent = this.zoomer.scaleExtent();\n    if (ratio == scaleExtent[0]) {\n      this.zoomer.ratioY = 1;\n      this.zoomer.ratioX = 1;\n    }\n    ratio = Math.max(scaleExtent[0], Math.min(scaleExtent[1], Math.pow(2, k)));\n\n    //recalculate panning\n    locus = [locus[0] * ratio + pan[0], locus[1] * ratio + pan[1]];\n    pan[0] += mouse[0] - locus[0];\n    pan[1] += mouse[1] - locus[1];\n\n    //save changes to the zoom behavior and run the event\n    //this.zoomer.scale(ratio);\n    //this.zoomer.translate([pan[0], pan[1]]);\n    this.zoomer.duration = duration || 0;\n    //this.zoomer.event(_this.element);\n    this.zoomSelection.call(this.zoomer.transform, d3.zoomIdentity.translate(pan[0], pan[1]).scale(ratio));\n\n  },\n\n\n  /*\n   * Reset zoom values without triggering a zoom event.\n   */\n  resetZoomState(element) {\n    //this.zoomer.scaleTo(element, 1);\n    this.zoomer.ratioY = 1;\n    this.zoomer.ratioX = 1;\n    //this.zoomer.translate([0, 0]);\n    (element || this.zoomSelection).property(\"__zoom\", d3.zoomIdentity);\n  },\n\n  reset(element, duration) {\n    const _this = this.context;\n    _this.isCanvasPreviouslyExpanded = false;\n\n    //this.zoomer.scale(1);\n    this.zoomer.ratioY = 1;\n    this.zoomer.ratioX = 1;\n    //this.zoomer.translate([0, 0]);\n    this.zoomer.duration = duration || 0;\n    //this.zoomer.event(element || _this.element);\n    (element || this.zoomSelection).call(this.zoomer.transform, d3.zoomIdentity);\n  },\n\n  rerun(element) {\n    const _this = this.context;\n    //this.zoomer.event(element || _this.element);\n    (element || this.zoomSelection).call(this.zoomer.scaleBy, 1);\n  },\n\n  zoomSelection(element) {\n    this.zoomSelection = element;\n  }\n\n});\n\nexport default PanZoom;\n\n\n// WEBPACK FOOTER //\n// ./src/panzoom.js","\nimport cssEscape from \"css.escape\";\n\nconst { utils } = Vizabi;\n\nconst Trail = Vizabi.Class.extend({\n\n  init(context) {\n    this.context = context;\n    this._isCreated = null;\n    this.actionsQueue = {};\n    this.entityTrails = {};\n    this.trailsData = [];\n    this.trailsInProgress = {};\n    this.activePromises = {};\n    this.trailTransitions = {};\n    this.delayedIterations = {};\n    this.drawingQueue = {};\n  },\n\n  toggle(arg) {\n    const _context = this.context;\n    if (arg) {\n\n      _context._trails.create().then(() => {\n        _context._trails.run([\"findVisible\", \"reveal\", \"opacityHandler\"]);\n      });\n    } else {\n      _context._trails.run(\"remove\");\n      _context.model.marker.select.forEach(d => {\n        delete d.trailStartTime;\n      });\n    }\n  },\n\n  create(selection) {\n    const _context = this.context;\n    const _this = this;\n    const KEY = _context.KEY;\n    const TIMEDIM = _context.TIMEDIM;\n    this._isCreated = new Promise((resolve, reject) => {\n      //quit if the function is called accidentally\n      if (!_context.model.ui.chart.trails) return;\n\n      const timePoints = _context.model.time.getAllSteps();\n\n      //work with marker.select (all selected entities), if no particular selection is specified\n      const promises = [];\n      selection = selection == null ? _context.model.marker.select : [selection];\n      _this._clearActions(selection);\n      _this.trailsData = _context.model.marker.select.map(d => {\n        const r = {\n          status: \"created\",\n          selectedEntityData: d\n        };\n        r[KEY] = d[KEY];\n        return r;\n      });\n      _this.trailTransitions = {};\n      const _trails = _context.bubbleContainer.selectAll(\"g.vzb-bc-entity.entity-trail\")\n        .data(_this.trailsData, d => (d[KEY]));\n\n      _trails.exit().remove();\n      _trails.enter()\n        .insert(\"g\", function(d) {\n          return this.querySelector(\".bubble-\" + cssEscape(d[KEY]));\n        })\n        .attr(\"class\", d => \"vzb-bc-entity entity-trail trail-\" + d[KEY])\n        .merge(_trails)\n        .each(function(d, index) {\n          // used for prevent move trail start time forward when we have empty values at end of time range\n          const trail = this;\n          promises.push(new Promise((resolve, reject) => {\n            const trailSegmentData = timePoints.map(m => ({\n              t: m,\n              key: d[KEY]\n            }));\n            const entityTrails = d3.select(trail).selectAll(\"g\")\n              .data(trailSegmentData)\n              .classed(\"vzb-invisible\", true);\n\n            entityTrails.exit().remove();\n\n            _this.entityTrails[d[KEY]] = entityTrails.enter().append(\"g\")\n              .attr(\"class\", \"vzb-bc-trailsegment vzb-invisible\")\n              .on(\"mouseover\", function(segment, index) {\n                if (utils.isTouchDevice()) return;\n\n                const pointer = {};\n                pointer[KEY] = segment.key;\n                pointer[TIMEDIM] = segment.t;\n\n                _context._axisProjections(pointer);\n                _context._labels.highlight(d, true);\n                const text = _context.model.time.formatDate(segment.t);\n                const selectedData = utils.find(_context.model.marker.select, f => f[KEY] == d[KEY]);\n                _context.model.marker.getFrame(pointer[TIMEDIM], values => {\n                  const x = _context.xScale(values.axis_x[pointer[KEY]]);\n                  const y = _context.yScale(values.axis_y[pointer[KEY]]);\n                  const s = utils.areaToRadius(_context.sScale(values.size[pointer[KEY]]));\n                  const c = values.color[pointer[KEY]] != null ? _context.cScale(values.color[pointer[KEY]]) : _context.COLOR_WHITEISH;\n                  if (text !== selectedData.trailStartTime) {\n                    _context._setTooltip(text, x, y, s + 3, c);\n                  }\n                  _context._setBubbleCrown(x, y, s, c);\n                  _context.model.marker.getModelObject(\"highlight\").trigger(\"change\", {\n                    \"size\": values.size[pointer[KEY]],\n                    \"color\": values.color[pointer[KEY]]\n                  });\n                });\n                //change opacity to OPACITY_HIGHLT = 1.0;\n                d3.select(this).style(\"opacity\", 1.0);\n              })\n              .on(\"mouseout\", function(segment, index) {\n                if (utils.isTouchDevice()) return;\n                _context._axisProjections();\n                _context._setTooltip();\n                _context._setBubbleCrown();\n                _context._labels.highlight(null, false);\n                _context.model.marker.getModelObject(\"highlight\").trigger(\"change\", null);\n                d3.select(this).style(\"opacity\", _context.model.marker.opacityRegular);\n              })\n              .each(function(segment, index) {\n                const view = d3.select(this);\n                view.append(\"circle\");\n                view.append(\"line\");\n              })\n              .merge(entityTrails);\n            resolve();\n          }));\n        });\n      if (promises.length > 0) {\n        Promise.all(promises).then(segments => {\n          resolve(true);\n        });\n      } else {\n        resolve(true);\n      }\n    });\n    return this._isCreated;\n  },\n\n  /**\n   * add actions for each selected entities\n   * @param selections\n   * @param actions\n   * @private\n   */\n  _addActions(selections, actions) {\n    const _context = this.context;\n    const _this = this;\n    const KEY = _context.KEY;\n\n    selections.forEach(d => {\n      if (!_this.actionsQueue[d[KEY]]) _this.actionsQueue[d[KEY]] = [];\n      _this.actionsQueue[d[KEY]] = [].concat(_this.actionsQueue[d[KEY]].filter(value => actions.indexOf(value) == -1), actions);\n    });\n  },\n\n  _clearActions(selections) {\n    const _context = this.context;\n    const _this = this;\n    const KEY = _context.KEY;\n\n    selections.forEach(d => {\n      if (!_this.actionsQueue[d[KEY]]) _this.actionsQueue[d[KEY]] = [];\n      _this.actionsQueue[d[KEY]] = [];\n      _this.drawingQueue[d[KEY]] = {};\n      _this.delayedIterations[d[KEY]] = {};\n      if (!_this.activePromises[d[KEY]]) _this.activePromises[d[KEY]] = [];\n      utils.forEach(_this.activePromises[d[KEY]], (promise, key) => {\n        if (promise.status === \"pending\") promise.reject();\n      });\n      _this.trailsInProgress[d[KEY]] = null;\n      _this.activePromises[d[KEY]] = [];\n    });\n  },\n\n  _getNextAction(key) {\n    return this.actionsQueue[key].shift();\n  },\n\n  run(actions, selection, duration) {\n    const _context = this.context;\n    const _this = this;\n    const KEY = _context.KEY;\n    if (!this._isCreated || _context.model.time.splash) return;\n    if (typeof actions === \"string\") actions = [actions];\n\n    this._isCreated.then(() => {\n      //quit if function is called accidentally\n      if ((!_context.model.ui.chart.trails || !_context.model.marker.select.length) && actions != \"remove\") return;\n\n      if (!duration) duration = 0;\n\n      //work with marker.select (all selected entities), if no particular selection is specified\n      selection = selection == null ? _context.model.marker.select : [selection];\n      for (let i = 0; i < actions.length; i++) {\n        if ([\"resize\", \"recolor\", \"remove\"].indexOf(actions[i]) != -1) {\n          const action = actions.splice(i, 1).pop();\n          --i;\n          _this.trailsData.forEach(d => {\n            const trail = _this.entityTrails[d[KEY]];\n            _context._trails[\"_\" + action](trail, duration, d);\n          });\n        }\n      }\n      if (actions.length == 0) {\n        return;\n      }\n      _this._addActions(selection, actions);\n      _this.trailsData.forEach(d => {\n        if (actions.indexOf(\"findVisible\") != -1) {\n          _this.drawingQueue[d[KEY]] = {};\n          _this.delayedIterations[d[KEY]] = {};\n        }\n        const trail = _this.entityTrails[d[KEY]];\n        //do all the actions over \"trail\"\n        const executeSequential = function(index) { // some function can be async, but we should run next when previous completed\n          const action = _this._getNextAction(d[KEY]);\n          if (action) {\n            _this.trailsInProgress[d[KEY]] = action;\n            const response = _context._trails[\"_\" + action](trail, duration, d);\n            if (response && response instanceof Promise) {\n              response.then(() => {\n                _this.trailsInProgress[d[KEY]] = null;\n                executeSequential(index + 1);\n              }, () => {\n                _this.trailsInProgress[d[KEY]] = null;\n              });\n            } else {\n              _this.trailsInProgress[d[KEY]] = null;\n              executeSequential(index + 1);\n            }\n          }\n        };\n        if (!_this.trailsInProgress[d[KEY]]) {\n          executeSequential(0);\n        }\n      });\n    });\n\n  },\n\n\n  _remove(trail, duration, d) {\n    this.actionsQueue[d[this.context.KEY]] = [];\n    if (trail) { // TODO: in some reason run twice\n      d3.select(this.entityTrails[d[this.context.KEY]].node().parentNode).remove();\n      this.entityTrails[d[this.context.KEY]] = null;\n    }\n  },\n\n  _resize(trail, duration, d) {\n    const _context = this.context;\n    if (_context.model.time.splash) {\n      return;\n    }\n//    this._isCreated.then(function() {\n    let updateLabel = false;\n\n    trail.each(function(segment, index) {\n\n      if (segment.valueY == null || segment.valueX == null || segment.valueS == null) return;\n\n      const view = d3.select(this);\n      if (duration) {\n        view.select(\"circle\")\n          .transition().duration(duration).ease(d3.easeLinear)\n          .attr(\"cy\", _context.yScale(segment.valueY))\n          .attr(\"cx\", _context.xScale(segment.valueX))\n          .attr(\"r\", utils.areaToRadius(_context.sScale(segment.valueS)));\n      } else {\n        view.select(\"circle\").interrupt()\n          .attr(\"cy\", _context.yScale(segment.valueY))\n          .attr(\"cx\", _context.xScale(segment.valueX))\n          .attr(\"r\", utils.areaToRadius(_context.sScale(segment.valueS)))\n          .transition();\n      }\n\n      if (!updateLabel && !segment.transparent) {\n        updateLabel = true;\n        _context._labels.updateLabelOnlyPosition(d, null, { \"scaledS0\": utils.areaToRadius(_context.sScale(segment.valueS)) });\n      }\n\n      if (!segment.next) return;\n      const next = segment.next;\n      if (next == null) return;\n      if (next.valueY == null || next.valueX == null) return;\n\n      const lineLength = Math.sqrt(\n        Math.pow(_context.xScale(segment.valueX) - _context.xScale(next.valueX), 2) +\n        Math.pow(_context.yScale(segment.valueY) - _context.yScale(next.valueY), 2)\n      );\n      if (duration) {\n        view.select(\"line\")\n          .transition().duration(duration).ease(d3.easeLinear)\n          .attr(\"x1\", _context.xScale(next.valueX))\n          .attr(\"y1\", _context.yScale(next.valueY))\n          .attr(\"x2\", _context.xScale(segment.valueX))\n          .attr(\"y2\", _context.yScale(segment.valueY))\n          .attr(\"stroke-dasharray\", lineLength)\n          .attr(\"stroke-dashoffset\", utils.areaToRadius(_context.sScale(segment.valueS)));\n      } else {\n        view.select(\"line\").interrupt()\n          .attr(\"x1\", _context.xScale(next.valueX))\n          .attr(\"y1\", _context.yScale(next.valueY))\n          .attr(\"x2\", _context.xScale(segment.valueX))\n          .attr(\"y2\", _context.yScale(segment.valueY))\n          .attr(\"stroke-dasharray\", lineLength)\n          .attr(\"stroke-dashoffset\", utils.areaToRadius(_context.sScale(segment.valueS)))\n          .transition();\n      }\n    });\n  },\n\n  _recolor(trail, duration, d) {\n    const _context = this.context;\n\n    trail.each(function(segment, index) {\n\n      const view = d3.select(this);\n\n      const strokeColor = _context.model.marker.color.which == \"geo.world_4region\" ?\n        //use predefined shades for color palette for \"geo.world_4region\" (hardcoded)\n        _context.model.marker.color.getColorShade({\n          colorID: segment.valueC,\n          shadeID: \"shade\"\n        })\n        :\n        //otherwise use color of the bubble with a fallback to bubble stroke color (blackish)\n        (segment.valueC != null ? _context.cScale(segment.valueC) : _context.COLOR_BLACKISH);\n\n      view.select(\"circle\")\n      //.transition().duration(duration).ease(d3.easeLinear)\n        .style(\"fill\", segment.valueC != null ? _context.cScale(segment.valueC) : _context.COLOR_WHITEISH);\n      view.select(\"line\")\n      //.transition().duration(duration).ease(d3.easeLinear)\n        .style(\"stroke\", strokeColor);\n    });\n  },\n\n  _opacityHandler(trail, duration, d) {\n    const _context = this.context;\n\n    trail.each(function(segment, index) {\n\n      const view = d3.select(this);\n\n      view\n      //.transition().duration(duration).ease(d3.easeLinear)\n        .style(\"opacity\", d.opacity || _context.model.marker.opacityRegular);\n    });\n  },\n\n\n  _findVisible(trail, duration, d) {\n    const _context = this.context;\n    const _this = this;\n    const KEY = _context.KEY;\n    return new Promise((resolve, reject) => {\n      new Promise((resolve1, reject1) => {\n        if (!d.limits) {\n          _context.model.marker.getEntityLimits(d[KEY]).then(limits => {\n            d.limits = limits;\n            resolve1();\n          });\n        } else {\n          resolve1();\n        }\n      }).then(() => {\n        if (!d.selectedEntityData.trailStartTime) {\n          d.selectedEntityData.trailStartTime = _context.model.time.formatDate(_context.time);\n        }\n        let trailStartTime = _context.model.time.parse(\"\" + d.selectedEntityData.trailStartTime);\n        if (_context.time - trailStartTime < 0 || d.limits.min - trailStartTime > 0) {\n          if (_context.time - trailStartTime < 0) {\n            // move trail start time with trail label back if need\n            d.selectedEntityData.trailStartTime = _context.model.time.formatDate(d3.max([_context.time, d.limits.min]));\n            trailStartTime = _context.model.time.parse(\"\" + d.selectedEntityData.trailStartTime);\n          } else {\n            // move trail start time with trail label to start time if need\n            d.selectedEntityData.trailStartTime = _context.model.time.formatDate(d.limits.min);\n            trailStartTime = _context.model.time.parse(\"\" + d.selectedEntityData.trailStartTime);\n          }\n          const cache = _context._labels.cached[d[KEY]];\n          const valueS = _context.frame.size[d[KEY]];\n          const valueC = _context.frame.color[d[KEY]];\n          cache.labelX0 = _context.frame.axis_x[d[KEY]];\n          cache.labelY0 = _context.frame.axis_y[d[KEY]];\n          cache.scaledS0 = (valueS || valueS === 0) ? utils.areaToRadius(_context.sScale(valueS)) : null;\n          cache.scaledC0 = valueC != null ? _context.cScale(valueC) : _context.COLOR_WHITEISH;\n          _context._updateLabel(d, 0, _context.frame.axis_x[d[KEY]], _context.frame.axis_y[d[KEY]], _context.frame.size[d[KEY]], _context.frame.color[d[KEY]], _context.frame.label[d[KEY]], _context.frame.size_label[d[KEY]], 0, true);\n        }\n        trail.each((segment, index) => {\n          // segment is transparent if it is after current time or before trail StartTime\n          const segmentVisibility = segment.transparent;\n          segment.transparent = d.selectedEntityData.trailStartTime == null || (segment.t - _context.time > 0) || (trailStartTime - segment.t > 0)\n            //no trail segment should be visible if leading bubble is shifted backwards, beyond start time\n            || (d.selectedEntityData.trailStartTime - _context.model.time.formatDate(_context.time) >= 0);\n          // always update nearest 2 points\n          if (segmentVisibility != segment.transparent || Math.abs(_context.model.time.formatDate(segment.t) - _context.model.time.formatDate(_context.time)) < 2) segment.visibilityChanged = true; // segment changed, so need to update it\n          if (segment.transparent) {\n            d3.select(trail._groups[0][index]).classed(\"vzb-invisible\", segment.transparent);\n          }\n        });\n        _this.drawingQueue[d[KEY]] = {};\n        _this.delayedIterations[d[KEY]] = {};\n        resolve();\n      });\n    });\n  },\n\n  _abortAnimation() {\n    const _context = this.context;\n    const _this = this;\n    const KEY = _context.KEY;\n    _this.trailsData.forEach(d => {\n      if (_this.trailTransitions[d[KEY]]) {\n        _this.trailTransitions[d[KEY]].select(\"line\").interrupt().transition();\n      }\n    });\n  },\n\n  _reveal(trail, duration, d) {\n    const _context = this.context;\n    if(_context.model.time.playing) duration = _context.model.time.delay;\n    const _this = this;\n    const KEY = _context.KEY;\n    d.status = \"reveal\";\n    const trailStartTime = _context.model.time.parse(\"\" + d.selectedEntityData.trailStartTime);\n    const generateTrailSegment = function(trail, index, nextIndex, level) {\n      return new Promise((resolve, reject) => {\n        const view = d3.select(trail._groups[0][index]);\n\n        const segment = view.datum();\n\n        //console.log(d[KEY] + \" transparent: \" + segment.transparent + \" vis_changed:\" + segment.visibilityChanged);\n        if (nextIndex - index == 1) {\n          if (segment.transparent) {\n            view.classed(\"vzb-invisible\", segment.transparent);\n            return resolve();\n          } else if (!segment.visibilityChanged) { // pass segment if it is not changed\n            return resolve();\n          }\n        }\n        _context.model.marker.getFrame(segment.t, frame => {\n          if (d.status != \"reveal\") return resolve();\n          if (!frame) return resolve();\n          segment.valueY = frame.axis_y[d[KEY]];\n          segment.valueX = frame.axis_x[d[KEY]];\n          segment.valueS = frame.size[d[KEY]];\n          segment.valueC = frame.color[d[KEY]];\n\n          if (segment.valueY == null || segment.valueX == null || segment.valueS == null) {\n            return resolve();\n          }\n\n          // fix label position if it not in correct place\n          if (trailStartTime && trailStartTime.toString() == segment.t.toString()) {\n            const cache = _context._labels.cached[d[KEY]];\n            cache.labelX0 = segment.valueX;\n            cache.labelY0 = segment.valueY;\n            const valueS = segment.valueS;\n            cache.scaledS0 = (valueS || valueS === 0) ? utils.areaToRadius(_context.sScale(valueS)) : null;\n            cache.scaledC0 = segment.valueC != null ? _context.cScale(segment.valueC) : _context.COLOR_WHITEISH;\n            _context._updateLabel(d, index, segment.valueX, segment.valueY, segment.valueS, segment.valueC, frame.label[d[KEY]], frame.size_label[d[KEY]], 0, true);\n          }\n          view.select(\"circle\")\n          //.transition().duration(duration).ease(d3.easeLinear)\n            .attr(\"cy\", _context.yScale(segment.valueY))\n            .attr(\"cx\", _context.xScale(segment.valueX))\n            .attr(\"r\", utils.areaToRadius(_context.sScale(segment.valueS)))\n            .style(\"fill\", segment.valueC != null ? _context.cScale(segment.valueC) : _context.COLOR_WHITEISH);\n\n          view.select(\"line\")\n            .attr(\"x2\", _context.xScale(segment.valueX))\n            .attr(\"y2\", _context.yScale(segment.valueY))\n            .attr(\"x1\", _context.xScale(segment.valueX))\n            .attr(\"y1\", _context.yScale(segment.valueY));\n\n          // last point should have data for line but it is invisible\n          if (_context.time - segment.t > 0) {\n            segment.visibilityChanged = false;\n            view.classed(\"vzb-invisible\", segment.transparent);\n          } else {\n            view.classed(\"vzb-invisible\", true);\n          }\n\n          if (!trail._groups[0][nextIndex] || _context.time.toString() == segment.t.toString()) {\n            return resolve();\n          }\n\n          const next = d3.select(trail._groups[0][nextIndex]);\n          const nextSegment = next.datum();\n          nextSegment.previous = segment;\n          segment.next = nextSegment;\n          let nextTime = nextSegment.t;\n          if (_context.time - nextSegment.t < 0) { // time is not equal start of year\n            segment.visibilityChanged = true; // redraw needed next time because line not have full length\n            nextTime = _context.time;\n          }\n          _context.model.marker.getFrame(nextTime, nextFrame => {\n            if (d.status != \"reveal\") return resolve();\n            if (!nextFrame || segment.valueY == null || segment.valueX == null || segment.valueS == null) {\n              return resolve();\n            }\n\n            if (nextFrame.axis_x[d[KEY]] == null || nextFrame.axis_y[d[KEY]] == null) {\n              return resolve();\n            }\n\n            nextSegment.valueY = nextFrame.axis_y[d[KEY]];\n            nextSegment.valueX = nextFrame.axis_x[d[KEY]];\n            nextSegment.valueS = nextFrame.size[d[KEY]];\n            nextSegment.valueC = nextFrame.color[d[KEY]];\n\n            _this.trailTransitions[d[KEY]] = view;\n            const strokeColor = _context.model.marker.color.which == \"geo.world_4region\" ?\n              //use predefined shades for color palette for \"geo.world_4region\" (hardcoded)\n              _context.model.marker.color.getColorShade({\n                colorID: segment.valueC,\n                shadeID: \"shade\"\n              })\n              :\n              //otherwise use color of the bubble with a fallback to bubble stroke color (blackish)\n              (segment.valueC != null ? _context.cScale(segment.valueC) : _context.COLOR_BLACKISH);\n\n            const lineLength = Math.sqrt(\n              Math.pow(_context.xScale(segment.valueX) - _context.xScale(nextFrame.axis_x[d[KEY]]), 2) +\n              Math.pow(_context.yScale(segment.valueY) - _context.yScale(nextFrame.axis_y[d[KEY]]), 2)\n            );\n            view.select(\"line\")\n              .attr(\"stroke-dasharray\", lineLength)\n              .attr(\"stroke-dashoffset\", utils.areaToRadius(_context.sScale(segment.valueS)))\n              .style(\"stroke\", strokeColor)\n              .transition().duration(duration).ease(d3.easeLinear)\n              .attr(\"x1\", _context.xScale(nextSegment.valueX))\n              .attr(\"y1\", _context.yScale(nextSegment.valueY))\n              .attr(\"x2\", _context.xScale(segment.valueX))\n              .attr(\"y2\", _context.yScale(segment.valueY));\n            if (nextIndex - index > 1) {\n              addNewIntervals(index, nextIndex);\n              return resolve();\n            }\n            return resolve();\n          });\n        });\n      });\n    };\n    const addPointBetween = function(previousIndex, nextIndex, index) {\n      return new Promise((resolve, reject) => {\n        const previous = d3.select(trail._groups[0][previousIndex]);\n        const next = d3.select(trail._groups[0][nextIndex]);\n        const view = d3.select(trail._groups[0][index]);\n        const previousSegment = previous.datum();\n        const nextSegment = next.datum();\n        const segment = view.datum();\n\n        if ((!previousSegment.previous && !previousSegment.next) || (!nextSegment.previous && !nextSegment.next)) {\n          // segment data cleared by create action\n          return resolve();\n        }\n\n        _context.model.marker.getFrame(segment.t, frame => {\n          if (d.status != \"reveal\") return resolve();\n          if (!frame ||\n            (typeof frame.axis_x === \"undefined\") || frame.axis_x[d[KEY]] == null ||\n            (typeof frame.axis_y === \"undefined\") || frame.axis_y[d[KEY]] == null) {\n            utils.warn(\"Frame for trail missed: \" + segment.t);\n            return resolve();\n          }\n          segment.valueY = frame.axis_y[d[KEY]];\n          segment.valueX = frame.axis_x[d[KEY]];\n          segment.valueS = frame.size[d[KEY]];\n          segment.valueC = frame.color[d[KEY]];\n\n          segment.previous = previousSegment;\n          segment.next = nextSegment;\n          previousSegment.next = segment;\n          nextSegment.previous = segment;\n\n          if (segment.valueY == null || segment.valueX == null || segment.valueS == null) {\n            utils.warn(\"Data for trail point missed: \" + segment.t);\n            return resolve();\n          }\n\n          const strokeColor = _context.model.marker.color.which == \"geo.world_4region\" ?\n            //use predefined shades for color palette for \"geo.world_4region\" (hardcoded)\n            _context.model.marker.color.getColorShade({\n              colorID: segment.valueC,\n              shadeID: \"shade\"\n            })\n            :\n            //otherwise use color of the bubble with a fallback to bubble stroke color (blackish)\n            (segment.valueC != null ? _context.cScale(segment.valueC) : _context.COLOR_BLACKISH);\n\n          const firstLineLength = Math.sqrt(\n            Math.pow(_context.xScale(previousSegment.valueX) - _context.xScale(segment.valueX), 2) +\n            Math.pow(_context.yScale(previousSegment.valueY) - _context.yScale(segment.valueX), 2)\n          );\n\n          previous.select(\"line\")\n            .transition().duration(duration).ease(d3.easeLinear)\n            .attr(\"x1\", _context.xScale(segment.valueX))\n            .attr(\"y1\", _context.yScale(segment.valueY))\n            .attr(\"x2\", _context.xScale(previousSegment.valueX))\n            .attr(\"y2\", _context.yScale(previousSegment.valueY))\n            .attr(\"stroke-dasharray\", firstLineLength)\n            .attr(\"stroke-dashoffset\", utils.areaToRadius(_context.sScale(previousSegment.valueS)))\n            .style(\"stroke\", strokeColor);\n\n          view.classed(\"vzb-invisible\", segment.transparent);\n\n          if (!segment.transparent) {\n            view.select(\"circle\")\n            //.transition().duration(duration).ease(d3.easeLinear)\n              .attr(\"cy\", _context.yScale(segment.valueY))\n              .attr(\"cx\", _context.xScale(segment.valueX))\n              .attr(\"r\", utils.areaToRadius(_context.sScale(segment.valueS)))\n              .style(\"fill\", segment.valueC != null ? _context.cScale(segment.valueC) : _context.COLOR_WHITEISH);\n\n            const secondLineLength = Math.sqrt(\n              Math.pow(_context.xScale(segment.valueX) - _context.xScale(nextSegment.valueX), 2) +\n              Math.pow(_context.yScale(segment.valueY) - _context.yScale(nextSegment.valueY), 2)\n            );\n\n            view.select(\"line\")\n              .transition().duration(duration).ease(d3.easeLinear)\n              .attr(\"x1\", _context.xScale(nextSegment.valueX))\n              .attr(\"y1\", _context.yScale(nextSegment.valueY))\n              .attr(\"x2\", _context.xScale(segment.valueX))\n              .attr(\"y2\", _context.yScale(segment.valueY))\n              .attr(\"stroke-dasharray\", secondLineLength)\n              .attr(\"stroke-dashoffset\", utils.areaToRadius(_context.sScale(segment.valueS)))\n              .style(\"stroke\", strokeColor);\n          }\n          addNewIntervals(previousIndex, index, nextIndex);\n          resolve();\n        });\n      });\n    };\n    const addNewIntervals = function(previousIndex, index, nextIndex) {\n      let mediumIndex;\n      if (index - previousIndex > 1) {\n        mediumIndex = getPointBetween(previousIndex, index);\n        _this.delayedIterations[d[KEY]][previousIndex] = {\n          first: previousIndex,\n          next: index,\n          medium: mediumIndex\n        };\n      }\n      if (nextIndex && nextIndex - index > 1) {\n        mediumIndex = getPointBetween(index, nextIndex);\n        _this.delayedIterations[d[KEY]][index] = {\n          first: index,\n          next: nextIndex,\n          medium: mediumIndex\n        };\n      }\n    };\n    const getPointBetween = function(previous, next) {\n      return Math.round(previous + (next - previous) / 2);\n    };\n\n    const _generateKeys = function(d, trail, div) {\n      const response = [];\n      let min = 0, max = 0;\n      const maxValue = d3.min([d.limits.max, _context.time]);\n      const minValue = d3.max([d.limits.min, _context.model.time.parse(\"\" + d.selectedEntityData.trailStartTime)]);\n      utils.forEach(trail._groups[0], (segment, index) => {\n        const data = segment.__data__;\n        if (data.t - minValue == 0) {\n          min = index;\n        } else if (data.t - maxValue == 0) {\n          max = index;\n        } else {\n          if (data.t > minValue && data.t < maxValue) {\n            if (_context.model.time.formatDate(data.t) % div == 0 || (data.next && data.previous)) {\n              response.push(index);\n            }\n          }\n        }\n      });\n      response.unshift(min);\n      if (max > 0) {\n        response.push(max);\n      }\n      return response;\n    };\n\n    const processPoints = function() {\n      return new Promise((resolve, reject) => {\n        const processPoint = function() {\n          const pointIndex = Object.keys(_this.drawingQueue[d[KEY]])[Math.floor(Math.random() * Object.keys(_this.drawingQueue[d[KEY]]).length)];\n          const point = JSON.parse(JSON.stringify(_this.drawingQueue[d[KEY]][pointIndex]));\n          delete _this.drawingQueue[d[KEY]][pointIndex];\n          addPointBetween(point.first, point.next, point.medium).then(() => {\n            if (Object.keys(_this.drawingQueue[d[KEY]]).length > 0) {\n              processPoint();\n            } else {\n              resolve();\n            }\n          });\n        };\n        if (Object.keys(_this.drawingQueue[d[KEY]]).length > 0) {\n          processPoint(_this.drawingQueue[d[KEY]]);\n        } else {\n          resolve();\n        }\n      });\n    };\n\n    return new Promise((resolve, reject) => {\n      /**\n       * iteration for each point from first segment to last\n       * @param trail\n       * @param index\n       */\n      const generateTrails = function(trail, index) {\n        if (index < 0 || index >= trail._groups[0].length) {\n          return resolve();\n        }\n        generateTrailSegment(trail, index, index + 1).then(() => {\n          generateTrails(trail, index + 1);\n        }, () => resolve());\n      };\n\n      /**\n       * recursive iteration for drawing point between points calculated in previous step\n       */\n      const processPointsBetween = function() {\n        processPoints().then(() => {\n          if (Object.keys(_this.delayedIterations[d[KEY]]).length == 0) {\n            return resolve();\n          }\n          _this.drawingQueue[d[KEY]] = _this.delayedIterations[d[KEY]];\n          _this.delayedIterations[d[KEY]] = {};\n          processPointsBetween();\n        }, () => resolve());\n      };\n\n      if (_context.model.marker.framesAreReady()) {\n        generateTrails(trail, 0);\n      } else {\n        _this.delayedIterations[d[KEY]] = {};\n        _this.drawingQueue[d[KEY]] = {};\n        const trailKeys = _generateKeys(d, trail, 50);\n        const segments = [];\n        if (trailKeys.length <= 1) {\n          return resolve();\n        }\n\n        _this.delayedIterations[d[KEY]] = {};\n        for (let i = 0; i < trailKeys.length - 1; i++) {\n          segments.push(generateTrailSegment(trail, trailKeys[i], trailKeys[i + 1], 1));\n        }\n        Promise.all(segments).then(() => {\n          if (Object.keys(_this.delayedIterations[d[KEY]]).length == 0) {\n            resolve();\n          } else {\n            _this.drawingQueue[d[KEY]] = _this.delayedIterations[d[KEY]];\n            _this.delayedIterations[d[KEY]] = {};\n            processPointsBetween();\n          }\n        }, () => {\n          resolve();\n        });\n      }\n    });\n  }\n});\n\nexport default Trail;\n\n\n\n// WEBPACK FOOTER //\n// ./src/trail.js","/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */\n;(function(root, factory) {\n\t// https://github.com/umdjs/umd/blob/master/returnExports.js\n\tif (typeof exports == 'object') {\n\t\t// For Node.js.\n\t\tmodule.exports = factory(root);\n\t} else if (typeof define == 'function' && define.amd) {\n\t\t// For AMD. Register as an anonymous module.\n\t\tdefine([], factory.bind(root, root));\n\t} else {\n\t\t// For browser globals (not exposing the function separately).\n\t\tfactory(root);\n\t}\n}(typeof global != 'undefined' ? global : this, function(root) {\n\n\tif (root.CSS && root.CSS.escape) {\n\t\treturn root.CSS.escape;\n\t}\n\n\t// https://drafts.csswg.org/cssom/#serialize-an-identifier\n\tvar cssEscape = function(value) {\n\t\tif (arguments.length == 0) {\n\t\t\tthrow new TypeError('`CSS.escape` requires an argument.');\n\t\t}\n\t\tvar string = String(value);\n\t\tvar length = string.length;\n\t\tvar index = -1;\n\t\tvar codeUnit;\n\t\tvar result = '';\n\t\tvar firstCodeUnit = string.charCodeAt(0);\n\t\twhile (++index < length) {\n\t\t\tcodeUnit = string.charCodeAt(index);\n\t\t\t// Note: there’s no need to special-case astral symbols, surrogate\n\t\t\t// pairs, or lone surrogates.\n\n\t\t\t// If the character is NULL (U+0000), then the REPLACEMENT CHARACTER\n\t\t\t// (U+FFFD).\n\t\t\tif (codeUnit == 0x0000) {\n\t\t\t\tresult += '\\uFFFD';\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t// If the character is in the range [\\1-\\1F] (U+0001 to U+001F) or is\n\t\t\t\t// U+007F, […]\n\t\t\t\t(codeUnit >= 0x0001 && codeUnit <= 0x001F) || codeUnit == 0x007F ||\n\t\t\t\t// If the character is the first character and is in the range [0-9]\n\t\t\t\t// (U+0030 to U+0039), […]\n\t\t\t\t(index == 0 && codeUnit >= 0x0030 && codeUnit <= 0x0039) ||\n\t\t\t\t// If the character is the second character and is in the range [0-9]\n\t\t\t\t// (U+0030 to U+0039) and the first character is a `-` (U+002D), […]\n\t\t\t\t(\n\t\t\t\t\tindex == 1 &&\n\t\t\t\t\tcodeUnit >= 0x0030 && codeUnit <= 0x0039 &&\n\t\t\t\t\tfirstCodeUnit == 0x002D\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\t// https://drafts.csswg.org/cssom/#escape-a-character-as-code-point\n\t\t\t\tresult += '\\\\' + codeUnit.toString(16) + ' ';\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t// If the character is the first character and is a `-` (U+002D), and\n\t\t\t\t// there is no second character, […]\n\t\t\t\tindex == 0 &&\n\t\t\t\tlength == 1 &&\n\t\t\t\tcodeUnit == 0x002D\n\t\t\t) {\n\t\t\t\tresult += '\\\\' + string.charAt(index);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// If the character is not handled by one of the above rules and is\n\t\t\t// greater than or equal to U+0080, is `-` (U+002D) or `_` (U+005F), or\n\t\t\t// is in one of the ranges [0-9] (U+0030 to U+0039), [A-Z] (U+0041 to\n\t\t\t// U+005A), or [a-z] (U+0061 to U+007A), […]\n\t\t\tif (\n\t\t\t\tcodeUnit >= 0x0080 ||\n\t\t\t\tcodeUnit == 0x002D ||\n\t\t\t\tcodeUnit == 0x005F ||\n\t\t\t\tcodeUnit >= 0x0030 && codeUnit <= 0x0039 ||\n\t\t\t\tcodeUnit >= 0x0041 && codeUnit <= 0x005A ||\n\t\t\t\tcodeUnit >= 0x0061 && codeUnit <= 0x007A\n\t\t\t) {\n\t\t\t\t// the character itself\n\t\t\t\tresult += string.charAt(index);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Otherwise, the escaped character.\n\t\t\t// https://drafts.csswg.org/cssom/#escape-a-character\n\t\t\tresult += '\\\\' + string.charAt(index);\n\n\t\t}\n\t\treturn result;\n\t};\n\n\tif (!root.CSS) {\n\t\troot.CSS = {};\n\t}\n\n\troot.CSS.escape = cssEscape;\n\treturn cssEscape;\n\n}));\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/css.escape/css.escape.js\n// module id = 4\n// module chunks = 0 1","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/styles.scss\n// module id = 5\n// module chunks = 0 1","module.exports = \"<!-- Bubble Chart Component -->\\n<div class=\\\"vzb-bubblechart\\\">\\n    <svg class=\\\"vzb-bubblechart-svg vzb-export\\\">\\n        <g class=\\\"vzb-bc-graph\\\">\\n            <g class=\\\"vzb-bc-year\\\"></g>\\n\\n            <svg class=\\\"vzb-bc-axis-x\\\"><g></g></svg>\\n            <svg class=\\\"vzb-bc-axis-y\\\"><g></g></svg>\\n            <line class=\\\"vzb-bc-projection-x\\\"></line>\\n            <line class=\\\"vzb-bc-projection-y\\\"></line>\\n\\n            <svg class=\\\"vzb-bc-bubbles-crop\\\">\\n                <g class=\\\"vzb-zoom-selection\\\"></g>\\n                <line class=\\\"vzb-bc-line-equal-xy vzb-invisible\\\"></line>\\n                <rect class=\\\"vzb-bc-eventarea\\\"></rect>\\n                <g class=\\\"vzb-bc-trails\\\"></g>\\n                <g class=\\\"vzb-bc-bubbles\\\"></g>\\n                <g class=\\\"vzb-bc-lines\\\"></g>\\n                <g class=\\\"vzb-bc-bubble-crown vzb-hidden\\\">\\n                    <circle class=\\\"vzb-crown-glow\\\"></circle>\\n                    <circle class=\\\"vzb-crown\\\"></circle>\\n                </g>\\n            </svg>\\n\\n            <g class=\\\"vzb-bc-axis-y-subtitle\\\"></g>\\n            <g class=\\\"vzb-bc-axis-x-subtitle\\\"></g>\\n            <g class=\\\"vzb-bc-axis-y-title\\\"></g>\\n            <g class=\\\"vzb-bc-axis-x-title\\\"></g>\\n            <g class=\\\"vzb-bc-axis-s-title\\\"></g>\\n            <g class=\\\"vzb-bc-axis-c-title\\\"></g>\\n\\n            <g class=\\\"vzb-bc-axis-y-info vzb-noexport\\\"></g>\\n            <g class=\\\"vzb-bc-axis-x-info vzb-noexport\\\"></g>\\n\\n            <svg class=\\\"vzb-bc-labels-crop\\\">\\n                <g class=\\\"vzb-bc-labels\\\"></g>\\n            </svg>\\n\\n            <g class=\\\"vzb-data-warning vzb-noexport\\\">\\n                <svg></svg>\\n                <text></text>\\n            </g>\\n\\n            <rect class=\\\"vzb-bc-zoom-rect\\\"></rect>\\n        </g>\\n    </svg>\\n    <svg>\\n        <defs>\\n            <filter id=\\\"vzb-glow-filter\\\" x=\\\"-50%\\\" y=\\\"-50%\\\" width=\\\"200%\\\" height=\\\"200%\\\">\\n                <feGaussianBlur in=\\\"SourceGraphic\\\" stdDeviation=\\\"2\\\"></feGaussianBlur>\\n            </filter>\\n        </defs>\\n    </svg>\\n    <!-- This could possibly be another component -->\\n    <div class=\\\"vzb-tooltip vzb-hidden vzb-tooltip-mobile\\\"></div>\\n</div>\\n\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/template.html\n// module id = 6\n// module chunks = 0 1","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/global.js\n// module id = 7\n// module chunks = 0 1"],"sourceRoot":""}